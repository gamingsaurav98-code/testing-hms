[{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\block\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isDragOver' is assigned a value but never used.","line":35,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleFileChange' is assigned a value but never used.","line":101,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleDragOver' is assigned a value but never used.","line":149,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleDragLeave' is assigned a value but never used.","line":154,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":154,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleDrop' is assigned a value but never used.","line":159,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":159,"endColumn":19}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { blockApi, BlockFormData, Block, ApiError } from '@/lib/api/index';\r\nimport { getImageUrl } from '@/lib/utils';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SingleImageUploadEdit,\r\n  TableSkeleton,\r\n  ImageModal\r\n} from '@/components/ui';\r\n\r\nexport default function EditBlock() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const blockId = params.id as string;\r\n\r\n  const [formData, setFormData] = useState<BlockFormData>({\r\n    block_name: '',\r\n    location: '',\r\n    manager_name: '',\r\n    manager_contact: '',\r\n    remarks: '',\r\n    block_attachment: null,\r\n  });\r\n  \r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const [currentBlock, setCurrentBlock] = useState<Block | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  // Fetch existing block data\r\n  useEffect(() => {\r\n    const fetchBlockData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        const block = await blockApi.getBlock(blockId);\r\n        setCurrentBlock(block);\r\n        \r\n        setFormData({\r\n          block_name: block.block_name,\r\n          location: block.location,\r\n          manager_name: block.manager_name,\r\n          manager_contact: block.manager_contact,\r\n          remarks: block.remarks,\r\n          block_attachment: null,\r\n        });\r\n\r\n        // Set existing image preview if available\r\n        if (block.block_attachment) {\r\n          const imageUrl = getImageUrl(block.block_attachment);\r\n          setImagePreview(imageUrl);\r\n        }\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching block data:', error);\r\n        if (error instanceof ApiError) {\r\n          setErrors({\r\n            fetch: `Failed to load block: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            fetch: 'Failed to load block data. Please try again.'\r\n          });\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (blockId) {\r\n      fetchBlockData();\r\n    }\r\n  }, [blockId]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      processFile(file);\r\n    }\r\n  };\r\n\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        block_attachment: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        block_attachment: 'File size must be less than 5MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      block_attachment: file\r\n    }));\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.block_attachment) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        block_attachment: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(true);\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n    \r\n    const files = e.dataTransfer.files;\r\n    if (files && files[0]) {\r\n      processFile(files[0]);\r\n    }\r\n  };\r\n\r\n  const removeImage = () => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      block_attachment: null\r\n    }));\r\n    setImagePreview(null);\r\n    const fileInput = document.getElementById('block_attachment') as HTMLInputElement;\r\n    if (fileInput) {\r\n      fileInput.value = '';\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.block_name.trim()) {\r\n      newErrors.block_name = 'Block name is required';\r\n    }\r\n\r\n    if (!formData.location.trim()) {\r\n      newErrors.location = 'Location is required';\r\n    }\r\n\r\n    if (!formData.manager_name.trim()) {\r\n      newErrors.manager_name = 'Manager name is required';\r\n    }\r\n\r\n    if (!formData.manager_contact.trim()) {\r\n      newErrors.manager_contact = 'Manager contact is required';\r\n    } else if (!/^\\d{10}$/.test(formData.manager_contact.trim())) {\r\n      newErrors.manager_contact = 'Please enter a valid 10-digit phone number';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      await blockApi.updateBlock(blockId, formData);\r\n      \r\n      // Redirect to blocks list on success\r\n      router.push('/admin/block');\r\n      \r\n    } catch (error) {\r\n      console.error('Error updating block:', error);\r\n      if (error instanceof ApiError) {\r\n        setErrors({\r\n          submit: `Failed to update block: ${error.message}`\r\n        });\r\n      } else {\r\n        setErrors({\r\n          submit: 'An error occurred while updating the block. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Edit Block</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading block data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/block')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Blocks\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Block</h1>\r\n        </div>\r\n\r\n        {/* Modern Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-800 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n              \r\n              {/* Block Name */}\r\n              <FormField\r\n                name=\"block_name\"\r\n                label=\"Block Name\"\r\n                required\r\n                value={formData.block_name}\r\n                onChange={handleInputChange}\r\n                error={errors.block_name}\r\n                placeholder=\"Enter block name\"\r\n              />\r\n\r\n              {/* Location */}\r\n              <FormField\r\n                name=\"location\"\r\n                label=\"Location\"\r\n                required\r\n                value={formData.location}\r\n                onChange={handleInputChange}\r\n                error={errors.location}\r\n                placeholder=\"Enter location\"\r\n              />\r\n\r\n              {/* Manager Name */}\r\n              <FormField\r\n                name=\"manager_name\"\r\n                label=\"Manager Name\"\r\n                required\r\n                value={formData.manager_name}\r\n                onChange={handleInputChange}\r\n                error={errors.manager_name}\r\n                placeholder=\"Enter manager name\"\r\n              />\r\n\r\n              {/* Manager Contact */}\r\n              <FormField\r\n                name=\"manager_contact\"\r\n                label=\"Manager Contact\"\r\n                required\r\n                value={formData.manager_contact}\r\n                onChange={handleInputChange}\r\n                error={errors.manager_contact}\r\n                placeholder=\"Enter 10-digit phone number\"\r\n              />\r\n\r\n              {/* Remarks - Full Width */}\r\n              <div className=\"lg:col-span-2\">\r\n                <FormField\r\n                  name=\"remarks\"\r\n                  label=\"Remarks\"\r\n                  value={formData.remarks || ''}\r\n                  onChange={handleInputChange}\r\n                  placeholder=\"Enter any additional remarks...\"\r\n                  type=\"textarea\"\r\n                  rows={3}\r\n                />\r\n              </div>\r\n\r\n              {/* File Upload - Full Width */}\r\n              <div className=\"lg:col-span-2 space-y-1\">\r\n                <SingleImageUploadEdit\r\n                  imagePreview={imagePreview}\r\n                  existingImageUrl={getImageUrl(currentBlock?.block_attachment)}\r\n                  onFileSelect={processFile}\r\n                  onRemove={removeImage}\r\n                  error={errors.block_attachment}\r\n                  label=\"Block Image\"\r\n                  onImageClick={(imageUrl, alt) => {\r\n                    setSelectedImage({ url: imageUrl, alt });\r\n                    setImageModalOpen(true);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-2 pt-4 border-t border-gray-200 mt-4\">\r\n              <CancelButton onClick={() => router.push('/admin/block')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Block\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\block\\[id]\\page.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: ')' expected.","line":228,"column":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { blockApi, Block, ApiError } from '@/lib/api/index';\r\nimport { Button, ConfirmModal, TableSkeleton, ImageModal } from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function BlockDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const blockId = params.id as string;\r\n\r\n  const [block, setBlock] = useState<Block | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  // Helper function for placeholder image\r\n  const getPlaceholderImageUrl = (): string => {\r\n    const svg = `\r\n      <svg width=\"200\" height=\"200\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <rect width=\"200\" height=\"200\" fill=\"#f3f4f6\"/>\r\n        <path d=\"M50 150l25-25 25 25 50-50 25 25v25H50v-25z\" fill=\"#d1d5db\"/>\r\n        <circle cx=\"75\" cy=\"75\" r=\"15\" fill=\"#d1d5db\"/>\r\n        <text x=\"100\" y=\"180\" text-anchor=\"middle\" fill=\"#6b7280\" font-family=\"sans-serif\" font-size=\"12\">No Image</text>\r\n      </svg>\r\n    `;\r\n    \r\n    return `data:image/svg+xml;base64,${btoa(svg)}`;\r\n  };\r\n\r\n  // Fetch block data\r\n  useEffect(() => {\r\n    const fetchBlock = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const blockData = await blockApi.getBlock(blockId);\r\n        setBlock(blockData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching block:', error);\r\n        if (error instanceof ApiError) {\r\n          if (error.status === 404) {\r\n            setError(`Block with ID ${blockId} not found. It may have been deleted or the ID is incorrect.`);\r\n          } else {\r\n            setError(`Failed to load block: ${error.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load block data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (blockId) {\r\n      fetchBlock();\r\n    }\r\n  }, [blockId]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const [deleteModal, setDeleteModal] = useState<boolean>(false);\r\n\r\n  const handleDeleteClick = () => {\r\n    setDeleteModal(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      await blockApi.deleteBlock(blockId);\r\n      \r\n      // Redirect to blocks list after successful deletion\r\n      router.push('/admin/block');\r\n    } catch (error) {\r\n      console.error('Error deleting block:', error);\r\n      if (error instanceof ApiError) {\r\n        alert(`Failed to delete block: ${error.message}`);\r\n      } else {\r\n        alert('Failed to delete block. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteModal(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Block Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading block details...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <div className=\"mt-3 space-x-2\">\r\n            <Button\r\n              onClick={() => window.location.reload()}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Retry\r\n            </Button>\r\n            <Button\r\n              onClick={() => router.push('/admin/block')}\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n            >\r\n              Back to Blocks\r\n            </Button>\r\n            <Button\r\n              onClick={async () => {\r\n                try {\r\n                  const response = await blockApi.getBlocks();\r\n                  const availableIds = response.data.map(b => b.id).join(', ');\r\n                  alert(`Available block IDs: ${availableIds}`);\r\n                } catch (err) {\r\n                  alert('Could not fetch available blocks');\r\n                }\r\n              }}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Show Available IDs\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!block) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-500\">Block not found</p>\r\n          <button\r\n            onClick={() => router.push('/admin/block')}\r\n            className=\"mt-2 text-[#235999] hover:text-[#1e4d87]\"\r\n          >\r\n            Back to Blocks\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal}\r\n        title=\"Delete Block\"\r\n        message=\"Are you sure you want to delete this block? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={handleDelete}\r\n        onCancel={() => setDeleteModal(false)}\r\n        isLoading={isDeleting}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-semibold text-gray-900\">{block.block_name}</h1>\r\n            </div>\r\n            <div className=\"flex space-x-2\">\r\n              <Button\r\n                onClick={() => router.push(`/admin/block/${block.id}/edit`)}\r\n                variant=\"primary\"\r\n              >\r\n                Edit Block\r\n              </Button>\r\n              <Button\r\n                onClick={handleDeleteClick}\r\n                disabled={isDeleting}\r\n                variant=\"danger\"\r\n                loading={isDeleting}\r\n              >\r\n                {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <div className=\"p-6\">\r\n            {/* Main Content - Image and Information Side by Side */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n              {/* Block Image */}\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 mb-6\">Block Image</h3>\r\n                <div className=\"border border-gray-200 rounded-lg overflow-hidden bg-gray-50\">\r\n                  <div className=\"flex items-center justify-center p-4 min-h-[300px]\">\r\n                    {block.block_attachment ? (\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted block images use onError and object fallback; native <img> is intentional here */}\r\n                      <img\r\n                        src={getImageUrl(block.block_attachment) || getPlaceholderImageUrl()}\r\n                        alt={block.block_name}\r\n                        className=\"max-w-full max-h-80 object-contain rounded\"\r\n                        onError={(e) => {\r\n                          console.error('Image failed to load for path:', block.block_attachment);\r\n                          if (block.block_attachment) {\r\n                            const fullUrl = getImageUrl(block.block_attachment);\r\n                            console.error('Full image URL:', fullUrl);\r\n                          }\r\n                          const target = e.target as HTMLImageElement;\r\n                          target.src = getPlaceholderImageUrl();\r\n                        }}\r\n                      />\r\n                    ) : (\r\n                      <div className=\"text-center text-gray-500\">\r\n                        <svg className=\"w-20 h-20 mx-auto mb-4 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                        </svg>\r\n                        <p>No image available</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Block Details */}\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 mb-6\">Block Information</h3>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Block Name</h4>\r\n                    <p className=\"text-lg text-gray-900\">{block.block_name}</p>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Location</h4>\r\n                    <p className=\"text-lg text-gray-900\">{block.location}</p>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Manager Name</h4>\r\n                    <p className=\"text-lg text-gray-900\">{block.manager_name}</p>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Manager Contact</h4>\r\n                    <p className=\"text-lg text-gray-900\">{block.manager_contact}</p>\r\n                  </div>\r\n\r\n                  {block.remarks && (\r\n                    <div>\r\n                      <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Remarks</h4>\r\n                      <p className=\"text-gray-900\">{block.remarks}</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Metadata */}\r\n            <div className=\"border-t border-gray-200 mt-8 pt-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n                <div>\r\n                  <span className=\"font-medium text-gray-500\">Created:</span>\r\n                  <span className=\"ml-2 text-gray-900\">{formatDate(block.created_at)}</span>\r\n                </div>\r\n                {block.updated_at && (\r\n                  <div>\r\n                    <span className=\"font-medium text-gray-500\">Last Updated:</span>\r\n                    <span className=\"ml-2 text-gray-900\">{formatDate(block.updated_at)}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\block\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isDragOver' is assigned a value but never used.","line":29,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleFileChange' is assigned a value but never used.","line":49,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleDragOver' is assigned a value but never used.","line":97,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleDragLeave' is assigned a value but never used.","line":102,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleDrop' is assigned a value but never used.","line":107,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":19}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { blockApi, BlockFormData, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SingleImageUploadCreate,\r\n  ImageModal\r\n} from '@/components/ui';\r\n\r\nexport default function CreateBlock() {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState<BlockFormData>({\r\n    block_name: '',\r\n    location: '',\r\n    manager_name: '',\r\n    manager_contact: '',\r\n    remarks: '',\r\n    block_attachment: null,\r\n  });\r\n  \r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      processFile(file);\r\n    }\r\n  };\r\n\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        block_attachment: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        block_attachment: 'File size must be less than 5MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      block_attachment: file\r\n    }));\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.block_attachment) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        block_attachment: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(true);\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n    \r\n    const files = e.dataTransfer.files;\r\n    if (files.length > 0) {\r\n      processFile(files[0]);\r\n    }\r\n  };\r\n\r\n  const removeImage = () => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      block_attachment: null\r\n    }));\r\n    setImagePreview(null);\r\n    \r\n    // Reset file input\r\n    const fileInput = document.getElementById('block_attachment') as HTMLInputElement;\r\n    if (fileInput) {\r\n      fileInput.value = '';\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.block_name.trim()) {\r\n      newErrors.block_name = 'Block name is required';\r\n    }\r\n\r\n    if (!formData.location.trim()) {\r\n      newErrors.location = 'Location is required';\r\n    }\r\n\r\n    if (!formData.manager_name.trim()) {\r\n      newErrors.manager_name = 'Manager name is required';\r\n    }\r\n\r\n    if (!formData.manager_contact.trim()) {\r\n      newErrors.manager_contact = 'Manager contact is required';\r\n    } else if (!/^\\d{10}$/.test(formData.manager_contact.trim())) {\r\n      newErrors.manager_contact = 'Please enter a valid 10-digit phone number';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      await blockApi.createBlock(formData);\r\n      \r\n      // Redirect to blocks list on success\r\n      router.push('/admin/block');\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating block:', error);\r\n      if (error instanceof ApiError) {\r\n        setErrors({\r\n          submit: `Failed to create block: ${error.message}`\r\n        });\r\n      } else {\r\n        setErrors({\r\n          submit: 'An error occurred while creating the block. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create Block</h1>\r\n        </div>\r\n\r\n        {/* Modern Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-700 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"space-y-4\">\r\n              {/* Form Grid */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Block Name */}\r\n                <FormField\r\n                  name=\"block_name\"\r\n                  label=\"Block Name\"\r\n                  required\r\n                  value={formData.block_name}\r\n                  onChange={handleInputChange}\r\n                  error={errors.block_name}\r\n                  placeholder=\"Enter block name\"\r\n                />\r\n\r\n                {/* Location */}\r\n                <FormField\r\n                  name=\"location\"\r\n                  label=\"Location\"\r\n                  required\r\n                  value={formData.location}\r\n                  onChange={handleInputChange}\r\n                  error={errors.location}\r\n                  placeholder=\"Enter location\"\r\n                />\r\n\r\n                {/* Manager Name */}\r\n                <FormField\r\n                  name=\"manager_name\"\r\n                  label=\"Manager Name\"\r\n                  required\r\n                  value={formData.manager_name}\r\n                  onChange={handleInputChange}\r\n                  error={errors.manager_name}\r\n                  placeholder=\"Enter manager name\"\r\n                />\r\n\r\n                {/* Manager Contact */}\r\n                <FormField\r\n                  name=\"manager_contact\"\r\n                  label=\"Manager Contact\"\r\n                  required\r\n                  value={formData.manager_contact}\r\n                  onChange={handleInputChange}\r\n                  error={errors.manager_contact}\r\n                  placeholder=\"Enter phone number\"\r\n                />\r\n              </div>\r\n\r\n              {/* Block Description - Full Width */}\r\n              <FormField\r\n                name=\"remarks\"\r\n                label=\"Description\"\r\n                value={formData.remarks || ''}\r\n                onChange={handleInputChange}\r\n                placeholder=\"Block description (optional)\"\r\n                type=\"textarea\"\r\n                rows={3}\r\n              />\r\n\r\n              {/* Image Upload Component */}\r\n              <div>\r\n                <SingleImageUploadCreate\r\n                  imagePreview={imagePreview}\r\n                  onFileSelect={processFile}\r\n                  onRemove={removeImage}\r\n                  error={errors.block_attachment}\r\n                  label=\"Block Image\"\r\n                  onImageClick={(imageUrl, alt) => {\r\n                    setSelectedImage({ url: imageUrl, alt });\r\n                    setImageModalOpen(true);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex justify-between items-center pt-4 mt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.back()} />\r\n              <SubmitButton \r\n                loading={isSubmitting} \r\n                loadingText=\"Creating...\"\r\n              >\r\n                Create Block\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\block\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCurrentPage' is assigned a value but never used.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalPages' is assigned a value but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { blockApi, Block, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  ConfirmModal, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\n\r\nexport default function BlockList() {\r\n  const router = useRouter();\r\n  const [blocks, setBlocks] = useState<Block[]>([]);\r\n  const [filteredBlocks, setFilteredBlocks] = useState<Block[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, blockId: string | null}>({\r\n    show: false,\r\n    blockId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch blocks from API\r\n  useEffect(() => {\r\n    const fetchBlocks = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await blockApi.getBlocks(currentPage);\r\n        setBlocks(response.data);\r\n        setFilteredBlocks(response.data);\r\n        setTotalPages(response.last_page);\r\n      } catch (error) {\r\n        console.error('Error fetching blocks:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch blocks: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch blocks. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchBlocks();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredBlocks(blocks);\r\n    } else {\r\n      const filtered = blocks.filter(block =>\r\n        block.block_name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        block.location.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        block.manager_name.toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredBlocks(filtered);\r\n    }\r\n  }, [searchQuery, blocks]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: '2-digit',\r\n      year: 'numeric'\r\n    });\r\n  };\r\n\r\n  const truncateText = (text: string, maxLength: number = 15) => {\r\n    if (!text) return 'No description';\r\n    if (text.length <= maxLength) return text;\r\n    return text.substring(0, maxLength) + '...';\r\n  };\r\n\r\n  const handleDeleteBlock = async (blockId: string) => {\r\n    setDeleteModal({show: true, blockId});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const blockId = deleteModal.blockId;\r\n    if (!blockId) return;\r\n\r\n    try {\r\n      setIsDeleting(blockId);\r\n      setDeleteModal({show: false, blockId: null});\r\n      setAlert({show: true, message: 'Deleting block...', type: 'success'});\r\n      \r\n      await blockApi.deleteBlock(blockId);\r\n      \r\n      // Remove from local state\r\n      const updatedBlocks = blocks.filter(block => block.id !== blockId);\r\n      setBlocks(updatedBlocks);\r\n      setFilteredBlocks(updatedBlocks.filter(block =>\r\n        !searchQuery.trim() ||\r\n        block.block_name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        block.location.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        block.manager_name.toLowerCase().includes(searchQuery.toLowerCase())\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Block deleted successfully!', type: 'success'});\r\n      \r\n      // Hide alert after 2 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting block:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({show: true, message: `Failed to delete block: ${error.message}`, type: 'error'});\r\n      } else {\r\n        setAlert({show: true, message: 'Failed to delete block. Please try again.', type: 'error'});\r\n      }\r\n      \r\n      // Hide error alert after 3 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000);\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, blockId: null});\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Blocks</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading blocks...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Block\"\r\n        message=\"Are you sure you want to delete this block? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Header with balanced spacing */}\r\n      <div className=\"flex justify-between items-start mb-8\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-semibold text-gray-900 mb-2\">Blocks</h1>\r\n          <p className=\"text-sm text-gray-600\">{blocks.length} total blocks</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/admin/block/create')}\r\n          icon={<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n          </svg>}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n        >\r\n          Add Block\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search blocks...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredBlocks.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No blocks found' : 'No blocks yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'Create your first block to get started'}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/admin/block/create')}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n            >\r\n              Create Block\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-3 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-2\">Block Details</div>\r\n              <div className=\"col-span-2\">Manager</div>\r\n              <div className=\"col-span-2\">Contact</div>\r\n              <div className=\"col-span-3\">Description</div>\r\n              <div className=\"col-span-2 text-center\">Created</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredBlocks.map((block) => (\r\n              <div key={block.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-3 items-center\">\r\n                  {/* Block Details */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{block.block_name}</div>\r\n                    <div className=\"flex items-center text-xs text-gray-500 mt-1\">\r\n                      <svg className=\"w-3 h-3 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                      </svg>\r\n                      <span className=\"truncate\">{block.location}</span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Manager */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-900 truncate\">{block.manager_name}</div>\r\n                  </div>\r\n\r\n                  {/* Contact */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700 truncate\">{block.manager_contact}</div>\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"text-sm text-gray-600\" title={block.remarks || 'No description'}>\r\n                      {truncateText(block.remarks)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Created Date */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-xs text-gray-500 text-center\">\r\n                      <div className=\"whitespace-nowrap\">\r\n                        {formatDate(block.created_at)}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex justify-center\">\r\n                      <ActionButtons \r\n                        viewUrl={`/admin/block/${block.id}`}\r\n                        editUrl={`/admin/block/${block.id}/edit`}\r\n                        onDelete={() => handleDeleteBlock(block.id)}\r\n                        isDeleting={isDeleting === block.id}\r\n                        style=\"compact\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredBlocks.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredBlocks.length} of {blocks.length} blocks\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\complain\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ImageModal' is defined but never used.","line":7,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":57},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4340,4343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4340,4343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4465,4468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4465,4468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":496,"column":19,"nodeType":"JSXOpeningElement","endLine":517,"endColumn":21,"suppressions":[{"kind":"directive","justification":"complaint attachment preview uses native <img> for onClick zoom and onError behavior"}]}],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { complainApi, Complain } from '@/lib/api/complain.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { Button, ConfirmModal, TableSkeleton, ImageModal } from '@/components/ui';\r\nimport ChatInterface from '@/components/ui/ChatInterface';\r\nimport { ChevronDown } from 'lucide-react';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function ComplainDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const complainId = params.id as string;\r\n\r\n  const [complain, setComplain] = useState<Complain | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [statusUpdating, setStatusUpdating] = useState(false);\r\n  const [showStatusDropdown, setShowStatusDropdown] = useState(false);\r\n  const [showImageModal, setShowImageModal] = useState(false);\r\n  const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Fetch complain data\r\n  useEffect(() => {\r\n    const fetchComplain = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const complainData = await complainApi.getComplain(complainId);\r\n        setComplain(complainData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching complain:', error);\r\n        if (error instanceof ApiError) {\r\n          if (error.status === 404) {\r\n            setError(`Complain with ID ${complainId} not found. It may have been deleted or the ID is incorrect.`);\r\n          } else {\r\n            setError(`Failed to load complain: ${error.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load complain data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (complainId) {\r\n      fetchComplain();\r\n    }\r\n  }, [complainId]);\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n        setShowStatusDropdown(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusColors = {\r\n      pending: 'bg-amber-100 text-amber-800',\r\n      in_progress: 'bg-blue-100 text-blue-800',\r\n      resolved: 'bg-green-100 text-green-800'\r\n    };\r\n    \r\n    return (\r\n      <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${statusColors[status as keyof typeof statusColors] || 'bg-gray-100 text-gray-800'}`}>\r\n        {status.replace('_', ' ')}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const [deleteModal, setDeleteModal] = useState<boolean>(false);\r\n\r\n  const handleDeleteClick = () => {\r\n    setDeleteModal(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      await complainApi.deleteComplain(complainId);\r\n      \r\n      // Redirect to complains list after successful deletion\r\n      router.push('/admin/complain');\r\n    } catch (error) {\r\n      console.error('Error deleting complain:', error);\r\n      if (error instanceof ApiError) {\r\n        alert(`Failed to delete complain: ${error.message}`);\r\n      } else {\r\n        alert('Failed to delete complain. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteModal(false);\r\n    }\r\n  };\r\n\r\n  const handleStatusUpdate = async (newStatus: string) => {\r\n    if (!complain) return;\r\n    \r\n    try {\r\n      setStatusUpdating(true);\r\n      await complainApi.updateComplain(complainId, {\r\n        title: complain.title,\r\n        description: complain.description,\r\n        student_id: complain.student_id,\r\n        staff_id: complain.staff_id,\r\n        status: newStatus as any\r\n      });\r\n      \r\n      // Update local state\r\n      setComplain({\r\n        ...complain,\r\n        status: newStatus as any\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('Error updating status:', error);\r\n      if (error instanceof ApiError) {\r\n        alert(`Failed to update status: ${error.message}`);\r\n      } else {\r\n        alert('Failed to update status. Please try again.');\r\n      }\r\n    } finally {\r\n      setStatusUpdating(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Complain Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading complain details...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <div className=\"mt-3 space-x-2\">\r\n            <Button\r\n              onClick={() => window.location.reload()}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Retry\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!complain) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-500\">Complain not found</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal}\r\n        title=\"Delete Complain\"\r\n        message=\"Are you sure you want to delete this complain? This action cannot be undone and will also delete all chat messages.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={handleDelete}\r\n        onCancel={() => setDeleteModal(false)}\r\n        isLoading={isDeleting}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200 shadow-sm\">\r\n        <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div>\r\n                <h1 className=\"text-xl font-bold text-gray-900\">{complain.title}</h1>\r\n                <div className=\"flex items-center gap-4 mt-2\">\r\n                  {getStatusBadge(complain.status)}\r\n                  <span className=\"text-sm text-gray-500\"></span>\r\n                  <span className=\"text-sm text-gray-600\">{formatDate(complain.created_at)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center space-x-3\">\r\n              {/* Status Update Dropdown */}\r\n              <div className=\"relative\" ref={dropdownRef}>\r\n                <button\r\n                  onClick={() => setShowStatusDropdown(!showStatusDropdown)}\r\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm\"\r\n                >\r\n                  <span>Update Status</span>\r\n                  <ChevronDown className=\"w-4 h-4\" />\r\n                </button>\r\n\r\n                {/* Dropdown menu */}\r\n                {showStatusDropdown && (\r\n                  <div className=\"absolute right-0 top-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50 min-w-[160px]\">\r\n                    {['pending', 'in_progress', 'resolved'].map((status) => (\r\n                      <button\r\n                        key={status}\r\n                        onClick={() => {\r\n                          handleStatusUpdate(status);\r\n                          setShowStatusDropdown(false);\r\n                        }}\r\n                        disabled={statusUpdating || complain.status === status}\r\n                        className={`w-full text-left px-4 py-2 text-sm transition-colors ${\r\n                          complain.status === status\r\n                            ? 'bg-blue-50 text-blue-700 cursor-not-allowed font-medium'\r\n                            : 'text-gray-700 hover:bg-gray-50'\r\n                        } ${statusUpdating ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                      >\r\n                        <span className=\"capitalize\">{status.replace('_', ' ')}</span>\r\n                        {complain.status === status && <span className=\"text-xs ml-2\"> Current</span>}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <Button\r\n                onClick={handleDeleteClick}\r\n                disabled={isDeleting}\r\n                variant=\"danger\"\r\n                size=\"sm\"\r\n                loading={isDeleting}\r\n              >\r\n                {isDeleting ? \"Deleting...\" : \"Delete Complain\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n        <div className=\"grid grid-cols-1 xl:grid-cols-5 gap-4\">\r\n          {/* Left Sidebar - Complain Details */}\r\n          <div className=\"xl:col-span-3\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden\" style={{height: '550px'}}>\r\n              {/* Info Section */}\r\n              <div className=\"p-5 h-full overflow-y-auto\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900\">Complain Details</h3>\r\n                </div>\r\n                \r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z\" />\r\n                      </svg>\r\n                      Title\r\n                    </label>\r\n                    <p className=\"text-sm text-gray-900 leading-relaxed font-medium bg-gray-50 p-2 rounded-lg border-l-4 border-blue-500\">{complain.title}</p>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                      </svg>\r\n                      Description\r\n                    </label>\r\n                    <div className=\"bg-gray-50 p-2 rounded-lg border-l-4 border-green-500\">\r\n                      <p className=\"text-xs text-gray-800 leading-relaxed whitespace-pre-wrap\">{complain.description}</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                      </svg>\r\n                      Submitted By\r\n                    </label>\r\n                    <div className=\"mt-1\">\r\n                      {complain.student && (\r\n                        <div className=\"flex items-center space-x-2 p-2 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200\">\r\n                          <div className=\"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-sm\">\r\n                            <span className=\"text-xs font-bold text-white\">S</span>\r\n                          </div>\r\n                          <div>\r\n                            <p className=\"text-xs font-semibold text-gray-900\">{complain.student.student_name}</p>\r\n                            <p className=\"text-xs text-blue-700 font-medium\">Student  {complain.student.contact_number}</p>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                      {complain.staff && (\r\n                        <div className=\"flex items-center space-x-2 p-2 bg-gradient-to-r from-green-50 to-green-100 rounded-lg border border-green-200\">\r\n                          <div className=\"w-6 h-6 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center shadow-sm\">\r\n                            <span className=\"text-xs font-bold text-white\">ST</span>\r\n                          </div>\r\n                          <div>\r\n                            <p className=\"text-xs font-semibold text-gray-900\">{complain.staff.staff_name}</p>\r\n                            <p className=\"text-xs text-green-700 font-medium\">Staff  {complain.staff.contact_number}</p>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                      {!complain.student && !complain.staff && (\r\n                        <p className=\"text-xs text-gray-500 italic\">Unknown user</p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Attachment */}\r\n                  {complain.complain_attachment && (\r\n                    <div>\r\n                      <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                        <svg className=\"w-3 h-3 mr-2 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\r\n                        </svg>\r\n                        Attachment\r\n                      </label>\r\n                      <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-2 hover:bg-gray-100 transition-colors\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div className=\"flex items-center space-x-2\">\r\n                            <div className=\"w-6 h-6 bg-orange-100 rounded-lg flex items-center justify-center\">\r\n                              {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? (\r\n                                <svg className=\"w-4 h-4 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                                </svg>\r\n                              ) : (\r\n                                <svg className=\"w-4 h-4 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                                </svg>\r\n                              )}\r\n                            </div>\r\n                            <div>\r\n                              <p className=\"text-xs font-medium text-gray-900\">\r\n                                {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? 'Image File' : 'Document File'}\r\n                              </p>\r\n                              <p className=\"text-xs text-gray-500\">Click to view attachment</p>\r\n                            </div>\r\n                          </div>\r\n                          <Button\r\n                            onClick={() => setShowImageModal(true)}\r\n                            variant=\"secondary\"\r\n                            size=\"sm\"\r\n                            icon={\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                              </svg>\r\n                            }\r\n                          >\r\n                            View\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Metadata */}\r\n                  <div className=\"pt-3 border-t border-gray-200\">\r\n                    <h4 className=\"text-xs font-bold text-gray-800 mb-3 flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      Information\r\n                    </h4>\r\n                    <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"p-3 bg-gray-50 rounded-lg\">\r\n                        <span className=\"text-gray-700 font-medium block text-xs mb-1\">Created</span>\r\n                        <span className=\"text-gray-900 font-semibold text-xs\">{formatDate(complain.created_at)}</span>\r\n                      </div>\r\n                      {complain.updated_at && (\r\n                        <div className=\"p-3 bg-gray-50 rounded-lg\">\r\n                          <span className=\"text-gray-700 font-medium block text-xs mb-1\">Updated</span>\r\n                          <span className=\"text-gray-900 font-semibold text-xs\">{formatDate(complain.updated_at)}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right Main Area - Chat Interface */}\r\n          <div className=\"xl:col-span-2\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden\" style={{height: '550px'}}>\r\n              <div className=\"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl flex-shrink-0\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <h3 className=\"text-base font-semibold text-gray-900\">Chat Messages</h3>\r\n                    <p className=\"text-xs text-gray-600 mt-1\">Communicate directly with the complainant about this complaint</p>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\r\n                    <span className=\"text-xs font-medium text-green-600\">Online</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1 min-h-0 overflow-hidden\">\r\n                <ChatInterface\r\n                  complainId={parseInt(complainId)}\r\n                  currentUserId={1} // This should come from auth context\r\n                  currentUserType=\"admin\"\r\n                  currentUserName=\"Admin\"\r\n                  className=\"h-full\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Attachment Modal */}\r\n      {complain?.complain_attachment && showImageModal && (\r\n        <div \r\n          className=\"fixed inset-0 bg-black/75 flex items-center justify-center p-4 z-50\"\r\n          onClick={() => setShowImageModal(false)}\r\n        >\r\n          <div className=\"relative max-w-4xl max-h-full bg-white rounded-xl overflow-hidden shadow-2xl\" onClick={(e) => e.stopPropagation()}>\r\n            {/* Modal Header */}\r\n            <div className=\"px-6 py-4 border-b border-gray-200 bg-gray-50\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? (\r\n                    <svg className=\"w-5 h-5 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                    </svg>\r\n                  ) : (\r\n                    <svg className=\"w-5 h-5 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                    </svg>\r\n                  )}\r\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                    {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? 'Image Attachment' : 'Document Attachment'}\r\n                  </h3>\r\n                </div>\r\n                <Button\r\n                  onClick={() => setShowImageModal(false)}\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  icon={\r\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                    </svg>\r\n                  }\r\n                >\r\n                  Close\r\n                </Button>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Modal Content */}\r\n            <div className=\"max-h-[70vh] overflow-auto\">\r\n              {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? (\r\n                <div className=\"p-6 flex justify-center\">\r\n                  {/* eslint-disable-next-line @next/next/no-img-element -- complaint attachment preview uses native <img> for onClick zoom and onError behavior */}\r\n                  <img\r\n                    src={getImageUrl(complain.complain_attachment)}\r\n                    alt=\"Complaint Attachment\"\r\n                    className=\"max-w-full max-h-[60vh] object-contain rounded-lg cursor-zoom-in hover:scale-105 transition-transform duration-200\"\r\n                    onClick={(e) => {\r\n                      const img = e.target as HTMLImageElement;\r\n                      if (img.style.transform === 'scale(2)') {\r\n                        img.style.transform = 'scale(1)';\r\n                        img.style.cursor = 'zoom-in';\r\n                        img.parentElement!.style.overflow = 'hidden';\r\n                      } else {\r\n                        img.style.transform = 'scale(2)';\r\n                        img.style.cursor = 'zoom-out';\r\n                        img.parentElement!.style.overflow = 'auto';\r\n                      }\r\n                    }}\r\n                    onError={(e) => {\r\n                      console.error('Image failed to load');\r\n                      const target = e.target as HTMLImageElement;\r\n                      target.style.display = 'none';\r\n                    }}\r\n                  />\r\n                </div>\r\n              ) : (\r\n                <div className=\"p-12 text-center\">\r\n                  <svg className=\"w-16 h-16 mx-auto text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                  </svg>\r\n                  <h4 className=\"text-lg font-medium text-gray-900 mb-2\">Document File</h4>\r\n                  <p className=\"text-gray-600 mb-6\">This file cannot be previewed directly. You can download it to view.</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Modal Actions */}\r\n            <div className=\"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3\">\r\n              <Button\r\n                onClick={() => {\r\n                  const link = document.createElement('a');\r\n                  link.href = getImageUrl(complain.complain_attachment);\r\n                  link.download = 'attachment';\r\n                  document.body.appendChild(link);\r\n                  link.click();\r\n                  document.body.removeChild(link);\r\n                }}\r\n                variant=\"primary\"\r\n                size=\"sm\"\r\n                icon={\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                  </svg>\r\n                }\r\n              >\r\n                Download\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\complain\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":15,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleBackToList' is assigned a value but never used.","line":91,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":25}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { complainApi, Complain } from '@/lib/api/complain.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  TableSkeleton \r\n} from '@/components/ui';\r\nimport ChatInterface from '@/components/ui/ChatInterface';\r\n\r\nexport default function ComplainChatPage() {\r\n  const router = useRouter();\r\n  const [complains, setComplains] = useState<Complain[]>([]);\r\n  const [filteredComplains, setFilteredComplains] = useState<Complain[]>([]);\r\n  const [selectedComplain, setSelectedComplain] = useState<Complain | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Fetch complains from API\r\n  useEffect(() => {\r\n    const fetchComplains = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await complainApi.getAllComplains();\r\n        setComplains(response);\r\n        setFilteredComplains(response);\r\n      } catch (error) {\r\n        console.error('Error fetching complains:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch complains: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch complains. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchComplains();\r\n  }, []);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredComplains(complains);\r\n    } else {\r\n      const filtered = complains.filter(complain =>\r\n        complain.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        complain.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (complain.student?.student_name || '').toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (complain.staff?.staff_name || '').toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredComplains(filtered);\r\n    }\r\n  }, [searchQuery, complains]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: '2-digit',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusColors = {\r\n      pending: 'bg-amber-100 text-amber-800',\r\n      in_progress: 'bg-blue-100 text-blue-800',\r\n      resolved: 'bg-green-100 text-green-800'\r\n    };\r\n    \r\n    return (\r\n      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColors[status as keyof typeof statusColors] || 'bg-gray-100 text-gray-800'}`}>\r\n        {status.replace('_', ' ')}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const handleSelectComplain = (complain: Complain) => {\r\n    setSelectedComplain(complain);\r\n  };\r\n\r\n  const handleBackToList = () => {\r\n    setSelectedComplain(null);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Chat with Users</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading complains...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show chat interface when a complain is selected\r\n  if (selectedComplain) {\r\n    return (\r\n      <div className=\"p-6 max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-semibold text-gray-900\">\r\n                Chat: {selectedComplain.title}\r\n              </h1>\r\n              <div className=\"flex items-center gap-4 mt-2\">\r\n                {getStatusBadge(selectedComplain.status)}\r\n                <span className=\"text-sm text-gray-500\">\r\n                  ID: #{selectedComplain.id}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\r\n          {/* User Information */}\r\n          <div className=\"lg:col-span-1\">\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">User Information</h3>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Name</h4>\r\n                  {selectedComplain.student && (\r\n                    <div>\r\n                      <p className=\"text-gray-900\">{selectedComplain.student.student_name}</p>\r\n                      <p className=\"text-sm text-gray-500\">Student</p>\r\n                    </div>\r\n                  )}\r\n                  {selectedComplain.staff && (\r\n                    <div>\r\n                      <p className=\"text-gray-900\">{selectedComplain.staff.staff_name}</p>\r\n                      <p className=\"text-sm text-gray-500\">Staff</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Contact</h4>\r\n                  {selectedComplain.student && (\r\n                    <p className=\"text-gray-900\">{selectedComplain.student.contact_number}</p>\r\n                  )}\r\n                  {selectedComplain.staff && (\r\n                    <p className=\"text-gray-900\">{selectedComplain.staff.contact_number}</p>\r\n                  )}\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Complain Title</h4>\r\n                  <p className=\"text-gray-900\">{selectedComplain.title}</p>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Description</h4>\r\n                  <p className=\"text-gray-700 text-sm whitespace-pre-wrap\">{selectedComplain.description}</p>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Created</h4>\r\n                  <p className=\"text-gray-700 text-sm\">{formatDate(selectedComplain.created_at)}</p>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Messages</h4>\r\n                  <p className=\"text-gray-700 text-sm\">\r\n                    {selectedComplain.total_messages || 0} total\r\n                    {((selectedComplain.unread_admin_messages ?? 0) > 0) && (\r\n                      <span className=\"ml-2 bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded-full\">\r\n                        {selectedComplain.unread_admin_messages ?? 0} unread\r\n                      </span>\r\n                    )}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Chat Interface */}\r\n          <div className=\"lg:col-span-3\">\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n              <div className=\"p-4 border-b border-gray-200\">\r\n                <h3 className=\"text-lg font-medium text-gray-900\">Chat Messages</h3>\r\n                <p className=\"text-sm text-gray-500 mt-1\">\r\n                  Communicate directly with the user about their complain\r\n                </p>\r\n              </div>\r\n              <div className=\"p-4\">\r\n                <ChatInterface\r\n                  complainId={selectedComplain.id}\r\n                  currentUserId={1} // This should come from auth context\r\n                  currentUserType=\"admin\"\r\n                  currentUserName=\"Admin\"\r\n                  className=\"h-96\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show complain list when no complain is selected\r\n  return (\r\n    <div className=\"p-6 max-w-7xl mx-auto\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Chat with Users</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">\r\n            Select a complain to start chatting with the user who submitted it\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search complains to chat...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Complain List */}\r\n      {filteredComplains.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No complains found' : 'No complains available'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500\">\r\n            {searchQuery ? 'Try a different search term' : 'No complaints have been submitted yet'}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Complain Details</div>\r\n              <div className=\"col-span-2\">User</div>\r\n              <div className=\"col-span-2\">Status</div>\r\n              <div className=\"col-span-2\">Chat Activity</div>\r\n              <div className=\"col-span-2\">Date</div>\r\n              <div className=\"col-span-1 text-center\">Action</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredComplains.map((complain) => (\r\n              <div \r\n                key={complain.id} \r\n                className=\"px-6 py-4 hover:bg-gray-50 transition-colors cursor-pointer\"\r\n                onClick={() => handleSelectComplain(complain)}\r\n              >\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Complain Details */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{complain.title}</div>\r\n                    <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">\r\n                      {complain.description}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* User */}\r\n                  <div className=\"col-span-2\">\r\n                    {complain.student && (\r\n                      <div>\r\n                        <div className=\"text-sm text-gray-900\">{complain.student.student_name}</div>\r\n                        <div className=\"text-xs text-gray-500\">Student</div>\r\n                      </div>\r\n                    )}\r\n                    {complain.staff && (\r\n                      <div>\r\n                        <div className=\"text-sm text-gray-900\">{complain.staff.staff_name}</div>\r\n                        <div className=\"text-xs text-gray-500\">Staff</div>\r\n                      </div>\r\n                    )}\r\n                    {!complain.student && !complain.staff && (\r\n                      <span className=\"text-xs text-gray-400\">Unknown</span>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"col-span-2\">\r\n                    {getStatusBadge(complain.status)}\r\n                  </div>\r\n\r\n                  {/* Chat Activity */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <div className=\"text-sm text-gray-600\">\r\n                        {complain.total_messages || 0} messages\r\n                      </div>\r\n                      {(complain.unread_admin_messages ?? 0) > 0 && (\r\n                        <div className=\"bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded-full\">\r\n                          {complain.unread_admin_messages ?? 0} unread\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Date */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-xs text-gray-500\">\r\n                      {formatDate(complain.created_at)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Action */}\r\n                  <div className=\"col-span-1 text-center\">\r\n                    <button\r\n                      className=\"bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1.5 rounded font-medium\"\r\n                      onClick={(e: React.MouseEvent) => {\r\n                        e.stopPropagation();\r\n                        handleSelectComplain(complain);\r\n                      }}\r\n                    >\r\n                      Chat\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Footer */}\r\n      {filteredComplains.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredComplains.length} of {complains.length} complains available for chat\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\complain\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":17,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCurrentPage' is assigned a value but never used.","line":23,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalPages' is assigned a value but never used.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":20}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { complainApi, Complain } from '@/lib/api/complain.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  ConfirmModal, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\n\r\nexport default function ComplainList() {\r\n  const router = useRouter();\r\n  const [complains, setComplains] = useState<Complain[]>([]);\r\n  const [filteredComplains, setFilteredComplains] = useState<Complain[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, complainId: string | null}>({\r\n    show: false,\r\n    complainId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch complains from API\r\n  useEffect(() => {\r\n    const fetchComplains = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await complainApi.getComplains(currentPage);\r\n        setComplains(response.data);\r\n        setFilteredComplains(response.data);\r\n        setTotalPages(response.last_page);\r\n      } catch (error) {\r\n        console.error('Error fetching complains:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch complains: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch complains. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchComplains();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredComplains(complains);\r\n    } else {\r\n      const filtered = complains.filter(complain =>\r\n        complain.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        complain.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        complain.status.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (complain.student?.student_name || '').toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (complain.staff?.staff_name || '').toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredComplains(filtered);\r\n    }\r\n  }, [searchQuery, complains]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusColors = {\r\n      pending: 'bg-amber-100 text-amber-800',\r\n      in_progress: 'bg-blue-100 text-blue-800',\r\n      resolved: 'bg-green-100 text-green-800'\r\n    };\r\n    \r\n    return (\r\n      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColors[status as keyof typeof statusColors] || 'bg-gray-100 text-gray-800'}`}>\r\n        {status.replace('_', ' ')}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const handleDeleteComplain = async (complainId: string) => {\r\n    setDeleteModal({show: true, complainId});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const complainId = deleteModal.complainId;\r\n    if (!complainId) return;\r\n\r\n    try {\r\n      setIsDeleting(complainId);\r\n      setDeleteModal({show: false, complainId: null});\r\n      setAlert({show: true, message: 'Deleting complain...', type: 'success'});\r\n      \r\n      await complainApi.deleteComplain(complainId);\r\n      \r\n      // Remove from local state\r\n      const updatedComplains = complains.filter(complain => complain.id !== parseInt(complainId));\r\n      setComplains(updatedComplains);\r\n      setFilteredComplains(updatedComplains.filter(complain =>\r\n        !searchQuery.trim() ||\r\n        complain.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        complain.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        complain.status.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (complain.student?.student_name || '').toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (complain.staff?.staff_name || '').toLowerCase().includes(searchQuery.toLowerCase())\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Complain deleted successfully!', type: 'success'});\r\n      \r\n      // Hide alert after 2 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting complain:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({show: true, message: `Failed to delete complain: ${error.message}`, type: 'error'});\r\n      } else {\r\n        setAlert({show: true, message: 'Failed to delete complain. Please try again.', type: 'error'});\r\n      }\r\n      \r\n      // Hide error alert after 3 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000);\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, complainId: null});\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Complains</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading complains...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Complain\"\r\n        message=\"Are you sure you want to delete this complain? This action cannot be undone and will also delete all chat messages.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Complains</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{complains.length} total complains</p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search complains...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredComplains.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No complains found' : 'No complains yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'No complaints have been submitted yet'}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Complain By</div>\r\n              <div className=\"col-span-4\">Complain Title</div>\r\n              <div className=\"col-span-2\">Status</div>\r\n              <div className=\"col-span-2\">Date</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredComplains.map((complain) => (\r\n              <div key={complain.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Complain By */}\r\n                  <div className=\"col-span-3\">\r\n                    {complain.student && (\r\n                      <div>\r\n                        <div className=\"text-sm text-gray-900\">{complain.student.student_name}</div>\r\n                        <div className=\"text-xs text-gray-500\">Student</div>\r\n                      </div>\r\n                    )}\r\n                    {complain.staff && (\r\n                      <div>\r\n                        <div className=\"text-sm text-gray-900\">{complain.staff.staff_name}</div>\r\n                        <div className=\"text-xs text-gray-500\">Staff</div>\r\n                      </div>\r\n                    )}\r\n                    {!complain.student && !complain.staff && (\r\n                      <span className=\"text-xs text-gray-400\">Unknown</span>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Complain Details */}\r\n                  <div className=\"col-span-4\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">\r\n                      {complain.title.length > 50 ? `${complain.title.substring(0, 50)}...` : complain.title}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"col-span-2\">\r\n                    {getStatusBadge(complain.status)}\r\n                  </div>\r\n\r\n                  {/* Date */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-xs text-gray-500\">\r\n                      {formatDate(complain.created_at)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <ActionButtons \r\n                      viewUrl={`/admin/complain/${complain.id}`}\r\n                      onDelete={() => handleDeleteComplain(complain.id.toString())}\r\n                      isDeleting={isDeleting === complain.id.toString()}\r\n                      style=\"compact\"\r\n                      hideEdit={true}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredComplains.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredComplains.length} of {complains.length} complains\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\expense-category\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormField' is defined but never used.","line":6,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is assigned a value but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { expenseCategoryApi, ExpenseCategoryFormData, ApiError } from '@/lib/api/index';\r\nimport { Button, FormField, SuccessToast } from '@/components/ui';\r\n\r\nexport default function CreateExpenseCategory() {\r\n  const router = useRouter();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  const [formData, setFormData] = useState<ExpenseCategoryFormData>({\r\n    name: '',\r\n    description: ''\r\n  });\r\n\r\n  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({});\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear validation error for this field\r\n    if (validationErrors[name]) {\r\n      setValidationErrors(prev => {\r\n        const newErrors = { ...prev };\r\n        delete newErrors[name];\r\n        return newErrors;\r\n      });\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const errors: Record<string, string> = {};\r\n\r\n    if (!formData.name || !formData.name.trim()) {\r\n      errors.name = 'Category name is required';\r\n    }\r\n\r\n    setValidationErrors(errors);\r\n    return Object.keys(errors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      await expenseCategoryApi.createExpenseCategory(formData);\r\n      \r\n      setAlert({show: true, message: 'Expense category created successfully!', type: 'success'});\r\n      \r\n      setTimeout(() => {\r\n        router.push('/admin/expense-category');\r\n      }, 1500);\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating expense category:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(error.message);\r\n        setAlert({show: true, message: error.message, type: 'error'});\r\n      } else {\r\n        setError('Failed to create expense category');\r\n        setAlert({show: true, message: 'Failed to create expense category', type: 'error'});\r\n      }\r\n      \r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      {/* Success/Error Toast */}\r\n      {alert.show && alert.type === 'success' && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.show && alert.type === 'error' && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <button\r\n              onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n              className=\"ml-auto pl-3 inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200\"\r\n            >\r\n              <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"w-full max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create Expense Category</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Add a new expense category</p>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n          <div className=\"space-y-6\">\r\n            {/* Category Name */}\r\n            <div>\r\n              <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Category Name <span className=\"text-red-500\">*</span>\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                id=\"name\"\r\n                name=\"name\"\r\n                value={formData.name}\r\n                onChange={handleInputChange}\r\n                className={`w-full px-4 py-3 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${\r\n                  validationErrors.name ? 'border-red-300' : 'border-gray-300'\r\n                }`}\r\n                placeholder=\"Enter category name\"\r\n                disabled={isLoading}\r\n              />\r\n              {validationErrors.name && (\r\n                <p className=\"mt-1 text-sm text-red-600\">{validationErrors.name}</p>\r\n              )}\r\n            </div>\r\n\r\n            {/* Description */}\r\n            <div>\r\n              <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Description (Optional)\r\n              </label>\r\n              <textarea\r\n                id=\"description\"\r\n                name=\"description\"\r\n                value={formData.description}\r\n                onChange={handleInputChange}\r\n                rows={4}\r\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                placeholder=\"Enter category description\"\r\n                disabled={isLoading}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Form Actions */}\r\n          <div className=\"flex justify-end items-center gap-3 pt-6 mt-6 border-t border-gray-200\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"secondary\"\r\n              onClick={() => router.back()}\r\n              disabled={isLoading}\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              variant=\"primary\"\r\n              loading={isLoading}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n            >\r\n              {isLoading ? 'Creating...' : 'Create Category'}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\expense\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormField' is defined but never used.","line":19,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'expense' is assigned a value but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'students' is assigned a value but never used.","line":30,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'paymentTypes' is assigned a value but never used.","line":31,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setPaymentTypes' is assigned a value but never used.","line":31,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":39},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'paymentAmount'. Either include it or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setDueAmount' needs the current value of 'paymentAmount'.","line":93,"column":6,"nodeType":"ArrayExpression","endLine":93,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [purchases, paymentStatus, paymentAmount]","fix":{"range":[3489,3515],"text":"[purchases, paymentStatus, paymentAmount]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":340,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13145,13148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13145,13148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { \r\n  expenseApi, \r\n  expenseCategoryApi, \r\n  supplierApi, \r\n  studentApi,\r\n  ExpenseFormData, \r\n  ExpenseCategory, \r\n  Supplier, \r\n  Student,\r\n  PaymentType,\r\n  PurchaseFormData,\r\n  Expense,\r\n  ApiError \r\n} from '@/lib/api/index';\r\nimport { Button, FormField, SingleImageUploadEdit, SuccessToast, TableSkeleton } from '@/components/ui';\r\n\r\nexport default function EditExpense() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isLoadingData, setIsLoadingData] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expense, setExpense] = useState<Expense | null>(null);\r\n  const [expenseCategories, setExpenseCategories] = useState<ExpenseCategory[]>([]);\r\n  const [suppliers, setSuppliers] = useState<Supplier[]>([]);\r\n  const [students, setStudents] = useState<Student[]>([]);\r\n  const [paymentTypes, setPaymentTypes] = useState<PaymentType[]>([]);\r\n  const [purchases, setPurchases] = useState<PurchaseFormData[]>([]);\r\n  const [existingImage, setExistingImage] = useState<string | null>(null);\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  const [formData, setFormData] = useState<ExpenseFormData>({\r\n    expense_category_id: '',\r\n    expense_type: '', // Keep for API compatibility\r\n    amount: 0,\r\n    expense_date: '',\r\n    title: '',\r\n    description: '',\r\n    student_id: '',\r\n    staff_id: '',\r\n    supplier_id: '',\r\n    expense_attachment: null,\r\n    paid_amount: 0,\r\n    due_amount: 0,\r\n    purchases: []\r\n  });\r\n\r\n  // Add payment status and total amount states\r\n  const [paymentStatus, setPaymentStatus] = useState<string>('');\r\n  const [totalAmount, setTotalAmount] = useState<number>(0);\r\n  const [paymentAmount, setPaymentAmount] = useState<number>(0);\r\n  const [dueAmount, setDueAmount] = useState<number>(0);\r\n  const [showPaymentAmount, setShowPaymentAmount] = useState<boolean>(false);\r\n\r\n  // Calculate total amount from purchases\r\n  useEffect(() => {\r\n    // Ensure each purchase total_amount is a number\r\n    const total = purchases.reduce((sum, purchase) => {\r\n      const purchaseAmount = typeof purchase.total_amount === 'number' ? purchase.total_amount : 0;\r\n      return sum + purchaseAmount;\r\n    }, 0);\r\n    \r\n    // Make sure total is a valid number\r\n    const safeTotal = isNaN(total) ? 0 : total;\r\n    \r\n    // Update total amount state and form data\r\n    setTotalAmount(safeTotal);\r\n    setFormData(prev => ({ ...prev, amount: safeTotal }));\r\n    \r\n    // Also update payment amount and due amount based on payment status\r\n    if (paymentStatus === 'paid') {\r\n      setPaymentAmount(safeTotal);\r\n      setDueAmount(0);\r\n    } else if (paymentStatus === 'partially_paid') {\r\n      // Keep existing payment amount, but ensure it doesn't exceed new total\r\n      setPaymentAmount(prev => Math.min(prev || 0, safeTotal));\r\n      // Recalculate due amount\r\n      setDueAmount(Math.max(0, safeTotal - (paymentAmount || 0)));\r\n    } else if (paymentStatus === 'credit') {\r\n      setPaymentAmount(0);\r\n      setDueAmount(safeTotal);\r\n    }\r\n  }, [purchases, paymentStatus]);\r\n\r\n  // Load initial data and expense details\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      try {\r\n        setIsLoadingData(true);\r\n        setError(null);\r\n        \r\n        // Get expense data directly for debugging\r\n        const expenseResponse = await expenseApi.getExpense(params.id as string);\r\n        console.log('API Response - Raw Expense Data:', JSON.stringify(expenseResponse));\r\n        \r\n        // Continue with other API calls\r\n        const [categoriesResponse, suppliersResponse, studentsResponse] = await Promise.all([\r\n          expenseCategoryApi.getExpenseCategories(),\r\n          supplierApi.getSuppliers(),\r\n          studentApi.getStudents()\r\n        ]);\r\n        \r\n        setExpense(expenseResponse);\r\n        setExpenseCategories(categoriesResponse);\r\n        setSuppliers(suppliersResponse.data);\r\n        setStudents(studentsResponse.data);\r\n        \r\n        // Set existing image\r\n        if (expenseResponse.expense_attachment) {\r\n          // Ensure the URL is properly formatted for display\r\n          const baseUrl = process.env.NEXT_PUBLIC_API_URL || '';\r\n          const attachmentPath = expenseResponse.expense_attachment || '';\r\n          \r\n          // Check if attachment path already includes /storage/ to avoid duplication\r\n          const attachmentUrl = attachmentPath.startsWith('http')\r\n            ? attachmentPath // Already a full URL\r\n            : attachmentPath.startsWith('/storage/')\r\n              ? `${baseUrl}${attachmentPath}` // Path already includes /storage/\r\n              : `${baseUrl}/storage/${attachmentPath}`; // Need to add /storage/\r\n          \r\n          console.log('Setting existing image URL:', attachmentUrl);\r\n          setExistingImage(attachmentUrl);\r\n        }\r\n        \r\n        // Set form data with existing values\r\n        setFormData({\r\n          expense_category_id: expenseResponse.expense_category_id,\r\n          expense_type: expenseResponse.expense_type,\r\n          amount: expenseResponse.amount,\r\n          expense_date: expenseResponse.expense_date,\r\n          title: expenseResponse.title,\r\n          description: expenseResponse.description || '',\r\n          student_id: expenseResponse.student_id || '',\r\n          staff_id: expenseResponse.staff_id || '',\r\n          supplier_id: expenseResponse.supplier_id || '',\r\n          expense_attachment: null,\r\n          paid_amount: expenseResponse.paid_amount || 0,\r\n          due_amount: expenseResponse.due_amount || 0,\r\n          purchases: []\r\n        });\r\n        \r\n        // Set initial total amount from the response\r\n        setTotalAmount(expenseResponse.amount || 0);\r\n        \r\n        // Set payment status from the response\r\n        if (expenseResponse.payment_status) {\r\n          setPaymentStatus(expenseResponse.payment_status);\r\n          \r\n          // Set showPaymentAmount and paymentAmount based on status\r\n          if (expenseResponse.payment_status === 'partially_paid') {\r\n            setShowPaymentAmount(true);\r\n            setPaymentAmount(expenseResponse.paid_amount || 0);\r\n            setDueAmount(Math.max(0, (expenseResponse.amount || 0) - (expenseResponse.paid_amount || 0)));\r\n          } else if (expenseResponse.payment_status === 'paid') {\r\n            setShowPaymentAmount(false);\r\n            setPaymentAmount(expenseResponse.amount || 0);\r\n            setDueAmount(0);\r\n          } else {\r\n            // Credit status\r\n            setShowPaymentAmount(false);\r\n            setPaymentAmount(0);\r\n            setDueAmount(expenseResponse.amount || 0);\r\n          }\r\n        } else {\r\n          // Default to credit if no status is set\r\n          setPaymentStatus('credit');\r\n          setShowPaymentAmount(false);\r\n          setPaymentAmount(0);\r\n          setDueAmount(expenseResponse.amount || 0);\r\n        }\r\n        \r\n        // Detailed debug logging\r\n        console.log('Expense Response Data Structure:', {\r\n          id: expenseResponse.id,\r\n          amount: expenseResponse.amount,\r\n          payment_status: expenseResponse.payment_status,\r\n          purchases_count: expenseResponse.purchases?.length || 0\r\n        });\r\n        \r\n        if (expenseResponse.purchases) {\r\n          console.log('Purchase Details:', expenseResponse.purchases.map(p => ({\r\n            name: p.item_name,\r\n            quantity: p.item_quantity,\r\n            unit_price: p.item_unit_price,\r\n            total: p.total_amount\r\n          })));\r\n        }\r\n        \r\n        // Set purchases if they exist\r\n        if (expenseResponse.purchases && expenseResponse.purchases.length > 0) {\r\n          const purchasesData = expenseResponse.purchases.map(purchase => ({\r\n            item_name: purchase.item_name,\r\n            item_quantity: Number(purchase.item_quantity) || 0,  // Ensure numeric type\r\n            item_price: Number(purchase.item_price) || 0,        // Ensure numeric type\r\n            item_unit_price: Number(purchase.item_unit_price) || 0, // Ensure numeric type\r\n            purchase_date: purchase.purchase_date,\r\n            total_amount: Number(purchase.total_amount) || 0     // Ensure numeric type\r\n          }));\r\n          \r\n          // Calculate total from purchases immediately and log it\r\n          const calculatedTotal = purchasesData.reduce((sum, p) => sum + p.total_amount, 0);\r\n          console.log('Calculated Total from Purchases:', calculatedTotal);\r\n          \r\n          // Update the state with the purchase data and calculated total\r\n          setPurchases(purchasesData);\r\n          setTotalAmount(calculatedTotal);\r\n          \r\n          // Also update form data with the calculated total\r\n          setFormData(prev => ({\r\n            ...prev,\r\n            amount: calculatedTotal\r\n          }));\r\n        } else {\r\n          // Always add one product field by default if no purchases exist\r\n          const defaultPurchase: PurchaseFormData = {\r\n            item_name: '',\r\n            item_quantity: 1,\r\n            item_price: 0,\r\n            item_unit_price: 0,\r\n            purchase_date: new Date().toISOString().split('T')[0],\r\n            total_amount: 0\r\n          };\r\n          setPurchases([defaultPurchase]);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading data:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load expense: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load expense. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoadingData(false);\r\n      }\r\n    };\r\n\r\n    if (params.id) {\r\n      loadData();\r\n    }\r\n  }, [params.id]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: name === 'amount' || name === 'paid_amount' || name === 'due_amount' ? parseFloat(value) || 0 : value\r\n    }));\r\n  };\r\n\r\n  const handlePaymentStatusChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const value = e.target.value;\r\n    setPaymentStatus(value);\r\n    \r\n    // Show payment amount field only for 'partially_paid' status\r\n    if (value === 'partially_paid') {\r\n      setShowPaymentAmount(true);\r\n      setPaymentAmount(0); // Default to 0 for partial payment\r\n    } else if (value === 'paid') {\r\n      // Don't show payment amount input, but set full payment\r\n      setShowPaymentAmount(false);\r\n      setPaymentAmount(totalAmount); // Full payment amount\r\n    } else {\r\n      // For 'credit' status\r\n      setShowPaymentAmount(false);\r\n      setPaymentAmount(0); // No payment for credit\r\n    }\r\n  };\r\n\r\n  const handlePaymentAmountChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    // Allow empty string in the input but store as 0 for calculations\r\n    const amount = e.target.value === '' ? 0 : parseFloat(e.target.value) || 0;\r\n    setPaymentAmount(amount);\r\n    \r\n    // Update due amount when payment amount changes\r\n    if (paymentStatus === 'partially_paid') {\r\n      setDueAmount(Math.max(0, totalAmount - amount));\r\n    }\r\n  };\r\n  \r\n  // Effect to update due amount whenever payment amount or total changes\r\n  useEffect(() => {\r\n    if (paymentStatus === 'paid') {\r\n      setDueAmount(0);\r\n    } else if (paymentStatus === 'partially_paid') {\r\n      setDueAmount(Math.max(0, totalAmount - paymentAmount));\r\n    } else {\r\n      setDueAmount(totalAmount);\r\n    }\r\n  }, [paymentAmount, totalAmount, paymentStatus]);\r\n\r\n  const handleFileSelect = (file: File) => {\r\n    setSelectedFile(file);\r\n    setImagePreview(URL.createObjectURL(file));\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      expense_attachment: file\r\n    }));\r\n  };\r\n\r\n  const handleFileRemove = () => {\r\n    setSelectedFile(null);\r\n    setImagePreview(null);\r\n    setExistingImage(null);\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      expense_attachment: null\r\n    }));\r\n  };\r\n\r\n  const handleImageClick = (imageUrl: string, alt: string) => {\r\n    console.log('Image clicked:', imageUrl, alt);\r\n  };\r\n\r\n  const addPurchase = () => {\r\n    const newPurchase: PurchaseFormData = {\r\n      item_name: '',\r\n      item_quantity: 1,\r\n      item_price: 0,\r\n      item_unit_price: 0,\r\n      purchase_date: new Date().toISOString().split('T')[0],\r\n      total_amount: 0\r\n    };\r\n    setPurchases([...purchases, newPurchase]);\r\n  };\r\n\r\n  const removePurchase = (index: number) => {\r\n    setPurchases(purchases.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updatePurchase = (index: number, field: keyof PurchaseFormData, value: any) => {\r\n    console.log(`Updating purchase at index ${index}, field: ${field}, value: ${value}`);\r\n    \r\n    const updatedPurchases = [...purchases];\r\n    updatedPurchases[index] = {\r\n      ...updatedPurchases[index],\r\n      [field]: value\r\n    };\r\n    \r\n    // When subtotal (total_amount) is manually updated, automatically calculate unit price\r\n    if (field === 'total_amount') {\r\n      const quantity = updatedPurchases[index].item_quantity;\r\n      \r\n      if (quantity > 0) {\r\n        // Calculate unit price based on the new subtotal\r\n        updatedPurchases[index].item_unit_price = value / quantity;\r\n      } else {\r\n        updatedPurchases[index].item_unit_price = 0;\r\n      }\r\n      updatedPurchases[index].item_price = value; // Set item_price to match total_amount\r\n    }\r\n    \r\n    // When quantity is updated, recalculate subtotal based on unit price\r\n    if (field === 'item_quantity') {\r\n      const unitPrice = updatedPurchases[index].item_unit_price;\r\n      const newTotalAmount = value * unitPrice;\r\n      updatedPurchases[index].total_amount = newTotalAmount;\r\n      updatedPurchases[index].item_price = newTotalAmount;\r\n    }\r\n    \r\n    // When unit price is updated, calculate subtotal based on quantity\r\n    if (field === 'item_unit_price') {\r\n      const quantity = updatedPurchases[index].item_quantity;\r\n      const newTotalAmount = quantity * value;\r\n      updatedPurchases[index].total_amount = newTotalAmount;\r\n      updatedPurchases[index].item_price = newTotalAmount;\r\n    }\r\n    \r\n    setPurchases(updatedPurchases);\r\n    \r\n    // Calculate and update the total amount immediately\r\n    const newTotal = updatedPurchases.reduce((sum, purchase) => {\r\n      const amount = typeof purchase.total_amount === 'number' ? purchase.total_amount : 0;\r\n      console.log(`Purchase in calculation: ${purchase.item_name}, Amount: ${amount}`);\r\n      return sum + amount;\r\n    }, 0);\r\n    \r\n    console.log('New calculated total:', newTotal);\r\n    \r\n    // Update total amount state and form data\r\n    setTotalAmount(newTotal);\r\n    setFormData(prev => ({ ...prev, amount: newTotal }));\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // For partially paid, validate payment amount doesn't exceed total\r\n      if (paymentStatus === 'partially_paid' && paymentAmount > totalAmount) {\r\n        setError(\"Payment amount cannot exceed the total amount for a partial payment.\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Validate attachment file if a new one is selected\r\n      if (selectedFile) {\r\n        // Check file type\r\n        const validFileTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf'];\r\n        if (!validFileTypes.includes(selectedFile.type)) {\r\n          setError(`Invalid file type. Allowed types: JPG, PNG, GIF, PDF. Selected file is ${selectedFile.type}`);\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Check file size (5MB limit)\r\n        const maxSize = 5 * 1024 * 1024; // 5MB in bytes\r\n        if (selectedFile.size > maxSize) {\r\n          setError(`File size exceeds 5MB limit. Selected file is ${(selectedFile.size / (1024 * 1024)).toFixed(2)}MB`);\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        console.log('Uploading file:', {\r\n          name: selectedFile.name,\r\n          type: selectedFile.type,\r\n          size: `${(selectedFile.size / 1024).toFixed(2)}KB`\r\n        });\r\n      }\r\n      \r\n      // Auto-generate expense_type from category\r\n      const selectedCategory = expenseCategories.find(cat => cat.id === formData.expense_category_id);\r\n      \r\n      // Handle payment amount based on status\r\n      let finalPaidAmount = 0;\r\n      let finalDueAmount = 0;\r\n      \r\n      if (paymentStatus === 'paid') {\r\n        finalPaidAmount = totalAmount;\r\n        finalDueAmount = 0;\r\n      } else if (paymentStatus === 'partially_paid') {\r\n        finalPaidAmount = paymentAmount;\r\n        finalDueAmount = Math.max(0, totalAmount - paymentAmount);\r\n      } else {\r\n        // Credit - everything is due\r\n        finalPaidAmount = 0;\r\n        finalDueAmount = totalAmount;\r\n      }\r\n      \r\n      // Create a copy of the form data to avoid manipulating the state directly\r\n      const dataToSubmit: ExpenseFormData = {\r\n        ...formData,\r\n        expense_type: selectedCategory?.name || 'General',\r\n        title: selectedCategory?.name || 'Expense',\r\n        amount: totalAmount,\r\n        paid_amount: finalPaidAmount,\r\n        due_amount: finalDueAmount,\r\n        payment_status: paymentStatus,\r\n        purchases: purchases.length > 0 ? purchases : undefined,\r\n        // Only include expense_attachment if there's a new file selected\r\n        expense_attachment: selectedFile\r\n      };\r\n\r\n      try {\r\n        console.log('Submitting expense update with data:', {\r\n          ...dataToSubmit,\r\n          expense_attachment: dataToSubmit.expense_attachment ? 'File included' : 'No file',\r\n          purchases: dataToSubmit.purchases?.length\r\n        });\r\n        \r\n        await expenseApi.updateExpense(params.id as string, dataToSubmit);\r\n        \r\n        setAlert({\r\n          show: true,\r\n          message: 'Expense updated successfully!',\r\n          type: 'success'\r\n        });\r\n\r\n        // Redirect after success\r\n        setTimeout(() => {\r\n          router.push('/admin/expense');\r\n        }, 2000);\r\n        \r\n      } catch (error) {\r\n        console.error('Error updating expense:', error);\r\n        \r\n        if (error instanceof ApiError) {\r\n          // Handle file upload error specifically\r\n          if (error.message.includes('attachment') || error.message.includes('upload')) {\r\n            setError(`Failed to upload attachment: ${error.message}. Please check the file type and size.`);\r\n          } else {\r\n            setError(`Failed to update expense: ${error.message}`);\r\n          }\r\n          \r\n          // Log validation errors if available\r\n          if (error.validation) {\r\n            console.error('Validation errors:', error.validation);\r\n          }\r\n        } else {\r\n          setError('Failed to update expense. Please try again.');\r\n        }\r\n        \r\n        setAlert({\r\n          show: true,\r\n          message: 'Failed to update expense. Please try again.',\r\n          type: 'error'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  if (isLoadingData) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Loading Expense...</h1>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <div className=\"max-w-full mx-auto px-4 py-6\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Expense</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Update expense information</p>\r\n        </div>\r\n\r\n        {/* Alert Notifications */}\r\n        {alert.show && alert.type === 'success' && (\r\n          <SuccessToast\r\n            show={alert.show}\r\n            message={alert.message}\r\n            progress={100}\r\n            onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n          />\r\n        )}\r\n        {alert.show && alert.type === 'error' && (\r\n          <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n            <div className=\"flex\">\r\n              <div className=\"flex-shrink-0\">\r\n                <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              </div>\r\n              <div className=\"ml-3\">\r\n                <p className=\"text-sm font-medium\">{alert.message}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-6\">\r\n            {/* Form Grid */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n              \r\n              {/* Left Column - Basic Information */}\r\n              <div className=\"lg:col-span-2 space-y-6\">\r\n                \r\n                {/* Basic Details Row */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  \r\n                  {/* Expense Category */}\r\n                  <div>\r\n                    <label htmlFor=\"expense_category_id\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Expense Category <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <select\r\n                      id=\"expense_category_id\"\r\n                      name=\"expense_category_id\"\r\n                      value={formData.expense_category_id}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                    >\r\n                      <option value=\"\">Select Category</option>\r\n                      {expenseCategories.map(category => (\r\n                        <option key={category.id} value={category.id}>\r\n                          {category.name}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n\r\n                  {/* Supplier */}\r\n                  <div>\r\n                    <label htmlFor=\"supplier_id\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Supplier <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <select\r\n                      id=\"supplier_id\"\r\n                      name=\"supplier_id\"\r\n                      value={formData.supplier_id}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                    >\r\n                      <option value=\"\">Select Supplier</option>\r\n                      {suppliers.map(supplier => (\r\n                        <option key={supplier.id} value={supplier.id}>\r\n                          {supplier.name}\r\n                          {supplier.opening_balance && supplier.opening_balance > 0 && (\r\n                            ` - ${supplier.balance_type === 'due' ? 'Due' : 'Advance'}: Rs.${supplier.opening_balance}`\r\n                          )}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div>\r\n                  <label htmlFor=\"description\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                    Description\r\n                  </label>\r\n                  <textarea\r\n                    id=\"description\"\r\n                    name=\"description\"\r\n                    value={formData.description}\r\n                    onChange={handleInputChange}\r\n                    rows={3}\r\n                    className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all resize-none\"\r\n                    placeholder=\"Enter expense description...\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Product Details */}\r\n                <div>\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900\">Product Details</h3>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={addPurchase}\r\n                      className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\r\n                    >\r\n                      Add Product\r\n                    </button>\r\n                  </div>\r\n\r\n                  {/* Always show at least one product field */}\r\n                  {purchases.length === 0 && (\r\n                    <div className=\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg\">\r\n                      <p className=\"text-gray-500 text-sm\">No products added yet</p>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={addPurchase}\r\n                        className=\"mt-2 text-blue-600 hover:text-blue-700 text-sm font-medium\"\r\n                      >\r\n                        Add your first product\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Product List */}\r\n                  <div className=\"space-y-4\">\r\n                    {purchases.map((purchase, index) => (\r\n                      <div key={index} className=\"p-4 border border-gray-200 rounded-lg bg-gray-50\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                          \r\n                          {/* Product Name */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Product Name\r\n                            </label>\r\n                            <input\r\n                              type=\"text\"\r\n                              value={purchase.item_name}\r\n                              onChange={(e) => updatePurchase(index, 'item_name', e.target.value)}\r\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                              placeholder=\"Enter product name\"\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Quantity */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Quantity\r\n                            </label>\r\n                            <input\r\n                              type=\"number\"\r\n                              value={purchase.item_quantity}\r\n                              onChange={(e) => updatePurchase(index, 'item_quantity', parseInt(e.target.value) || 0)}\r\n                              min=\"0\"\r\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                              placeholder=\"Qty\"\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Unit Price */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Unit Price\r\n                            </label>\r\n                            <input\r\n                              type=\"number\"\r\n                              value={purchase.item_unit_price}\r\n                              onChange={(e) => updatePurchase(index, 'item_unit_price', parseFloat(e.target.value) || 0)}\r\n                              min=\"0\"\r\n                              step=\"0.01\"\r\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                              placeholder=\"Unit price\"\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Subtotal */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Subtotal\r\n                            </label>\r\n                            <div className=\"flex items-center\">\r\n                              <input\r\n                                type=\"number\"\r\n                                value={purchase.total_amount}\r\n                                onChange={(e) => updatePurchase(index, 'total_amount', parseFloat(e.target.value) || 0)}\r\n                                min=\"0\"\r\n                                step=\"0.01\"\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                                placeholder=\"0.00\"\r\n                              />\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={() => removePurchase(index)}\r\n                                className=\"ml-2 p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors\"\r\n                              >\r\n                                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                                </svg>\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Total Amount Line */}\r\n                <div className=\"flex justify-end items-center mt-4 mb-4\">\r\n                  <div className=\"bg-gray-100 px-4 py-3 rounded-lg border border-gray-200\">\r\n                    <span className=\"text-gray-700 font-medium mr-4\">Total Amount:</span>\r\n                    <span className=\"text-lg font-bold text-gray-900\">Rs.{(() => {\r\n                      // Calculate total directly from purchases for accuracy\r\n                      const calculatedTotal = purchases.reduce((sum, p) => {\r\n                        // Always force to number type for reliable calculation\r\n                        const amount = Number(p.total_amount) || 0;\r\n                        console.log(`Total line - Purchase: ${p.item_name}, Amount: ${amount}, Type: ${typeof amount}`);\r\n                        return sum + amount;\r\n                      }, 0);\r\n                      console.log('Final Total amount line:', calculatedTotal);\r\n                      return calculatedTotal.toFixed(2);\r\n                    })()}</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Date and Payment Status Row */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  \r\n                  {/* Payment Date */}\r\n                  <div>\r\n                    <label htmlFor=\"expense_date\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Payment Date <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <input\r\n                      type=\"date\"\r\n                      id=\"expense_date\"\r\n                      name=\"expense_date\"\r\n                      value={formData.expense_date}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Payment Status */}\r\n                  <div>\r\n                    <label htmlFor=\"payment_status\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Payment Status <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <select\r\n                      id=\"payment_status\"\r\n                      name=\"payment_status\"\r\n                      value={paymentStatus}\r\n                      onChange={handlePaymentStatusChange}\r\n                      className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                    >\r\n                      <option value=\"\">Select Status</option>\r\n                      <option value=\"paid\">Paid</option>\r\n                      <option value=\"partially_paid\">Partially Paid</option>\r\n                      <option value=\"credit\">Credit</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                </div>\r\n\r\n                {/* Payment Amount (Conditional) */}\r\n                {showPaymentAmount && (\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label htmlFor=\"payment_amount\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                        Payment Amount <span className=\"text-red-500\">*</span>\r\n                      </label>\r\n                      <input\r\n                        type=\"number\"\r\n                        id=\"payment_amount\"\r\n                        name=\"payment_amount\"\r\n                        value={paymentAmount || ''}\r\n                        onChange={handlePaymentAmountChange}\r\n                        min=\"0\"\r\n                        step=\"0.01\"\r\n                        className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                        placeholder=\"Enter payment amount...\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-end\">\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"text-sm text-gray-600\">Partial payment</div>\r\n                        {paymentAmount > 0 && (\r\n                          <div className=\"text-sm font-medium\">\r\n                            <span className=\"text-amber-600\">Due to add to supplier: </span>\r\n                            <span className=\"text-amber-700 font-semibold\">Rs.{Math.max(0, totalAmount - paymentAmount).toFixed(2)}</span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n              </div>\r\n\r\n              {/* Right Column - Image Upload & Summary */}\r\n              <div className=\"lg:col-span-1 space-y-6\">\r\n                \r\n                {/* Image Upload */}\r\n                <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-200\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                    Expense Attachment\r\n                  </label>\r\n                  <SingleImageUploadEdit\r\n                    imagePreview={imagePreview}\r\n                    existingImageUrl={existingImage}\r\n                    onFileSelect={handleFileSelect}\r\n                    onRemove={handleFileRemove}\r\n                    onImageClick={handleImageClick}\r\n                    label=\"\"\r\n                    error={error && error.includes('attachment') ? error : undefined}\r\n                  />\r\n                  {!existingImage && !imagePreview && (\r\n                    <p className=\"text-xs text-neutral-500 mt-1\">No attachment currently available</p>\r\n                  )}\r\n                  {existingImage && (\r\n                    <p className=\"text-xs text-green-600 mt-1\">Current attachment will be displayed in the preview above</p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Summary Card */}\r\n                <div className=\"bg-blue-50 rounded-lg p-4 border border-blue-200\">\r\n                  <h4 className=\"font-semibold text-blue-900 mb-3\">Summary</h4>\r\n                  <div className=\"space-y-2 text-sm\">\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-blue-700\">Total Items:</span>\r\n                      <span className=\"font-medium text-blue-900\">{purchases.length}</span>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-blue-700\">Total Quantity:</span>\r\n                      <span className=\"font-medium text-blue-900\">{purchases.reduce((sum, p) => sum + p.item_quantity, 0)}</span>\r\n                    </div>\r\n                    <div className=\"border-t border-blue-200 pt-2 mt-2\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-blue-700 font-medium\">Total Amount:</span>\r\n                        <span className=\"font-bold text-blue-900\">Rs.{(() => {\r\n                            // Calculate directly from purchases for accuracy\r\n                            const calculatedTotal = purchases.reduce((sum, p) => {\r\n                              // Always force to number type to avoid string concatenation issues\r\n                              const amount = Number(p.total_amount) || 0;\r\n                              console.log(`Purchase in summary: ${p.item_name}, Amount: ${amount}`);\r\n                              return sum + amount;\r\n                            }, 0);\r\n                            console.log('Final Summary Total:', calculatedTotal);\r\n                            return calculatedTotal.toFixed(2);\r\n                          })()}</span>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Payment Status */}\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-blue-700\">Payment Status:</span>\r\n                      <span className=\"font-medium\">\r\n                        {paymentStatus === 'paid' && \r\n                          <span className=\"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium\">Paid</span>\r\n                        }\r\n                        {paymentStatus === 'partially_paid' && \r\n                          <span className=\"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium\">Partially Paid</span>\r\n                        }\r\n                        {paymentStatus === 'credit' && \r\n                          <span className=\"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium\">Credit</span>\r\n                        }\r\n                        {!paymentStatus && \r\n                          <span className=\"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium\">Not Set</span>\r\n                        }\r\n                      </span>\r\n                    </div>\r\n                    \r\n                    {/* Payment details based on status */}\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-blue-700\">Paid Amount:</span>\r\n                      <span className=\"font-medium text-blue-900\">\r\n                        Rs.{(typeof paymentAmount === 'number' ? paymentAmount : 0).toFixed(2)}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-blue-700\">Due Amount:</span>\r\n                      <span className=\"font-medium text-blue-900\">\r\n                        Rs.{(typeof dueAmount === 'number' ? dueAmount : 0).toFixed(2)}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200 mt-8\">\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                onClick={() => router.push('/admin/expense')}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n              >\r\n                {isLoading ? 'Updating...' : 'Update Expense'}\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\expense\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Plus' is defined but never used.","line":7,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":59},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":440,"column":17,"nodeType":"JSXOpeningElement","endLine":440,"endColumn":62},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":448,"column":19,"nodeType":"JSXOpeningElement","endLine":448,"endColumn":62}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { expenseApi, Expense, ApiError } from '@/lib/api/index';\r\nimport { Button, TableSkeleton, ImageModal } from '@/components/ui';\r\nimport { Calendar, AlertCircle, Info, User, Check, X, Plus, Image } from 'lucide-react';\r\n\r\nexport default function ExpenseDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const [expense, setExpense] = useState<Expense | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showImageModal, setShowImageModal] = useState<boolean>(false);\r\n  const [modalImageUrl, setModalImageUrl] = useState<string>('');\r\n  const [modalImageAlt, setModalImageAlt] = useState<string>('');\r\n\r\n  useEffect(() => {\r\n    const fetchExpense = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await expenseApi.getExpense(params.id as string);\r\n        \r\n        // Process expense data to ensure all required fields are present\r\n        const processedExpense = {\r\n          ...response,\r\n          // Calculate due amount if not provided\r\n          due_amount: response.due_amount !== undefined \r\n            ? response.due_amount \r\n            : Math.max(0, (response.amount || 0) - (response.paid_amount || 0))\r\n        };\r\n\r\n        console.log('Fetched expense data:', processedExpense);\r\n        setExpense(processedExpense);\r\n      } catch (error) {\r\n        console.error('Error fetching expense:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch expense: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch expense. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (params.id) {\r\n      fetchExpense();\r\n    }\r\n  }, [params.id]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    // Ensure amount is a valid number\r\n    const safeAmount = isNaN(amount) ? 0 : amount;\r\n    return new Intl.NumberFormat('en-NP', {\r\n      style: 'currency',\r\n      currency: 'NPR'\r\n    }).format(safeAmount);\r\n  };\r\n\r\n  // Calculate payment status based on amounts\r\n  const calculatePaymentStatus = (expense: Expense): string => {\r\n    // If payment_status is explicitly set, use that\r\n    if (expense.payment_status) {\r\n      return expense.payment_status;\r\n    }\r\n\r\n    const totalAmount = expense.amount || 0;\r\n    const paidAmount = expense.paid_amount || 0;\r\n    \r\n    if (paidAmount >= totalAmount && totalAmount > 0) {\r\n      return 'paid';\r\n    } else if (paidAmount > 0) {\r\n      return 'partially_paid';\r\n    } else {\r\n      return 'credit'; // Assuming credit expenses are on credit\r\n    }\r\n  };\r\n\r\n  const getPaymentStatusColor = (status: string | null | undefined) => {\r\n    if (!status) {\r\n      return 'bg-gray-100 text-gray-800';\r\n    }\r\n    \r\n    switch (status) {\r\n      case 'paid':\r\n        return 'bg-green-100 text-green-800';\r\n      case 'partially_paid':\r\n        return 'bg-yellow-100 text-yellow-800';\r\n      case 'credit':\r\n        return 'bg-red-100 text-red-800';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Loading Expense...</h1>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!expense) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-500\">Expense not found</p>\r\n          <button\r\n            onClick={() => router.push('/admin/expense')}\r\n            className=\"mt-2 text-[#235999] hover:text-[#1e4d87]\"\r\n          >\r\n            Back to Expenses\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">{expense.title}</h1>\r\n          </div>\r\n          <div className=\"flex space-x-2\">\r\n            <Button\r\n              onClick={() => router.push(`/admin/expense/${expense.id}/edit`)}\r\n              variant=\"primary\"\r\n            >\r\n              Edit Expense\r\n            </Button>\r\n            <Button\r\n              variant=\"danger\"\r\n              disabled={isDeleting}\r\n              loading={isDeleting}\r\n              onClick={() => {\r\n                if (confirm('Are you sure you want to delete this expense?')) {\r\n                  setIsDeleting(true);\r\n                  expenseApi.deleteExpense(expense.id as string)\r\n                    .then(() => {\r\n                      router.push('/admin/expense');\r\n                    })\r\n                    .catch((error) => {\r\n                      console.error('Error deleting expense:', error);\r\n                      alert('Failed to delete expense. Please try again.');\r\n                      setIsDeleting(false);\r\n                    });\r\n                }\r\n              }}\r\n            >\r\n              {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-6\">\r\n        {/* Status Summary */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n          <div className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <div className=\"flex justify-between items-start\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500\">Total Amount</p>\r\n                <p className=\"text-2xl font-bold text-gray-900 mt-1\">{formatCurrency(expense.amount || 0)}</p>\r\n              </div>\r\n              <div className=\"bg-blue-100 p-2 rounded-full\">\r\n                <AlertCircle className=\"h-5 w-5 text-blue-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <div className=\"flex justify-between items-start\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500\">Paid Amount</p>\r\n                <p className=\"text-2xl font-bold text-green-600 mt-1\">{formatCurrency(expense.paid_amount || 0)}</p>\r\n              </div>\r\n              <div className=\"bg-green-100 p-2 rounded-full\">\r\n                <Check className=\"h-5 w-5 text-green-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <div className=\"flex justify-between items-start\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500\">Due Amount</p>\r\n                <p className=\"text-2xl font-bold text-red-600 mt-1\">\r\n                  {formatCurrency((expense.due_amount !== undefined) \r\n                    ? expense.due_amount \r\n                    : ((expense.amount || 0) - (expense.paid_amount || 0)))}\r\n                </p>\r\n              </div>\r\n              <div className=\"bg-red-100 p-2 rounded-full\">\r\n                <AlertCircle className=\"h-5 w-5 text-red-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Basic Information */}\r\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <div className=\"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center mr-3\">\r\n              <Info className=\"h-4 w-4 text-blue-600\" />\r\n            </div>\r\n            <h2 className=\"text-lg font-medium text-gray-900\">Basic Information</h2>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-500\">Title</h3>\r\n              <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.title}</p>\r\n            </div>\r\n            \r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-500\">Type</h3>\r\n              <p className=\"text-sm font-medium text-gray-900 mt-1 capitalize\">{expense.expense_type || 'N/A'}</p>\r\n            </div>\r\n            \r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-500\">Amount</h3>\r\n              <p className=\"text-sm font-medium text-gray-900 mt-1\">\r\n                {formatCurrency(expense.amount || 0)}\r\n                {expense.due_amount !== undefined && expense.due_amount > 0 && (\r\n                  <span className=\"text-xs ml-2 text-red-600\">\r\n                    (Due: {formatCurrency(expense.due_amount)})\r\n                  </span>\r\n                )}\r\n              </p>\r\n            </div>\r\n            \r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-500\">Date</h3>\r\n              <div className=\"flex items-center mt-1\">\r\n                <Calendar className=\"h-3.5 w-3.5 text-gray-400 mr-1.5\" />\r\n                <p className=\"text-sm font-medium text-gray-900\">{formatDate(expense.expense_date)}</p>\r\n              </div>\r\n            </div>\r\n            \r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-500\">Payment Status</h3>\r\n              {(() => {\r\n                // Use our helper function to calculate the payment status\r\n                const status = calculatePaymentStatus(expense);\r\n                \r\n                // Format the display text\r\n                const displayText = status === 'partially_paid' \r\n                  ? 'Partial' \r\n                  : status.charAt(0).toUpperCase() + status.slice(1).replace('_', ' ');\r\n                \r\n                const StatusIcon = status === 'paid' ? Check : status === 'credit' ? X : AlertCircle;\r\n                \r\n                return (\r\n                  <div className=\"flex items-center mt-1\">\r\n                    <span className={`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${getPaymentStatusColor(status)}`}>\r\n                      <StatusIcon className=\"h-3 w-3 mr-1\" />\r\n                      {displayText}\r\n                    </span>\r\n                  </div>\r\n                );\r\n              })()}\r\n            </div>\r\n            \r\n            {expense.description && (\r\n              <div className=\"md:col-span-2\">\r\n                <h3 className=\"text-sm font-medium text-gray-500\">Description</h3>\r\n                <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.description}</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Supplier Information */}\r\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <div className=\"h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center mr-3\">\r\n              <User className=\"h-4 w-4 text-indigo-600\" />\r\n            </div>\r\n            <h2 className=\"text-lg font-medium text-gray-900\">Supplier Information</h2>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            {expense.supplier ? (\r\n              <>\r\n                <div>\r\n                  <h3 className=\"text-sm font-medium text-gray-500\">Supplier Name</h3>\r\n                  <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.supplier.name}</p>\r\n                </div>\r\n                \r\n                {expense.supplier.contact_number && (\r\n                  <div>\r\n                    <h3 className=\"text-sm font-medium text-gray-500\">Contact Number</h3>\r\n                    <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.supplier.contact_number}</p>\r\n                  </div>\r\n                )}\r\n                \r\n                {expense.supplier.email && (\r\n                  <div>\r\n                    <h3 className=\"text-sm font-medium text-gray-500\">Email</h3>\r\n                    <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.supplier.email}</p>\r\n                  </div>\r\n                )}\r\n                \r\n                {expense.supplier.address && (\r\n                  <div>\r\n                    <h3 className=\"text-sm font-medium text-gray-500\">Address</h3>\r\n                    <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.supplier.address}</p>\r\n                  </div>\r\n                )}\r\n              </>\r\n            ) : expense.student ? (\r\n              <>\r\n                <div>\r\n                  <h3 className=\"text-sm font-medium text-gray-500\">Student Name</h3>\r\n                  <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.student.student_name}</p>\r\n                </div>\r\n                \r\n                {expense.student.contact_number && (\r\n                  <div>\r\n                    <h3 className=\"text-sm font-medium text-gray-500\">Contact Number</h3>\r\n                    <p className=\"text-sm font-medium text-gray-900 mt-1\">{expense.student.contact_number}</p>\r\n                  </div>\r\n                )}\r\n              </>\r\n            ) : (\r\n              <div>\r\n                <p className=\"text-sm text-gray-500\">No supplier information available</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Purchase Items */}\r\n        {expense.purchases && expense.purchases.length > 0 && (\r\n          <div className=\"bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <div className=\"flex items-center mb-4\">\r\n              <div className=\"h-8 w-8 rounded-full bg-amber-100 flex items-center justify-center mr-3\">\r\n                <AlertCircle className=\"h-4 w-4 text-amber-600\" />\r\n              </div>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Purchase Items</h2>\r\n            </div>\r\n            \r\n            <div className=\"overflow-x-auto rounded-lg border border-gray-200\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Item Name\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Quantity\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Unit Price\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Total Amount\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {expense.purchases.map((purchase, index) => (\r\n                    <tr key={index} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                        {purchase.item_name || 'Unnamed Item'}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {purchase.item_quantity || 0}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {formatCurrency(purchase.item_unit_price || 0)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                        {formatCurrency(purchase.total_amount || 0)}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                  <tr className=\"bg-blue-50\">\r\n                    <td colSpan={3} className=\"px-6 py-3 text-right text-sm font-semibold text-gray-900\">\r\n                      Total\r\n                    </td>\r\n                    <td className=\"px-6 py-3 whitespace-nowrap text-sm font-bold text-blue-900\">\r\n                      {formatCurrency(\r\n                        expense.purchases.reduce((sum, item) => sum + (item.total_amount || 0), 0)\r\n                      )}\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Attachment */}\r\n        {expense.expense_attachment && (\r\n          <div className=\"bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <div className=\"flex items-center mb-4\">\r\n              <div className=\"h-8 w-8 rounded-full bg-purple-100 flex items-center justify-center mr-3\">\r\n                <Image className=\"h-4 w-4 text-purple-600\" />\r\n              </div>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Attachment</h2>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center p-4 bg-gray-50 rounded-lg\">\r\n              <div className=\"flex-shrink-0 mr-4\">\r\n                <div className=\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                  <Image className=\"h-5 w-5 text-gray-500\" />\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <p className=\"text-sm font-medium text-gray-700 mb-1\">Expense Receipt</p>\r\n                <button\r\n                  onClick={() => {\r\n                    // Ensure the URL is properly formatted\r\n                    const imageUrl = expense.expense_attachment?.startsWith('http') \r\n                      ? expense.expense_attachment \r\n                      : `${process.env.NEXT_PUBLIC_API_URL}/storage/${expense.expense_attachment}`;\r\n                    \r\n                    setModalImageUrl(imageUrl);\r\n                    setModalImageAlt('Expense Receipt');\r\n                    setShowImageModal(true);\r\n                  }}\r\n                  className=\"inline-flex items-center text-sm text-blue-600 hover:text-blue-800 font-medium cursor-pointer\"\r\n                >\r\n                  View Attachment\r\n                  <svg className=\"w-4 h-4 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Image Modal for Attachment */}\r\n        <ImageModal\r\n          show={showImageModal}\r\n          imageUrl={modalImageUrl}\r\n          alt={modalImageAlt}\r\n          onClose={() => setShowImageModal(false)}\r\n        />\r\n\r\n        {/* Timestamps */}\r\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <div className=\"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center mr-3\">\r\n              <Calendar className=\"h-4 w-4 text-gray-600\" />\r\n            </div>\r\n            <h2 className=\"text-lg font-medium text-gray-900\">Timestamps</h2>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n              <h3 className=\"text-sm font-medium text-gray-500\">Created At</h3>\r\n              <div className=\"flex items-center mt-2\">\r\n                <Calendar className=\"h-3.5 w-3.5 text-gray-400 mr-1.5\" />\r\n                <p className=\"text-sm font-medium text-gray-900\">{formatDate(expense.created_at)}</p>\r\n              </div>\r\n            </div>\r\n            \r\n            {expense.updated_at && (\r\n              <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n                <h3 className=\"text-sm font-medium text-gray-500\">Updated At</h3>\r\n                <div className=\"flex items-center mt-2\">\r\n                  <Calendar className=\"h-3.5 w-3.5 text-gray-400 mr-1.5\" />\r\n                  <p className=\"text-sm font-medium text-gray-900\">{formatDate(expense.updated_at)}</p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\expense\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormField' is defined but never used.","line":18,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'students' is assigned a value but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'paymentTypes' is assigned a value but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setPaymentTypes' is assigned a value but never used.","line":27,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedFile' is assigned a value but never used.","line":30,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'purchases.length'. Either include it or remove the dependency array.","line":105,"column":6,"nodeType":"ArrayExpression","endLine":105,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [purchases.length]","fix":{"range":[3714,3716],"text":"[purchases.length]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6338,6341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6338,6341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { \r\n  expenseApi, \r\n  expenseCategoryApi, \r\n  supplierApi, \r\n  studentApi,\r\n  ExpenseFormData, \r\n  ExpenseCategory, \r\n  Supplier, \r\n  Student,\r\n  PaymentType,\r\n  PurchaseFormData,\r\n  ApiError \r\n} from '@/lib/api/index';\r\nimport { Button, FormField, SingleImageUploadCreate, SuccessToast } from '@/components/ui';\r\n\r\nexport default function CreateExpense() {\r\n  const router = useRouter();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expenseCategories, setExpenseCategories] = useState<ExpenseCategory[]>([]);\r\n  const [suppliers, setSuppliers] = useState<Supplier[]>([]);\r\n  const [students, setStudents] = useState<Student[]>([]);\r\n  const [paymentTypes, setPaymentTypes] = useState<PaymentType[]>([]);\r\n  const [purchases, setPurchases] = useState<PurchaseFormData[]>([]);\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  const [formData, setFormData] = useState<ExpenseFormData>({\r\n    expense_category_id: '',\r\n    expense_type: '', // Keep for API compatibility but will be auto-generated\r\n    amount: 0,\r\n    expense_date: new Date().toISOString().split('T')[0],\r\n    title: '',\r\n    description: '',\r\n    student_id: '',\r\n    staff_id: '',\r\n    supplier_id: '',\r\n    expense_attachment: null,\r\n    paid_amount: 0,\r\n    due_amount: 0,\r\n    purchases: []\r\n  });\r\n\r\n  // Add payment status state\r\n  const [paymentStatus, setPaymentStatus] = useState<string>('');\r\n  const [totalAmount, setTotalAmount] = useState<number>(0);\r\n  const [paymentAmount, setPaymentAmount] = useState<number>(0);\r\n  const [showPaymentAmount, setShowPaymentAmount] = useState<boolean>(false);\r\n\r\n  // Calculate total amount from purchases\r\n  useEffect(() => {\r\n    const total = purchases.reduce((sum, purchase) => sum + purchase.total_amount, 0);\r\n    setTotalAmount(total);\r\n    setFormData(prev => ({ ...prev, amount: total }));\r\n  }, [purchases]);\r\n\r\n  // Load initial data\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      try {\r\n        console.log('Fetching categories, suppliers, and students...');\r\n        \r\n        const [categoriesResponse, suppliersResponse, studentsResponse] = await Promise.all([\r\n          expenseCategoryApi.getExpenseCategories(),\r\n          supplierApi.getSuppliers(),\r\n          studentApi.getStudents()\r\n        ]);\r\n        \r\n        console.log('Categories response:', categoriesResponse);\r\n        console.log('Suppliers response:', suppliersResponse);\r\n        console.log('Students response:', studentsResponse);\r\n        \r\n        setExpenseCategories(categoriesResponse);\r\n        setSuppliers(suppliersResponse.data);\r\n        setStudents(studentsResponse.data);\r\n        \r\n        // Always add one product field by default\r\n        if (purchases.length === 0) {\r\n          const defaultPurchase: PurchaseFormData = {\r\n            item_name: '',\r\n            item_quantity: 1,\r\n            item_price: 0,\r\n            item_unit_price: 0,\r\n            purchase_date: new Date().toISOString().split('T')[0],\r\n            total_amount: 0\r\n          };\r\n          setPurchases([defaultPurchase]);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading data:', error);\r\n        setError('Failed to load required data. Please refresh the page.');\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, []);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: name === 'amount' || name === 'paid_amount' || name === 'due_amount' ? parseFloat(value) || 0 : value\r\n    }));\r\n  };\r\n\r\n  const handlePaymentStatusChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const value = e.target.value;\r\n    setPaymentStatus(value);\r\n    \r\n    // Show payment amount field only for 'partially_paid' status\r\n    if (value === 'partially_paid') {\r\n      setShowPaymentAmount(true);\r\n      setPaymentAmount(0); // Default to 0 for partial payment\r\n    } else if (value === 'paid') {\r\n      // Don't show payment amount input, but set full payment\r\n      setShowPaymentAmount(false);\r\n      // Set payment amount to total amount or 0 if total is 0\r\n      const paymentValue = totalAmount > 0 ? totalAmount : 0;\r\n      setPaymentAmount(paymentValue);\r\n    } else {\r\n      // For 'credit' status\r\n      setShowPaymentAmount(false);\r\n      setPaymentAmount(0); // No payment for credit\r\n    }\r\n  };\r\n\r\n  const handlePaymentAmountChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    // Allow empty string in the input but store as 0 for calculations\r\n    const amount = e.target.value === '' ? 0 : parseFloat(e.target.value) || 0;\r\n    setPaymentAmount(amount);\r\n  };\r\n\r\n  const handleFileSelect = (file: File) => {\r\n    setSelectedFile(file);\r\n    setImagePreview(URL.createObjectURL(file));\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      expense_attachment: file\r\n    }));\r\n  };\r\n\r\n  const handleFileRemove = () => {\r\n    setSelectedFile(null);\r\n    setImagePreview(null);\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      expense_attachment: null\r\n    }));\r\n  };\r\n\r\n  const handleImageClick = (imageUrl: string, alt: string) => {\r\n    // Handle image preview modal if needed\r\n    console.log('Image clicked:', imageUrl, alt);\r\n  };\r\n\r\n  const addPurchase = () => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const newPurchase: PurchaseFormData = {\r\n      item_name: '',\r\n      item_quantity: 1,\r\n      item_price: 0,\r\n      item_unit_price: 0,\r\n      purchase_date: today,\r\n      total_amount: 0\r\n    };\r\n    setPurchases([...purchases, newPurchase]);\r\n  };\r\n\r\n  const removePurchase = (index: number) => {\r\n    setPurchases(purchases.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updatePurchase = (index: number, field: keyof PurchaseFormData, value: any) => {\r\n    const updatedPurchases = [...purchases];\r\n    updatedPurchases[index] = {\r\n      ...updatedPurchases[index],\r\n      [field]: value\r\n    };\r\n    \r\n    // When subtotal (total_amount) is manually updated, automatically calculate unit price\r\n    if (field === 'total_amount') {\r\n      const quantity = updatedPurchases[index].item_quantity;\r\n      \r\n      if (quantity > 0) {\r\n        // Calculate unit price based on the new subtotal\r\n        updatedPurchases[index].item_unit_price = value / quantity;\r\n      } else {\r\n        updatedPurchases[index].item_unit_price = 0;\r\n      }\r\n      updatedPurchases[index].item_price = value; // Set item_price to match total_amount\r\n    }\r\n    \r\n    // When quantity is updated, recalculate unit price from current subtotal\r\n    if (field === 'item_quantity') {\r\n      const totalAmount = updatedPurchases[index].total_amount;\r\n      \r\n      if (value > 0) {\r\n        updatedPurchases[index].item_unit_price = totalAmount / value;\r\n      } else {\r\n        updatedPurchases[index].item_unit_price = 0;\r\n      }\r\n    }\r\n    \r\n    // When unit price is updated, calculate subtotal based on quantity\r\n    if (field === 'item_unit_price') {\r\n      const quantity = updatedPurchases[index].item_quantity;\r\n      const newTotalAmount = quantity * value;\r\n      updatedPurchases[index].total_amount = newTotalAmount;\r\n      updatedPurchases[index].item_price = newTotalAmount;\r\n    }\r\n    \r\n    setPurchases(updatedPurchases);\r\n    \r\n    // Calculate and update the total amount immediately\r\n    const newTotal = updatedPurchases.reduce((sum, purchase) => {\r\n      return sum + (typeof purchase.total_amount === 'number' ? purchase.total_amount : 0);\r\n    }, 0);\r\n    \r\n    // Update total amount state\r\n    setTotalAmount(newTotal);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Validate required fields\r\n      if (!formData.expense_category_id) {\r\n        setError(\"Please select an expense category.\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      if (!formData.supplier_id) {\r\n        setError(\"Please select a supplier.\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Description is optional, removed validation\r\n\r\n      if (!paymentStatus) {\r\n        setError(\"Please select a payment status.\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // For partially paid, validate payment amount doesn't exceed total\r\n      if (paymentStatus === 'partially_paid' && paymentAmount > totalAmount) {\r\n        setError(\"Payment amount cannot exceed the total amount for a partial payment.\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Auto-generate expense_type from category\r\n      const selectedCategory = expenseCategories.find(cat => cat.id === formData.expense_category_id);\r\n      \r\n      // Handle payment amount based on status\r\n      let finalPaidAmount = 0;\r\n      let finalDueAmount = 0;\r\n      \r\n      if (paymentStatus === 'paid') {\r\n        finalPaidAmount = totalAmount;\r\n        finalDueAmount = 0;\r\n      } else if (paymentStatus === 'partially_paid') {\r\n        finalPaidAmount = paymentAmount;\r\n        finalDueAmount = Math.max(0, totalAmount - paymentAmount);\r\n      } else {\r\n        // Credit - everything is due\r\n        finalPaidAmount = 0;\r\n        finalDueAmount = totalAmount;\r\n      }\r\n      \r\n      // Make sure purchases have all required fields, especially purchase_date\r\n      const processedPurchases = purchases.map(purchase => ({\r\n        ...purchase,\r\n        purchase_date: purchase.purchase_date || new Date().toISOString().split('T')[0]\r\n      }));\r\n      \r\n      const dataToSubmit = {\r\n        ...formData,\r\n        expense_type: selectedCategory?.name || 'General',\r\n        title: selectedCategory?.name || 'Expense',\r\n        amount: totalAmount,\r\n        paid_amount: finalPaidAmount,\r\n        due_amount: finalDueAmount,\r\n        payment_type_id: '1', // Default payment type\r\n        payment_status: paymentStatus, // Add payment status to the submission\r\n        purchases: processedPurchases.length > 0 ? processedPurchases : undefined\r\n      };\r\n\r\n      await expenseApi.createExpense(dataToSubmit);\r\n      \r\n      setAlert({\r\n        show: true,\r\n        message: 'Expense created successfully!',\r\n        type: 'success'\r\n      });\r\n\r\n      // Redirect after success\r\n      setTimeout(() => {\r\n        router.push('/admin/expense');\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating expense:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(`Failed to create expense: ${error.message}`);\r\n      } else {\r\n        setError('Failed to create expense. Please try again.');\r\n      }\r\n      setAlert({\r\n        show: true,\r\n        message: 'Failed to create expense. Please try again.',\r\n        type: 'error'\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <div className=\"max-w-full mx-auto px-4 py-6\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create Expense</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Add a new expense record</p>\r\n        </div>\r\n\r\n        {/* Alert Notifications */}\r\n        {alert.show && alert.type === 'success' && (\r\n          <SuccessToast\r\n            show={alert.show}\r\n            message={alert.message}\r\n            progress={100}\r\n            onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n          />\r\n        )}\r\n        {alert.show && alert.type === 'error' && (\r\n          <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n            <div className=\"flex\">\r\n              <div className=\"flex-shrink-0\">\r\n                <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              </div>\r\n              <div className=\"ml-3\">\r\n                <p className=\"text-sm font-medium\">{alert.message}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">{error}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-6\">\r\n            {/* Form Grid */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n              \r\n              {/* Left Column - Basic Information */}\r\n              <div className=\"lg:col-span-2 space-y-6\">\r\n                \r\n                {/* Basic Details Row */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  \r\n                  {/* Expense Category */}\r\n                  <div>\r\n                    <label htmlFor=\"expense_category_id\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Expense Category <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <div className=\"flex gap-2\">\r\n                      <select\r\n                        id=\"expense_category_id\"\r\n                        name=\"expense_category_id\"\r\n                        value={formData.expense_category_id}\r\n                        onChange={handleInputChange}\r\n                        className=\"flex-1 px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                      >\r\n                        <option value=\"\">Select Category</option>\r\n                        {expenseCategories.map(category => (\r\n                          <option key={category.id} value={category.id}>\r\n                            {category.name}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => router.push('/admin/expense-category/create')}\r\n                        className=\"px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-1\"\r\n                        title=\"Add New Category\"\r\n                      >\r\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                        </svg>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Supplier */}\r\n                  <div>\r\n                    <label htmlFor=\"supplier_id\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Supplier <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <select\r\n                      id=\"supplier_id\"\r\n                      name=\"supplier_id\"\r\n                      value={formData.supplier_id}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                    >\r\n                      <option value=\"\">Select Supplier</option>\r\n                      {suppliers.map(supplier => (\r\n                        <option key={supplier.id} value={supplier.id}>\r\n                          {supplier.name}\r\n                          {supplier.opening_balance && supplier.opening_balance > 0 && (\r\n                            ` - ${supplier.balance_type === 'due' ? 'Due' : 'Advance'}: Rs.${supplier.opening_balance}`\r\n                          )}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div>\r\n                  <label htmlFor=\"description\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                    Description\r\n                  </label>\r\n                  <textarea\r\n                    id=\"description\"\r\n                    name=\"description\"\r\n                    value={formData.description}\r\n                    onChange={handleInputChange}\r\n                    rows={3}\r\n                    className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all resize-none\"\r\n                    placeholder=\"Enter expense description...\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Product Details */}\r\n                <div>\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900\">Product Details</h3>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={addPurchase}\r\n                      className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\r\n                    >\r\n                      Add Product\r\n                    </button>\r\n                  </div>\r\n\r\n                  {/* Always show at least one product field */}\r\n                  {purchases.length === 0 && (\r\n                    <div className=\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg\">\r\n                      <p className=\"text-gray-500 text-sm\">No products added yet</p>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={addPurchase}\r\n                        className=\"mt-2 text-blue-600 hover:text-blue-700 text-sm font-medium\"\r\n                      >\r\n                        Add your first product\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Product List */}\r\n                  <div className=\"space-y-4\">\r\n                    {purchases.map((purchase, index) => (\r\n                      <div key={index} className=\"p-4 border border-gray-200 rounded-lg bg-gray-50\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                          \r\n                          {/* Product Name */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Product Name\r\n                            </label>\r\n                            <input\r\n                              type=\"text\"\r\n                              value={purchase.item_name}\r\n                              onChange={(e) => updatePurchase(index, 'item_name', e.target.value)}\r\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                              placeholder=\"Enter product name\"\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Quantity */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Quantity\r\n                            </label>\r\n                            <input\r\n                              type=\"number\"\r\n                              value={purchase.item_quantity}\r\n                              onChange={(e) => updatePurchase(index, 'item_quantity', parseInt(e.target.value) || 0)}\r\n                              min=\"0\"\r\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                              placeholder=\"Qty\"\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Unit Price */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Unit Price\r\n                            </label>\r\n                            <input\r\n                              type=\"number\"\r\n                              value={purchase.item_unit_price}\r\n                              onChange={(e) => updatePurchase(index, 'item_unit_price', parseFloat(e.target.value) || 0)}\r\n                              min=\"0\"\r\n                              step=\"0.01\"\r\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                              placeholder=\"Unit price\"\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Subtotal */}\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                              Subtotal\r\n                            </label>\r\n                            <div className=\"flex items-center\">\r\n                              <input\r\n                                type=\"number\"\r\n                                value={purchase.total_amount}\r\n                                onChange={(e) => updatePurchase(index, 'total_amount', parseFloat(e.target.value) || 0)}\r\n                                min=\"0\"\r\n                                step=\"0.01\"\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                                placeholder=\"0.00\"\r\n                              />\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={() => removePurchase(index)}\r\n                                className=\"ml-2 p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors\"\r\n                              >\r\n                                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                                </svg>\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Total Amount Line */}\r\n                <div className=\"flex justify-end items-center mt-4 mb-4\">\r\n                  <div className=\"bg-gray-100 px-4 py-3 rounded-lg border border-gray-200\">\r\n                    <span className=\"text-gray-700 font-medium mr-4\">Total Amount:</span>\r\n                    <span className=\"text-lg font-bold text-gray-900\">Rs.{(() => {\r\n                      // Calculate total directly from purchases for accuracy\r\n                      const calculatedTotal = purchases.reduce((sum, p) => {\r\n                        return sum + (typeof p.total_amount === 'number' ? p.total_amount : 0);\r\n                      }, 0);\r\n                      return calculatedTotal.toFixed(2);\r\n                    })()}</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Date and Payment Status Row */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  \r\n                  {/* Payment Date */}\r\n                  <div>\r\n                    <label htmlFor=\"expense_date\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Payment Date <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <input\r\n                      type=\"date\"\r\n                      id=\"expense_date\"\r\n                      name=\"expense_date\"\r\n                      value={formData.expense_date}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Payment Status */}\r\n                  <div>\r\n                    <label htmlFor=\"payment_status\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                      Payment Status <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <select\r\n                      id=\"payment_status\"\r\n                      name=\"payment_status\"\r\n                      value={paymentStatus}\r\n                      onChange={handlePaymentStatusChange}\r\n                      className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                    >\r\n                      <option value=\"\">Select Status</option>\r\n                      <option value=\"paid\">Paid</option>\r\n                      <option value=\"partially_paid\">Partially Paid</option>\r\n                      <option value=\"credit\">Credit</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                </div>\r\n\r\n                {/* Payment Amount (Conditional) */}\r\n                {showPaymentAmount && (\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label htmlFor=\"payment_amount\" className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                        Payment Amount <span className=\"text-red-500\">*</span>\r\n                      </label>\r\n                      <input\r\n                        type=\"number\"\r\n                        id=\"payment_amount\"\r\n                        name=\"payment_amount\"\r\n                        value={paymentAmount || ''}\r\n                        onChange={handlePaymentAmountChange}\r\n                        min=\"0\"\r\n                        step=\"0.01\"\r\n                        className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm text-neutral-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all\"\r\n                        placeholder=\"Enter payment amount...\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-end\">\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"text-sm text-gray-600\">Partial payment</div>\r\n                        {paymentAmount > 0 && (\r\n                          <div className=\"text-sm font-medium\">\r\n                            <span className=\"text-amber-600\">Due to add to supplier: </span>\r\n                            <span className=\"text-amber-700 font-semibold\">Rs.{Math.max(0, totalAmount - paymentAmount).toFixed(2)}</span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n              </div>\r\n\r\n              {/* Right Column - Image Upload & Summary */}\r\n              <div className=\"lg:col-span-1 space-y-6\">\r\n                \r\n                {/* Image Upload */}\r\n                <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-200\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900 mb-2\">\r\n                    Expense Attachment\r\n                  </label>\r\n                  <SingleImageUploadCreate\r\n                    imagePreview={imagePreview}\r\n                    onFileSelect={handleFileSelect}\r\n                    onRemove={handleFileRemove}\r\n                    onImageClick={handleImageClick}\r\n                    label=\"\"\r\n                  />\r\n                  {!imagePreview && (\r\n                    <p className=\"text-xs text-neutral-500 mt-1\">Add an image of the receipt or invoice (optional)</p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Summary Card */}\r\n                <div className=\"bg-blue-50 rounded-lg p-4 border border-blue-200\">\r\n                  <h4 className=\"font-semibold text-blue-900 mb-3\">Summary</h4>\r\n                  <div className=\"space-y-2 text-sm\">\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-blue-700\">Total Items:</span>\r\n                      <span className=\"font-medium text-blue-900\">{purchases.length}</span>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-blue-700\">Total Quantity:</span>\r\n                      <span className=\"font-medium text-blue-900\">{purchases.reduce((sum, p) => sum + p.item_quantity, 0)}</span>\r\n                    </div>\r\n                    <div className=\"border-t border-blue-200 pt-2 mt-2\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-blue-700 font-medium\">Total Amount:</span>\r\n                        <span className=\"font-bold text-blue-900\">Rs.{totalAmount.toFixed(2)}</span>\r\n                      </div>\r\n                    </div>\r\n                    {/* Payment details based on status */}\r\n                    {paymentStatus && (\r\n                      <>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-blue-700\">Payment Status:</span>\r\n                          <span className=\"font-medium\">\r\n                            {paymentStatus === 'paid' && \r\n                              <span className=\"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium\">Paid</span>\r\n                            }\r\n                            {paymentStatus === 'partially_paid' && \r\n                              <span className=\"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium\">Partially Paid</span>\r\n                            }\r\n                            {paymentStatus === 'credit' && \r\n                              <span className=\"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium\">Credit</span>\r\n                            }\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-blue-700\">Paid Amount:</span>\r\n                          <span className=\"font-medium text-blue-900\">\r\n                            Rs.{paymentStatus === 'paid' \r\n                              ? totalAmount.toFixed(2) \r\n                              : paymentStatus === 'partially_paid' \r\n                                ? paymentAmount.toFixed(2) \r\n                                : '0.00'}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-blue-700\">Due Amount:</span>\r\n                          <span className=\"font-medium text-blue-900\">\r\n                            Rs.{paymentStatus === 'paid' \r\n                              ? '0.00' \r\n                              : paymentStatus === 'partially_paid' \r\n                                ? (totalAmount - paymentAmount).toFixed(2) \r\n                                : totalAmount.toFixed(2)}\r\n                          </span>\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200 mt-8\">\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                onClick={() => router.push('/admin/expense')}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n              >\r\n                {isLoading ? 'Creating...' : 'Create Expense'}\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\expense\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCurrentPage' is assigned a value but never used.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalPages' is assigned a value but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { expenseApi, Expense, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  ConfirmModal, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\n\r\nexport default function ExpenseList() {\r\n  const router = useRouter();\r\n  const [expenses, setExpenses] = useState<Expense[]>([]);\r\n  const [filteredExpenses, setFilteredExpenses] = useState<Expense[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, expenseId: string | null}>({\r\n    show: false,\r\n    expenseId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch expenses from API\r\n  useEffect(() => {\r\n    const fetchExpenses = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await expenseApi.getExpenses(currentPage);\r\n        // Log the first expense to see what fields are available\r\n        if (response.data && response.data.length > 0) {\r\n          console.log('Sample expense data:', response.data[0]);\r\n        }\r\n        \r\n        // Process expenses to ensure payment status is set\r\n        const processedExpenses = response.data.map(expense => {\r\n          const expenseCopy = { ...expense };\r\n          // If payment status is missing but we have payment data, calculate it\r\n          if (!expenseCopy.payment_status) {\r\n            const paidAmount = expenseCopy.paid_amount || 0;\r\n            const totalAmount = expenseCopy.amount || 0;\r\n            \r\n            if (paidAmount >= totalAmount && totalAmount > 0) {\r\n              expenseCopy.payment_status = 'paid';\r\n            } else if (paidAmount > 0) {\r\n              expenseCopy.payment_status = 'partially_paid';\r\n            } else {\r\n              expenseCopy.payment_status = 'credit';\r\n            }\r\n          }\r\n          return expenseCopy;\r\n        });\r\n        \r\n        setExpenses(processedExpenses);\r\n        setFilteredExpenses(processedExpenses);\r\n        setTotalPages(response.last_page);\r\n      } catch (error) {\r\n        console.error('Error fetching expenses:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch expenses: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch expenses. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchExpenses();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredExpenses(expenses);\r\n    } else {\r\n      const filtered = expenses.filter(expense =>\r\n        expense.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        expense.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        expense.expenseCategory?.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        expense.supplier?.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredExpenses(filtered);\r\n    }\r\n  }, [searchQuery, expenses]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: '2-digit'\r\n    });\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('en-NP', {\r\n      style: 'currency',\r\n      currency: 'NPR'\r\n    }).format(amount);\r\n  };\r\n\r\n  const getPaymentStatusColor = (status: string | null | undefined) => {\r\n    if (!status) {\r\n      return 'bg-gray-100 text-gray-800';\r\n    }\r\n    \r\n    switch (status) {\r\n      case 'paid':\r\n        return 'bg-green-100 text-green-800';\r\n      case 'partially_paid':\r\n        return 'bg-yellow-100 text-yellow-800';\r\n      case 'credit':\r\n        return 'bg-red-100 text-red-800';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n  \r\n  // No longer needed as we're using payment_status directly\r\n\r\n  const handleDeleteExpense = async (expenseId: string) => {\r\n    setDeleteModal({show: true, expenseId});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const expenseId = deleteModal.expenseId;\r\n    if (!expenseId) return;\r\n\r\n    try {\r\n      setIsDeleting(expenseId);\r\n      setDeleteModal({show: false, expenseId: null});\r\n      setAlert({show: true, message: 'Deleting expense...', type: 'success'});\r\n      \r\n      await expenseApi.deleteExpense(expenseId);\r\n      \r\n      // Remove from local state\r\n      const updatedExpenses = expenses.filter(expense => expense.id !== expenseId);\r\n      setExpenses(updatedExpenses);\r\n      setFilteredExpenses(updatedExpenses.filter(expense =>\r\n        !searchQuery.trim() ||\r\n        expense.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        expense.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        expense.expenseCategory?.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        expense.supplier?.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Expense deleted successfully!', type: 'success'});\r\n      \r\n      // Hide alert after 3 seconds\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting expense:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({show: true, message: `Failed to delete expense: ${error.message}`, type: 'error'});\r\n      } else {\r\n        setAlert({show: true, message: 'Failed to delete expense. Please try again.', type: 'error'});\r\n      }\r\n      \r\n      // Hide error alert after 5 seconds\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 5000);\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, expenseId: null});\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Expenses</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading expenses...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Expense\"\r\n        message=\"Are you sure you want to delete this expense? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Expenses</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{expenses.length} total expenses</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/admin/expense/create')}\r\n          icon={<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n          </svg>}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n        >\r\n          Add Expense\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search expenses...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredExpenses.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v2\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No expenses found' : 'No expenses yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'Create your first expense to get started'}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/admin/expense/create')}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n            >\r\n              Create Expense\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Expense Details</div>\r\n              <div className=\"col-span-2\">Description</div>\r\n              <div className=\"col-span-2\">Amount</div>\r\n              <div className=\"col-span-1\">Status</div>\r\n              <div className=\"col-span-2\">Supplier</div>\r\n              <div className=\"col-span-1 text-center\">Date</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredExpenses.map((expense) => (\r\n              <div key={expense.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Expense Details - Title only */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{expense.title}</div>\r\n                  </div>\r\n\r\n                  {/* Description - truncated to 15 characters */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-900\">\r\n                      {expense.description \r\n                        ? (expense.description.length > 15 \r\n                            ? expense.description.substring(0, 15) + '...' \r\n                            : expense.description)\r\n                        : 'No description'\r\n                      }\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Amount */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm font-medium text-gray-900\">{formatCurrency(expense.amount)}</div>\r\n                    {(expense.paid_amount || 0) > 0 && (\r\n                      <div className=\"text-xs text-green-600\">Paid: {formatCurrency(expense.paid_amount || 0)}</div>\r\n                    )}\r\n                    {expense.amount > (expense.paid_amount || 0) && (\r\n                      <div className=\"text-xs text-red-600\">Due: {formatCurrency(expense.amount - (expense.paid_amount || 0))}</div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Status - Using pre-calculated status from data processing */}\r\n                  <div className=\"col-span-1\">\r\n                    <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${getPaymentStatusColor(expense.payment_status)}`}>\r\n                      {expense.payment_status === 'paid' && 'Paid'}\r\n                      {expense.payment_status === 'partially_paid' && 'Partial'}\r\n                      {(!expense.payment_status || expense.payment_status === 'credit') && 'Credit'}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {/* Supplier */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-900\">\r\n                      {expense.supplier?.name || expense.student?.student_name || 'N/A'}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Date */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"text-xs text-gray-500 text-center\">\r\n                      {formatDate(expense.expense_date)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <ActionButtons \r\n                      viewUrl={`/admin/expense/${expense.id}`}\r\n                      editUrl={`/admin/expense/${expense.id}/edit`}\r\n                      onDelete={() => handleDeleteExpense(expense.id)}\r\n                      isDeleting={isDeleting === expense.id}\r\n                      style=\"compact\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredExpenses.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredExpenses.length} of {expenses.length} expenses\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\income-type\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchIncomeType'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchIncomeType, id]","fix":{"range":[926,930],"text":"[fetchIncomeType, id]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { incomeTypeApi, IncomeTypeFormData, ApiError } from '@/lib/api/index';\r\nimport { FormField, TableSkeleton, SubmitButton, CancelButton } from '@/components/ui';\r\nimport { ArrowLeft } from 'lucide-react';\r\n\r\nexport default function EditIncomeType() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = params?.id as string;\r\n\r\n  const [formData, setFormData] = useState<IncomeTypeFormData>({\r\n    title: '',\r\n    description: '',\r\n  });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [submitError, setSubmitError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      fetchIncomeType();\r\n    }\r\n  }, [id]);\r\n\r\n  const fetchIncomeType = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await incomeTypeApi.getIncomeType(id);\r\n      setFormData({\r\n        title: data.title,\r\n        description: data.description || '',\r\n      });\r\n    } catch (error) {\r\n      console.error('Error fetching income type:', error);\r\n      setSubmitError(error instanceof ApiError ? error.message : 'Failed to load Income Type');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    if (errors[name]) {\r\n      setErrors(prev => ({ ...prev, [name]: '' }));\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.title.trim()) {\r\n      newErrors.title = 'Title is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSubmitError(null);\r\n\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n      await incomeTypeApi.updateIncomeType(id, formData);\r\n      router.push('/admin/income-type');\r\n    } catch (error) {\r\n      console.error('Error updating income type:', error);\r\n      if (error instanceof ApiError) {\r\n        if (error.validation) {\r\n          // Convert validation errors array to string\r\n          const validationErrors: Record<string, string> = {};\r\n          Object.entries(error.validation).forEach(([key, value]) => {\r\n            validationErrors[key] = Array.isArray(value) ? value[0] : value;\r\n          });\r\n          setErrors(validationErrors);\r\n        } else {\r\n          setSubmitError(error.message);\r\n        }\r\n      } else {\r\n        setSubmitError('Failed to update Income Type. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Payment Purpose</h1>\r\n        <p className=\"text-sm text-gray-600 mt-1\">Update payment purpose information</p>\r\n      </div>\r\n\r\n      {submitError && (\r\n        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <p className=\"text-red-800\">{submitError}</p>\r\n        </div>\r\n      )}\r\n\r\n      <form onSubmit={handleSubmit} className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div className=\"space-y-6\">\r\n          <FormField\r\n            name=\"title\"\r\n            label=\"Title\"\r\n            required\r\n            value={formData.title}\r\n            onChange={handleInputChange}\r\n            error={errors.title}\r\n            placeholder=\"e.g., Monthly Rent, Security Deposit, Mess Fee\"\r\n          />\r\n\r\n          <FormField\r\n            name=\"description\"\r\n            label=\"Description\"\r\n            value={formData.description || ''}\r\n            onChange={handleInputChange}\r\n            error={errors.description}\r\n            placeholder=\"Optional description\"\r\n            type=\"textarea\"\r\n            rows={3}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"mt-6 flex items-center justify-end gap-3 pt-6 border-t border-gray-200\">\r\n          <CancelButton onClick={() => router.back()} />\r\n          <SubmitButton loading={isSubmitting} loadingText=\"Updating...\">\r\n            Update Payment Purpose\r\n          </SubmitButton>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\income-type\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchIncomeType'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchIncomeType, id]","fix":{"range":[868,872],"text":"[fetchIncomeType, id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { incomeTypeApi, IncomeTypeModel, ApiError } from '@/lib/api/index';\r\nimport { Button, TableSkeleton, ConfirmModal } from '@/components/ui';\r\nimport { ArrowLeft, Edit, Trash } from 'lucide-react';\r\n\r\nexport default function ViewIncomeType() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = params?.id as string;\r\n\r\n  const [incomeType, setIncomeType] = useState<IncomeTypeModel | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      fetchIncomeType();\r\n    }\r\n  }, [id]);\r\n\r\n  const fetchIncomeType = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await incomeTypeApi.getIncomeType(id);\r\n      setIncomeType(data);\r\n    } catch (error) {\r\n      console.error('Error fetching income type:', error);\r\n      setError(error instanceof ApiError ? error.message : 'Failed to load Income Type');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      await incomeTypeApi.deleteIncomeType(id);\r\n      router.push('/admin/income-type');\r\n    } catch (error) {\r\n      console.error('Error deleting income type:', error);\r\n      setError(error instanceof ApiError ? error.message : 'Failed to delete Income Type');\r\n      setShowDeleteModal(false);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !incomeType) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error || 'Payment purpose not found'}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/income-type')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Payment Purposes\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"mb-6\">\r\n        <button\r\n          onClick={() => router.back()}\r\n          className=\"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4 transition-colors\"\r\n        >\r\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n          Back\r\n        </button>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">{incomeType.title}</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">Payment purpose details</p>\r\n          </div>\r\n          <div className=\"flex gap-3\">\r\n            <Button\r\n              onClick={() => router.push(`/admin/income-type/${id}/edit`)}\r\n              icon={<Edit className=\"w-4 h-4\" />}\r\n              variant=\"edit\"\r\n            >\r\n              Edit\r\n            </Button>\r\n            <Button\r\n              onClick={() => setShowDeleteModal(true)}\r\n              icon={<Trash className=\"w-4 h-4\" />}\r\n              variant=\"delete\"\r\n            >\r\n              Delete\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Payment Purpose Information</h2>\r\n          <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\r\n            <div className=\"sm:col-span-2\">\r\n              <dt className=\"text-sm font-medium text-gray-500\">Title</dt>\r\n              <dd className=\"mt-1 text-sm text-gray-900\">{incomeType.title}</dd>\r\n            </div>\r\n            \r\n            <div className=\"sm:col-span-2\">\r\n              <dt className=\"text-sm font-medium text-gray-500\">Description</dt>\r\n              <dd className=\"mt-1 text-sm text-gray-900\">{incomeType.description || '-'}</dd>\r\n            </div>\r\n\r\n            <div>\r\n              <dt className=\"text-sm font-medium text-gray-500\">Created Date</dt>\r\n              <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(incomeType.created_at)}</dd>\r\n            </div>\r\n\r\n            <div>\r\n              <dt className=\"text-sm font-medium text-gray-500\">Last Updated</dt>\r\n              <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(incomeType.updated_at)}</dd>\r\n            </div>\r\n          </dl>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={showDeleteModal}\r\n        title=\"Delete Payment Purpose\"\r\n        message=\"Are you sure you want to delete this payment purpose? This action cannot be undone.\"\r\n        confirmText={isDeleting ? 'Deleting...' : 'Delete'}\r\n        cancelText=\"Cancel\"\r\n        onConfirm={handleDelete}\r\n        onCancel={() => setShowDeleteModal(false)}\r\n        variant=\"danger\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\income-type\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { incomeTypeApi, IncomeTypeFormData, ApiError } from '@/lib/api/index';\r\nimport { FormField, SubmitButton, CancelButton } from '@/components/ui';\r\nimport { ArrowLeft } from 'lucide-react';\r\n\r\nexport default function CreateIncomeType() {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState<IncomeTypeFormData>({\r\n    title: '',\r\n    description: '',\r\n  });\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [submitError, setSubmitError] = useState<string | null>(null);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    if (errors[name]) {\r\n      setErrors(prev => ({ ...prev, [name]: '' }));\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.title.trim()) {\r\n      newErrors.title = 'Title is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSubmitError(null);\r\n\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n      await incomeTypeApi.createIncomeType(formData);\r\n      router.push('/admin/income-type');\r\n    } catch (error) {\r\n      console.error('Error creating income type:', error);\r\n      if (error instanceof ApiError) {\r\n        if (error.validation) {\r\n          // Convert validation errors array to string\r\n          const validationErrors: Record<string, string> = {};\r\n          Object.entries(error.validation).forEach(([key, value]) => {\r\n            validationErrors[key] = Array.isArray(value) ? value[0] : value;\r\n          });\r\n          setErrors(validationErrors);\r\n        } else {\r\n          setSubmitError(error.message);\r\n        }\r\n      } else {\r\n        setSubmitError('Failed to create Income Type. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-semibold text-gray-900\">Add Payment Purpose</h1>\r\n        <p className=\"text-sm text-gray-600 mt-1\">Create a new payment purpose for income recording</p>\r\n      </div>\r\n\r\n      {submitError && (\r\n        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <p className=\"text-red-800\">{submitError}</p>\r\n        </div>\r\n      )}\r\n\r\n      <form onSubmit={handleSubmit} className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div className=\"space-y-6\">\r\n          <FormField\r\n            name=\"title\"\r\n            label=\"Title\"\r\n            required\r\n            value={formData.title}\r\n            onChange={handleInputChange}\r\n            error={errors.title}\r\n            placeholder=\"e.g., Monthly Rent, Security Deposit, Mess Fee\"\r\n          />\r\n\r\n          <FormField\r\n            name=\"description\"\r\n            label=\"Description\"\r\n            value={formData.description || ''}\r\n            onChange={handleInputChange}\r\n            error={errors.description}\r\n            placeholder=\"Optional description\"\r\n            type=\"textarea\"\r\n            rows={3}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"mt-6 flex items-center justify-end gap-3 pt-6 border-t border-gray-200\">\r\n          <CancelButton onClick={() => router.back()} />\r\n          <SubmitButton loading={isSubmitting} loadingText=\"Creating...\">\r\n            Create Payment Purpose\r\n          </SubmitButton>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\income\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ActionButtons' is defined but never used.","line":9,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":38}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useParams } from 'next/navigation';\r\nimport { incomeApi } from '@/lib/api/income.api';\r\nimport { IncomeFormData, Income, Student, IncomeType, PaymentType } from '@/lib/api/types';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { TableSkeleton, ActionButtons, SingleImageUploadEdit, ImageModal } from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function EditIncome() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = Array.isArray(params.id) ? params.id[0] : params.id || '';\r\n  \r\n  const [formData, setFormData] = useState<IncomeFormData>({\r\n    student_id: '',\r\n    income_type_id: '',\r\n    payment_type_id: '',\r\n    amount: 0,\r\n    income_date: '',\r\n    received_amount: 0,\r\n    due_amount: 0,\r\n    payment_status: 'paid'\r\n  });\r\n  \r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  const [students, setStudents] = useState<Student[]>([]);\r\n  const [incomeTypes, setIncomeTypes] = useState<IncomeType[]>([]);\r\n  const [paymentTypes, setPaymentTypes] = useState<PaymentType[]>([]);\r\n  const [currentIncome, setCurrentIncome] = useState<Income | null>(null);\r\n  \r\n  // Image upload states\r\n  const [attachmentPreview, setAttachmentPreview] = useState<string | null>(null);\r\n  const [isImageModalOpen, setIsImageModalOpen] = useState(false);\r\n  const [imageModalSrc, setImageModalSrc] = useState('');\r\n  const [imageModalAlt, setImageModalAlt] = useState('');\r\n\r\n  // Fetch income data and dropdown options\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch income data from API\r\n        const income = await incomeApi.getIncome(id);\r\n        setCurrentIncome(income);\r\n        \r\n        // Format date for input (date only, no time)\r\n        let incomeDateFormatted = '';\r\n        try {\r\n          const date = new Date(income.income_date);\r\n          const year = date.getFullYear();\r\n          const month = String(date.getMonth() + 1).padStart(2, '0');\r\n          const day = String(date.getDate()).padStart(2, '0');\r\n          incomeDateFormatted = `${year}-${month}-${day}`;\r\n        } catch (e) {\r\n          console.error('Error formatting date:', e);\r\n          // If there's an error, try to extract just the date part\r\n          incomeDateFormatted = income.income_date?.split('T')[0] || income.income_date;\r\n        }\r\n        \r\n        // Set form data\r\n        setFormData({\r\n          student_id: income.student_id,\r\n          income_type_id: income.income_type_id,\r\n          payment_type_id: income.payment_type_id,\r\n          amount: income.amount,\r\n          income_date: incomeDateFormatted,\r\n          received_amount: income.received_amount || 0,\r\n          due_amount: income.due_amount || 0,\r\n          title: income.title,\r\n          description: income.description,\r\n          payment_status: income.payment_status || 'paid'\r\n        });\r\n        \r\n        // Fetch dropdown data from API\r\n        const [studentsData, incomeTypesData, paymentTypesData] = await Promise.all([\r\n          incomeApi.getStudents(),\r\n          incomeApi.getIncomeTypes(),\r\n          incomeApi.getPaymentTypes()\r\n        ]);\r\n        \r\n        setStudents(studentsData);\r\n        setIncomeTypes(incomeTypesData);\r\n        setPaymentTypes(paymentTypesData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        if (error instanceof ApiError) {\r\n          setErrors({\r\n            fetch: `Failed to load data: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            fetch: 'Failed to load income data. Please try again.'\r\n          });\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [id]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    if (name === 'amount' || name === 'received_amount') {\r\n      const numValue = parseFloat(value) || 0;\r\n      \r\n      setFormData(prev => {\r\n        const newState = {\r\n          ...prev,\r\n          [name]: numValue\r\n        };\r\n        \r\n        // Auto-calculate due amount when amount or received_amount changes\r\n        if (name === 'amount' || name === 'received_amount') {\r\n          newState.due_amount = Math.max(0, newState.amount - (newState.received_amount || 0));\r\n          \r\n          // Auto-update payment status based on due amount\r\n          if (newState.due_amount > 0) {\r\n            newState.payment_status = 'partial';\r\n          } else {\r\n            newState.payment_status = 'paid';\r\n          }\r\n        }\r\n        \r\n        return newState;\r\n      });\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value\r\n      }));\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.student_id) {\r\n      newErrors.student_id = 'Student is required';\r\n    }\r\n\r\n    if (!formData.payment_type_id) {\r\n      newErrors.payment_type_id = 'Payment method is required';\r\n    }\r\n    \r\n    if (!formData.income_type_id) {\r\n      newErrors.income_type_id = 'Income Type is required';\r\n    }\r\n\r\n    if (!formData.amount || formData.amount <= 0) {\r\n      newErrors.amount = 'Amount must be greater than 0';\r\n    }\r\n\r\n    if (!formData.income_date) {\r\n      newErrors.income_date = 'Payment date is required';\r\n    }\r\n\r\n    if (formData.received_amount !== undefined && formData.received_amount < 0) {\r\n      newErrors.received_amount = 'Received amount cannot be negative';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      // Update income record using API\r\n      await incomeApi.updateIncome(id, formData);\r\n      \r\n      // Redirect to income detail view on success\r\n      router.push(`/admin/income/${id}`);\r\n      \r\n    } catch (error) {\r\n      console.error('Error updating income:', error);\r\n      if (error instanceof ApiError) {\r\n        setErrors({\r\n          submit: `Failed to update payment record: ${error.message}`\r\n        });\r\n      } else {\r\n        setErrors({\r\n          submit: 'An error occurred while updating the payment record. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Edit Income Record</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading income data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/income')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Go Back\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!currentIncome) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-amber-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-amber-800\">Income record not found.</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/income')}\r\n            className=\"mt-3 bg-amber-100 hover:bg-amber-200 text-amber-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Income List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 w-full p-4 md:p-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Payment Record</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Update payment information</p>\r\n        </div>\r\n\r\n        {/* Form Card - Full Width */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-6\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-700 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5 md:gap-6\">\r\n              {/* Student Selection */}\r\n              <div>\r\n                <label htmlFor=\"student_id\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Select Student <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"student_id\"\r\n                  name=\"student_id\"\r\n                  value={formData.student_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">-- Select a Student --</option>\r\n                  {(Array.isArray(students) ? students : []).map(student => {\r\n                    // We can't style part of an option element directly with CSS\r\n                    // But we can indicate due amounts clearly in the text\r\n                    const displayText = student.due_amount && student.due_amount > 0\r\n                      ? `${student.student_name}  (Due: Rs. ${student.due_amount})`\r\n                      : student.student_name;\r\n                      \r\n                    return (\r\n                      <option key={student.id} value={student.id}>\r\n                        {displayText}\r\n                      </option>\r\n                    );\r\n                  })}\r\n                </select>\r\n                {errors.student_id && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.student_id}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Payment Method */}\r\n              <div>\r\n                <label htmlFor=\"payment_type_id\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment Method <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"payment_type_id\"\r\n                  name=\"payment_type_id\"\r\n                  value={formData.payment_type_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">-- Select Payment Method --</option>\r\n                  {(Array.isArray(paymentTypes) ? paymentTypes : []).map(type => (\r\n                    <option key={type.id} value={type.id}>{type.name}</option>\r\n                  ))}\r\n                </select>\r\n                {errors.payment_type_id && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.payment_type_id}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Income Type (Optional) */}\r\n              <div>\r\n                <label htmlFor=\"income_type_id\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment For <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"income_type_id\"\r\n                  name=\"income_type_id\"\r\n                  value={formData.income_type_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">-- Select Income Type --</option>\r\n                  {(Array.isArray(incomeTypes) ? incomeTypes : []).map(type => (\r\n                    <option key={type.id} value={type.id}>{type.title}</option>\r\n                  ))}\r\n                </select>\r\n                {errors.income_type_id && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.income_type_id}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Amount */}\r\n              <div>\r\n                <label htmlFor=\"amount\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Amount <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    id=\"amount\"\r\n                    name=\"amount\"\r\n                    value={formData.amount || ''}\r\n                    onChange={handleInputChange}\r\n                    min=\"0\"\r\n                    step=\"0.01\"\r\n                    placeholder=\"Enter amount in Rs.\"\r\n                    className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                  />\r\n                </div>\r\n                {errors.amount && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.amount}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Received Amount */}\r\n              <div>\r\n                <label htmlFor=\"received_amount\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Received Amount\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    id=\"received_amount\"\r\n                    name=\"received_amount\"\r\n                    value={formData.received_amount || ''}\r\n                    onChange={handleInputChange}\r\n                    min=\"0\"\r\n                    step=\"0.01\"\r\n                    placeholder=\"Amount received\"\r\n                    className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                  />\r\n                </div>\r\n                {errors.received_amount && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.received_amount}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Due Amount (Calculated) */}\r\n              <div>\r\n                <label htmlFor=\"due_amount\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Due Amount\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    id=\"due_amount\"\r\n                    name=\"due_amount\"\r\n                    value={formData.due_amount || 0}\r\n                    readOnly\r\n                    className=\"w-full px-4 py-2.5 border border-gray-300 bg-gray-50 rounded-md text-sm cursor-not-allowed\"\r\n                  />\r\n                </div>\r\n                <p className=\"text-xs text-gray-500 mt-1\">This amount is automatically calculated.</p>\r\n              </div>\r\n\r\n              {/* Payment Status */}\r\n              <div>\r\n                <label htmlFor=\"payment_status\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment Status <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"payment_status\"\r\n                  name=\"payment_status\"\r\n                  value={formData.payment_status}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"paid\">Paid</option>\r\n                  <option value=\"partial\">Partial</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Payment Date (Date Only) */}\r\n              <div>\r\n                <label htmlFor=\"income_date\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment Date <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  id=\"income_date\"\r\n                  name=\"income_date\"\r\n                  value={formData.income_date ? formData.income_date.split('T')[0] : ''}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                />\r\n                {errors.income_date && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.income_date}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Notes - Full Width */}\r\n              <div className=\"col-span-1 md:col-span-2\">\r\n                <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Notes (Optional)\r\n                </label>\r\n                <textarea\r\n                  id=\"description\"\r\n                  name=\"description\"\r\n                  value={formData.description || ''}\r\n                  onChange={handleInputChange}\r\n                  rows={4}\r\n                  placeholder=\"Enter any additional notes here...\"\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                />\r\n              </div>\r\n\r\n              {/* File Attachment using SingleImageUploadEdit - Full Width */}\r\n              <div className=\"col-span-1 md:col-span-2\">\r\n                <SingleImageUploadEdit\r\n                  imagePreview={attachmentPreview}\r\n                  existingImageUrl={currentIncome?.income_attachment ? \r\n                    getImageUrl(currentIncome.income_attachment) : null\r\n                  }\r\n                  onFileSelect={(file) => {\r\n                    // Create a preview URL\r\n                    const previewUrl = URL.createObjectURL(file);\r\n                    setAttachmentPreview(previewUrl);\r\n                    \r\n                    // Update form data\r\n                    setFormData(prev => ({\r\n                      ...prev,\r\n                      income_attachment: file\r\n                    }));\r\n                  }}\r\n                  onRemove={() => {\r\n                    // Clear the preview and form data\r\n                    setAttachmentPreview(null);\r\n                    setFormData(prev => ({\r\n                      ...prev,\r\n                      income_attachment: undefined\r\n                    }));\r\n                  }}\r\n                  error={errors.income_attachment}\r\n                  label=\"Receipt/Attachment (Optional)\"\r\n                  onImageClick={(url, alt) => {\r\n                    setImageModalSrc(url);\r\n                    setImageModalAlt(alt);\r\n                    setIsImageModalOpen(true);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions - Full Width */}\r\n            <div className=\"flex justify-end space-x-3 mt-8 pt-5 border-t border-gray-200 col-span-1 md:col-span-2\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => router.back()}\r\n                className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 text-sm font-medium\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isSubmitting}\r\n                className=\"bg-[#235999] hover:bg-[#1c4a82] text-white px-6 py-2 rounded-md text-sm font-medium flex items-center gap-1\"\r\n              >\r\n                {isSubmitting ? (\r\n                  <>\r\n                    <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                    </svg>\r\n                    Saving...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                      <path d=\"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z\"></path>\r\n                      <polyline points=\"17 21 17 13 7 13 7 21\"></polyline>\r\n                      <polyline points=\"7 3 7 8 15 8\"></polyline>\r\n                    </svg>\r\n                    Update Payment\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Image Preview Modal */}\r\n      <ImageModal\r\n        show={isImageModalOpen}\r\n        onClose={() => setIsImageModalOpen(false)}\r\n        imageUrl={imageModalSrc}\r\n        alt={imageModalAlt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\income\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ActionButtons' is defined but never used.","line":10,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ConfirmModal' is defined but never used.","line":10,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formatCurrency' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":24},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":261,"column":23,"nodeType":"JSXOpeningElement","endLine":265,"endColumn":25}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useParams } from 'next/navigation';\r\nimport { incomeApi } from '@/lib/api/income.api';\r\nimport { Income } from '@/lib/api/types';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { TableSkeleton, ActionButtons, Button, ConfirmModal } from '@/components/ui';\r\nimport { formatCurrency, formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function IncomeDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = Array.isArray(params.id) ? params.id[0] : params.id || '';\r\n\r\n  const [income, setIncome] = useState<Income | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchIncome = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch income data from API\r\n        const data = await incomeApi.getIncome(id);\r\n        \r\n        setIncome(data);\r\n      } catch (error) {\r\n        console.error('Error fetching income details:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load income details: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load income details. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchIncome();\r\n  }, [id]);\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      \r\n      // Delete income record using API\r\n      await incomeApi.deleteIncome(id);\r\n      \r\n      router.push('/admin/income');\r\n    } catch (error) {\r\n      console.error('Error deleting income:', error);\r\n      setError('Failed to delete income record.');\r\n      setShowDeleteModal(false);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const getStatusBadgeClass = (status?: string) => {\r\n    switch (status) {\r\n      case 'paid':\r\n        return 'bg-green-100 text-green-800';\r\n      case 'partial':\r\n        return 'bg-amber-100 text-amber-800';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  const getStatusText = (status?: string) => {\r\n    switch (status) {\r\n      case 'paid':\r\n        return 'Paid';\r\n      case 'partial':\r\n        return 'Partial Payment';\r\n      default:\r\n        return 'Unknown';\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Income Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading income data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/income')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Income List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!income) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-amber-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-amber-800\">Income record not found.</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/income')}\r\n            className=\"mt-3 bg-amber-100 hover:bg-amber-200 text-amber-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Income List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header with Actions */}\r\n        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-6\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Income Details</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">View complete payment information</p>\r\n          </div>\r\n          <div className=\"mt-4 md:mt-0 flex space-x-2\">\r\n            <Button\r\n              onClick={() => router.push(`/admin/income/${income.id}/edit`)}\r\n              variant=\"edit\"\r\n            >\r\n              Edit Payment\r\n            </Button>\r\n            <Button\r\n              onClick={() => setShowDeleteModal(true)}\r\n              disabled={isDeleting}\r\n              variant=\"delete\"\r\n              loading={isDeleting}\r\n            >\r\n              {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Payment Status Banner */}\r\n        <div className={`mb-6 p-4 rounded-lg ${getStatusBadgeClass(income.payment_status)} bg-opacity-20`}>\r\n          <div className=\"flex items-center\">\r\n            <div className={`p-2 rounded-full ${getStatusBadgeClass(income.payment_status)}`}>\r\n              {income.payment_status === 'paid' && (\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              )}\r\n              {income.payment_status === 'partial' && (\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              )}\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <h3 className=\"text-sm font-medium\">{getStatusText(income.payment_status)}</h3>\r\n              <p className=\"text-sm\">\r\n                {income.payment_status === 'paid' && 'Full payment has been received.'}\r\n                {income.payment_status === 'partial' && 'Partial payment has been received. The remaining amount is due.'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Income Details Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-6\">\r\n          <div className=\"p-6\">\r\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Payment Details</h2>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              <div>\r\n                <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Basic Information</h3>\r\n                <dl className=\"divide-y divide-gray-200\">\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Payment ID</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{income.id}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Payment Date</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{formatDate(income.income_date)}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Payment Method</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{income.payment_type?.name || 'N/A'}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Payment For</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{income.income_type?.title || 'N/A'}</dd>\r\n                  </div>\r\n                  {income.title && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Title</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{income.title}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              <div>\r\n                <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Amount Information</h3>\r\n                <dl className=\"divide-y divide-gray-200\">\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Total Amount</dt>\r\n                    <dd className=\"text-sm text-gray-900 font-medium\">Rs. {Number(income.amount).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Received Amount</dt>\r\n                    <dd className=\"text-sm text-green-600 font-medium\">Rs. {Number(income.received_amount || 0).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Due Amount</dt>\r\n                    <dd className=\"text-sm text-red-600 font-medium\">Rs. {Number(income.due_amount || 0).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Created At</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{formatDate(income.created_at)}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Last Updated</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{formatDate(income.updated_at)}</dd>\r\n                  </div>\r\n                </dl>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Student Information */}\r\n            {income.student && (\r\n              <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n                <h3 className=\"text-sm font-medium text-gray-500 mb-3\">Student Information</h3>\r\n                <div className=\"flex items-center\">\r\n                  <div className=\"h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-lg font-medium\">\r\n                    {income.student.student_image ? (\r\n                      <img \r\n                        src={getImageUrl(income.student.student_image)} \r\n                        alt={income.student.student_name}\r\n                        className=\"h-12 w-12 rounded-full object-cover\" \r\n                      />\r\n                    ) : (\r\n                      income.student.student_name.charAt(0).toUpperCase()\r\n                    )}\r\n                  </div>\r\n                  <div className=\"ml-4\">\r\n                    <h4 className=\"text-base font-medium text-gray-900\">{income.student.student_name}</h4>\r\n                    <div className=\"mt-1 flex items-center text-sm text-gray-500\">\r\n                      <span className=\"truncate\">{income.student.email}</span>\r\n                      <span className=\"mx-2 inline-block h-1 w-1 rounded-full bg-gray-400\"></span>\r\n                      <span>{income.student.contact_number}</span>\r\n                    </div>\r\n                    {income.student.room && (\r\n                      <p className=\"mt-1 text-xs text-gray-500\">\r\n                        Room: {income.student.room.room_name} ({income.student.room.block?.block_name || 'Unknown Block'})\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Notes */}\r\n            {income.description && (\r\n              <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n                <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Notes</h3>\r\n                <p className=\"text-sm text-gray-700 whitespace-pre-line\">{income.description}</p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Attachment if available */}\r\n            {income.income_attachment && (\r\n              <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n                <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Attachments</h3>\r\n                <a \r\n                  href={getImageUrl(income.income_attachment)} \r\n                  target=\"_blank\" \r\n                  rel=\"noopener noreferrer\"\r\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\r\n                >\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\r\n                  </svg>\r\n                  View Attachment\r\n                </a>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed inset-0 z-10 overflow-y-auto\">\r\n          <div className=\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\r\n            <div className=\"fixed inset-0 transition-opacity\" aria-hidden=\"true\">\r\n              <div className=\"absolute inset-0 bg-gray-500 opacity-75\"></div>\r\n            </div>\r\n\r\n            <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\r\n\r\n            <div className=\"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full\">\r\n              <div className=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                <div className=\"sm:flex sm:items-start\">\r\n                  <div className=\"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10\">\r\n                    <svg className=\"h-6 w-6 text-red-600\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n                    </svg>\r\n                  </div>\r\n                  <div className=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\">\r\n                    <h3 className=\"text-lg leading-6 font-medium text-gray-900\">Delete Income Record</h3>\r\n                    <div className=\"mt-2\">\r\n                      <p className=\"text-sm text-gray-500\">\r\n                        Are you sure you want to delete this income record? This action cannot be undone.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleDelete}\r\n                  disabled={isDeleting}\r\n                  className=\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm\"\r\n                >\r\n                  {isDeleting ? 'Deleting...' : 'Delete'}\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowDeleteModal(false)}\r\n                  className=\"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\income\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormField' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ActionButtons' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { incomeApi } from '@/lib/api/income.api';\r\nimport { IncomeFormData, Student, IncomeType, PaymentType } from '@/lib/api/types';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button,\r\n  FormField,\r\n  TableSkeleton,\r\n  ActionButtons,\r\n  SingleImageUploadCreate,\r\n  ImageModal\r\n} from '@/components/ui';\r\n\r\nexport default function CreateIncome() {\r\n  const router = useRouter();\r\n  // Format the current date and time for the datetime-local input\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  const month = String(now.getMonth() + 1).padStart(2, '0');\r\n  const day = String(now.getDate()).padStart(2, '0');\r\n  const hours = String(now.getHours()).padStart(2, '0');\r\n  const minutes = String(now.getMinutes()).padStart(2, '0');\r\n  const currentDate = `${year}-${month}-${day}T${hours}:${minutes}`;\r\n  \r\n  const [formData, setFormData] = useState<IncomeFormData>({\r\n    student_id: '',\r\n    income_type_id: '',\r\n    payment_type_id: '',\r\n    amount: 0,\r\n    income_date: currentDate.split('T')[0], // Only keep the date part\r\n    received_amount: 0,\r\n    due_amount: 0,\r\n    payment_status: 'paid'\r\n  });\r\n  \r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  // Image upload states\r\n  const [attachmentPreview, setAttachmentPreview] = useState<string | null>(null);\r\n  const [isImageModalOpen, setIsImageModalOpen] = useState(false);\r\n  const [imageModalSrc, setImageModalSrc] = useState('');\r\n  const [imageModalAlt, setImageModalAlt] = useState('');\r\n  \r\n  const [students, setStudents] = useState<Student[]>([]);\r\n  const [incomeTypes, setIncomeTypes] = useState<IncomeType[]>([]);\r\n  const [paymentTypes, setPaymentTypes] = useState<PaymentType[]>([]);\r\n\r\n  // Fetch dropdown data\r\n  useEffect(() => {\r\n    const fetchDropdownData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch data from API\r\n        const [studentsData, incomeTypesData, paymentTypesData] = await Promise.all([\r\n          incomeApi.getStudents(),\r\n          incomeApi.getIncomeTypes(),\r\n          incomeApi.getPaymentTypes()\r\n        ]);\r\n        \r\n        setStudents(studentsData);\r\n        setIncomeTypes(incomeTypesData);\r\n        setPaymentTypes(paymentTypesData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching dropdown data:', error);\r\n        if (error instanceof ApiError) {\r\n          setErrors({\r\n            fetch: `Failed to load data: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            fetch: 'Failed to load form data. Please try again.'\r\n          });\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchDropdownData();\r\n  }, []);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    if (name === 'student_id') {\r\n      // When student is selected, fetch their monthly fee if available\r\n      const selectedStudent = students.find(student => student.id === value);\r\n      console.log('Selected student:', selectedStudent);\r\n      \r\n      setFormData(prev => {\r\n        const newState = {\r\n          ...prev,\r\n          [name]: value\r\n        };\r\n        \r\n        // Auto-fill amount with student's monthly fee if available\r\n        if (selectedStudent?.monthly_fee) {\r\n          const monthlyFee = parseFloat(selectedStudent.monthly_fee) || 0;\r\n          if (monthlyFee > 0) {\r\n            newState.amount = monthlyFee;\r\n            newState.received_amount = monthlyFee; // Default to full payment\r\n            newState.due_amount = 0;\r\n            newState.payment_status = 'paid';\r\n            \r\n            // Find and select the monthly fee income type if available\r\n            const monthlyFeeType = incomeTypes.find(type => \r\n              type.title.toLowerCase().includes('monthly') || \r\n              type.title.toLowerCase().includes('rent') || \r\n              type.title.toLowerCase().includes('fee')\r\n            );\r\n            if (monthlyFeeType) {\r\n              newState.income_type_id = monthlyFeeType.id;\r\n            }\r\n          }\r\n        }\r\n        \r\n        return newState;\r\n      });\r\n    } else if (name === 'amount' || name === 'received_amount') {\r\n      const numValue = parseFloat(value) || 0;\r\n      \r\n      setFormData(prev => {\r\n        const newState = {\r\n          ...prev,\r\n          [name]: numValue\r\n        };\r\n        \r\n        // Auto-calculate due amount when amount or received_amount changes\r\n        if (name === 'amount' || name === 'received_amount') {\r\n          newState.due_amount = Math.max(0, newState.amount - (newState.received_amount || 0));\r\n          \r\n          // Auto-update payment status based on due amount\r\n          if (newState.due_amount > 0) {\r\n            newState.payment_status = 'partial';\r\n          } else {\r\n            newState.payment_status = 'paid';\r\n          }\r\n        }\r\n        \r\n        return newState;\r\n      });\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value\r\n      }));\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.student_id) {\r\n      newErrors.student_id = 'Student is required';\r\n    }\r\n\r\n    if (!formData.payment_type_id) {\r\n      newErrors.payment_type_id = 'Payment method is required';\r\n    }\r\n    \r\n    if (!formData.income_type_id) {\r\n      newErrors.income_type_id = 'Income Type is required';\r\n    }\r\n\r\n    if (!formData.amount || formData.amount <= 0) {\r\n      newErrors.amount = 'Amount must be greater than 0';\r\n    }\r\n\r\n    if (!formData.income_date) {\r\n      newErrors.income_date = 'Payment date is required';\r\n    }\r\n\r\n    if (formData.received_amount !== undefined && formData.received_amount < 0) {\r\n      newErrors.received_amount = 'Received amount cannot be negative';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      // Create income record using API\r\n      await incomeApi.createIncome(formData);\r\n      \r\n      // Redirect to incomes list on success\r\n      router.push('/admin/income');\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating income:', error);\r\n      if (error instanceof ApiError) {\r\n        setErrors({\r\n          submit: `Failed to create payment record: ${error.message}`\r\n        });\r\n      } else {\r\n        setErrors({\r\n          submit: 'An error occurred while creating the payment record. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Record New Income</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading form data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/income')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Go Back\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 w-full p-4 md:p-6\">\r\n      <div className=\"w-full\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Record Payment</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Create a new payment record in the system</p>\r\n        </div>\r\n\r\n        {/* Modern Form Card - Full Width */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-6\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-700 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5 md:gap-6\">\r\n              {/* Student Selection */}\r\n              <div>\r\n                <label htmlFor=\"student_id\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Select Student <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"student_id\"\r\n                  name=\"student_id\"\r\n                  value={formData.student_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">-- Select a Student --</option>\r\n                  {(Array.isArray(students) ? students : []).map(student => {\r\n                    // We can't style part of an option element directly with CSS\r\n                    // But we can indicate due amounts clearly in the text\r\n                    const displayText = student.due_amount && student.due_amount > 0\r\n                      ? `${student.student_name}  (Due: Rs. ${student.due_amount})`\r\n                      : student.student_name;\r\n                      \r\n                    return (\r\n                      <option key={student.id} value={student.id}>\r\n                        {displayText}\r\n                      </option>\r\n                    );\r\n                  })}\r\n                </select>\r\n                {errors.student_id && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.student_id}\r\n                  </div>\r\n                )}\r\n                <p className=\"text-xs text-gray-500 mt-1\">Select the student for whom you are recording the payment.</p>\r\n              </div>\r\n\r\n              {/* Payment Method */}\r\n              <div>\r\n                <label htmlFor=\"payment_type_id\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment Method <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"payment_type_id\"\r\n                  name=\"payment_type_id\"\r\n                  value={formData.payment_type_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">Select Payment Method</option>\r\n                  {(Array.isArray(paymentTypes) ? paymentTypes : []).map(type => (\r\n                    <option key={type.id} value={type.id}>{type.name}</option>\r\n                  ))}\r\n                </select>\r\n                {errors.payment_type_id && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.payment_type_id}\r\n                  </div>\r\n                )}\r\n                <p className=\"text-xs text-gray-500 mt-1\">Choose the method of payment.</p>\r\n              </div>\r\n              \r\n              {/* Income Type (Optional) */}\r\n              <div>\r\n                <label htmlFor=\"income_type_id\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment For <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"income_type_id\"\r\n                  name=\"income_type_id\"\r\n                  value={formData.income_type_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">-- Select Income Type --</option>\r\n                  {(Array.isArray(incomeTypes) ? incomeTypes : []).map(type => (\r\n                    <option key={type.id} value={type.id}>{type.title}</option>\r\n                  ))}\r\n                </select>\r\n                {errors.income_type_id && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.income_type_id}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Amount */}\r\n              <div>\r\n                <label htmlFor=\"amount\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Amount <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    id=\"amount\"\r\n                    name=\"amount\"\r\n                    value={formData.amount || ''}\r\n                    onChange={handleInputChange}\r\n                    min=\"0\"\r\n                    step=\"0.01\"\r\n                    placeholder=\"Enter amount in Rs.\"\r\n                    className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                  />\r\n                </div>\r\n                {errors.amount && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.amount}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Received Amount */}\r\n              <div>\r\n                <label htmlFor=\"received_amount\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Received Amount\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    id=\"received_amount\"\r\n                    name=\"received_amount\"\r\n                    value={formData.received_amount || ''}\r\n                    onChange={handleInputChange}\r\n                    min=\"0\"\r\n                    step=\"0.01\"\r\n                    placeholder=\"Amount received\"\r\n                    className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                  />\r\n                </div>\r\n                {errors.received_amount && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.received_amount}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Due Amount (Calculated) */}\r\n              <div>\r\n                <label htmlFor=\"due_amount\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Due Amount\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    id=\"due_amount\"\r\n                    name=\"due_amount\"\r\n                    value={formData.due_amount || 0}\r\n                    readOnly\r\n                    className=\"w-full px-4 py-2.5 border border-gray-300 bg-gray-50 rounded-md text-sm cursor-not-allowed\"\r\n                  />\r\n                </div>\r\n                <p className=\"text-xs text-gray-500 mt-1\">This amount is automatically calculated.</p>\r\n              </div>\r\n              \r\n              {/* Payment Status */}\r\n              <div>\r\n                <label htmlFor=\"payment_status\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment Status <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"payment_status\"\r\n                  name=\"payment_status\"\r\n                  value={formData.payment_status}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"paid\">Paid</option>\r\n                  <option value=\"partial\">Partial</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Payment Date (Date Only) */}\r\n              <div>\r\n                <label htmlFor=\"income_date\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Payment Date <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  id=\"income_date\"\r\n                  name=\"income_date\"\r\n                  value={formData.income_date}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                />\r\n                {errors.income_date && (\r\n                  <div className=\"mt-1.5 text-xs text-red-600\">\r\n                    {errors.income_date}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Notes - Full Width */}\r\n              <div className=\"col-span-1 md:col-span-2\">\r\n                <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-900 mb-1\">\r\n                  Notes (Optional)\r\n                </label>\r\n                <textarea\r\n                  id=\"description\"\r\n                  name=\"description\"\r\n                  value={formData.description || ''}\r\n                  onChange={handleInputChange}\r\n                  rows={4}\r\n                  placeholder=\"Enter any additional notes here...\"\r\n                  className=\"w-full px-4 py-2.5 border border-gray-300 rounded-md text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* File Attachment using SingleImageUploadCreate - Full Width */}\r\n            <div className=\"mt-5 col-span-1 md:col-span-2\">\r\n              <SingleImageUploadCreate\r\n                imagePreview={attachmentPreview}\r\n                onFileSelect={(file) => {\r\n                  // Create a preview URL\r\n                  const previewUrl = URL.createObjectURL(file);\r\n                  setAttachmentPreview(previewUrl);\r\n                  \r\n                  // Update form data\r\n                  setFormData(prev => ({\r\n                    ...prev,\r\n                    income_attachment: file\r\n                  }));\r\n                }}\r\n                onRemove={() => {\r\n                  // Clear the preview and form data\r\n                  setAttachmentPreview(null);\r\n                  setFormData(prev => ({\r\n                    ...prev,\r\n                    income_attachment: undefined\r\n                  }));\r\n                }}\r\n                error={errors.income_attachment}\r\n                label=\"Receipt/Attachment (Optional)\"\r\n                onImageClick={(url, alt) => {\r\n                  setImageModalSrc(url);\r\n                  setImageModalAlt(alt);\r\n                  setIsImageModalOpen(true);\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            {/* Form Actions - Full Width */}\r\n            <div className=\"flex justify-end space-x-3 mt-8 pt-5 border-t border-gray-200 col-span-1 md:col-span-2\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => router.push('/admin/income')}\r\n                className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 text-sm font-medium\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isSubmitting}\r\n                className=\"bg-[#235999] hover:bg-[#1c4a82] text-white px-6 py-2 rounded-md text-sm font-medium flex items-center gap-1\"\r\n              >\r\n                {isSubmitting ? (\r\n                  <>\r\n                    <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                    </svg>\r\n                    Saving...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                      <path d=\"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z\"></path>\r\n                      <polyline points=\"17 21 17 13 7 13 7 21\"></polyline>\r\n                      <polyline points=\"7 3 7 8 15 8\"></polyline>\r\n                    </svg>\r\n                    Save Payment\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Image Preview Modal */}\r\n      <ImageModal\r\n        show={isImageModalOpen}\r\n        onClose={() => setIsImageModalOpen(false)}\r\n        imageUrl={imageModalSrc}\r\n        alt={imageModalAlt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\inquiry\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Inquiry' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":10},{"ruleId":"react/no-children-prop","severity":2,"message":"Do not pass children as props. Instead, nest children between the opening and closing tags.","line":301,"column":15,"nodeType":"JSXAttribute","messageId":"nestChildren","endLine":301,"endColumn":32}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect, use } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { \r\n  inquiryApi,\r\n  Inquiry,\r\n  InquiryFormData,\r\n  ApiError\r\n} from '@/lib/api/index';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SuccessToast,\r\n  TableSkeleton\r\n} from '@/components/ui';\r\n\r\nexport default function EditInquiry({ params }: { params: Promise<{ id: string }> }) {\r\n  const router = useRouter();\r\n  const { id: inquiryId } = use(params);\r\n  const [formData, setFormData] = useState<InquiryFormData>({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    seater_type: 1 // Default to 1-seater\r\n  });\r\n  \r\n  // Track if the form data has been loaded\r\n  const [isFormLoaded, setIsFormLoaded] = useState(false);\r\n  \r\n  const [isCustomSeater, setIsCustomSeater] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n  \r\n  // Load inquiry data\r\n  useEffect(() => {\r\n    const fetchInquiry = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        console.log('Fetching inquiry with ID:', inquiryId);\r\n        \r\n        const inquiryData = await inquiryApi.getInquiry(inquiryId);\r\n        console.log('Received inquiry data:', inquiryData);\r\n        \r\n        if (!inquiryData) {\r\n          throw new Error('No inquiry data received');\r\n        }\r\n        \r\n        const seaterType = inquiryData.seater_type || 1;\r\n        \r\n        const formDataToSet = {\r\n          name: inquiryData.name || '',\r\n          email: inquiryData.email || '',\r\n          phone: inquiryData.phone || '',\r\n          seater_type: seaterType\r\n        };\r\n        \r\n        console.log('Setting form data:', formDataToSet);\r\n        \r\n        // Initialize form data\r\n        setFormData(formDataToSet);\r\n        \r\n        // Set custom seater flag if seater type is not 1-4\r\n        setIsCustomSeater(seaterType > 4 || seaterType < 1);\r\n        setIsFormLoaded(true);\r\n      } catch (error) {\r\n        console.error('Error fetching inquiry:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load inquiry: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load inquiry data. Please try refreshing the page.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    fetchInquiry();\r\n  }, [inquiryId]);\r\n  \r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    if (name === 'seater_type') {\r\n      // Only allow numbers and ensure value is within reasonable range\r\n      const numValue = value ? parseInt(value) : 0;\r\n      if (!isNaN(numValue) && numValue > 0) {\r\n        setFormData({\r\n          ...formData,\r\n          seater_type: numValue\r\n        });\r\n      }\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n  };\r\n  \r\n  // No seater array logic needed\r\n  \r\n\r\n  \r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    // Validate required fields\r\n    if (!formData.name || !formData.phone) {\r\n      setError('Please fill in all required fields.');\r\n      return;\r\n    }\r\n    \r\n    setIsSubmitting(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      await inquiryApi.updateInquiry(inquiryId, formData);\r\n      setSuccess('Inquiry updated successfully!');\r\n      setTimeout(() => {\r\n        router.push('/admin/inquiry');\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error('Error updating inquiry:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(`Failed to update inquiry: ${error.message}`);\r\n      } else {\r\n        setError('Failed to update inquiry. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading || !isFormLoaded) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Inquiry</h1>\r\n            <p className=\"text-sm text-gray-500 mt-1\">Loading inquiry data for ID: {inquiryId}...</p>\r\n          </div>\r\n          <TableSkeleton />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  if (!formData || (!formData.name && !formData.phone && !isLoading)) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">No inquiry data found for ID: {inquiryId}</p>\r\n            </div>\r\n            <button\r\n              onClick={() => router.push('/admin/inquiry')}\r\n              className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n            >\r\n              Back to Inquiries\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Success Toast */}\r\n        {success && (\r\n          <SuccessToast\r\n            show={!!success}\r\n            message={success}\r\n            progress={100}\r\n            onClose={() => setSuccess(null)}\r\n          />\r\n        )}\r\n        \r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Inquiry</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Modify inquiry details for {formData.name}</p>\r\n        </div>\r\n      \r\n      {/* Error Alert */}\r\n      {error && (\r\n        <div className=\"mb-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded\">\r\n          <p className=\"font-medium\">Error</p>\r\n          <p>{error}</p>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Modern Form Card */}\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n        <form onSubmit={handleSubmit} className=\"p-4\">\r\n          {/* Error Alert */}\r\n          {error && (\r\n            <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n              <p className=\"text-red-800 text-sm\">{error}</p>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n            {/* Student Name */}\r\n            <FormField\r\n              label=\"Student Name\"\r\n              name=\"name\"\r\n              value={formData.name}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter student name\"\r\n              required\r\n              error={!formData.name && error ? 'Name is required' : ''}\r\n            />\r\n            \r\n            {/* Email */}\r\n            <FormField\r\n              label=\"Email Address\"\r\n              name=\"email\"\r\n              value={formData.email || ''}\r\n              onChange={handleInputChange}\r\n              type=\"email\"\r\n              placeholder=\"Enter email address (optional)\"\r\n            />\r\n            \r\n            {/* Phone */}\r\n            <FormField\r\n              label=\"Phone Number\"\r\n              name=\"phone\"\r\n              value={formData.phone}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter phone number\"\r\n              required\r\n              error={!formData.phone && error ? 'Phone number is required' : ''}\r\n            />\r\n            \r\n            {/* Number of Seaters */}\r\n            <div>\r\n              <FormField\r\n                label=\"Number of Seaters\"\r\n                name=\"seater_type_select\"\r\n                value={!isFormLoaded ? '1' : (isCustomSeater ? 'custom' : String(formData.seater_type || 1))}\r\n                onChange={(e) => {\r\n                  const value = e.target.value;\r\n                  if (value === 'custom') {\r\n                    setIsCustomSeater(true);\r\n                    return;\r\n                  }\r\n                  setIsCustomSeater(false);\r\n                  setFormData({\r\n                    ...formData,\r\n                    seater_type: parseInt(value) || 1\r\n                  });\r\n                }}\r\n                type=\"select\"\r\n                options={[\r\n                  { value: '1', label: '1-Seater' },\r\n                  { value: '2', label: '2-Seater' },\r\n                  { value: '3', label: '3-Seater' },\r\n                  { value: '4', label: '4-Seater' },\r\n                  { value: 'custom', label: 'Custom Seater' }\r\n                ]}\r\n                required\r\n                error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n              />\r\n            </div>\r\n\r\n            {/* Custom Seater Input - Show only when custom is selected */}\r\n            {isCustomSeater && (\r\n              <FormField\r\n                label=\"Custom Seater Number\"\r\n                name=\"seater_type\"\r\n                value={String(formData.seater_type || '')}\r\n                onChange={(e) => {\r\n                  const numValue = e.target.value ? parseInt(e.target.value) : 1;\r\n                  if (!isNaN(numValue) && numValue > 0) {\r\n                    setFormData({\r\n                      ...formData,\r\n                      seater_type: numValue\r\n                    });\r\n                  }\r\n                }}\r\n                type=\"text\"\r\n                placeholder=\"Enter custom number of seaters\"\r\n                required\r\n                error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n              />\r\n            )}\r\n          </div>\r\n          \r\n          {/* Form Actions */}\r\n          <div className=\"flex items-center justify-end space-x-2 pt-4 border-t border-gray-200 mt-4\">\r\n            <CancelButton \r\n              onClick={() => router.push('/admin/inquiry')} \r\n              children=\"Cancel\"\r\n            />\r\n            <SubmitButton \r\n              loading={isSubmitting} \r\n              loadingText=\"Updating...\"\r\n            >\r\n              Update Inquiry\r\n            </SubmitButton>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n  \r\n  // No helper functions needed as room selection has been removed\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\inquiry\\create\\page.tsx","messages":[{"ruleId":"react/no-children-prop","severity":2,"message":"Do not pass children as props. Instead, nest children between the opening and closing tags.","line":222,"column":15,"nodeType":"JSXAttribute","messageId":"nestChildren","endLine":222,"endColumn":32}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { \r\n  inquiryApi, \r\n  InquiryFormData,\r\n  ApiError,\r\n} from '@/lib/api/index';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SuccessToast,\r\n} from '@/components/ui';\r\n\r\nexport default function CreateInquiry() {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState<InquiryFormData>({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    seater_type: 1\r\n  });\r\n  const [isCustomSeater, setIsCustomSeater] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n  \r\n  // Form handling logic\r\n  \r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    if (name === 'seater_type') {\r\n      // Only allow numbers and ensure value is within reasonable range\r\n      const numValue = value ? parseInt(value) : 0;\r\n      if (!isNaN(numValue) && numValue > 0) {\r\n        setFormData({\r\n          ...formData,\r\n          seater_type: numValue\r\n        });\r\n      }\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n  };\r\n  \r\n  // Room seater options have been removed\r\n  // No helper functions needed for room selection\r\n  \r\n\r\n  \r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validate required fields\r\n    if (!formData.name || !formData.phone || !formData.seater_type) {\r\n      setError('Please fill in all required fields.');\r\n      return;\r\n    }\r\n    \r\n    setIsSubmitting(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      console.log('Submitting data:', formData);\r\n      const response = await inquiryApi.createInquiry(formData);\r\n      console.log('Create response:', response);\r\n      \r\n      setSuccess('Inquiry created successfully!');\r\n      \r\n      // Reset form\r\n      setFormData({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        seater_type: 1\r\n      });\r\n      \r\n      // Redirect after delay\r\n      setTimeout(() => {\r\n        router.push('/admin/inquiry');\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating inquiry:', error);\r\n      if (error instanceof ApiError && error.validation) {\r\n        // Show validation errors if available\r\n        const validationMessages = Object.values(error.validation).flat();\r\n        setError(validationMessages.join('\\n'));\r\n      } else if (error instanceof ApiError) {\r\n        setError(`Failed to create inquiry: ${error.message}`);\r\n      } else {\r\n        setError('Failed to create inquiry. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      {/* Success Toast */}\r\n      {success && (\r\n        <SuccessToast\r\n          show={!!success}\r\n          message={success}\r\n          progress={100}\r\n          onClose={() => setSuccess(null)}\r\n        />\r\n      )}\r\n      \r\n      <div className=\"w-full max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create New Inquiry</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Record a new student inquiry for accommodation</p>\r\n        </div>\r\n        \r\n        {/* Error Alert */}\r\n        {error && (\r\n          <div className=\"mb-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded\">\r\n            <p className=\"font-medium\">Error</p>\r\n            <p>{error}</p>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n          <div className=\"grid grid-cols-1 gap-6 mb-6 md:grid-cols-2\">\r\n            {/* Student Name */}\r\n            <FormField\r\n              label=\"Student Name\"\r\n              name=\"name\"\r\n              value={formData.name}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter student name\"\r\n              required\r\n              error={!formData.name && error ? 'Name is required' : ''}\r\n            />\r\n            \r\n            {/* Phone */}\r\n            <FormField\r\n              label=\"Phone Number\"\r\n              name=\"phone\"\r\n              value={formData.phone}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter phone number\"\r\n              required\r\n              error={!formData.phone && error ? 'Phone number is required' : ''}\r\n            />\r\n            \r\n            {/* Email */}\r\n            <FormField\r\n              label=\"Email Address\"\r\n              name=\"email\"\r\n              value={formData.email || ''}\r\n              onChange={handleInputChange}\r\n              type=\"email\"\r\n              placeholder=\"Enter email address (optional)\"\r\n            />\r\n            \r\n            {/* Number of Seaters */}\r\n            <div className=\"space-y-2\">\r\n              <FormField\r\n                label=\"Number of Seaters\"\r\n                name=\"seater_type_select\"\r\n                value={isCustomSeater ? 'custom' : formData.seater_type.toString()}\r\n                onChange={(e) => {\r\n                  const value = e.target.value;\r\n                  if (value === 'custom') {\r\n                    setIsCustomSeater(true);\r\n                    return;\r\n                  }\r\n                  setIsCustomSeater(false);\r\n                  setFormData({\r\n                    ...formData,\r\n                    seater_type: parseInt(value)\r\n                  });\r\n                }}\r\n                type=\"select\"\r\n                options={[\r\n                  { value: '1', label: '1-Seater' },\r\n                  { value: '2', label: '2-Seater' },\r\n                  { value: '3', label: '3-Seater' },\r\n                  { value: '4', label: '4-Seater' },\r\n                  { value: 'custom', label: 'Custom Seater' }\r\n                ]}\r\n                required\r\n                error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n              />\r\n              {isCustomSeater && (\r\n                <FormField\r\n                  label=\"Custom Seater Number\"\r\n                  name=\"seater_type\"\r\n                  value={formData.seater_type?.toString() || ''}\r\n                  onChange={(e) => {\r\n                    const numValue = e.target.value ? parseInt(e.target.value) : 0;\r\n                    if (!isNaN(numValue) && numValue > 0) {\r\n                      setFormData({\r\n                        ...formData,\r\n                        seater_type: numValue\r\n                      });\r\n                    }\r\n                  }}\r\n                  type=\"text\"\r\n                  placeholder=\"Enter custom number of seaters\"\r\n                  required\r\n                  error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        \r\n          {/* Form Actions */}\r\n          <div className=\"flex justify-end items-center gap-3 pt-6 mt-6 border-t border-gray-200\">\r\n            <CancelButton \r\n              onClick={() => router.push('/admin/inquiry')} \r\n              children=\"Cancel\"\r\n            />\r\n            <SubmitButton \r\n              loading={isSubmitting} \r\n              loadingText=\"Creating...\"\r\n            >\r\n              Create Inquiry\r\n            </SubmitButton>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n  \r\n  // No helper functions needed as room selection has been removed\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\inquiry\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCurrentPage' is assigned a value but never used.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalPages' is assigned a value but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { inquiryApi, Inquiry, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  ConfirmModal, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\n\r\nexport default function InquiryList() {\r\n  const router = useRouter();\r\n  const [inquiries, setInquiries] = useState<Inquiry[]>([]);\r\n  const [filteredInquiries, setFilteredInquiries] = useState<Inquiry[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, inquiryId: string | null}>({\r\n    show: false,\r\n    inquiryId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch inquiries from API\r\n  useEffect(() => {\r\n    const fetchInquiries = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await inquiryApi.getInquiries(currentPage);\r\n        setInquiries(response.data);\r\n        setFilteredInquiries(response.data);\r\n        setTotalPages(response.last_page);\r\n      } catch (error) {\r\n        console.error('Error fetching inquiries:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch inquiries: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch inquiries. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchInquiries();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredInquiries(inquiries);\r\n    } else {\r\n      const filtered = inquiries.filter(inquiry =>\r\n        inquiry.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        inquiry.phone.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (inquiry.email && inquiry.email.toLowerCase().includes(searchQuery.toLowerCase()))\r\n      );\r\n      setFilteredInquiries(filtered);\r\n    }\r\n  }, [searchQuery, inquiries]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: '2-digit'\r\n    });\r\n  };\r\n\r\n  const handleDeleteInquiry = async (inquiryId: string) => {\r\n    setDeleteModal({show: true, inquiryId});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const inquiryId = deleteModal.inquiryId;\r\n    if (!inquiryId) return;\r\n\r\n    try {\r\n      setIsDeleting(inquiryId);\r\n      setDeleteModal({show: false, inquiryId: null});\r\n      setAlert({show: true, message: 'Deleting inquiry...', type: 'success'});\r\n      \r\n      await inquiryApi.deleteInquiry(inquiryId);\r\n      \r\n      // Remove from local state\r\n      const updatedInquiries = inquiries.filter(inquiry => inquiry.id !== inquiryId);\r\n      setInquiries(updatedInquiries);\r\n      setFilteredInquiries(updatedInquiries.filter(inquiry =>\r\n        !searchQuery.trim() ||\r\n        inquiry.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        inquiry.phone.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (inquiry.email && inquiry.email.toLowerCase().includes(searchQuery.toLowerCase()))\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Inquiry deleted successfully!', type: 'success'});\r\n      \r\n      // Hide alert after 3 seconds\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting inquiry:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({show: true, message: `Failed to delete inquiry: ${error.message}`, type: 'error'});\r\n      } else {\r\n        setAlert({show: true, message: 'Failed to delete inquiry. Please try again.', type: 'error'});\r\n      }\r\n      \r\n      // Hide error alert after 5 seconds\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 5000);\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, inquiryId: null});\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Inquiries</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading inquiries...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Inquiry\"\r\n        message=\"Are you sure you want to delete this inquiry? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Inquiries</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{inquiries.length} total inquiries</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/admin/inquiry/create')}\r\n          icon={<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n          </svg>}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n        >\r\n          Add Inquiry\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search inquiries...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredInquiries.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No inquiries found' : 'No inquiries yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'Create your first inquiry to get started'}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/admin/inquiry/create')}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n            >\r\n              Create Inquiry\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Inquiry Details</div>\r\n              <div className=\"col-span-2\">Contact Info</div>\r\n              <div className=\"col-span-2\">Seater</div>\r\n              <div className=\"col-span-2\">Created By</div>\r\n              <div className=\"col-span-2 text-center\">Created</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredInquiries.map((inquiry) => (\r\n              <div key={inquiry.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Inquiry Details */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{inquiry.name}</div>\r\n                  </div>\r\n\r\n                  {/* Contact Info */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-900\">{inquiry.phone}</div>\r\n                    {inquiry.email && (\r\n                      <div className=\"text-xs text-gray-500 mt-1 truncate\">\r\n                        {inquiry.email}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Seater */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700\">\r\n                      {inquiry.seater_type ? `${inquiry.seater_type}-seater` : 'Not specified'}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Created By Staff */}\r\n                  <div className=\"col-span-2\">\r\n                    {inquiry.staff ? (\r\n                      <div>\r\n                        <div className=\"text-sm text-gray-900 font-medium\">{inquiry.staff.staff_name}</div>\r\n                        <div className=\"text-xs text-gray-500 truncate\">{inquiry.staff.email}</div>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"text-sm text-gray-400 italic\">Admin</div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Created Date */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-xs text-gray-500 text-center\">\r\n                      {formatDate(inquiry.created_at)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex justify-center\">\r\n                      <ActionButtons \r\n                        viewUrl={`/admin/inquiry/${inquiry.id}`}\r\n                        editUrl={`/admin/inquiry/${inquiry.id}/edit`}\r\n                        onDelete={() => handleDeleteInquiry(inquiry.id)}\r\n                        isDeleting={isDeleting === inquiry.id}\r\n                        style=\"compact\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredInquiries.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredInquiries.length} of {inquiries.length} inquiries\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\notice\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'blockApi' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'studentApi' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isLoadingData' is assigned a value but never used.","line":41,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'originalNotice' is assigned a value but never used.","line":62,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5669,5672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5669,5672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":303,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9493,9496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9493,9496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":323,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10523,10526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10523,10526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":328,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10662,10665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10662,10665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { \r\n  noticeApi, \r\n  NoticeFormData, \r\n  Notice, \r\n  blockApi, \r\n  studentApi, \r\n  StudentForNotice, \r\n  StaffForNotice, \r\n  BlockForNotice \r\n} from '@/lib/api';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  MultipleImageUploadEdit,\r\n  ImageModal\r\n} from '@/components/ui';\r\nimport { AlertCircle } from 'lucide-react';\r\n\r\ninterface ExistingAttachment {\r\n  id: number;\r\n  image: string;\r\n  is_primary: boolean;\r\n  name?: string;\r\n  type?: string;\r\n}\r\n\r\nexport default function EditNotice() {\r\n  const router = useRouter();\r\n  const { id } = useParams();\r\n  const noticeId = Array.isArray(id) ? id[0] : id || '';\r\n  \r\n  // Initialize states for students, staff, and blocks\r\n  const [students, setStudents] = useState<StudentForNotice[]>([]);\r\n  const [staff, setStaff] = useState<StaffForNotice[]>([]);\r\n  const [blocks, setBlocks] = useState<BlockForNotice[]>([]);\r\n  const [isLoadingData, setIsLoadingData] = useState<{\r\n    students: boolean;\r\n    staff: boolean;\r\n    blocks: boolean;\r\n  }>({ students: false, staff: false, blocks: false });\r\n  \r\n  const [formData, setFormData] = useState<NoticeFormData>({\r\n    title: '',\r\n    description: '',\r\n    schedule_time: new Date().toISOString().split('T')[0] + 'T' + \r\n      new Date().toTimeString().split(' ')[0].substring(0, 5),\r\n    target_type: 'all',\r\n    notice_type: 'general',\r\n    status: 'active',\r\n    notice_attachments: [],\r\n    student_id: 0,\r\n    staff_id: 0,\r\n    block_id: 0,\r\n  });\r\n  \r\n  const [showScheduleDate, setShowScheduleDate] = useState(false);\r\n  const [originalNotice, setOriginalNotice] = useState<Notice | null>(null);\r\n  \r\n  const [attachments, setAttachments] = useState<File[]>([]);\r\n  const [existingAttachments, setExistingAttachments] = useState<ExistingAttachment[]>([]);\r\n  const [removedAttachmentIds, setRemovedAttachmentIds] = useState<number[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  // Fetch notice data on component mount\r\n  useEffect(() => {\r\n    if (!noticeId) {\r\n      setErrors({ submit: 'Notice ID is missing' });\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    \r\n    const fetchData = async () => {\r\n      try {\r\n        setIsLoadingData({\r\n          students: true,\r\n          staff: true,\r\n          blocks: true\r\n        });\r\n        \r\n        // Fetch notice data first\r\n        const noticeData = await noticeApi.getNotice(noticeId);\r\n        setOriginalNotice(noticeData);\r\n        \r\n        // Check if we should show schedule date field\r\n        let formattedScheduleTime = '';\r\n        let shouldShowScheduleDate = false;\r\n        \r\n        if (noticeData.schedule_time) {\r\n          const scheduleDate = new Date(noticeData.schedule_time);\r\n          const currentDate = new Date();\r\n          \r\n          // Only show schedule date if it's in the future\r\n          if (scheduleDate > currentDate) {\r\n            shouldShowScheduleDate = true;\r\n            formattedScheduleTime = scheduleDate.toISOString().slice(0, 16);\r\n          }\r\n        }\r\n        \r\n        setShowScheduleDate(shouldShowScheduleDate);\r\n        \r\n        // Now fetch the students, staff, and blocks data using the appropriate API methods\r\n        try {\r\n          const studentsResponse = await noticeApi.getStudentsForNotice('');\r\n          setStudents(studentsResponse.data);\r\n        } catch (error) {\r\n          console.error('Error fetching students:', error);\r\n        } finally {\r\n          setIsLoadingData(prev => ({ ...prev, students: false }));\r\n        }\r\n        \r\n        try {\r\n          const staffResponse = await noticeApi.getStaffForNotice('');\r\n          setStaff(staffResponse.data);\r\n        } catch (error) {\r\n          console.error('Error fetching staff:', error);\r\n        } finally {\r\n          setIsLoadingData(prev => ({ ...prev, staff: false }));\r\n        }\r\n        \r\n        try {\r\n          const blocksResponse = await noticeApi.getBlocksForNotice('');\r\n          setBlocks(blocksResponse.data);\r\n        } catch (error) {\r\n          console.error('Error fetching blocks:', error);\r\n        } finally {\r\n          setIsLoadingData(prev => ({ ...prev, blocks: false }));\r\n        }\r\n        \r\n        // Set form data\r\n        setFormData({\r\n          title: noticeData.title,\r\n          description: noticeData.description,\r\n          schedule_time: shouldShowScheduleDate ? formattedScheduleTime : undefined,\r\n          target_type: noticeData.target_type,\r\n          notice_type: noticeData.notice_type || 'general',\r\n          status: noticeData.status || 'active',\r\n          notice_attachments: [],\r\n          student_id: noticeData.student_id || null,\r\n          staff_id: noticeData.staff_id || null,\r\n          block_id: noticeData.block_id || null,\r\n        });\r\n\r\n        // Set existing attachments\r\n        if (noticeData.attachments && noticeData.attachments.length > 0) {\r\n          const mappedAttachments = noticeData.attachments.map(attachment => ({\r\n            id: attachment.id,\r\n            image: attachment.path,\r\n            is_primary: false,\r\n            name: attachment.name,\r\n            type: attachment.type,\r\n          }));\r\n          \r\n          setExistingAttachments(mappedAttachments);\r\n        }\r\n        \r\n        setIsLoading(false);\r\n      } catch (error: any) {\r\n        console.error('Error fetching data:', error);\r\n        setErrors({\r\n          submit: error.message || 'Error loading data. Please try again.'\r\n        });\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [noticeId]);\r\n\r\n  // Auto-resize textarea function\r\n  const autoResizeTextarea = (element: HTMLTextAreaElement) => {\r\n    element.style.height = 'auto';\r\n    element.style.height = `${Math.max(element.scrollHeight, 56)}px`;\r\n  };\r\n\r\n  // Auto-resize description textarea when data is loaded\r\n  useEffect(() => {\r\n    const textarea = document.getElementById('description') as HTMLTextAreaElement;\r\n    if (textarea && formData.description) {\r\n      setTimeout(() => {\r\n        autoResizeTextarea(textarea);\r\n      }, 0);\r\n    }\r\n  }, [formData.description]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    // Convert ID fields to numbers if they're not empty\r\n    if (['student_id', 'staff_id', 'block_id'].includes(name) && value) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: parseInt(value, 10)\r\n      }));\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value\r\n      }));\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const addAttachments = (files: File[]) => {\r\n    setAttachments(prev => [...prev, ...files]);\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      notice_attachments: [...(prev.notice_attachments || []), ...files]\r\n    }));\r\n    \r\n    // Clear error if it exists\r\n    if (errors.notice_attachments) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        notice_attachments: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const removeAttachment = (index: number) => {\r\n    const updatedAttachments = [...attachments];\r\n    updatedAttachments.splice(index, 1);\r\n    setAttachments(updatedAttachments);\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      notice_attachments: updatedAttachments\r\n    }));\r\n  };\r\n\r\n  const removeExistingAttachment = (id: number) => {\r\n    setRemovedAttachmentIds(prev => [...prev, id]);\r\n    setExistingAttachments(prev => prev.filter(attachment => attachment.id !== id));\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.title.trim()) {\r\n      newErrors.title = 'Title is required';\r\n    }\r\n\r\n    if (!formData.description.trim()) {\r\n      newErrors.description = 'Description is required';\r\n    }\r\n\r\n    if (showScheduleDate && !formData.schedule_time) {\r\n      newErrors.schedule_time = 'Schedule time is required';\r\n    }\r\n\r\n    if (!formData.target_type) {\r\n      newErrors.target_type = 'Target audience is required';\r\n    }\r\n    \r\n    // Validate specific target selections\r\n    if (formData.target_type === 'specific_student' && !formData.student_id) {\r\n      newErrors.student_id = 'Please select a student';\r\n    }\r\n    \r\n    if (formData.target_type === 'specific_staff' && !formData.staff_id) {\r\n      newErrors.staff_id = 'Please select a staff member';\r\n    }\r\n    \r\n    if (formData.target_type === 'block' && !formData.block_id) {\r\n      newErrors.block_id = 'Please select a block';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    if (!noticeId) {\r\n      setErrors({ submit: 'Notice ID is missing. Cannot update.' });\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      // Make sure IDs are properly formatted\r\n      const processedFormData: any = {\r\n        title: formData.title,\r\n        description: formData.description,\r\n        target_type: formData.target_type,\r\n        notice_type: formData.notice_type,\r\n        status: formData.status,\r\n        notice_attachments: formData.notice_attachments,\r\n        // Make sure null or empty string IDs are sent as null\r\n        student_id: formData.target_type === 'specific_student' ? formData.student_id || null : null,\r\n        staff_id: formData.target_type === 'specific_staff' ? formData.staff_id || null : null,\r\n        block_id: formData.target_type === 'block' ? formData.block_id || null : null,\r\n        removed_attachments: removedAttachmentIds\r\n      };\r\n      \r\n      // Only include schedule_time if it should be shown and updated\r\n      if (showScheduleDate && formData.schedule_time) {\r\n        processedFormData.schedule_time = formData.schedule_time;\r\n      }\r\n      \r\n      console.log('Submitting notice data:', processedFormData);\r\n      await noticeApi.updateNotice(noticeId, processedFormData as any);\r\n      \r\n      // Redirect back to notice details page\r\n      router.push(`/admin/notice/${noticeId}`);\r\n      \r\n    } catch (error: any) {\r\n      console.error('Error updating notice:', error);\r\n      if (error.validation) {\r\n        // Handle validation errors from the API\r\n        const validationErrors: Record<string, string> = {};\r\n        Object.entries(error.validation).forEach(([field, messages]) => {\r\n          validationErrors[field] = Array.isArray(messages) ? messages[0] : messages as string;\r\n        });\r\n        setErrors(validationErrors);\r\n      } else {\r\n        setErrors({\r\n          submit: error.message || 'An error occurred while updating the notice. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-8 flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6 flex justify-between items-center\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Notice</h1>\r\n          \r\n          {/* Status Switch - Only Toggle */}\r\n          <div className=\"flex items-center space-x-3\">\r\n            <span className={`text-sm transition-colors ${formData.status === 'inactive' ? 'text-gray-900 font-medium' : 'text-gray-500'}`}>\r\n              Inactive\r\n            </span>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                const newStatus = formData.status === 'active' ? 'inactive' : 'active';\r\n                setFormData(prev => ({ ...prev, status: newStatus }));\r\n                if (errors.status) {\r\n                  setErrors(prev => ({ ...prev, status: '' }));\r\n                }\r\n              }}\r\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 hover:shadow-md ${\r\n                formData.status === 'active' ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-200 hover:bg-gray-300'\r\n              }`}\r\n              title={`Switch to ${formData.status === 'active' ? 'inactive' : 'active'}`}\r\n            >\r\n              <span\r\n                className={`inline-block h-4 w-4 transform rounded-full bg-white shadow-sm transition-transform duration-200 ease-in-out ${\r\n                  formData.status === 'active' ? 'translate-x-6' : 'translate-x-1'\r\n                }`}\r\n              />\r\n            </button>\r\n            <span className={`text-sm transition-colors ${formData.status === 'active' ? 'text-gray-900 font-medium' : 'text-gray-500'}`}>\r\n              Active\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Error Alert */}\r\n        {errors.submit && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n              <p className=\"text-red-800\">{errors.submit}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-8\">\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n              {/* Left Column */}\r\n              <div className=\"space-y-6\">\r\n                {/* Notice Title */}\r\n                <FormField\r\n                  name=\"title\"\r\n                  label=\"Notice Title\"\r\n                  required\r\n                  value={formData.title}\r\n                  onChange={handleInputChange}\r\n                  error={errors.title}\r\n                  placeholder=\"Enter notice title\"\r\n                />\r\n\r\n                {/* Notice Description */}\r\n                <div className=\"space-y-1.5\">\r\n                  <label htmlFor=\"description\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Notice Description <span className=\"text-red-500 ml-1\">*</span>\r\n                  </label>\r\n                  <textarea\r\n                    id=\"description\"\r\n                    name=\"description\"\r\n                    value={formData.description}\r\n                    onChange={(e) => {\r\n                      handleInputChange(e);\r\n                      const target = e.target as HTMLTextAreaElement;\r\n                      if (target.scrollHeight > 56) {\r\n                        autoResizeTextarea(target);\r\n                      } else {\r\n                        target.style.height = '56px';\r\n                      }\r\n                    }}\r\n                    onInput={(e) => {\r\n                      const target = e.target as HTMLTextAreaElement;\r\n                      if (target.scrollHeight > 56) {\r\n                        autoResizeTextarea(target);\r\n                      } else {\r\n                        target.style.height = '56px';\r\n                      }\r\n                    }}\r\n                    placeholder=\"Enter notice description\"\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200 resize-none overflow-hidden\"\r\n                    style={{ minHeight: '56px', height: '56px' }}\r\n                    rows={1}\r\n                  />\r\n                  {errors.description && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <AlertCircle className=\"h-3.5 w-3.5 mr-2\" />\r\n                      {errors.description}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Right Column */}\r\n              <div className=\"space-y-6\">\r\n                {/* Schedule Date/Time - Only show if notice originally had schedule time and it's in the future */}\r\n                {showScheduleDate && (\r\n                  <div className=\"space-y-1.5\">\r\n                    <label htmlFor=\"schedule_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                      Schedule Date <span className=\"text-red-500 ml-1\">*</span>\r\n                    </label>\r\n                    <input\r\n                      type=\"datetime-local\"\r\n                      id=\"schedule_time\"\r\n                      name=\"schedule_time\"\r\n                      value={formData.schedule_time || ''}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                    />\r\n                    {errors.schedule_time && (\r\n                      <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                        <AlertCircle className=\"h-3.5 w-3.5 mr-2\" />\r\n                        {errors.schedule_time}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Target Audience */}\r\n                <FormField\r\n                  name=\"target_type\"\r\n                  label=\"Send Notice To\"\r\n                  type=\"select\"\r\n                  required\r\n                  value={formData.target_type}\r\n                  onChange={handleInputChange}\r\n                  error={errors.target_type}\r\n                  options={[\r\n                    { value: 'all', label: 'Everyone' },\r\n                    { value: 'student', label: 'All Students' },\r\n                    { value: 'staff', label: 'All Staff' },\r\n                    { value: 'specific_student', label: 'Specific Student' },\r\n                    { value: 'specific_staff', label: 'Specific Staff' },\r\n                    { value: 'block', label: 'Specific Block' }\r\n                  ]}\r\n                />\r\n\r\n                {/* Notice Type */}\r\n                <FormField\r\n                  name=\"notice_type\"\r\n                  label=\"Notice Type\"\r\n                  type=\"select\"\r\n                  value={formData.notice_type || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.notice_type}\r\n                  options={[\r\n                    { value: 'general', label: 'General' },\r\n                    { value: 'urgent', label: 'Urgent' },\r\n                    { value: 'event', label: 'Event' },\r\n                    { value: 'announcement', label: 'Announcement' }\r\n                  ]}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Full Width Sections */}\r\n            <div className=\"space-y-6 mt-8\">\r\n              {/* Conditional Field for Specific Student */}\r\n              {formData.target_type === 'specific_student' && (\r\n                <FormField\r\n                  name=\"student_id\"\r\n                  label=\"Select Student\"\r\n                  type=\"select\"\r\n                  required\r\n                  value={formData.student_id ? formData.student_id.toString() : ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.student_id}\r\n                  options={[\r\n                    { value: '', label: '-- Select a student --' },\r\n                    ...(Array.isArray(students) ? students : []).map(student => ({\r\n                      value: student.id.toString(),\r\n                      label: `${student.name} ${student.room && student.room.block ? `(${student.room.block.name}, Room: ${student.room.room_number})` : ''}`\r\n                    }))\r\n                  ]}\r\n                />\r\n              )}\r\n\r\n              {/* Conditional Field for Specific Staff */}\r\n              {formData.target_type === 'specific_staff' && (\r\n                <FormField\r\n                  name=\"staff_id\"\r\n                  label=\"Select Staff\"\r\n                  type=\"select\"\r\n                  required\r\n                  value={formData.staff_id ? formData.staff_id.toString() : ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.staff_id}\r\n                  options={[\r\n                    { value: '', label: '-- Select a staff member --' },\r\n                    ...staff.map(staffMember => ({\r\n                      value: staffMember.id.toString(),\r\n                      label: `${staffMember.name} (${staffMember.staff_id || 'No ID'})`\r\n                    }))\r\n                  ]}\r\n                />\r\n              )}\r\n\r\n              {/* Conditional Field for Block */}\r\n              {formData.target_type === 'block' && (\r\n                <FormField\r\n                  name=\"block_id\"\r\n                  label=\"Select Block\"\r\n                  type=\"select\"\r\n                  required\r\n                  value={formData.block_id ? formData.block_id.toString() : ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.block_id}\r\n                  options={[\r\n                    { value: '', label: '-- Select a block --' },\r\n                    ...blocks.map(block => ({\r\n                      value: block.id.toString(),\r\n                      label: `${block.name} - ${block.location || 'No location'}`\r\n                    }))\r\n                  ]}\r\n                />\r\n              )}\r\n\r\n              {/* Attachments */}\r\n              <div>\r\n                <MultipleImageUploadEdit\r\n                  images={attachments}\r\n                  existingImages={existingAttachments}\r\n                  removedImageIds={removedAttachmentIds}\r\n                  onAddImages={addAttachments}\r\n                  onRemoveImage={removeAttachment}\r\n                  onRemoveExistingImage={removeExistingAttachment}\r\n                  error={errors.notice_attachments}\r\n                  label=\"Attachments\"\r\n                  onImageClick={(imageUrl, alt) => {\r\n                    setSelectedImage({ url: imageUrl, alt });\r\n                    setImageModalOpen(true);\r\n                  }}\r\n                />\r\n                <p className=\"text-xs text-gray-500 mt-1\">\r\n                  PDF, DOC, Images - Max 2MB each\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex justify-between items-center pt-6 mt-6 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.back()} />\r\n              <SubmitButton \r\n                loading={isSubmitting} \r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Notice\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\notice\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ExternalLink' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":15}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { noticeApi, Notice } from '@/lib/api';\r\nimport { Button, ImageModal } from '@/components/ui';\r\nimport { \r\n  ArrowLeft, \r\n  Edit, \r\n  Trash, \r\n  Calendar, \r\n  User,\r\n  Clock, \r\n  File,\r\n  AlertCircle,\r\n  Check,\r\n  X,\r\n  ExternalLink\r\n} from 'lucide-react';\r\nimport { formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function NoticeDetail() {\r\n  const router = useRouter();\r\n  const { id } = useParams();\r\n  const noticeId = Array.isArray(id) ? id[0] : id || '';\r\n  \r\n  const [notice, setNotice] = useState<Notice | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [showConfirmDelete, setShowConfirmDelete] = useState(false);\r\n  \r\n  // Fetch notice data\r\n  useEffect(() => {\r\n    if (!noticeId) {\r\n      setError('Notice ID is missing');\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    \r\n    const fetchNotice = async () => {\r\n      try {\r\n        const data = await noticeApi.getNotice(noticeId);\r\n        setNotice(data);\r\n      } catch (err) {\r\n        setError('Failed to load notice details');\r\n        console.error('Error fetching notice:', err);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchNotice();\r\n  }, [noticeId]);\r\n\r\n  const handleDeleteClick = () => {\r\n    setShowConfirmDelete(true);\r\n  };\r\n\r\n  const handleCancelDelete = () => {\r\n    setShowConfirmDelete(false);\r\n  };\r\n\r\n  const handleConfirmDelete = async () => {\r\n    setIsDeleting(true);\r\n    try {\r\n      await noticeApi.deleteNotice(noticeId);\r\n      router.push('/admin/notice');\r\n    } catch (err) {\r\n      console.error('Error deleting notice:', err);\r\n      setError('Failed to delete notice');\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setShowConfirmDelete(false);\r\n    }\r\n  };\r\n\r\n  const handleAttachmentClick = (url: string, name: string) => {\r\n    // For all file types, show in the modal\r\n    setSelectedImage({ url: getImageUrl(url), alt: name });\r\n    setImageModalOpen(true);\r\n  };\r\n\r\n  // Function to get file type icon\r\n  const getFileIcon = (fileName: string) => {\r\n    const extension = fileName.split('.').pop()?.toLowerCase();\r\n    \r\n    switch(extension) {\r\n      case 'pdf':\r\n        return (\r\n          <div className=\"bg-red-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-red-600\" />\r\n          </div>\r\n        );\r\n      case 'doc':\r\n      case 'docx':\r\n        return (\r\n          <div className=\"bg-blue-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-blue-600\" />\r\n          </div>\r\n        );\r\n      case 'jpg':\r\n      case 'jpeg':\r\n      case 'png':\r\n      case 'gif':\r\n        return (\r\n          <div className=\"bg-green-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-green-600\" />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div className=\"bg-gray-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-gray-600\" />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 p-4 flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !notice) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 p-4\">\r\n        <div className=\"max-w-5xl mx-auto bg-red-50 border border-red-200 rounded-lg p-6\">\r\n          <div className=\"flex items-center text-red-700 mb-4\">\r\n            <AlertCircle className=\"w-6 h-6 mr-2\" />\r\n            <h2 className=\"text-lg font-semibold\">Error</h2>\r\n          </div>\r\n          <p className=\"text-red-600\">{error || 'Notice not found'}</p>\r\n          <Button className=\"mt-6\" onClick={() => router.push('/admin/notice')}>\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            Back to Notices\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Header with Actions */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-semibold text-gray-900\">Notice Details</h1>\r\n            </div>\r\n            <div className=\"flex space-x-2\">\r\n              <Button\r\n                onClick={() => router.push(`/admin/notice/${noticeId}/edit`)}\r\n                variant=\"primary\"\r\n              >\r\n                Edit Notice\r\n              </Button>\r\n              <Button\r\n                onClick={handleDeleteClick}\r\n                disabled={isDeleting}\r\n                variant=\"danger\"\r\n                loading={isDeleting}\r\n              >\r\n                {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Notice Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n          {/* Notice Header */}\r\n          <div className=\"bg-gray-50 border-b border-gray-200 px-6 py-4\">\r\n            <div className=\"flex justify-between items-start\">\r\n              <h2 className=\"text-xl font-medium text-gray-900\">{notice.title}</h2>\r\n              <div className=\"flex items-center\">\r\n                {notice.status === 'active' ? (\r\n                  <div className=\"bg-green-100 text-green-700 px-3 py-1 rounded-full flex items-center text-sm font-medium\">\r\n                    <Check className=\"h-3.5 w-3.5 mr-1\" />\r\n                    Active\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"bg-gray-100 text-gray-700 px-3 py-1 rounded-full flex items-center text-sm font-medium\">\r\n                    <X className=\"h-3.5 w-3.5 mr-1\" />\r\n                    Inactive\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Notice Content */}\r\n          <div className=\"p-6\">\r\n            {/* Notice Metadata */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 text-sm\">\r\n              <div className=\"flex items-center text-gray-600\">\r\n                <Calendar className=\"h-4 w-4 mr-2 text-gray-500\" />\r\n                <span className=\"font-medium mr-2\">Scheduled:</span> \r\n                {formatDate(notice.schedule_time)}\r\n              </div>\r\n              <div className=\"flex items-center text-gray-600\">\r\n                <User className=\"h-4 w-4 mr-2 text-gray-500\" />\r\n                <span className=\"font-medium mr-2\">Target:</span>\r\n                {notice.target_info ? (\r\n                  notice.target_info.type === 'specific_student' ? \r\n                    `Specific Student: ${notice.target_info.name}` : \r\n                  notice.target_info.type === 'specific_staff' ? \r\n                    `Specific Staff: ${notice.target_info.name}` : \r\n                  notice.target_info.type === 'block' ? \r\n                    `Specific Block: ${notice.target_info.name}` : \r\n                  notice.target_info.name || notice.target_info.type\r\n                ) : (\r\n                  notice.target_type === 'all' ? 'Everyone' : \r\n                  notice.target_type === 'student' ? 'All Students' : \r\n                  notice.target_type === 'staff' ? 'All Staff' : \r\n                  notice.target_type === 'specific_student' && notice.student ? `Specific Student: ${notice.student.name}` :\r\n                  notice.target_type === 'specific_student' ? 'Specific Student' : \r\n                  notice.target_type === 'specific_staff' && notice.staff ? `Specific Staff: ${notice.staff.name}` :\r\n                  notice.target_type === 'specific_staff' ? 'Specific Staff' : \r\n                  notice.target_type === 'block' && notice.block ? `Specific Block: ${notice.block.name}` :\r\n                  notice.target_type === 'block' ? 'Specific Block' : \r\n                  notice.target_type\r\n                )}\r\n              </div>\r\n              <div className=\"flex items-center text-gray-600\">\r\n                <File className=\"h-4 w-4 mr-2 text-gray-500\" />\r\n                <span className=\"font-medium mr-2\">Type:</span>\r\n                {notice.notice_type ? notice.notice_type.charAt(0).toUpperCase() + notice.notice_type.slice(1) : 'N/A'}\r\n              </div>\r\n              <div className=\"flex items-center text-gray-600\">\r\n                <Clock className=\"h-4 w-4 mr-2 text-gray-500\" />\r\n                <span className=\"font-medium mr-2\">Created:</span>\r\n                {formatDate(notice.created_at)}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Target Details - Show only for specific targets */}\r\n            {(notice.target_type === 'specific_student' || \r\n              notice.target_type === 'specific_staff' || \r\n              notice.target_type === 'block') && (\r\n              <div className=\"mb-6 border-t border-gray-100 pt-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-2\">\r\n                  {notice.target_type === 'specific_student' ? 'Student' : \r\n                   notice.target_type === 'specific_staff' ? 'Staff' : 'Block'} Information\r\n                </h3>\r\n                <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-100\">\r\n                  {notice.target_info ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.target_info.name}</span>\r\n                      </div>\r\n                      {notice.target_info.type === 'specific_student' && notice.target_info.identifier ? (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Student ID:</span>\r\n                          <span>{notice.target_info.identifier}</span>\r\n                        </div>\r\n                      ) : notice.target_info.identifier ? (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">ID:</span>\r\n                          <span>{notice.target_info.identifier}</span>\r\n                        </div>\r\n                      ) : null}\r\n                      {notice.target_info.contact && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Contact:</span>\r\n                          <span>{notice.target_info.contact}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.type === 'specific_student' && notice.profile_data?.address && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Address:</span>\r\n                          <span>{notice.profile_data.address}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.location && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Location:</span>\r\n                          <span>{notice.target_info.location}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.rooms_count !== undefined && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Rooms:</span>\r\n                          <span>{notice.target_info.rooms_count}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : notice.student && notice.target_type === 'specific_student' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.student.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Student ID:</span>\r\n                        <span>{notice.student.student_id}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.student.contact}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Email:</span>\r\n                        <span>{notice.student.email}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Address:</span>\r\n                        <span>{notice.profile_data?.address || \"Not available\"}</span>\r\n                      </div>\r\n                      {notice.student.room && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Room:</span>\r\n                          <span>{notice.student.room.room_number}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : notice.staff && notice.target_type === 'specific_staff' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.staff.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">ID:</span>\r\n                        <span>{notice.staff.staff_id}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.staff.contact}</span>\r\n                      </div>\r\n                    </div>\r\n                  ) : notice.block && notice.target_type === 'block' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.block.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Location:</span>\r\n                        <span>{notice.block.location}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Manager:</span>\r\n                        <span>{notice.block.manager_name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.block.manager_contact}</span>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <p>No detailed information available.</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Description */}\r\n            <div className=\"mb-6 border-t border-gray-100 pt-6\">\r\n              <h3 className=\"text-md font-medium text-gray-800 mb-2\">Description</h3>\r\n              <div className=\"text-gray-700 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg border border-gray-100\">\r\n                {notice.description}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Attachments */}\r\n            {notice.attachments && notice.attachments.length > 0 && (\r\n              <div className=\"mb-4 border-t border-gray-100 pt-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Attachments</h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                  {notice.attachments.map((attachment) => (\r\n                    <div \r\n                      key={attachment.id} \r\n                      className=\"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 hover:bg-gray-100\"\r\n                    >\r\n                      {getFileIcon(attachment.name)}\r\n                      <div \r\n                        className=\"ml-3 flex-grow truncate cursor-pointer\"\r\n                        onClick={() => handleAttachmentClick(attachment.path, attachment.name)}\r\n                      >\r\n                        <div className=\"text-sm font-medium text-gray-700 truncate\">{attachment.name}</div>\r\n                      </div>\r\n                      <div className=\"flex space-x-2 ml-2\">\r\n                        <button \r\n                          className=\"p-1 rounded hover:bg-blue-100\" \r\n                          title=\"View\"\r\n                          onClick={() => handleAttachmentClick(attachment.path, attachment.name)}\r\n                        >\r\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-blue-500\">\r\n                            <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\"></path>\r\n                            <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\r\n                          </svg>\r\n                        </button>\r\n                        <a \r\n                          href={getImageUrl(attachment.path)} \r\n                          download={attachment.name}\r\n                          className=\"p-1 rounded hover:bg-green-100\" \r\n                          title=\"Download\"\r\n                          onClick={(e) => e.stopPropagation()}\r\n                        >\r\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-green-500\">\r\n                            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\r\n                            <polyline points=\"7 10 12 15 17 10\"></polyline>\r\n                            <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\r\n                          </svg>\r\n                        </a>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showConfirmDelete && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white rounded-lg shadow-lg max-w-md w-full p-6\">\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Confirm Delete</h3>\r\n            <p className=\"text-gray-700 mb-6\">Are you sure you want to delete this notice? This action cannot be undone.</p>\r\n            <div className=\"flex justify-end space-x-3\">\r\n              <Button variant=\"secondary\" onClick={handleCancelDelete} disabled={isDeleting}>\r\n                Cancel\r\n              </Button>\r\n              <Button variant=\"danger\" onClick={handleConfirmDelete} disabled={isDeleting}>\r\n                {isDeleting ? 'Deleting...' : 'Delete'}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\notice\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PaginatedResponse' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Search' is defined but never used.","line":20,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleSearchChange' is assigned a value but never used.","line":121,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":121,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":267,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8178,8181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8178,8181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { \r\n  noticeApi, \r\n  NoticeFormData, \r\n  StudentForNotice, \r\n  StaffForNotice, \r\n  BlockForNotice,\r\n  PaginatedResponse\r\n} from '@/lib/api';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  MultipleImageUploadCreate,\r\n  ImageModal\r\n} from '@/components/ui';\r\nimport { AlertCircle, Search } from 'lucide-react';\r\n\r\nexport default function CreateNotice() {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState<NoticeFormData>({\r\n    title: '',\r\n    description: '',\r\n    schedule_time: '',\r\n    target_type: 'all',\r\n    notice_type: 'general',\r\n    status: 'active',\r\n    notice_attachments: [],\r\n    student_id: null,\r\n    staff_id: null,\r\n    block_id: null,\r\n  });\r\n  \r\n  const [isScheduled, setIsScheduled] = useState(false);\r\n  const [attachments, setAttachments] = useState<File[]>([]);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n  \r\n  // State for fetching data for specific targets\r\n  const [students, setStudents] = useState<StudentForNotice[]>([]);\r\n  const [staff, setStaff] = useState<StaffForNotice[]>([]);\r\n  const [blocks, setBlocks] = useState<BlockForNotice[]>([]);\r\n  const [isLoading, setIsLoading] = useState<{\r\n    students: boolean;\r\n    staff: boolean;\r\n    blocks: boolean;\r\n  }>({ students: false, staff: false, blocks: false });\r\n  const [searchTimeout, setSearchTimeout] = useState<NodeJS.Timeout | null>(null);\r\n\r\n  // Handle schedule toggle change\r\n  const handleScheduleToggle = (enabled: boolean) => {\r\n    setIsScheduled(enabled);\r\n    if (enabled) {\r\n      // Set default schedule time to current date/time + 1 hour\r\n      const now = new Date();\r\n      now.setHours(now.getHours() + 1);\r\n      const scheduleTime = now.toISOString().split('T')[0] + 'T' + \r\n        now.toTimeString().split(' ')[0].substring(0, 5);\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        schedule_time: scheduleTime\r\n      }));\r\n    } else {\r\n      // Clear schedule time for immediate sending\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        schedule_time: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const addAttachments = (files: File[]) => {\r\n    setAttachments(prev => [...prev, ...files]);\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      notice_attachments: [...(prev.notice_attachments || []), ...files]\r\n    }));\r\n    \r\n    // Clear error if it exists\r\n    if (errors.notice_attachments) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        notice_attachments: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const removeAttachment = (index: number) => {\r\n    const updatedAttachments = [...attachments];\r\n    updatedAttachments.splice(index, 1);\r\n    setAttachments(updatedAttachments);\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      notice_attachments: updatedAttachments\r\n    }));\r\n  };\r\n  \r\n  // Modified to handle search through FormField component's onChange event\r\n  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    // If this is the student_id, staff_id, or block_id field and it's empty,\r\n    // we might want to search for new options\r\n    if ((name === 'student_id' || name === 'staff_id' || name === 'block_id') && !value) {\r\n      // Clear any existing timeout\r\n      if (searchTimeout) {\r\n        clearTimeout(searchTimeout);\r\n      }\r\n      \r\n      const timeout = setTimeout(() => {\r\n        // Refresh the data based on the field name\r\n        if (name === 'student_id') {\r\n          fetchStudents(value);\r\n        } else if (name === 'staff_id') {\r\n          fetchStaff(value);\r\n        } else if (name === 'block_id') {\r\n          fetchBlocks(value);\r\n        }\r\n      }, 200); // Reduced from 500ms to 200ms for faster search response\r\n      \r\n      setSearchTimeout(timeout);\r\n    }\r\n  };\r\n  \r\n  // Fetch students data\r\n  const fetchStudents = async (search: string = '') => {\r\n    try {\r\n      setIsLoading(prev => ({ ...prev, students: true }));\r\n      const response = await noticeApi.getStudentsForNotice(search);\r\n      setStudents(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching students:', error);\r\n    } finally {\r\n      setIsLoading(prev => ({ ...prev, students: false }));\r\n    }\r\n  };\r\n  \r\n  // Fetch staff data\r\n  const fetchStaff = async (search: string = '') => {\r\n    try {\r\n      setIsLoading(prev => ({ ...prev, staff: true }));\r\n      const response = await noticeApi.getStaffForNotice(search);\r\n      setStaff(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching staff:', error);\r\n    } finally {\r\n      setIsLoading(prev => ({ ...prev, staff: false }));\r\n    }\r\n  };\r\n  \r\n  // Fetch blocks data\r\n  const fetchBlocks = async (search: string = '') => {\r\n    try {\r\n      setIsLoading(prev => ({ ...prev, blocks: true }));\r\n      const response = await noticeApi.getBlocksForNotice(search);\r\n      setBlocks(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching blocks:', error);\r\n    } finally {\r\n      setIsLoading(prev => ({ ...prev, blocks: false }));\r\n    }\r\n  };\r\n  \r\n  // Effect to fetch data when target type changes\r\n  useEffect(() => {\r\n    // Reset IDs when target type changes\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      student_id: null,\r\n      staff_id: null,\r\n      block_id: null\r\n    }));\r\n    \r\n    // Fetch data based on target type\r\n    if (formData.target_type === 'specific_student') {\r\n      fetchStudents('');\r\n    } else if (formData.target_type === 'specific_staff') {\r\n      fetchStaff('');\r\n    } else if (formData.target_type === 'block') {\r\n      fetchBlocks('');\r\n    }\r\n  }, [formData.target_type]);\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.title.trim()) {\r\n      newErrors.title = 'Title is required';\r\n    }\r\n\r\n    if (!formData.description.trim()) {\r\n      newErrors.description = 'Description is required';\r\n    }\r\n\r\n    // Only validate schedule_time if scheduling is enabled\r\n    if (isScheduled) {\r\n      if (!formData.schedule_time) {\r\n        newErrors.schedule_time = 'Schedule time is required when scheduling is enabled';\r\n      } else {\r\n        // Validate that scheduled time is in the future\r\n        const scheduleDate = new Date(formData.schedule_time);\r\n        const now = new Date();\r\n        if (scheduleDate <= now) {\r\n          newErrors.schedule_time = 'Schedule time must be in the future';\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!formData.target_type) {\r\n      newErrors.target_type = 'Target audience is required';\r\n    }\r\n    \r\n    // Validate specific target selections\r\n    if (formData.target_type === 'specific_student' && !formData.student_id) {\r\n      newErrors.student_id = 'Please select a student';\r\n    }\r\n    \r\n    if (formData.target_type === 'specific_staff' && !formData.staff_id) {\r\n      newErrors.staff_id = 'Please select a staff member';\r\n    }\r\n    \r\n    if (formData.target_type === 'block' && !formData.block_id) {\r\n      newErrors.block_id = 'Please select a block';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      await noticeApi.createNotice(formData);\r\n      \r\n      // Redirect to notices list on success\r\n      router.push('/admin/notice');\r\n      \r\n    } catch (error: any) {\r\n      console.error('Error creating notice:', error);\r\n      if (error.validation) {\r\n        // Handle validation errors from the API\r\n        const validationErrors: Record<string, string> = {};\r\n        Object.entries(error.validation).forEach(([field, messages]) => {\r\n          validationErrors[field] = Array.isArray(messages) ? messages[0] : messages as string;\r\n        });\r\n        setErrors(validationErrors);\r\n      } else {\r\n        setErrors({\r\n          submit: error.message || 'An error occurred while creating the notice. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create Notice</h1>\r\n        </div>\r\n\r\n        {/* Error Alert */}\r\n        {errors.submit && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n              <p className=\"text-red-800\">{errors.submit}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-6\">\r\n            <div className=\"space-y-6\">\r\n              {/* Notice Title */}\r\n              <FormField\r\n                name=\"title\"\r\n                label=\"Notice Title\"\r\n                required\r\n                value={formData.title}\r\n                onChange={handleInputChange}\r\n                error={errors.title}\r\n                placeholder=\"Enter notice title\"\r\n              />\r\n\r\n              {/* Notice Description */}\r\n              <FormField\r\n                name=\"description\"\r\n                label=\"Notice Description\"\r\n                required\r\n                value={formData.description}\r\n                onChange={handleInputChange}\r\n                error={errors.description}\r\n                placeholder=\"Enter notice description\"\r\n                type=\"textarea\"\r\n                rows={5}\r\n              />\r\n\r\n              {/* Schedule Toggle */}\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"schedule_toggle\"\r\n                    checked={isScheduled}\r\n                    onChange={(e) => handleScheduleToggle(e.target.checked)}\r\n                    className=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2\"\r\n                  />\r\n                  <label htmlFor=\"schedule_toggle\" className=\"text-sm font-medium text-gray-900 cursor-pointer\">\r\n                    Schedule this notice for later\r\n                  </label>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Schedule Date/Time - Only show when scheduling is enabled */}\r\n              {isScheduled && (\r\n                <div className=\"space-y-1.5\">\r\n                  <label htmlFor=\"schedule_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Schedule Date & Time <span className=\"text-red-500 ml-1\">*</span>\r\n                  </label>\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    id=\"schedule_time\"\r\n                    name=\"schedule_time\"\r\n                    value={formData.schedule_time}\r\n                    onChange={handleInputChange}\r\n                    min={new Date().toISOString().slice(0, 16)} // Prevent past dates\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                  />\r\n                  {errors.schedule_time && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <AlertCircle className=\"h-3.5 w-3.5 mr-2\" />\r\n                      {errors.schedule_time}\r\n                    </div>\r\n                  )}\r\n                  <div className=\"text-xs text-gray-500\">\r\n                    The notice will be automatically sent at the specified date and time.\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Target Audience */}\r\n              <FormField\r\n                name=\"target_type\"\r\n                label=\"Send Notice To\"\r\n                type=\"select\"\r\n                required\r\n                value={formData.target_type}\r\n                onChange={handleInputChange}\r\n                error={errors.target_type}\r\n                options={[\r\n                  { value: 'all', label: 'Everyone' },\r\n                  { value: 'student', label: 'All Students' },\r\n                  { value: 'staff', label: 'All Staff' },\r\n                  { value: 'specific_student', label: 'Specific Student' },\r\n                  { value: 'specific_staff', label: 'Specific Staff' },\r\n                  { value: 'block', label: 'Specific Block' }\r\n                ]}\r\n              />\r\n              \r\n              {/* Conditional fields based on target type - Show student selection first */}\r\n              {formData.target_type === 'specific_student' && (\r\n                <FormField\r\n                  name=\"student_id\"\r\n                  label=\"Select Student\"\r\n                  type=\"select\"\r\n                  required\r\n                  value={formData.student_id?.toString() || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.student_id}\r\n                  options={[\r\n                    { value: '', label: isLoading.students ? 'Loading students...' : 'Choose a student' },\r\n                    ...(Array.isArray(students) ? students : []).map(student => ({ \r\n                      value: student.id.toString(), \r\n                      label: `${student.name}${student.student_id ? ` (${student.student_id})` : ''}${student.room && student.room.room_number ? ` - Room: ${student.room.room_number}` : ''}${student.room && student.room.block && student.room.block.name ? ` (${student.room.block.name})` : ''}`\r\n                    }))\r\n                  ]}\r\n                />\r\n              )}\r\n              \r\n              {formData.target_type === 'specific_staff' && (\r\n                <FormField\r\n                  name=\"staff_id\"\r\n                  label=\"Select Staff\"\r\n                  type=\"select\"\r\n                  required\r\n                  value={formData.staff_id?.toString() || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.staff_id}\r\n                  options={[\r\n                    { value: '', label: isLoading.staff ? 'Loading staff...' : 'Choose a staff member' },\r\n                    ...staff.map(staffMember => ({ \r\n                      value: staffMember.id.toString(), \r\n                      label: `${staffMember.name} (${staffMember.staff_id})`\r\n                    }))\r\n                  ]}\r\n                />\r\n              )}\r\n              \r\n              {formData.target_type === 'block' && (\r\n                <FormField\r\n                  name=\"block_id\"\r\n                  label=\"Select Block\"\r\n                  type=\"select\"\r\n                  required\r\n                  value={formData.block_id?.toString() || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.block_id}\r\n                  options={[\r\n                    { value: '', label: isLoading.blocks ? 'Loading blocks...' : 'Choose a block' },\r\n                    ...blocks.map(block => ({ \r\n                      value: block.id.toString(), \r\n                      label: `${block.name} - ${block.location}` \r\n                    }))\r\n                  ]}\r\n                />\r\n              )}\r\n\r\n              {/* Notice Type - Moved after conditional selections */}\r\n              <FormField\r\n                name=\"notice_type\"\r\n                label=\"Notice Type\"\r\n                type=\"select\"\r\n                value={formData.notice_type || ''}\r\n                onChange={handleInputChange}\r\n                error={errors.notice_type}\r\n                options={[\r\n                  { value: 'general', label: 'General' },\r\n                  { value: 'urgent', label: 'Urgent' },\r\n                  { value: 'announcement', label: 'Announcement' }\r\n                ]}\r\n              />\r\n\r\n              {/* Attachments */}\r\n              <div>\r\n                <MultipleImageUploadCreate\r\n                  images={attachments}\r\n                  onAddImages={addAttachments}\r\n                  onRemoveImage={removeAttachment}\r\n                  error={errors.notice_attachments}\r\n                  label=\"Add Attachments\"\r\n                  onImageClick={(imageUrl, alt) => {\r\n                    setSelectedImage({ url: imageUrl, alt });\r\n                    setImageModalOpen(true);\r\n                  }}\r\n                />\r\n                <p className=\"text-xs text-gray-500 mt-1\">\r\n                  PDF, DOC, Images - Max 2MB each\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex justify-between items-center pt-6 mt-6 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.back()} />\r\n              <SubmitButton \r\n                loading={isSubmitting} \r\n                loadingText={isScheduled ? \"Scheduling...\" : \"Sending...\"}\r\n              >\r\n                {isScheduled ? \"Schedule Notice\" : \"Send Notice Now\"}\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\notice\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PaginatedResponse' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":16,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertCircle' is defined but never used.","line":16,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Plus' is defined but never used.","line":16,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formatDate' is defined but never used.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":20}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { noticeApi, Notice, ApiError } from '@/lib/api';\r\nimport { PaginatedResponse } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  ConfirmModal, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\nimport { Calendar, User, AlertCircle, Check, X, Plus } from 'lucide-react';\r\nimport { formatDate } from '@/lib/utils';\r\n\r\nexport default function NoticeList() {\r\n  const router = useRouter();\r\n  const [notices, setNotices] = useState<Notice[]>([]);\r\n  const [filteredNotices, setFilteredNotices] = useState<Notice[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [totalNotices, setTotalNotices] = useState(0);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, noticeId: string | null}>({\r\n    show: false,\r\n    noticeId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch notices from API\r\n  useEffect(() => {\r\n    const fetchNotices = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await noticeApi.getNotices(currentPage);\r\n        setNotices(response.data);\r\n        setFilteredNotices(response.data);\r\n        setTotalPages(response.last_page);\r\n        setTotalNotices(response.total);\r\n      } catch (error) {\r\n        console.error('Error fetching notices:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch notices: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch notices. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchNotices();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredNotices(notices);\r\n    } else {\r\n      const filtered = notices.filter(notice =>\r\n        notice.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        notice.target_type.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (notice.description && notice.description.toLowerCase().includes(searchQuery.toLowerCase()))\r\n      );\r\n      setFilteredNotices(filtered);\r\n    }\r\n  }, [searchQuery, notices]);\r\n\r\n  const handleDeleteNotice = async (noticeId: number | string) => {\r\n    setDeleteModal({show: true, noticeId: noticeId.toString()});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const noticeId = deleteModal.noticeId;\r\n    if (!noticeId) return;\r\n\r\n    try {\r\n      setIsDeleting(noticeId);\r\n      setDeleteModal({show: false, noticeId: null});\r\n      setAlert({show: true, message: 'Deleting notice...', type: 'success'});\r\n      \r\n      await noticeApi.deleteNotice(noticeId);\r\n      \r\n      // Remove from local state\r\n      const updatedNotices = notices.filter(notice => notice.id.toString() !== noticeId);\r\n      setNotices(updatedNotices);\r\n      setFilteredNotices(updatedNotices.filter(notice =>\r\n        !searchQuery.trim() ||\r\n        notice.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        notice.target_type.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (notice.description && notice.description.toLowerCase().includes(searchQuery.toLowerCase()))\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Notice deleted successfully!', type: 'success'});\r\n      \r\n      // Hide alert after 2 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting notice:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({show: true, message: `Failed to delete notice: ${error.message}`, type: 'error'});\r\n      } else {\r\n        setAlert({show: true, message: 'Failed to delete notice. Please try again.', type: 'error'});\r\n      }\r\n      \r\n      // Hide error alert after 3 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'error'});\r\n      }, 3000);\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, noticeId: null});\r\n  };\r\n\r\n  const handlePageChange = (page: number) => {\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  // Render pagination controls\r\n  const renderPagination = () => {\r\n    if (totalPages <= 1) return null;\r\n\r\n    const pages = [];\r\n    const maxVisiblePages = 5;\r\n    \r\n    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));\r\n    const endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);\r\n    \r\n    // Adjust start if needed\r\n    if (endPage - startPage + 1 < maxVisiblePages) {\r\n      startPage = Math.max(1, endPage - maxVisiblePages + 1);\r\n    }\r\n\r\n    // Previous button\r\n    pages.push(\r\n      <button\r\n        key=\"prev\"\r\n        onClick={() => handlePageChange(currentPage - 1)}\r\n        disabled={currentPage === 1}\r\n        className=\"px-3 py-1 border border-gray-300 rounded-md mr-1 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n      >\r\n        &laquo;\r\n      </button>\r\n    );\r\n\r\n    // First page if needed\r\n    if (startPage > 1) {\r\n      pages.push(\r\n        <button key=\"1\" onClick={() => handlePageChange(1)} className=\"px-3 py-1 border border-gray-300 rounded-md mr-1\">\r\n          1\r\n        </button>\r\n      );\r\n      if (startPage > 2) {\r\n        pages.push(<span key=\"ellipsis1\" className=\"px-2\">...</span>);\r\n      }\r\n    }\r\n\r\n    // Page numbers\r\n    for (let i = startPage; i <= endPage; i++) {\r\n      pages.push(\r\n        <button\r\n          key={i}\r\n          onClick={() => handlePageChange(i)}\r\n          className={`px-3 py-1 border rounded-md mr-1 ${\r\n            i === currentPage\r\n              ? 'bg-blue-600 text-white border-blue-600'\r\n              : 'border-gray-300'\r\n          }`}\r\n        >\r\n          {i}\r\n        </button>\r\n      );\r\n    }\r\n\r\n    // Last page if needed\r\n    if (endPage < totalPages) {\r\n      if (endPage < totalPages - 1) {\r\n        pages.push(<span key=\"ellipsis2\" className=\"px-2\">...</span>);\r\n      }\r\n      pages.push(\r\n        <button\r\n          key={totalPages}\r\n          onClick={() => handlePageChange(totalPages)}\r\n          className=\"px-3 py-1 border border-gray-300 rounded-md mr-1\"\r\n        >\r\n          {totalPages}\r\n        </button>\r\n      );\r\n    }\r\n\r\n    // Next button\r\n    pages.push(\r\n      <button\r\n        key=\"next\"\r\n        onClick={() => handlePageChange(currentPage + 1)}\r\n        disabled={currentPage === totalPages}\r\n        className=\"px-3 py-1 border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed\"\r\n      >\r\n        &raquo;\r\n      </button>\r\n    );\r\n\r\n    return <div className=\"flex justify-center mt-6\">{pages}</div>;\r\n  };\r\n\r\n  // Function to get target audience display text\r\n  const getTargetDisplay = (targetType: string): string => {\r\n    switch (targetType) {\r\n      case 'all':\r\n        return 'Everyone';\r\n      case 'students':\r\n        return 'Students Only';\r\n      case 'staff':\r\n        return 'Staff Only';\r\n      default:\r\n        return targetType;\r\n    }\r\n  };\r\n\r\n  // Function to get the sent time display\r\n  const getSentTimeDisplay = (notice: Notice) => {\r\n    // Use schedule_time if it exists, otherwise use created_at\r\n    const sentTime = notice.schedule_time || notice.created_at;\r\n    const dateObj = new Date(sentTime);\r\n    \r\n    // Format date and time separately\r\n    const dateStr = dateObj.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric'\r\n    });\r\n    \r\n    const timeStr = dateObj.toLocaleTimeString('en-US', {\r\n      hour: 'numeric',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n    \r\n    return (\r\n      <div className=\"flex flex-col\">\r\n        <span className=\"text-sm text-gray-900\">{dateStr}</span>\r\n        <span className=\"text-sm text-gray-500\">{timeStr}</span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Determine status badge based on notice status\r\n  const renderStatusBadge = (status: string) => {\r\n    if (status === 'active') {\r\n      return (\r\n        <div className=\"inline-flex items-center bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Active\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"inline-flex items-center bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Inactive\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Notices</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading notices...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Notice\"\r\n        message=\"Are you sure you want to delete this notice? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Notices</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{totalNotices} total notices</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/admin/notice/create')}\r\n          icon={<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n          </svg>}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n        >\r\n          Add Notice\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search notices...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredNotices.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No notices found' : 'No notices yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'Create your first notice to get started'}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/admin/notice/create')}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n            >\r\n              Create Notice\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Title</div>\r\n              <div className=\"col-span-2\">Description</div>\r\n              <div className=\"col-span-2\">Sent Date</div>\r\n              <div className=\"col-span-2\">Target</div>\r\n              <div className=\"col-span-1 text-center\">Status</div>\r\n              <div className=\"col-span-2 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredNotices.map((notice) => (\r\n              <div key={notice.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Notice Title */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{notice.title}</div>\r\n                    <div className=\"text-xs text-gray-500 mt-1\">\r\n                      {notice.notice_type && (\r\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800\">\r\n                          {notice.notice_type.charAt(0).toUpperCase() + notice.notice_type.slice(1)}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-600 truncate\">\r\n                      {notice.description \r\n                        ? notice.description.length > 15 \r\n                          ? `${notice.description.substring(0, 15)}...` \r\n                          : notice.description\r\n                        : 'No description'\r\n                      }\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Sent Date */}\r\n                  <div className=\"col-span-2\">\r\n                    {getSentTimeDisplay(notice)}\r\n                  </div>\r\n\r\n                  {/* Target */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700\">{getTargetDisplay(notice.target_type)}</div>\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex justify-center\">\r\n                      {renderStatusBadge(notice.status || 'active')}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"flex justify-center\">\r\n                      <ActionButtons \r\n                        viewUrl={`/admin/notice/${notice.id}`}\r\n                        editUrl={`/admin/notice/${notice.id}/edit`}\r\n                        onDelete={() => handleDeleteNotice(notice.id)}\r\n                        isDeleting={isDeleting === notice.id.toString()}\r\n                        style=\"compact\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Pagination */}\r\n      {renderPagination()}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredNotices.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredNotices.length} of {totalNotices} notices\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\payment-type\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PaymentTypeModel' is defined but never used.","line":5,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPaymentType'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPaymentType, id]","fix":{"range":[948,952],"text":"[fetchPaymentType, id]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { paymentTypeApi, PaymentTypeFormData, PaymentTypeModel, ApiError } from '@/lib/api/index';\r\nimport { FormField, TableSkeleton, SubmitButton, CancelButton } from '@/components/ui';\r\nimport { ArrowLeft } from 'lucide-react';\r\n\r\nexport default function EditPaymentType() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = params?.id as string;\r\n\r\n  const [formData, setFormData] = useState<PaymentTypeFormData>({\r\n    name: '',\r\n    is_active: true,\r\n  });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [submitError, setSubmitError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      fetchPaymentType();\r\n    }\r\n  }, [id]);\r\n\r\n  const fetchPaymentType = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await paymentTypeApi.getPaymentType(id);\r\n      setFormData({\r\n        name: data.name,\r\n        is_active: data.is_active,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error fetching payment type:', error);\r\n      setSubmitError(error instanceof ApiError ? error.message : 'Failed to load payment method');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value, type } = e.target;\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: type === 'checkbox' ? (e.target as HTMLInputElement).checked : value\r\n    }));\r\n    \r\n    // Clear error for this field\r\n    if (errors[name]) {\r\n      setErrors(prev => ({ ...prev, [name]: '' }));\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.name.trim()) {\r\n      newErrors.name = 'Payment method name is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSubmitError(null);\r\n\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n      await paymentTypeApi.updatePaymentType(id, formData);\r\n      router.push('/admin/payment-type');\r\n    } catch (error) {\r\n      console.error('Error updating payment type:', error);\r\n      if (error instanceof ApiError) {\r\n        if (error.validation) {\r\n          // Convert validation errors array to string\r\n          const validationErrors: Record<string, string> = {};\r\n          Object.entries(error.validation).forEach(([key, value]) => {\r\n            validationErrors[key] = Array.isArray(value) ? value[0] : value;\r\n          });\r\n          setErrors(validationErrors);\r\n        } else {\r\n          setSubmitError(error.message);\r\n        }\r\n      } else {\r\n        setSubmitError('Failed to update payment method. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Payment Method</h1>\r\n        <p className=\"text-sm text-gray-600 mt-1\">Update payment method information</p>\r\n      </div>\r\n\r\n      {/* Error Alert */}\r\n      {submitError && (\r\n        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <p className=\"text-red-800\">{submitError}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Form */}\r\n      <form onSubmit={handleSubmit} className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div className=\"space-y-6\">\r\n          {/* Payment Method Name */}\r\n          <FormField\r\n            name=\"name\"\r\n            label=\"Payment Method Name\"\r\n            required\r\n            value={formData.name}\r\n            onChange={handleInputChange}\r\n            error={errors.name}\r\n            placeholder=\"e.g., Cash, Bank Transfer, Credit Card\"\r\n          />\r\n\r\n          {/* Status */}\r\n          <div>\r\n            <label className=\"flex items-center space-x-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                name=\"is_active\"\r\n                checked={formData.is_active}\r\n                onChange={handleInputChange}\r\n                className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n              />\r\n              <span className=\"text-sm font-medium text-gray-700\">\r\n                Active\r\n              </span>\r\n            </label>\r\n            <p className=\"mt-1 text-sm text-gray-500\">\r\n              Inactive payment methods will not be available for selection\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Actions */}\r\n        <div className=\"mt-6 flex items-center justify-end gap-3 pt-6 border-t border-gray-200\">\r\n          <CancelButton onClick={() => router.back()} />\r\n          <SubmitButton loading={isSubmitting} loadingText=\"Updating...\">\r\n            Update Payment Method\r\n          </SubmitButton>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\payment-type\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPaymentType'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPaymentType, id]","fix":{"range":[875,879],"text":"[fetchPaymentType, id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { paymentTypeApi, PaymentTypeModel, ApiError } from '@/lib/api/index';\r\nimport { Button, TableSkeleton, ConfirmModal } from '@/components/ui';\r\nimport { ArrowLeft, Edit, Trash } from 'lucide-react';\r\n\r\nexport default function ViewPaymentType() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = params?.id as string;\r\n\r\n  const [paymentType, setPaymentType] = useState<PaymentTypeModel | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      fetchPaymentType();\r\n    }\r\n  }, [id]);\r\n\r\n  const fetchPaymentType = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await paymentTypeApi.getPaymentType(id);\r\n      setPaymentType(data);\r\n    } catch (error) {\r\n      console.error('Error fetching payment type:', error);\r\n      setError(error instanceof ApiError ? error.message : 'Failed to load payment method');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      await paymentTypeApi.deletePaymentType(id);\r\n      router.push('/admin/payment-type');\r\n    } catch (error) {\r\n      console.error('Error deleting payment type:', error);\r\n      setError(error instanceof ApiError ? error.message : 'Failed to delete payment method');\r\n      setShowDeleteModal(false);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !paymentType) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error || 'Payment method not found'}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/payment-type')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Payment Methods\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <button\r\n          onClick={() => router.back()}\r\n          className=\"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4 transition-colors\"\r\n        >\r\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n          Back\r\n        </button>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">{paymentType.name}</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">Payment method details</p>\r\n          </div>\r\n          <div className=\"flex gap-3\">\r\n            <Button\r\n              onClick={() => router.push(`/admin/payment-type/${id}/edit`)}\r\n              icon={<Edit className=\"w-4 h-4\" />}\r\n              variant=\"edit\"\r\n            >\r\n              Edit\r\n            </Button>\r\n            <Button\r\n              onClick={() => setShowDeleteModal(true)}\r\n              icon={<Trash className=\"w-4 h-4\" />}\r\n              variant=\"delete\"\r\n            >\r\n              Delete\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Details Card */}\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Payment Method Information</h2>\r\n          <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\r\n            <div>\r\n              <dt className=\"text-sm font-medium text-gray-500\">Payment Method Name</dt>\r\n              <dd className=\"mt-1 text-sm text-gray-900\">{paymentType.name}</dd>\r\n            </div>\r\n            \r\n            <div>\r\n              <dt className=\"text-sm font-medium text-gray-500\">Status</dt>\r\n              <dd className=\"mt-1\">\r\n                <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${\r\n                  paymentType.is_active \r\n                    ? 'bg-green-100 text-green-800' \r\n                    : 'bg-red-100 text-red-800'\r\n                }`}>\r\n                  {paymentType.is_active ? 'Active' : 'Inactive'}\r\n                </span>\r\n              </dd>\r\n            </div>\r\n\r\n            <div>\r\n              <dt className=\"text-sm font-medium text-gray-500\">Created Date</dt>\r\n              <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(paymentType.created_at)}</dd>\r\n            </div>\r\n\r\n            <div>\r\n              <dt className=\"text-sm font-medium text-gray-500\">Last Updated</dt>\r\n              <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(paymentType.updated_at)}</dd>\r\n            </div>\r\n          </dl>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteModal && (\r\n        <ConfirmModal\r\n          show={showDeleteModal}\r\n          title=\"Delete Payment Method\"\r\n          message=\"Are you sure you want to delete this payment method? This action cannot be undone.\"\r\n          confirmText={isDeleting ? 'Deleting...' : 'Delete'}\r\n          cancelText=\"Cancel\"\r\n          onConfirm={handleDelete}\r\n          onCancel={() => setShowDeleteModal(false)}\r\n          variant=\"danger\"\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\payment-type\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { paymentTypeApi, PaymentTypeFormData, ApiError } from '@/lib/api/index';\r\nimport { FormField, SubmitButton, CancelButton } from '@/components/ui';\r\nimport { ArrowLeft } from 'lucide-react';\r\n\r\nexport default function CreatePaymentType() {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState<PaymentTypeFormData>({\r\n    name: '',\r\n    is_active: true,\r\n  });\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [submitError, setSubmitError] = useState<string | null>(null);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value, type } = e.target;\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: type === 'checkbox' ? (e.target as HTMLInputElement).checked : value\r\n    }));\r\n    \r\n    // Clear error for this field\r\n    if (errors[name]) {\r\n      setErrors(prev => ({ ...prev, [name]: '' }));\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.name.trim()) {\r\n      newErrors.name = 'Payment method name is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSubmitError(null);\r\n\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n      await paymentTypeApi.createPaymentType(formData);\r\n      router.push('/admin/payment-type');\r\n    } catch (error) {\r\n      console.error('Error creating payment type:', error);\r\n      if (error instanceof ApiError) {\r\n        if (error.validation) {\r\n          // Convert validation errors array to string\r\n          const validationErrors: Record<string, string> = {};\r\n          Object.entries(error.validation).forEach(([key, value]) => {\r\n            validationErrors[key] = Array.isArray(value) ? value[0] : value;\r\n          });\r\n          setErrors(validationErrors);\r\n        } else {\r\n          setSubmitError(error.message);\r\n        }\r\n      } else {\r\n        setSubmitError('Failed to create payment method. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-semibold text-gray-900\">Add Payment Method</h1>\r\n        <p className=\"text-sm text-gray-600 mt-1\">Create a new payment method for income recording</p>\r\n      </div>\r\n\r\n      {/* Error Alert */}\r\n      {submitError && (\r\n        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <p className=\"text-red-800\">{submitError}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Form */}\r\n      <form onSubmit={handleSubmit} className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div className=\"space-y-6\">\r\n          {/* Payment Method Name */}\r\n          <FormField\r\n            name=\"name\"\r\n            label=\"Payment Method Name\"\r\n            required\r\n            value={formData.name}\r\n            onChange={handleInputChange}\r\n            error={errors.name}\r\n            placeholder=\"e.g., Cash, Bank Transfer, Credit Card\"\r\n          />\r\n\r\n          {/* Status */}\r\n          <div>\r\n            <label className=\"flex items-center space-x-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                name=\"is_active\"\r\n                checked={formData.is_active}\r\n                onChange={handleInputChange}\r\n                className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n              />\r\n              <span className=\"text-sm font-medium text-gray-700\">\r\n                Active\r\n              </span>\r\n            </label>\r\n            <p className=\"mt-1 text-sm text-gray-500\">\r\n              Inactive payment methods will not be available for selection\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Actions */}\r\n        <div className=\"mt-6 flex items-center justify-end gap-3 pt-6 border-t border-gray-200\">\r\n          <CancelButton onClick={() => router.back()} />\r\n          <SubmitButton loading={isSubmitting} loadingText=\"Creating...\">\r\n            Create Payment Method\r\n          </SubmitButton>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'UpdateProfileData' is defined but never used.","line":4,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChangePasswordData' is defined but never used.","line":4,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":87},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2283,2286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2283,2286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3534,3537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3534,3537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { profileApi, type UserProfile, type UpdateProfileData, type ChangePasswordData } from '@/lib/api';\r\nimport { Button, TableSkeleton } from '@/components/ui';\r\nimport { PasswordInput } from '@/components/ui/password-input';\r\nimport { User, AlertCircle } from 'lucide-react';\r\n\r\nexport default function AdminProfile() {\r\n  const [profile, setProfile] = useState<UserProfile | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Email update state\r\n  const [email, setEmail] = useState('');\r\n  const [isUpdatingEmail, setIsUpdatingEmail] = useState(false);\r\n  const [emailError, setEmailError] = useState<string | null>(null);\r\n  const [emailSuccess, setEmailSuccess] = useState(false);\r\n  \r\n  // Password change state\r\n  const [currentPassword, setCurrentPassword] = useState('');\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [isChangingPassword, setIsChangingPassword] = useState(false);\r\n  const [passwordError, setPasswordError] = useState<string | null>(null);\r\n  const [passwordSuccess, setPasswordSuccess] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchProfile();\r\n  }, []);\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const data = await profileApi.getProfile();\r\n      setProfile(data);\r\n      setEmail(data.email || '');\r\n    } catch (err) {\r\n      console.error('Error fetching profile:', err);\r\n      setError('Failed to load profile. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUpdateEmail = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setEmailError(null);\r\n    setEmailSuccess(false);\r\n\r\n    if (!email || !email.includes('@')) {\r\n      setEmailError('Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsUpdatingEmail(true);\r\n      const updatedProfile = await profileApi.updateProfile({ email });\r\n      setProfile(updatedProfile);\r\n      setEmailSuccess(true);\r\n      \r\n      setTimeout(() => {\r\n        setEmailSuccess(false);\r\n      }, 3000);\r\n    } catch (err: any) {\r\n      console.error('Error updating email:', err);\r\n      setEmailError(err.message || 'Failed to update email. Please try again.');\r\n    } finally {\r\n      setIsUpdatingEmail(false);\r\n    }\r\n  };\r\n\r\n  const handleChangePassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setPasswordError(null);\r\n    setPasswordSuccess(false);\r\n\r\n    if (!currentPassword || !newPassword || !confirmPassword) {\r\n      setPasswordError('All password fields are required');\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 8) {\r\n      setPasswordError('New password must be at least 8 characters long');\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      setPasswordError('New password and confirmation do not match');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsChangingPassword(true);\r\n      await profileApi.changePassword({\r\n        current_password: currentPassword,\r\n        new_password: newPassword,\r\n        new_password_confirmation: confirmPassword,\r\n      });\r\n      \r\n      setPasswordSuccess(true);\r\n      setCurrentPassword('');\r\n      setNewPassword('');\r\n      setConfirmPassword('');\r\n      \r\n      setTimeout(() => {\r\n        setPasswordSuccess(false);\r\n      }, 3000);\r\n    } catch (err: any) {\r\n      console.error('Error changing password:', err);\r\n      setPasswordError(err.message || 'Failed to change password. Please check your current password.');\r\n    } finally {\r\n      setIsChangingPassword(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Profile Settings</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading profile information...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !profile) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n            <p className=\"text-red-800\">{error || 'Profile not found'}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-xl font-medium text-gray-900\">Profile Settings</h1>\r\n        <p className=\"text-sm text-gray-500 mt-1\">Manage your account settings and preferences</p>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Profile Information Card */}\r\n        <div className=\"lg:col-span-1\">\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                <User className=\"w-6 h-6 text-blue-600\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-lg font-medium text-gray-900\">Account Info</h2>\r\n                <p className=\"text-sm text-gray-500\">\r\n                  {profile.role === 'staff' && profile.staff_name ? profile.staff_name : \r\n                   profile.role === 'student' && profile.student_name ? profile.student_name :\r\n                   profile.role}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">User ID</label>\r\n                <p className=\"text-sm font-medium text-gray-900 mt-1\">{profile.user_id}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Email</label>\r\n                <p className=\"text-sm text-gray-900 mt-1\">{profile.email}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Role</label>\r\n                <p className=\"text-sm text-gray-900 mt-1 capitalize\">\r\n                  {profile.role === 'staff' ? 'Staff' : \r\n                   profile.role === 'student' ? 'Student' : \r\n                   profile.role}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Member Since</label>\r\n                <p className=\"text-sm text-gray-900 mt-1\">\r\n                  {new Date(profile.created_at).toLocaleDateString('en-US', {\r\n                    year: 'numeric',\r\n                    month: 'long',\r\n                    day: 'numeric'\r\n                  })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Email Update and Password Change Forms */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          {/* Update Email Form */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n              </svg>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Update Email Address</h2>\r\n            </div>\r\n\r\n            {emailSuccess && (\r\n              <div className=\"mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-sm text-green-800\">Email updated successfully!</p>\r\n              </div>\r\n            )}\r\n\r\n            {emailError && (\r\n              <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-600\" />\r\n                <p className=\"text-sm text-red-800\">{emailError}</p>\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleUpdateEmail}>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Email Address\r\n                  </label>\r\n                  <input\r\n                    type=\"email\"\r\n                    id=\"email\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"Enter your email address\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={isUpdatingEmail || email === profile.email}\r\n                  className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n                >\r\n                  {isUpdatingEmail ? 'Updating...' : 'Update Email'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n\r\n          {/* Change Password Form */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n              </svg>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Change Password</h2>\r\n            </div>\r\n\r\n            {passwordSuccess && (\r\n              <div className=\"mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-sm text-green-800\">Password changed successfully!</p>\r\n              </div>\r\n            )}\r\n\r\n            {passwordError && (\r\n              <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-600\" />\r\n                <p className=\"text-sm text-red-800\">{passwordError}</p>\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleChangePassword}>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"current-password\"\r\n                    label=\"Current Password\"\r\n                    value={currentPassword}\r\n                    onChange={(e) => setCurrentPassword(e.target.value)}\r\n                    placeholder=\"Enter your current password\"\r\n                    required\r\n                    autoComplete=\"current-password\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"new-password\"\r\n                    label=\"New Password\"\r\n                    value={newPassword}\r\n                    onChange={(e) => setNewPassword(e.target.value)}\r\n                    placeholder=\"Enter new password (min 8 characters)\"\r\n                    required\r\n                    minLength={8}\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"confirm-password\"\r\n                    label=\"Confirm New Password\"\r\n                    value={confirmPassword}\r\n                    onChange={(e) => setConfirmPassword(e.target.value)}\r\n                    placeholder=\"Confirm new password\"\r\n                    required\r\n                    minLength={8}\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                </div>\r\n\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={isChangingPassword}\r\n                  className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n                >\r\n                  {isChangingPassword ? 'Changing Password...' : 'Change Password'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\room\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleImageClick' is assigned a value but never used.","line":228,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":228,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { roomApi, RoomFormData, Room, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  TableSkeleton, \r\n  ImageModal,\r\n  SingleImageUploadEdit\r\n} from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function EditRoom() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const roomId = params.id as string;\r\n\r\n  const [formData, setFormData] = useState<RoomFormData>({\r\n    room_name: '',\r\n    block_id: '',\r\n    capacity: 0,\r\n    room_type: '',\r\n    room_attachment: null,\r\n  });\r\n  \r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [currentRoom, setCurrentRoom] = useState<Room | null>(null);\r\n  const [blocks, setBlocks] = useState<{id: string, block_name: string}[]>([]);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  // Fetch room and dropdowns data\r\n  useEffect(() => {\r\n    const fetchRoomData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch room data\r\n        const room = await roomApi.getRoom(roomId);\r\n        setCurrentRoom(room);\r\n        \r\n        // Fetch blocks for dropdown\r\n        const blocksData = await roomApi.getBlocks();\r\n        // Ensure blocksData is an array\r\n        setBlocks(Array.isArray(blocksData) ? blocksData : []);\r\n        \r\n        // Set form data\r\n        setFormData({\r\n          room_name: room.room_name,\r\n          block_id: room.block_id,\r\n          capacity: room.capacity,\r\n          room_type: room.room_type,\r\n          room_attachment: null,\r\n        });\r\n\r\n        // Set existing image preview if available\r\n        if (room.room_attachment) {\r\n          const imageUrl = getImageUrl(room.room_attachment);\r\n          setImagePreview(imageUrl);\r\n        }\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching room data:', error);\r\n        if (error instanceof ApiError) {\r\n          setErrors({\r\n            fetch: `Failed to load room: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            fetch: 'Failed to load room data. Please try again.'\r\n          });\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (roomId) {\r\n      fetchRoomData();\r\n    }\r\n  }, [roomId]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    if (name === 'room_type') {\r\n      // Auto-set capacity based on room type\r\n      let capacity = 0;\r\n      switch (value) {\r\n        case 'single':\r\n          capacity = 1;\r\n          break;\r\n        case 'double':\r\n          capacity = 2;\r\n          break;\r\n        case 'triple':\r\n          capacity = 3;\r\n          break;\r\n        case 'quad':\r\n          capacity = 4;\r\n          break;\r\n        default:\r\n          capacity = 0;\r\n      }\r\n      \r\n      // Only auto-update capacity if there are no students or if the new capacity is greater\r\n      const currentOccupancy = currentRoom?.students?.length || 0;\r\n      if (currentOccupancy === 0 || capacity >= currentOccupancy) {\r\n        setFormData(prev => ({\r\n          ...prev,\r\n          [name]: value,\r\n          capacity: capacity\r\n        }));\r\n      } else {\r\n        // Just update the room type, not the capacity (can't reduce below occupancy)\r\n        setFormData(prev => ({\r\n          ...prev,\r\n          [name]: value\r\n        }));\r\n        \r\n        // Add an error to notify user\r\n        setErrors(prev => ({\r\n          ...prev,\r\n          capacity: `Cannot reduce capacity below current occupancy (${currentOccupancy} students)`\r\n        }));\r\n      }\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: name === 'capacity' ? parseInt(value) || 0 : value\r\n      }));\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        room_attachment: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        room_attachment: 'File size must be less than 5MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      room_attachment: file\r\n    }));\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.room_attachment) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        room_attachment: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const removeImage = () => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      room_attachment: null\r\n    }));\r\n    setImagePreview(null);\r\n    const fileInput = document.getElementById('room_attachment') as HTMLInputElement;\r\n    if (fileInput) {\r\n      fileInput.value = '';\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.room_name.trim()) {\r\n      newErrors.room_name = 'Room name is required';\r\n    }\r\n\r\n    if (!formData.block_id) {\r\n      newErrors.block_id = 'Block is required';\r\n    }\r\n\r\n    if (!formData.capacity || formData.capacity <= 0) {\r\n      newErrors.capacity = 'Capacity must be greater than 0';\r\n    }\r\n\r\n    // Status is now handled automatically\r\n\r\n    if (!formData.room_type) {\r\n      newErrors.room_type = 'Room type is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleImageClick = (url: string, alt: string) => {\r\n    setSelectedImage({ url, alt });\r\n    setImageModalOpen(true);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      await roomApi.updateRoom(roomId, formData);\r\n      \r\n      // Redirect to rooms list on success\r\n      router.push('/admin/room');\r\n      \r\n    } catch (error) {\r\n      console.error('Error updating room:', error);\r\n      if (error instanceof ApiError) {\r\n        setErrors({\r\n          submit: `Failed to update room: ${error.message}`\r\n        });\r\n      } else {\r\n        setErrors({\r\n          submit: 'An error occurred while updating the room. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Edit Room</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading room data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/room')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Rooms\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Room</h1>\r\n        </div>\r\n\r\n        {/* Modern Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-800 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\r\n              \r\n              {/* Room Name */}\r\n              <FormField\r\n                name=\"room_name\"\r\n                label=\"Room Name\"\r\n                required\r\n                value={formData.room_name}\r\n                onChange={handleInputChange}\r\n                error={errors.room_name}\r\n                placeholder=\"Enter room name\"\r\n              />\r\n\r\n              {/* Room Type */}\r\n              <div>\r\n                <label htmlFor=\"room_type\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Room Type <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"room_type\"\r\n                  name=\"room_type\"\r\n                  value={formData.room_type}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">Select room type</option>\r\n                  <option value=\"single\">Single Seater</option>\r\n                  <option value=\"double\">Double Seater</option>\r\n                  <option value=\"triple\">Three Seater</option>\r\n                  <option value=\"quad\">Four Seater</option>\r\n                </select>\r\n                {errors.room_type && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.room_type}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Block */}\r\n              <div>\r\n                <label htmlFor=\"block_id\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Block <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"block_id\"\r\n                  name=\"block_id\"\r\n                  value={formData.block_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">Select block</option>\r\n                  {Array.isArray(blocks) && blocks.map(block => (\r\n                    <option key={block.id} value={block.id}>{block.block_name}</option>\r\n                  ))}\r\n                </select>\r\n                {errors.block_id && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.block_id}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Capacity - Now spans 1.5 columns */}\r\n              <div className=\"lg:col-span-2\">\r\n                <label htmlFor=\"capacity\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Capacity <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  id=\"capacity\"\r\n                  name=\"capacity\"\r\n                  value={formData.capacity.toString()}\r\n                  onChange={handleInputChange}\r\n                  disabled={formData.room_type === 'single' || formData.room_type === 'double' || formData.room_type === 'triple' || formData.room_type === 'quad'}\r\n                  min={currentRoom?.students?.length || 1}\r\n                  placeholder=\"Enter room capacity\"\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                />\r\n                {errors.capacity && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.capacity}\r\n                  </div>\r\n                )}\r\n                <p className=\"text-xs text-gray-500 mt-1\">\r\n                  {currentRoom?.students?.length \r\n                    ? `Current occupancy: ${currentRoom.students.length} students. Capacity cannot be reduced below this.`\r\n                    : 'Capacity is automatically set based on room type.'}\r\n                </p>\r\n              </div>\r\n\r\n\r\n\r\n              {/* File Upload - Full Width */}\r\n              <div className=\"lg:col-span-3 space-y-1\">\r\n                <label className=\"block text-sm font-medium text-gray-900\">Room Image</label>\r\n                \r\n                <SingleImageUploadEdit\r\n                  imagePreview={imagePreview}\r\n                  existingImageUrl={currentRoom?.room_attachment ? getImageUrl(currentRoom.room_attachment) : null}\r\n                  onFileSelect={processFile}\r\n                  onRemove={removeImage}\r\n                  error={errors.room_attachment}\r\n                  label=\"\"\r\n                  onImageClick={(imageUrl, alt) => {\r\n                    setSelectedImage({ url: imageUrl, alt });\r\n                    setImageModalOpen(true);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-2 pt-4 border-t border-gray-200 mt-4\">\r\n              <CancelButton onClick={() => router.push('/admin/room')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Room\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\room\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ImageModal' is defined but never used.","line":6,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":141,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":141,"endColumn":29}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":226,"column":21,"nodeType":"JSXOpeningElement","endLine":230,"endColumn":23,"suppressions":[{"kind":"directive","justification":"server-hosted room images; using native <img> keeps consistent on-page display and is safe here"}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { roomApi, Room, ApiError } from '@/lib/api/index';\r\nimport { Button, ConfirmModal, TableSkeleton, ImageModal } from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function RoomDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const roomId = params.id as string;\r\n  \r\n  const [room, setRoom] = useState<Room | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<boolean>(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  // Fetch room data\r\n  useEffect(() => {\r\n    const fetchRoom = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const roomData = await roomApi.getRoom(roomId);\r\n        setRoom(roomData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching room:', error);\r\n        if (error instanceof ApiError) {\r\n          if (error.status === 404) {\r\n            setError(`Room with ID ${roomId} not found. It may have been deleted or the ID is incorrect.`);\r\n          } else {\r\n            setError(`Failed to load room: ${error.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load room data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (roomId) {\r\n      fetchRoom();\r\n    }\r\n  }, [roomId]);\r\n\r\n  const handleDeleteClick = () => {\r\n    setDeleteModal(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      await roomApi.deleteRoom(roomId);\r\n      \r\n      // Redirect to rooms list after successful deletion\r\n      router.push('/admin/room');\r\n    } catch (error) {\r\n      console.error('Error deleting room:', error);\r\n      if (error instanceof ApiError) {\r\n        alert(`Failed to delete room: ${error.message}`);\r\n      } else {\r\n        alert('Failed to delete room. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteModal(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getRoomStatusBadge = (status: string) => {\r\n    switch(status.toLowerCase()) {\r\n      case 'occupied':\r\n        return <span className=\"px-2.5 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full\">Occupied</span>;\r\n      case 'vacant':\r\n        return <span className=\"px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full\">Vacant</span>;\r\n      case 'maintenance':\r\n        return <span className=\"px-2.5 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full\">Maintenance</span>;\r\n      default:\r\n        return <span className=\"px-2.5 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full\">{status}</span>;\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Room Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading room information...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <div className=\"mt-3 space-x-2\">\r\n            <Button\r\n              onClick={() => window.location.reload()}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Retry\r\n            </Button>\r\n            <Button\r\n              onClick={() => router.push('/admin/room')}\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n            >\r\n              Back to Rooms\r\n            </Button>\r\n            <Button\r\n              onClick={async () => {\r\n                try {\r\n                  const response = await roomApi.getRooms();\r\n                  const availableIds = response.data.map(r => r.id).join(', ');\r\n                  alert(`Available room IDs: ${availableIds}`);\r\n                } catch (err) {\r\n                  alert('Could not fetch available rooms');\r\n                }\r\n              }}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Show Available IDs\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!room) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-500\">Room not found</p>\r\n          <button\r\n            onClick={() => router.push('/admin/room')}\r\n            className=\"mt-2 text-[#235999] hover:text-[#1e4d87]\"\r\n          >\r\n            Back to Rooms\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal}\r\n        title=\"Delete Room\"\r\n        message=\"Are you sure you want to delete this room? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={handleDelete}\r\n        onCancel={() => setDeleteModal(false)}\r\n        isLoading={isDeleting}\r\n        variant=\"danger\"\r\n      />\r\n      \r\n      <div className=\"w-full\">\r\n\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">{room.room_name}</h1>\r\n          </div>\r\n          <div className=\"flex space-x-2\">\r\n            <Button\r\n              onClick={() => router.push(`/admin/room/${room.id}/edit`)}\r\n              variant=\"primary\"\r\n            >\r\n              Edit Room\r\n            </Button>\r\n            <Button\r\n              onClick={handleDeleteClick}\r\n              disabled={isDeleting}\r\n              variant=\"danger\"\r\n              loading={isDeleting}\r\n            >\r\n              {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content Card */}\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n        <div className=\"p-6\">\r\n          {/* Main Content - Image and Information Side by Side */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n            {/* Room Image */}\r\n            {room.room_attachment && (\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 mb-6\">Room Image</h3>\r\n                <div className=\"border border-gray-200 rounded-lg overflow-hidden bg-gray-50\">\r\n                  <div className=\"flex items-center justify-center p-4\">\r\n                    {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted room images; using native <img> keeps consistent on-page display and is safe here */}\r\n                    <img\r\n                      src={getImageUrl(room.room_attachment)}\r\n                      alt={room.room_name}\r\n                      className=\"max-w-full max-h-80 object-contain\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Room Details */}\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-6\">Room Information</h3>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Room Name</h4>\r\n                  <p className=\"text-lg text-gray-900\">{room.room_name}</p>\r\n                </div>\r\n                \r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Room Type</h4>\r\n                  <p className=\"text-lg text-gray-900 capitalize\">{room.room_type}</p>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Status</h4>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <p className=\"text-lg text-gray-900\">{room.status}</p>\r\n                    {getRoomStatusBadge(room.status)}\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Capacity</h4>\r\n                  <p className=\"text-lg text-gray-900\">{room.capacity} beds</p>\r\n                </div>\r\n                \r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Vacant Beds</h4>\r\n                  <div className=\"flex items-center\">\r\n                    <p className=\"text-lg text-gray-900\">\r\n                      {room.vacant_beds !== undefined ? room.vacant_beds : 'Unknown'}\r\n                    </p>\r\n                    {room.vacant_beds !== undefined && (\r\n                      <span className={`ml-2 inline-block w-3 h-3 rounded-full ${room.vacant_beds > 0 ? 'bg-green-500' : 'bg-red-500'}`}></span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                \r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Location</h4>\r\n                  <p className=\"text-lg text-gray-900\">\r\n                    {room.block?.block_name ? `${room.block.block_name}` : 'No Block'} \r\n                    {''}\r\n                  </p>\r\n                </div>\r\n                \r\n                {/* Add any additional room properties here if needed */}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Metadata */}\r\n          <div className=\"border-t border-gray-200 mt-8 pt-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n              <div>\r\n                <span className=\"font-medium text-gray-500\">Created:</span>\r\n                <span className=\"ml-2 text-gray-900\">{formatDate(room.created_at)}</span>\r\n              </div>\r\n              {room.updated_at && (\r\n                <div>\r\n                  <span className=\"font-medium text-gray-500\">Last Updated:</span>\r\n                  <span className=\"ml-2 text-gray-900\">{formatDate(room.updated_at)}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\room\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleImageClick' is assigned a value but never used.","line":210,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { roomApi, RoomFormData, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  TableSkeleton, \r\n  ImageModal,\r\n  SingleImageUploadCreate\r\n} from '@/components/ui';\r\n\r\nexport default function CreateRoom() {\r\n  const router = useRouter();\r\n\r\n  const [formData, setFormData] = useState<RoomFormData>({\r\n    room_name: '',\r\n    block_id: '',\r\n    capacity: 0,\r\n    room_type: '',\r\n    custom_room_type: '',\r\n    room_attachment: null,\r\n  });\r\n  \r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [blocks, setBlocks] = useState<{id: string, block_name: string}[]>([]);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  // Fetch dropdown data\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch blocks for dropdown\r\n        const blocksData = await roomApi.getBlocks();\r\n        // Ensure blocksData is an array\r\n        setBlocks(Array.isArray(blocksData) ? blocksData : []);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        if (error instanceof ApiError) {\r\n          setErrors({\r\n            fetch: `Failed to load data: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            fetch: 'Failed to load data. Please try again.'\r\n          });\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    if (name === 'room_type') {\r\n      // Auto-set capacity based on room type\r\n      let capacity = 0;\r\n      switch (value) {\r\n        case 'single':\r\n          capacity = 1;\r\n          break;\r\n        case 'double':\r\n          capacity = 2;\r\n          break;\r\n        case 'triple':\r\n          capacity = 3;\r\n          break;\r\n        case 'quad':\r\n          capacity = 4;\r\n          break;\r\n        case 'manual':\r\n          // For manual, keep existing capacity or set to 1 if it's 0\r\n          capacity = formData.capacity > 0 ? formData.capacity : 1;\r\n          break;\r\n        default:\r\n          capacity = 0;\r\n      }\r\n      \r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value,\r\n        capacity: capacity\r\n      }));\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: name === 'capacity' ? parseInt(value) || 0 : value\r\n      }));\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        room_attachment: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        room_attachment: 'File size must be less than 5MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      room_attachment: file\r\n    }));\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.room_attachment) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        room_attachment: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const removeImage = () => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      room_attachment: null\r\n    }));\r\n    setImagePreview(null);\r\n    const fileInput = document.getElementById('room_attachment') as HTMLInputElement;\r\n    if (fileInput) {\r\n      fileInput.value = '';\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.room_name.trim()) {\r\n      newErrors.room_name = 'Room name is required';\r\n    }\r\n\r\n    if (!formData.block_id) {\r\n      newErrors.block_id = 'Block is required';\r\n    }\r\n\r\n    if (!formData.capacity || formData.capacity <= 0) {\r\n      newErrors.capacity = 'Capacity must be greater than 0';\r\n    }\r\n    \r\n    if (!formData.room_type) {\r\n      newErrors.room_type = 'Room type is required';\r\n    }\r\n    \r\n    // For manual room type, validate custom room type and don't override capacity\r\n    if (formData.room_type === 'manual') {\r\n      if (!formData.custom_room_type || formData.custom_room_type.trim() === '') {\r\n        newErrors.custom_room_type = 'Custom room type is required';\r\n      }\r\n    } else {\r\n      // Update capacity based on standard room type if needed\r\n      if (formData.room_type === 'single' && formData.capacity !== 1) {\r\n        formData.capacity = 1;\r\n      } else if (formData.room_type === 'double' && formData.capacity !== 2) {\r\n        formData.capacity = 2;\r\n      } else if (formData.room_type === 'triple' && formData.capacity !== 3) {\r\n        formData.capacity = 3;\r\n      } else if (formData.room_type === 'quad' && formData.capacity !== 4) {\r\n        formData.capacity = 4;\r\n      }\r\n    }\r\n\r\n    // Status is now handled by the backend automatically\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleImageClick = (url: string, alt: string) => {\r\n    setSelectedImage({ url, alt });\r\n    setImageModalOpen(true);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      await roomApi.createRoom(formData);\r\n      \r\n      // Redirect to rooms list on success\r\n      router.push('/admin/room');\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating room:', error);\r\n      if (error instanceof ApiError) {\r\n        // Display validation errors if available\r\n        if (error.validation) {\r\n          const validationErrors: Record<string, string> = {};\r\n          \r\n          // Convert validation errors from API to form errors\r\n          Object.entries(error.validation).forEach(([field, messages]) => {\r\n            validationErrors[field] = Array.isArray(messages) ? messages[0] : messages;\r\n          });\r\n          \r\n          setErrors({\r\n            ...validationErrors,\r\n            submit: `Failed to create room: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            submit: `Failed to create room: ${error.message}`\r\n          });\r\n        }\r\n      } else {\r\n        setErrors({\r\n          submit: 'An error occurred while creating the room. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Create Room</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/room')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Rooms\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create New Room</h1>\r\n        </div>\r\n\r\n        {/* Modern Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-800 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\r\n              \r\n              {/* Room Name */}\r\n              <FormField\r\n                name=\"room_name\"\r\n                label=\"Room Name\"\r\n                required\r\n                value={formData.room_name}\r\n                onChange={handleInputChange}\r\n                error={errors.room_name}\r\n                placeholder=\"Enter room name\"\r\n              />\r\n\r\n              {/* Room Type */}\r\n              <div>\r\n                <label htmlFor=\"room_type\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Room Type <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"room_type\"\r\n                  name=\"room_type\"\r\n                  value={formData.room_type}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">Select room type</option>\r\n                  <option value=\"single\">Single Seater</option>\r\n                  <option value=\"double\">Double Seater</option>\r\n                  <option value=\"triple\">Three Seater</option>\r\n                  <option value=\"quad\">Four Seater</option>\r\n                  <option value=\"manual\">Manual (Custom)</option>\r\n                </select>\r\n                {errors.room_type && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.room_type}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Custom Room Type - visible when manual is selected */}\r\n              {formData.room_type === 'manual' && (\r\n                <div>\r\n                  <label htmlFor=\"custom_room_type\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Custom Room Type <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"custom_room_type\"\r\n                    name=\"custom_room_type\"\r\n                    value={formData.custom_room_type || ''}\r\n                    onChange={handleInputChange}\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                    placeholder=\"Enter custom room type\"\r\n                  />\r\n                  {errors.custom_room_type && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      {errors.custom_room_type}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Block */}\r\n              <div>\r\n                <label htmlFor=\"block_id\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Block <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  id=\"block_id\"\r\n                  name=\"block_id\"\r\n                  value={formData.block_id}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                >\r\n                  <option value=\"\">Select block</option>\r\n                  {Array.isArray(blocks) && blocks.map(block => (\r\n                    <option key={block.id} value={block.id}>{block.block_name}</option>\r\n                  ))}\r\n                </select>\r\n                {errors.block_id && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.block_id}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Capacity - Now spans 3 columns for standard types, or 1 column for manual type */}\r\n              <div className={formData.room_type === 'manual' ? '' : 'lg:col-span-3'}>\r\n                <label htmlFor=\"capacity\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Capacity <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  id=\"capacity\"\r\n                  name=\"capacity\"\r\n                  value={formData.capacity.toString()}\r\n                  onChange={handleInputChange}\r\n                  disabled={formData.room_type !== 'manual' && formData.room_type !== ''}\r\n                  min={1}\r\n                  placeholder={formData.room_type === 'manual' ? \"Enter capacity\" : \"Capacity is set by room type\"}\r\n                  className={`w-full px-4 py-4 border border-neutral-200/60 ${formData.room_type !== 'manual' && formData.room_type !== '' ? 'bg-gray-50' : 'bg-white'} rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200`}\r\n                />\r\n                {errors.capacity && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.capacity}\r\n                  </div>\r\n                )}\r\n                <p className=\"text-xs text-gray-500 mt-1\">\r\n                  {formData.room_type === 'manual' ? \r\n                    \"Enter the capacity for this custom room type\" : \r\n                    \"Capacity is automatically set based on room type: Single = 1, Double = 2, Three Seater = 3, Four Seater = 4\"}\r\n                </p>\r\n              </div>\r\n\r\n              {/* File Upload - Full Width */}\r\n              <div className=\"lg:col-span-3 space-y-1\">\r\n                <label className=\"block text-sm font-medium text-gray-900\">Room Image</label>\r\n                \r\n                <SingleImageUploadCreate\r\n                  imagePreview={imagePreview}\r\n                  onFileSelect={processFile}\r\n                  onRemove={removeImage}\r\n                  error={errors.room_attachment}\r\n                  label=\"\"\r\n                  onImageClick={(imageUrl, alt) => {\r\n                    setSelectedImage({ url: imageUrl, alt });\r\n                    setImageModalOpen(true);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-2 pt-4 border-t border-gray-200 mt-4\">\r\n              <CancelButton onClick={() => router.push('/admin/room')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Creating...\"\r\n              >\r\n                Create Room\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\room\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ActionButtons' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCurrentPage' is assigned a value but never used.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalPages' is assigned a value but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formatDate' is assigned a value but never used.","line":76,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":19}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { roomApi, Room, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  ConfirmModal, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons\r\n} from '@/components/ui';\r\n\r\nexport default function RoomList() {\r\n  const router = useRouter();\r\n  const [rooms, setRooms] = useState<Room[]>([]);\r\n  const [filteredRooms, setFilteredRooms] = useState<Room[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, roomId: string | null}>({\r\n    show: false,\r\n    roomId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch rooms from API\r\n  useEffect(() => {\r\n    const fetchRooms = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await roomApi.getRooms(currentPage);\r\n        setRooms(response.data);\r\n        setFilteredRooms(response.data);\r\n        setTotalPages(response.last_page);\r\n      } catch (error) {\r\n        console.error('Error fetching rooms:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch rooms: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch rooms. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRooms();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredRooms(rooms);\r\n    } else {\r\n      const filtered = rooms.filter(room =>\r\n        room.room_name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        room.room_type.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        String(room.capacity).includes(searchQuery) ||\r\n        (room.block?.block_name || '').toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredRooms(filtered);\r\n    }\r\n  }, [searchQuery, rooms]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: '2-digit'\r\n    });\r\n  };\r\n\r\n  const handleDeleteRoom = async (roomId: string) => {\r\n    setDeleteModal({show: true, roomId});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const roomId = deleteModal.roomId;\r\n    if (!roomId) return;\r\n\r\n    try {\r\n      setIsDeleting(roomId);\r\n      setDeleteModal({show: false, roomId: null});\r\n      setAlert({show: true, message: 'Deleting room...', type: 'success'});\r\n      \r\n      await roomApi.deleteRoom(roomId);\r\n      \r\n      // Remove from local state\r\n      const updatedRooms = rooms.filter(room => room.id !== roomId);\r\n      setRooms(updatedRooms);\r\n      setFilteredRooms(updatedRooms.filter(room =>\r\n        !searchQuery.trim() ||\r\n        room.room_name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        room.room_type.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        String(room.capacity).includes(searchQuery)\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Room deleted successfully!', type: 'success'});\r\n      \r\n      // Hide alert after 2 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting room:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({show: true, message: `Failed to delete room: ${error.message}`, type: 'error'});\r\n      } else {\r\n        setAlert({show: true, message: 'Failed to delete room. Please try again.', type: 'error'});\r\n      }\r\n      \r\n      // Hide error alert after 3 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000);\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, roomId: null});\r\n  };\r\n\r\n  const getRoomStatusBadge = (status: string, vacantBeds?: number, capacity?: number) => {\r\n    if (vacantBeds !== undefined && capacity !== undefined) {\r\n      // Display occupancy ratio along with status\r\n      if (vacantBeds <= 0) {\r\n        // Fully occupied - Red\r\n        return <span className=\"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full\">Occupied ({capacity}/{capacity})</span>;\r\n      } else if (vacantBeds === capacity) {\r\n        // Fully vacant - Green\r\n        return <span className=\"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full\">Vacant (0/{capacity})</span>;\r\n      } else {\r\n        // Partially vacant - Yellow\r\n        const occupiedBeds = capacity - vacantBeds;\r\n        return (\r\n          <span className=\"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full\">\r\n            Occupied ({occupiedBeds}/{capacity})\r\n          </span>\r\n        );\r\n      }\r\n    }\r\n    \r\n    // Simpler status display (just vacant or occupied)\r\n    switch(status.toLowerCase()) {\r\n      case 'occupied':\r\n        return <span className=\"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full\">Occupied</span>;\r\n      case 'vacant':\r\n        return <span className=\"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full\">Vacant</span>;\r\n      default:\r\n        return <span className=\"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full\">{status}</span>;\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Rooms</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading rooms...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <Button\r\n            onClick={() => window.location.reload()}\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800\"\r\n          >\r\n            Retry\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Room\"\r\n        message=\"Are you sure you want to delete this room? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Rooms</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{rooms.length} total rooms</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/admin/room/create')}\r\n          icon={<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n          </svg>}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n        >\r\n          Add Room\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search rooms by name, type, block or capacity...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredRooms.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No rooms found' : 'No rooms yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'Create your first room to get started'}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/admin/room/create')}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n              icon={<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n              </svg>}\r\n            >\r\n              Create Room\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Room Details</div>\r\n              <div className=\"col-span-2\">Block</div>\r\n              <div className=\"col-span-2\">Type</div>\r\n              <div className=\"col-span-2\">Capacity</div>\r\n              <div className=\"col-span-2 text-center\">Status</div>\r\n              <div className=\"col-span-1 text-center pl-2\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredRooms.map((room) => (\r\n              <div key={room.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Room Details */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{room.room_name}</div>\r\n                    <div className=\"flex items-center text-xs text-gray-500 mt-1\">\r\n                      <svg className=\"w-3 h-3 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\r\n                      </svg>\r\n                      Room\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Block */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-900\">{room.block?.block_name || 'No Block'}</div>\r\n                  </div>\r\n\r\n                  {/* Type */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700 capitalize\">{room.room_type}</div>\r\n                  </div>\r\n\r\n                  {/* Capacity */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700\">\r\n                      <span className=\"font-medium\">{room.capacity}</span>\r\n                      {room.vacant_beds !== undefined && (\r\n                        <span className=\"text-xs text-gray-500 ml-1\">\r\n                          ({room.vacant_beds} vacant)\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"col-span-2 text-center\">\r\n                    {getRoomStatusBadge(room.status, room.vacant_beds, room.capacity)}\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex flex-nowrap gap-2 justify-center pl-2\">\r\n                      <button\r\n                        onClick={() => router.push(`/admin/room/${room.id}`)}\r\n                        className=\"bg-gray-100 text-gray-700 p-1.5 rounded hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300\"\r\n                        title=\"View Room\"\r\n                      >\r\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                        </svg>\r\n                      </button>\r\n                      <button\r\n                        onClick={() => router.push(`/admin/room/${room.id}/edit`)}\r\n                        className=\"bg-blue-100 text-blue-700 p-1.5 rounded hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-300\"\r\n                        title=\"Edit Room\"\r\n                      >\r\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                        </svg>\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDeleteRoom(room.id)}\r\n                        disabled={isDeleting === room.id}\r\n                        className={`bg-red-100 text-red-700 p-1.5 rounded hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-red-300 ${isDeleting === room.id ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                        title=\"Delete Room\"\r\n                      >\r\n                        {isDeleting === room.id ? (\r\n                          <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                          </svg>\r\n                        ) : (\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m6-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                          </svg>\r\n                        )}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredRooms.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredRooms.length} of {rooms.length} rooms\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\salary\\[id]\\edit\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, salaryId]","fix":{"range":[1170,1180],"text":"[fetchData, salaryId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2140,2143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2140,2143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3811,3814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3811,3814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { SalaryApi, StaffApi, type UpdateSalaryRequest, type Salary, type Staff } from '@/lib/api';\r\nimport { \r\n  SubmitButton, \r\n  CancelButton, \r\n  SuccessToast,\r\n  TableSkeleton \r\n} from '@/components/ui';\r\n\r\nexport default function EditSalary() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const salaryId = parseInt(params.id as string);\r\n  \r\n  const [staff, setStaff] = useState<Staff[]>([]);\r\n  const [salary, setSalary] = useState<Salary | null>(null);\r\n  const [formData, setFormData] = useState<UpdateSalaryRequest>({});\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingData, setLoadingData] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({});\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (salaryId) {\r\n      fetchData();\r\n    }\r\n  }, [salaryId]);\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      setLoadingData(true);\r\n      const [salaryData, staffData] = await Promise.all([\r\n        SalaryApi.getById(salaryId),\r\n        StaffApi.getAll(true)\r\n      ]);\r\n      \r\n      setSalary(salaryData);\r\n      setStaff(staffData);\r\n      \r\n      // Initialize form data with current salary data\r\n      setFormData({\r\n        staff_id: salaryData.staff_id,\r\n        amount: salaryData.amount,\r\n        month: salaryData.month,\r\n        year: salaryData.year,\r\n        description: salaryData.description,\r\n        status: salaryData.status\r\n      });\r\n      \r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to load salary data');\r\n    } finally {\r\n      setLoadingData(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    let processedValue: any = value;\r\n    \r\n    if (name === 'staff_id' || name === 'month' || name === 'year') {\r\n      processedValue = parseInt(value) || 0;\r\n    } else if (name === 'amount') {\r\n      processedValue = parseFloat(value) || 0;\r\n    }\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: processedValue\r\n    }));\r\n    \r\n    // Clear validation error for this field\r\n    if (validationErrors[name]) {\r\n      setValidationErrors(prev => {\r\n        const newErrors = { ...prev };\r\n        delete newErrors[name];\r\n        return newErrors;\r\n      });\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const errors: Record<string, string> = {};\r\n\r\n    if (formData.staff_id !== undefined && (!formData.staff_id || formData.staff_id === 0)) {\r\n      errors.staff_id = 'Please select a staff member';\r\n    }\r\n    \r\n    if (formData.amount !== undefined && (!formData.amount || formData.amount <= 0)) {\r\n      errors.amount = 'Please enter a valid amount';\r\n    }\r\n\r\n    setValidationErrors(errors);\r\n    return Object.keys(errors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const updatedSalary = await SalaryApi.update(salaryId, formData);\r\n      setSalary(updatedSalary);\r\n      \r\n      setAlert({\r\n        show: true,\r\n        message: 'Salary record updated successfully!',\r\n        type: 'success'\r\n      });\r\n      \r\n      // Redirect after a short delay\r\n      setTimeout(() => {\r\n        router.push('/admin/salary');\r\n      }, 2000);\r\n      \r\n    } catch (err: any) {\r\n      if (err.validation) {\r\n        setValidationErrors(err.validation);\r\n      } else {\r\n        setError(err instanceof Error ? err.message : 'Failed to update salary record');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loadingData) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Salary</h1>\r\n            <p className=\"text-sm text-gray-500 mt-1\">Loading salary data...</p>\r\n          </div>\r\n          <TableSkeleton />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !salary) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">{error || 'Salary record not found'}</p>\r\n            </div>\r\n            <button\r\n              onClick={() => router.push('/admin/salary')}\r\n              className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n            >\r\n              Back to Salary List\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Success Toast */}\r\n        {alert.type === 'success' && alert.show && (\r\n          <SuccessToast\r\n            show={alert.show}\r\n            message={alert.message}\r\n            progress={100}\r\n            onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n          />\r\n        )}\r\n\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Salary</h1>\r\n        </div>\r\n\r\n        {/* Modern Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {error && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-700 text-sm\">{error}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"space-y-4\">\r\n              {/* Current Info Display */}\r\n              <div className=\"bg-gray-50 rounded-lg p-4\">\r\n                <h3 className=\"text-sm font-medium text-gray-700 mb-2\">Current Information</h3>\r\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                  <div>\r\n                    <span className=\"text-gray-500\">Staff:</span> {salary.staff?.staff_name}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-500\">Period:</span> {salary.month_name} {salary.year}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-500\">Amount:</span> Rs. {salary.formatted_amount}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-500\">Status:</span> {salary.status}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Staff Selection */}\r\n              <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Staff Selection</h2>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Select Staff <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <select\r\n                    name=\"staff_id\"\r\n                    value={formData.staff_id || salary.staff_id}\r\n                    onChange={handleInputChange}\r\n                    className={`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-[#235999] focus:border-[#235999] sm:text-sm ${\r\n                      validationErrors.staff_id ? 'border-red-300' : 'border-gray-300'\r\n                    }`}\r\n                    disabled={loading}\r\n                  >\r\n                    <option value={0}>Select Staff</option>\r\n                    {staff.map((staffMember) => (\r\n                      <option key={staffMember.id} value={staffMember.id}>\r\n                        {staffMember.staff_name} ({staffMember.staff_id})\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {validationErrors.staff_id && (\r\n                    <p className=\"mt-1 text-sm text-red-600\">{validationErrors.staff_id}</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Payment Details */}\r\n              <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Payment Details</h2>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {/* Payment Amount */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Payment Amount <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      name=\"amount\"\r\n                      min=\"0\"\r\n                      step=\"0.01\"\r\n                      value={formData.amount !== undefined ? formData.amount : salary.amount}\r\n                      onChange={handleInputChange}\r\n                      className={`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-[#235999] focus:border-[#235999] sm:text-sm ${\r\n                        validationErrors.amount ? 'border-red-300' : 'border-gray-300'\r\n                      }`}\r\n                      placeholder=\"Enter payment amount\"\r\n                      disabled={loading}\r\n                    />\r\n                    {validationErrors.amount && (\r\n                      <p className=\"mt-1 text-sm text-red-600\">{validationErrors.amount}</p>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Original Creation Date */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Payment Date\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={new Date(salary.created_at).toLocaleDateString('en-US', {\r\n                        day: '2-digit',\r\n                        month: '2-digit',\r\n                        year: 'numeric'\r\n                      })}\r\n                      className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-50 sm:text-sm\"\r\n                      disabled\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div className=\"mt-4\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Description (Optional)\r\n                  </label>\r\n                  <textarea\r\n                    name=\"description\"\r\n                    value={formData.description !== undefined ? formData.description || '' : salary.description || ''}\r\n                    onChange={handleInputChange}\r\n                    rows={3}\r\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#235999] focus:border-[#235999] sm:text-sm\"\r\n                    placeholder=\"Enter description (optional)\"\r\n                    disabled={loading}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex justify-between items-center pt-4 mt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push('/admin/salary')} />\r\n              <SubmitButton \r\n                loading={loading}\r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Salary\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\salary\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":7,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":37},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSalary'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSalary, salaryId]","fix":{"range":[676,686],"text":"[fetchSalary, salaryId]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { SalaryApi, type Salary } from '@/lib/api';\r\nimport { Button } from '@/components/ui';\r\nimport { Edit, Calendar, User, Clock } from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\nexport default function SalaryDetail() {\r\n  const params = useParams();\r\n  const salaryId = parseInt(params.id as string);\r\n  \r\n  const [salary, setSalary] = useState<Salary | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (salaryId) {\r\n      fetchSalary();\r\n    }\r\n  }, [salaryId]);\r\n\r\n  const fetchSalary = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const salaryData = await SalaryApi.getById(salaryId);\r\n      setSalary(salaryData);\r\n      setError(null);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to load salary details');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('en-NP', {\r\n      style: 'currency',\r\n      currency: 'NPR'\r\n    }).format(amount);\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !salary) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error || 'Salary record not found'}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-center justify-end mb-4\">\r\n            <Link href={`/admin/salary/${salary.id}/edit`}>\r\n              <Button \r\n                icon={<Edit className=\"w-4 h-4\" />}\r\n                className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n              >\r\n                Edit Salary\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Salary Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">\r\n            Salary record for {salary.staff?.staff_name} - {salary.month_name} {salary.year}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Main Content */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Primary Information */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          {/* Staff Information Card */}\r\n          <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-4\">\r\n              <User className=\"w-5 h-5 text-gray-400\" />\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Staff Information</h2>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Staff Name</label>\r\n                <p className=\"mt-1 text-sm text-gray-900 font-medium\">{salary.staff?.staff_name}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Staff ID</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{salary.staff_id}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Email</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{salary.staff?.email || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Contact Number</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{salary.staff?.contact_number || 'N/A'}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Salary Information Card */}\r\n          <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-4\">\r\n              <User className=\"w-5 h-5 text-gray-400\" />\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Salary Information</h2>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Payment Date</label>\r\n                <p className=\"mt-1 text-sm text-gray-900 font-medium\">\r\n                  {formatDate(salary.created_at)}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Amount</label>\r\n                <p className=\"mt-1 text-lg text-gray-900 font-bold\">\r\n                  {formatCurrency(salary.amount)}\r\n                </p>\r\n              </div>\r\n              <div className=\"md:col-span-2\">\r\n                <label className=\"block text-sm font-medium text-gray-500\">Description</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{salary.description || 'No description provided'}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Sidebar Information */}\r\n        <div className=\"space-y-6\">\r\n          {/* Timeline Card */}\r\n          <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-4\">\r\n              <Calendar className=\"w-5 h-5 text-gray-400\" />\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Timeline</h2>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Created</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">\r\n                  {formatDate(salary.created_at)}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-500\">Last Updated</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">\r\n                  {formatDate(salary.updated_at)}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Quick Actions Card */}\r\n          <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Quick Actions</h2>\r\n            <div className=\"space-y-3\">\r\n              <Link href={`/admin/salary/${salary.id}/edit`} className=\"block\">\r\n                <Button variant=\"secondary\" className=\"w-full\" icon={<Edit className=\"w-4 h-4\" />}>\r\n                  Edit Salary\r\n                </Button>\r\n              </Link>\r\n              <Link href=\"/admin/salary/create\" className=\"block\">\r\n                <Button variant=\"primary\" className=\"w-full bg-[#235999] hover:bg-[#1e4d87]\">\r\n                  Create New Salary\r\n                </Button>\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\salary\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormField' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1638,1641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1638,1641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3172,3175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3172,3175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { SalaryApi, StaffApi, type CreateSalaryRequest, type Staff } from '@/lib/api';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SuccessToast \r\n} from '@/components/ui';\r\n\r\nexport default function CreateSalary() {\r\n  const router = useRouter();\r\n  const [staff, setStaff] = useState<Staff[]>([]);\r\n  const [formData, setFormData] = useState<CreateSalaryRequest>({\r\n    staff_id: 0,\r\n    amount: 0,\r\n    month: new Date().getMonth() + 1,\r\n    year: new Date().getFullYear(),\r\n    description: '',\r\n    status: 'pending'\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingStaff, setLoadingStaff] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({});\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchStaff();\r\n  }, []);\r\n\r\n  const fetchStaff = async () => {\r\n    try {\r\n      setLoadingStaff(true);\r\n      const staffData = await StaffApi.getAll(true);\r\n      setStaff(staffData);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to load staff');\r\n    } finally {\r\n      setLoadingStaff(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    let processedValue: any = value;\r\n    \r\n    if (name === 'staff_id' || name === 'month' || name === 'year') {\r\n      processedValue = parseInt(value) || 0;\r\n    } else if (name === 'amount') {\r\n      processedValue = parseFloat(value) || 0;\r\n    }\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: processedValue\r\n    }));\r\n    \r\n    // Clear validation error for this field\r\n    if (validationErrors[name]) {\r\n      setValidationErrors(prev => {\r\n        const newErrors = { ...prev };\r\n        delete newErrors[name];\r\n        return newErrors;\r\n      });\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const errors: Record<string, string> = {};\r\n\r\n    if (!formData.staff_id || formData.staff_id === 0) {\r\n      errors.staff_id = 'Please select a staff member';\r\n    }\r\n    \r\n    if (!formData.amount || formData.amount <= 0) {\r\n      errors.amount = 'Please enter a valid amount';\r\n    }\r\n\r\n    setValidationErrors(errors);\r\n    return Object.keys(errors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      await SalaryApi.create(formData);\r\n      \r\n      setAlert({\r\n        show: true,\r\n        message: 'Salary record created successfully!',\r\n        type: 'success'\r\n      });\r\n      \r\n      // Redirect after a short delay\r\n      setTimeout(() => {\r\n        router.push('/admin/salary');\r\n      }, 2000);\r\n      \r\n    } catch (err: any) {\r\n      if (err.validation) {\r\n        setValidationErrors(err.validation);\r\n      } else {\r\n        setError(err instanceof Error ? err.message : 'Failed to create salary record');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loadingStaff) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"flex justify-center items-center h-64\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Success Toast */}\r\n        {alert.type === 'success' && alert.show && (\r\n          <SuccessToast\r\n            show={alert.show}\r\n            message={alert.message}\r\n            progress={100}\r\n            onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n          />\r\n        )}\r\n\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create Salary</h1>\r\n        </div>\r\n\r\n        {/* Modern Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {error && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-700 text-sm\">{error}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"space-y-4\">\r\n              {/* Staff Selection */}\r\n              <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Staff Selection</h2>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Select Staff <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <select\r\n                    name=\"staff_id\"\r\n                    value={formData.staff_id}\r\n                    onChange={handleInputChange}\r\n                    className={`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-[#235999] focus:border-[#235999] sm:text-sm ${\r\n                      validationErrors.staff_id ? 'border-red-300' : 'border-gray-300'\r\n                    }`}\r\n                    disabled={loading}\r\n                  >\r\n                    <option value={0}>Select Staff</option>\r\n                    {staff.map((staffMember) => (\r\n                      <option key={staffMember.id} value={staffMember.id}>\r\n                        {staffMember.staff_name} ({staffMember.staff_id})\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {validationErrors.staff_id && (\r\n                    <p className=\"mt-1 text-sm text-red-600\">{validationErrors.staff_id}</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Payment Details */}\r\n              <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Payment Details</h2>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {/* Payment Amount */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Payment Amount <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      name=\"amount\"\r\n                      min=\"0\"\r\n                      step=\"0.01\"\r\n                      value={formData.amount}\r\n                      onChange={handleInputChange}\r\n                      className={`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-[#235999] focus:border-[#235999] sm:text-sm ${\r\n                        validationErrors.amount ? 'border-red-300' : 'border-gray-300'\r\n                      }`}\r\n                      placeholder=\"Enter payment amount\"\r\n                      disabled={loading}\r\n                    />\r\n                    {validationErrors.amount && (\r\n                      <p className=\"mt-1 text-sm text-red-600\">{validationErrors.amount}</p>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Payment Date */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Payment Date\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={new Date().toLocaleDateString('en-US', {\r\n                        day: '2-digit',\r\n                        month: '2-digit', \r\n                        year: 'numeric'\r\n                      })}\r\n                      className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-50 sm:text-sm\"\r\n                      disabled\r\n                    />\r\n                    <p className=\"mt-1 text-xs text-gray-500\">Current date will be used</p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div className=\"mt-4\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Description (Optional)\r\n                  </label>\r\n                  <textarea\r\n                    name=\"description\"\r\n                    value={formData.description || ''}\r\n                    onChange={handleInputChange}\r\n                    rows={3}\r\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#235999] focus:border-[#235999] sm:text-sm\"\r\n                    placeholder=\"Enter description (optional)\"\r\n                    disabled={loading}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex justify-between items-center pt-4 mt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.back()} />\r\n              <SubmitButton \r\n                loading={loading} \r\n                loadingText=\"Processing...\"\r\n              >\r\n                Process Payment\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\salary\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SalaryFilters' is defined but never used.","line":5,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit' is defined but never used.","line":7,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":12}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { SalaryApi, type Salary, type SalaryFilters } from '@/lib/api';\r\nimport { Button, SearchBar, ConfirmModal, SuccessToast, TableSkeleton, ActionButtons } from '@/components/ui';\r\nimport { Trash, Edit, Plus } from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\nexport default function SalaryList() {\r\n  const router = useRouter();\r\n  const [salaries, setSalaries] = useState<Salary[]>([]);\r\n  const [filteredSalaries, setFilteredSalaries] = useState<Salary[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, salaryId: number | null}>({\r\n    show: false,\r\n    salaryId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n  const [isDeleting, setIsDeleting] = useState<number | null>(null);\r\n\r\n  const fetchSalaries = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await SalaryApi.getAll({});\r\n      const salaryData = Array.isArray(response) ? response : response.data;\r\n      setSalaries(salaryData);\r\n      setFilteredSalaries(salaryData);\r\n      setError(null);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to load salaries');\r\n      console.error('Error fetching salaries:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchSalaries();\r\n  }, []);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredSalaries(salaries);\r\n    } else {\r\n      const filtered = salaries.filter(salary =>\r\n        salary.staff?.staff_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        salary.staff?.staff_id?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        salary.month_name?.toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredSalaries(filtered);\r\n    }\r\n  }, [searchQuery, salaries]);\r\n\r\n  const handleDelete = async (id: number) => {\r\n    setDeleteModal({show: true, salaryId: id});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const salaryId = deleteModal.salaryId;\r\n    if (!salaryId) return;\r\n\r\n    try {\r\n      setIsDeleting(salaryId);\r\n      setDeleteModal({show: false, salaryId: null});\r\n      \r\n      await SalaryApi.delete(salaryId);\r\n      \r\n      const updatedSalaries = salaries.filter(salary => salary.id !== salaryId);\r\n      setSalaries(updatedSalaries);\r\n      setFilteredSalaries(updatedSalaries.filter(salary =>\r\n        !searchQuery.trim() ||\r\n        salary.staff?.staff_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        salary.staff?.staff_id?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        salary.month_name?.toLowerCase().includes(searchQuery.toLowerCase())\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Salary deleted successfully!', type: 'success'});\r\n      \r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 2000); // Reduced from 3000ms\r\n      \r\n    } catch (err) {\r\n      setAlert({\r\n        show: true, \r\n        message: err instanceof Error ? err.message : 'Failed to delete salary', \r\n        type: 'error'\r\n      });\r\n      \r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000); // Reduced from 5000ms\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, salaryId: null});\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('en-NP', {\r\n      style: 'currency',\r\n      currency: 'NPR'\r\n    }).format(amount);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Salary Management</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading salaries...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Salary\"\r\n        message=\"Are you sure you want to delete this salary record? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Salary Management</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{salaries.length} total salary records</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/admin/salary/create')}\r\n          icon={<Plus className=\"w-4 h-4\" />}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n        >\r\n          Create Salary\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"mb-6\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search salaries by staff name or ID...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Salary List */}\r\n      {filteredSalaries.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No salaries found' : 'No salary records yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'Create your first salary record to get started'}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/admin/salary/create')}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n            >\r\n              Create Salary\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Staff Details</div>\r\n              <div className=\"col-span-3\">Description</div>\r\n              <div className=\"col-span-3\">Amount</div>\r\n              <div className=\"col-span-2\">Created Date</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredSalaries.map((salary) => (\r\n              <div key={salary.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Staff Details */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{salary.staff?.staff_name}</div>\r\n                    <div className=\"text-xs text-gray-500\">{salary.staff?.staff_id}</div>\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"text-sm text-gray-900\">\r\n                      {salary.description || 'No description'}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Amount */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"text-sm font-medium text-gray-900\">{formatCurrency(salary.amount)}</div>\r\n                  </div>\r\n\r\n                  {/* Created Date */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-xs text-gray-500\">\r\n                      {new Date(salary.created_at).toLocaleDateString()}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <ActionButtons \r\n                      viewUrl={`/admin/salary/${salary.id}`}\r\n                      editUrl={`/admin/salary/${salary.id}/edit`}\r\n                      onDelete={() => handleDelete(salary.id)}\r\n                      isDeleting={isDeleting === salary.id}\r\n                      style=\"compact\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Footer */}\r\n      {filteredSalaries.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredSalaries.length} of {salaries.length} salary records\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff-checkin-checkout\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2867,2870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2867,2870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { staffCheckInCheckOutApi, StaffCheckInCheckOut, StaffCheckInCheckOutFormData } from '@/lib/api/staff-checkincheckout.api';\r\nimport { \r\n  SubmitButton, \r\n  CancelButton \r\n} from '@/components/ui';\r\n\r\nexport default function EditStaffCheckinCheckout() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const recordId = params.id as string;\r\n  \r\n  const [record, setRecord] = useState<StaffCheckInCheckOut | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  const [formData, setFormData] = useState<StaffCheckInCheckOutFormData>({\r\n    staff_id: '',\r\n    block_id: '',\r\n    date: '',\r\n    checkin_time: '',\r\n    checkout_time: '',\r\n    remarks: '',\r\n  });\r\n\r\n  // Fetch initial data\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Fetch record details only\r\n        const recordResponse = await staffCheckInCheckOutApi.getCheckInCheckOut(recordId);\r\n        const recordData = recordResponse.data;\r\n        setRecord(recordData);\r\n        \r\n        // Set form data for editable fields only\r\n        setFormData({\r\n          staff_id: recordData.staff_id,\r\n          block_id: recordData.block_id,\r\n          date: recordData.date,\r\n          checkin_time: recordData.checkin_time || '',\r\n          checkout_time: recordData.checkout_time || '',\r\n          remarks: recordData.remarks || '',\r\n        });\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        setErrors({ fetch: 'Failed to load record data' });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    if (recordId) {\r\n      fetchData();\r\n    }\r\n  }, [recordId]);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setErrors({});\r\n\r\n    try {\r\n      // Only submit the editable fields (times)\r\n      const updateData = {\r\n        checkin_time: formData.checkin_time || undefined,\r\n        checkout_time: formData.checkout_time || undefined,\r\n      };\r\n\r\n      await staffCheckInCheckOutApi.updateCheckInCheckOut(recordId, updateData);\r\n      router.push(`/admin/staff-checkin-checkout/${recordId}`);\r\n    } catch (error: any) {\r\n      console.error('Error updating record:', error);\r\n      if (error.validation) {\r\n        setErrors(error.validation);\r\n      } else {\r\n        setErrors({ general: error.message || 'Failed to update record' });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const formatDateTimeForInput = (dateTime: string | null | undefined): string => {\r\n    if (!dateTime) return '';\r\n    // Convert to local datetime-local format: YYYY-MM-DDTHH:mm\r\n    const date = new Date(dateTime);\r\n    const offset = date.getTimezoneOffset();\r\n    const localDate = new Date(date.getTime() - (offset * 60 * 1000));\r\n    return localDate.toISOString().slice(0, 16);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch || !record) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch || 'Record not found'}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/staff-checkin-checkout')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      <div className=\"w-full\">\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Check-in/Check-out Record</h1>\r\n            <p className=\"text-gray-600 mt-1\">\r\n              Update the check-in/check-out details for {record?.staff?.staff_name}\r\n            </p>\r\n          </div>\r\n\r\n          {errors.general && (\r\n            <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n              <div className=\"flex\">\r\n                <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-red-800\">{errors.general}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {/* Read-only Information Section */}\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Record Information</h2>\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Staff */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Staff</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">\r\n                    {record?.staff?.staff_name} ({record?.staff?.staff_id})\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Block */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Block</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{record?.block?.block_name}</p>\r\n                </div>\r\n\r\n                {/* Date */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Date</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">\r\n                    {record?.date ? new Date(record.date).toLocaleDateString('en-US', {\r\n                      year: 'numeric',\r\n                      month: 'long',\r\n                      day: 'numeric'\r\n                    }) : 'Not set'}\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Remarks */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Remarks</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{record?.remarks || 'No remarks'}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Editable Time Fields Section */}\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Edit Times</h2>\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Checkout Time */}\r\n                <div className=\"space-y-1.5\">\r\n                  <label htmlFor=\"checkout_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Check-out Time\r\n                  </label>\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    id=\"checkout_time\"\r\n                    name=\"checkout_time\"\r\n                    value={formatDateTimeForInput(formData.checkout_time)}\r\n                    onChange={handleChange}\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                  />\r\n                  {errors.checkout_time && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      {errors.checkout_time}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Checkin Time */}\r\n                <div className=\"space-y-1.5\">\r\n                  <label htmlFor=\"checkin_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Check-in Time\r\n                  </label>\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    id=\"checkin_time\"\r\n                    name=\"checkin_time\"\r\n                    value={formatDateTimeForInput(formData.checkin_time)}\r\n                    onChange={handleChange}\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                  />\r\n                  {errors.checkin_time && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      {errors.checkin_time}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push(`/admin/staff-checkin-checkout/${recordId}`)} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Record\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff-checkin-checkout\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":7,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecord'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRecord, recordId]","fix":{"range":[1635,1645],"text":"[fetchRecord, recordId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1873,1876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1873,1876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2378,2381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2378,2381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { staffCheckInCheckOutApi, StaffCheckInCheckOut } from '@/lib/api/staff-checkincheckout.api';\r\nimport { Button, ConfirmModal } from '@/components/ui';\r\nimport { Check, X, ArrowLeft, Edit, Trash, Clock } from 'lucide-react';\r\n\r\nexport default function StaffCheckinCheckoutDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const recordId = params.id as string;\r\n  \r\n  const [record, setRecord] = useState<StaffCheckInCheckOut | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const fetchRecord = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await staffCheckInCheckOutApi.getCheckInCheckOut(recordId);\r\n      setRecord(response.data);\r\n      setError(null);\r\n      \r\n      // Debug logging to understand the record structure\r\n      console.log('Staff Check-in/Checkout Record:', response.data);\r\n      console.log('Status:', response.data.status);\r\n      console.log('Checkout Time:', response.data.checkout_time);\r\n      console.log('Checkin Time:', response.data.checkin_time);\r\n    } catch (error) {\r\n      console.error('Error fetching record:', error);\r\n      setError('Failed to load record details');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (recordId) {\r\n      fetchRecord();\r\n    }\r\n  }, [recordId]);\r\n\r\n  const handleApproveCheckout = async () => {\r\n    try {\r\n      setActionLoading('approve');\r\n      await staffCheckInCheckOutApi.approveCheckout(recordId);\r\n      await fetchRecord(); // Refresh data\r\n    } catch (error: any) {\r\n      console.error('Error approving checkout:', error);\r\n      // Show user-friendly error message\r\n      alert(error?.message || 'Failed to approve checkout. Please try again.');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleDeclineCheckout = async () => {\r\n    try {\r\n      setActionLoading('decline');\r\n      await staffCheckInCheckOutApi.declineCheckout(recordId, 'Checkout declined by admin');\r\n      await fetchRecord(); // Refresh data\r\n    } catch (error: any) {\r\n      console.error('Error declining checkout:', error);\r\n      // Show user-friendly error message\r\n      alert(error?.message || 'Failed to decline checkout. Please try again.');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      await staffCheckInCheckOutApi.deleteCheckInCheckOut(recordId);\r\n      router.push('/admin/staff-checkin-checkout');\r\n    } catch (error) {\r\n      console.error('Error deleting record:', error);\r\n    }\r\n  };\r\n\r\n  const formatDateTime = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return 'Not set';\r\n    return new Date(dateTime).toLocaleString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return 'Not set';\r\n    return new Date(dateTime).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const calculateDuration = (estimatedCheckinDate: string | null | undefined, checkoutTime: string | null | undefined) => {\r\n    if (!estimatedCheckinDate || !checkoutTime) return 'N/A';\r\n    \r\n    const estimated = new Date(estimatedCheckinDate);\r\n    const checkout = new Date(checkoutTime);\r\n    const diffMs = estimated.getTime() - checkout.getTime();\r\n    \r\n    // Handle negative duration (if checkout is after estimated checkin)\r\n    const absDiffMs = Math.abs(diffMs);\r\n    const diffDays = Math.floor(absDiffMs / (1000 * 60 * 60 * 24));\r\n    const diffHours = Math.floor((absDiffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n    \r\n    if (diffDays > 0) {\r\n      return `${diffDays} days ${diffHours} hours`;\r\n    } else {\r\n      return `${diffHours} hours`;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = () => {\r\n    if (!record) return null;\r\n    \r\n    // Check admin approval status first\r\n    if (record.status === 'approved') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-4 h-4 mr-2\" />\r\n          Approved\r\n        </span>\r\n      );\r\n    } else if (record.status === 'declined') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800\">\r\n          <X className=\"w-4 h-4 mr-2\" />\r\n          Declined\r\n        </span>\r\n      );\r\n    } else if (record.status === 'pending') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800\">\r\n          <Clock className=\"w-4 h-4 mr-2\" />\r\n          Pending Approval\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time && record.checkin_time) {\r\n      // If both checkout and checkin exist and status is not pending/approved/declined\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-4 h-4 mr-2\" />\r\n          Complete\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time) {\r\n      // Only checkout exists, waiting for checkin\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800\">\r\n          <Clock className=\"w-4 h-4 mr-2\" />\r\n          Checked Out\r\n        </span>\r\n      );\r\n    } else if (record.checkin_time) {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800\">\r\n          <Clock className=\"w-4 h-4 mr-2\" />\r\n          Checked In\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800\">\r\n          <X className=\"w-4 h-4 mr-2\" />\r\n          Draft\r\n        </span>\r\n      );\r\n    }\r\n  };\r\n\r\n  const needsApproval = () => {\r\n    // Show approval actions if status is pending\r\n    return record?.status === 'pending';\r\n  };\r\n\r\n  const isCheckInApproval = () => {\r\n    // If both checkout_time and checkin_time exist, it's a check-in approval\r\n    return record?.checkout_time && record?.checkin_time;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !record) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-red-500 mb-4\">{error || 'Record not found'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">\r\n              Check-in/Check-out Details\r\n            </h1>\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            {getStatusBadge()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Main Details */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          {/* Staff Information */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Staff Information</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Staff Name</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.staff?.staff_name || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Staff ID</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.staff?.staff_id || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Contact Number</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.staff?.contact_number || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Email</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.staff?.email || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Department</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.staff?.department || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Position</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.staff?.position || 'N/A'}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Location Information */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Location Information</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Block</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.block?.block_name || 'N/A'}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Check-in/Check-out Details */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Check-in/Check-out Details</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Date</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDate(record.date)}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Status</label>\r\n                <div className=\"mt-1\">{getStatusBadge()}</div>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Check-out Time</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.checkout_time)}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Check-in Time</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.checkin_time)}</p>\r\n              </div>\r\n              {record.estimated_checkin_date && (\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Estimated Check-in Date</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{formatDate(record.estimated_checkin_date)}</p>\r\n                </div>\r\n              )}\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Duration</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">\r\n                  {calculateDuration(record.estimated_checkin_date, record.checkout_time)}\r\n                </p>\r\n              </div>\r\n              {record.remarks && (\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-medium text-gray-500\">Remarks</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{record.remarks}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Actions Sidebar */}\r\n        <div className=\"space-y-6\">\r\n          {/* Admin Actions */}\r\n          {needsApproval() && (\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Admin Actions</h3>\r\n              <div className=\"space-y-3\">\r\n                <Button\r\n                  onClick={handleApproveCheckout}\r\n                  disabled={actionLoading === 'approve'}\r\n                  loading={actionLoading === 'approve'}\r\n                  className=\"w-full bg-green-600 text-white hover:bg-green-700 border-0\"\r\n                  icon={<Check className=\"w-4 h-4\" />}\r\n                >\r\n                  {actionLoading === 'approve' \r\n                    ? 'Approving...' \r\n                    : isCheckInApproval() \r\n                      ? 'Approve Check-in' \r\n                      : 'Approve Checkout'}\r\n                </Button>\r\n                <Button\r\n                  variant=\"danger\"\r\n                  onClick={handleDeclineCheckout}\r\n                  disabled={actionLoading === 'decline'}\r\n                  loading={actionLoading === 'decline'}\r\n                  className=\"w-full\"\r\n                  icon={<X className=\"w-4 h-4\" />}\r\n                >\r\n                  {actionLoading === 'decline' \r\n                    ? 'Declining...' \r\n                    : isCheckInApproval() \r\n                      ? 'Decline Check-in' \r\n                      : 'Decline Checkout'}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Record Actions */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Record Actions</h3>\r\n            <div className=\"space-y-3\">\r\n              <Button\r\n                variant=\"edit\"\r\n                onClick={() => router.push(`/admin/staff-checkin-checkout/${record.id}/edit`)}\r\n                className=\"w-full\"\r\n                icon={<Edit className=\"w-4 h-4\" />}\r\n              >\r\n                Edit Record\r\n              </Button>\r\n              <Button\r\n                variant=\"danger\"\r\n                onClick={() => setDeleteModal(true)}\r\n                className=\"w-full\"\r\n                icon={<Trash className=\"w-4 h-4\" />}\r\n              >\r\n                Delete Record\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Metadata */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Record Information</h3>\r\n            <div className=\"space-y-3\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Created</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.created_at)}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Last Updated</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.updated_at)}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal}\r\n        onCancel={() => setDeleteModal(false)}\r\n        onConfirm={handleDelete}\r\n        title=\"Delete Check-in/Check-out Record\"\r\n        message={`Are you sure you want to delete this check-in/check-out record for ${record?.staff?.staff_name || 'this staff member'}? This action cannot be undone.`}\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        variant=\"danger\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff-checkin-checkout\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2478,2481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2478,2481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { staffCheckInCheckOutApi, StaffCheckInCheckOutFormData } from '@/lib/api/staff-checkincheckout.api';\r\nimport { blockApi, Block } from '@/lib/api/index';\r\nimport { staffApi, Staff } from '@/lib/api/staff.api';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton \r\n} from '@/components/ui';\r\n\r\nexport default function CreateStaffCheckinCheckout() {\r\n  const router = useRouter();\r\n  \r\n  const [staff, setStaff] = useState<Staff[]>([]);\r\n  const [blocks, setBlocks] = useState<Block[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  // Get current date for default values\r\n  const currentDate = new Date().toISOString().split('T')[0];\r\n  \r\n  const [formData, setFormData] = useState<StaffCheckInCheckOutFormData>({\r\n    staff_id: '',\r\n    block_id: '',\r\n    date: currentDate,\r\n    checkin_time: '',\r\n    checkout_time: '',\r\n    remarks: '',\r\n  });\r\n\r\n  // Fetch initial data\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Fetch staff and blocks\r\n        const [staffResponse, blocksResponse] = await Promise.all([\r\n          staffApi.getAllActiveStaff(),\r\n          blockApi.getBlocks()\r\n        ]);\r\n        \r\n        setStaff(staffResponse || []);\r\n        setBlocks(blocksResponse.data || []);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        setErrors({ fetch: 'Failed to load required data' });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setErrors({});\r\n\r\n    try {\r\n      await staffCheckInCheckOutApi.createCheckInCheckOut(formData);\r\n      router.push('/admin/staff-checkin-checkout');\r\n    } catch (error: any) {\r\n      console.error('Error creating record:', error);\r\n      if (error.validation) {\r\n        setErrors(error.validation);\r\n      } else {\r\n        setErrors({ general: error.message || 'Failed to create record' });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/staff-checkin-checkout')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      <div className=\"w-full\">\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Create Check-in/Check-out Record</h1>\r\n            <p className=\"text-gray-600 mt-1\">\r\n              Add a new staff check-in/check-out record\r\n            </p>\r\n          </div>\r\n\r\n          {errors.general && (\r\n            <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n              <div className=\"flex\">\r\n                <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-red-800\">{errors.general}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n              {/* Staff Member Selection */}\r\n              <FormField\r\n                label=\"Staff Member\"\r\n                name=\"staff_id\"\r\n                type=\"select\"\r\n                value={formData.staff_id}\r\n                onChange={handleChange}\r\n                required\r\n                error={errors.staff_id}\r\n                options={staff.map(member => ({\r\n                  value: member.id.toString(),\r\n                  label: `${member.staff_name} (${member.staff_id || 'N/A'}) - ${member.department || 'N/A'}`\r\n                }))}\r\n              />\r\n\r\n              {/* Block Selection */}\r\n              <FormField\r\n                label=\"Block\"\r\n                name=\"block_id\"\r\n                type=\"select\"\r\n                value={formData.block_id}\r\n                onChange={handleChange}\r\n                required\r\n                error={errors.block_id}\r\n                options={blocks.map(block => ({\r\n                  value: block.id,\r\n                  label: block.block_name\r\n                }))}\r\n              />\r\n\r\n              {/* Date */}\r\n              <FormField\r\n                label=\"Date\"\r\n                name=\"date\"\r\n                type=\"date\"\r\n                value={formData.date}\r\n                onChange={handleChange}\r\n                required\r\n                error={errors.date}\r\n              />\r\n\r\n              {/* Checkout Time */}\r\n              <div className=\"space-y-1.5\">\r\n                <label htmlFor=\"checkout_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Check-out Time\r\n                </label>\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  id=\"checkout_time\"\r\n                  name=\"checkout_time\"\r\n                  value={formData.checkout_time || ''}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                />\r\n                {errors.checkout_time && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.checkout_time}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Checkin Time */}\r\n              <div className=\"space-y-1.5\">\r\n                <label htmlFor=\"checkin_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Check-in Time\r\n                </label>\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  id=\"checkin_time\"\r\n                  name=\"checkin_time\"\r\n                  value={formData.checkin_time || ''}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                />\r\n                {errors.checkin_time && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.checkin_time}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Remarks */}\r\n            <FormField\r\n              label=\"Remarks\"\r\n              name=\"remarks\"\r\n              type=\"textarea\"\r\n              value={formData.remarks || ''}\r\n              onChange={handleChange}\r\n              error={errors.remarks}\r\n              placeholder=\"Any additional notes or comments...\"\r\n              rows={3}\r\n            />\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push('/admin/staff-checkin-checkout')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Creating...\"\r\n              >\r\n                Create Record\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff-checkin-checkout\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowRight' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'records' is assigned a value but never used.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'actionLoading' is assigned a value but never used.","line":38,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setActionLoading' is assigned a value but never used.","line":38,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":41}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { staffCheckInCheckOutApi, StaffCheckInCheckOut } from '@/lib/api/staff-checkincheckout.api';\r\nimport { PaginatedResponse } from '@/lib/api/core';\r\nimport { Button, ConfirmModal, ActionButtons } from '@/components/ui';\r\nimport { \r\n  Plus, \r\n  ArrowRight, \r\n  ArrowLeft, \r\n  Search,\r\n  Check,\r\n  Clock,\r\n  X,\r\n  Eye,\r\n  Edit,\r\n  Trash\r\n} from 'lucide-react';\r\n\r\nexport default function StaffCheckinCheckoutList() {\r\n  const [records, setRecords] = useState<StaffCheckInCheckOut[]>([]);\r\n  const [filteredRecords, setFilteredRecords] = useState<StaffCheckInCheckOut[]>([]);\r\n  const [allRecords, setAllRecords] = useState<StaffCheckInCheckOut[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [deleteModal, setDeleteModal] = useState<{\r\n    show: boolean;\r\n    recordId: string | null;\r\n    staffName: string;\r\n  }>({\r\n    show: false,\r\n    recordId: null,\r\n    staffName: ''\r\n  });\r\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n\r\n  const fetchRecords = async (page: number = 1) => {\r\n    try {\r\n      setLoading(true);\r\n      const response: PaginatedResponse<StaffCheckInCheckOut> = await staffCheckInCheckOutApi.getCheckInCheckOuts(page, { all: true });\r\n      \r\n      const fetchedRecords = response.data || [];\r\n      setAllRecords(fetchedRecords);\r\n      setRecords(fetchedRecords);\r\n      setFilteredRecords(fetchedRecords);\r\n      \r\n      // Set pagination info from PaginatedResponse structure\r\n      if (response.last_page) {\r\n        setTotalPages(response.last_page);\r\n      } else {\r\n        setTotalPages(1);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching records:', error);\r\n      setRecords([]);\r\n      setFilteredRecords([]);\r\n      setAllRecords([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Live search effect\r\n  useEffect(() => {\r\n    if (!searchTerm.trim()) {\r\n      setFilteredRecords(allRecords);\r\n    } else {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      const filtered = allRecords.filter(record => \r\n        record.staff?.staff_name?.toLowerCase().includes(searchLower)\r\n      );\r\n      setFilteredRecords(filtered);\r\n    }\r\n  }, [searchTerm, allRecords]);\r\n\r\n  useEffect(() => {\r\n    fetchRecords(currentPage);\r\n  }, [currentPage]);\r\n\r\n  const handleSearch = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    // Live search handles filtering, no need to fetch again\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!deleteModal.recordId) return;\r\n\r\n    try {\r\n      await staffCheckInCheckOutApi.deleteCheckInCheckOut(deleteModal.recordId);\r\n      setDeleteModal({ show: false, recordId: null, staffName: '' });\r\n      fetchRecords(currentPage);\r\n    } catch (error) {\r\n      console.error('Error deleting record:', error);\r\n    }\r\n  };\r\n\r\n  const formatTime = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleTimeString('en-US', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const calculateDuration = (record: StaffCheckInCheckOut) => {\r\n    if (!record.checkout_time) return '-';\r\n    \r\n    // If staff has checked in, calculate actual duration between checkout and checkin\r\n    if (record.checkin_time) {\r\n      const checkout = new Date(record.checkout_time);\r\n      const checkin = new Date(record.checkin_time);\r\n      const diffMs = checkin.getTime() - checkout.getTime();\r\n      \r\n      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n      \r\n      if (diffDays > 0) {\r\n        return `${diffDays}d ${diffHours}h ${diffMinutes}m`;\r\n      } else if (diffHours > 0) {\r\n        return `${diffHours}h ${diffMinutes}m`;\r\n      } else {\r\n        return `${diffMinutes}m`;\r\n      }\r\n    }\r\n    \r\n    // If not checked in yet, calculate estimated duration between checkout and estimated checkin\r\n    if (record.estimated_checkin_date) {\r\n      const checkout = new Date(record.checkout_time);\r\n      const estimated = new Date(record.estimated_checkin_date);\r\n      const diffMs = estimated.getTime() - checkout.getTime();\r\n      \r\n      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n      \r\n      if (diffDays > 0) {\r\n        return `${diffDays}d ${diffHours}h ${diffMinutes}m (est.)`;\r\n      } else if (diffHours > 0) {\r\n        return `${diffHours}h ${diffMinutes}m (est.)`;\r\n      } else {\r\n        return `${diffMinutes}m (est.)`;\r\n      }\r\n    }\r\n    \r\n    return '-';\r\n  };\r\n\r\n  const getStatusBadge = (record: StaffCheckInCheckOut) => {\r\n    // Check admin approval status first\r\n    if (record.status === 'approved') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Approved\r\n        </span>\r\n      );\r\n    } else if (record.status === 'declined') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Declined\r\n        </span>\r\n      );\r\n    } else if (record.status === 'pending') {\r\n      // Differentiate between pending checkout and pending check-in\r\n      if (record.checkout_time && record.checkin_time) {\r\n        // Both times exist - this is a pending check-in approval\r\n        return (\r\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            Pending In\r\n          </span>\r\n        );\r\n      } else if (record.checkout_time) {\r\n        // Only checkout time exists - this is a pending checkout approval\r\n        return (\r\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            Pending Out\r\n          </span>\r\n        );\r\n      } else {\r\n        // Generic pending\r\n        return (\r\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            Pending\r\n          </span>\r\n        );\r\n      }\r\n    } else if (record.checkout_time && record.checkin_time) {\r\n      // If both checkout and checkin exist and status is not pending/approved/declined\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Complete\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time) {\r\n      // Only checkout exists\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked Out\r\n        </span>\r\n      );\r\n    } else if (record.checkin_time) {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked In\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Draft\r\n        </span>\r\n      );\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Staff Check-in/Check-out</h1>\r\n          <Link href=\"/admin/staff-checkin-checkout/create\">\r\n            <Button \r\n              className=\"bg-[#235999] hover:bg-[#1e4d87] text-white\"\r\n              icon={<Plus className=\"w-4 h-4\" />}\r\n            >\r\n              Add New Record\r\n            </Button>\r\n          </Link>\r\n      </div>\r\n\r\n      <div className=\"mb-6\">\r\n        <form onSubmit={handleSearch} className=\"max-w-md\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Search by staff name...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg text-sm text-gray-600 placeholder:text-gray-400 focus:border-gray-400 focus:ring-0 outline-none transition-all duration-200 bg-white\"\r\n            />\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Staff Name\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Block\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Checkout Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Est. Check-in Date\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Check-in Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Duration\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Status\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {filteredRecords.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={8} className=\"px-6 py-8 text-center text-gray-500\">\r\n                    {searchTerm ? `No staff found matching \"${searchTerm}\"` : 'No check-in/check-out records found.'}\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                filteredRecords.map((record) => (\r\n                  <tr key={record.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">\r\n                        {record.staff?.staff_name || 'N/A'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">\r\n                        {record.block?.block_name || 'N/A'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"flex flex-col\">\r\n                        <div className=\"text-sm text-gray-500\">\r\n                          {formatDate(record.checkout_time)}\r\n                        </div>\r\n                        <div className=\"text-sm font-medium text-gray-900\">\r\n                          {formatTime(record.checkout_time)}\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {record.estimated_checkin_date ? formatDate(record.estimated_checkin_date) : 'Not set'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"flex flex-col\">\r\n                        <div className=\"text-sm text-gray-500\">\r\n                          {formatDate(record.checkin_time)}\r\n                        </div>\r\n                        <div className=\"text-sm font-medium text-gray-900\">\r\n                          {formatTime(record.checkin_time)}\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {calculateDuration(record)}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      {getStatusBadge(record)}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <ActionButtons\r\n                        viewUrl={`/admin/staff-checkin-checkout/${record.id}`}\r\n                        editUrl={`/admin/staff-checkin-checkout/${record.id}/edit`}\r\n                        onDelete={() => setDeleteModal({\r\n                          show: true,\r\n                          recordId: record.id,\r\n                          staffName: record.staff?.staff_name || 'Unknown'\r\n                        })}\r\n                        style=\"compact\"\r\n                      />\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Pagination */}\r\n        {totalPages > 1 && (\r\n          <div className=\"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6\">\r\n            <div className=\"flex-1 flex justify-between sm:hidden\">\r\n              <Button\r\n                variant=\"secondary\"\r\n                onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\r\n                disabled={currentPage === 1}\r\n              >\r\n                Previous\r\n              </Button>\r\n              <Button\r\n                variant=\"secondary\"\r\n                onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\r\n                disabled={currentPage === totalPages}\r\n              >\r\n                Next\r\n              </Button>\r\n            </div>\r\n            <div className=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-gray-700\">\r\n                  Showing page <span className=\"font-medium\">{currentPage}</span> of{' '}\r\n                  <span className=\"font-medium\">{totalPages}</span>\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\" aria-label=\"Pagination\">\r\n                  <Button\r\n                    variant=\"secondary\"\r\n                    onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\r\n                    disabled={currentPage === 1}\r\n                    className=\"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\"\r\n                  >\r\n                    Previous\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"secondary\"\r\n                    onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\r\n                    disabled={currentPage === totalPages}\r\n                    className=\"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\"\r\n                  >\r\n                    Next\r\n                  </Button>\r\n                </nav>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        onCancel={() => setDeleteModal({ show: false, recordId: null, staffName: '' })}\r\n        onConfirm={handleDelete}\r\n        title=\"Delete Check-in/Check-out Record\"\r\n        message={`Are you sure you want to delete the check-in/check-out record for ${deleteModal.staffName}? This action cannot be undone.`}\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        variant=\"danger\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertCircle' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'updatedStaff' is assigned a value but never used.","line":435,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":435,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":750,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[27113,27129],"text":"Father&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[27113,27129],"text":"Father&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[27113,27129],"text":"Father&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[27113,27129],"text":"Father&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":781,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[28577,28593],"text":"Mother&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[28577,28593],"text":"Mother&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[28577,28593],"text":"Mother&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[28577,28593],"text":"Mother&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":812,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[30016,30048],"text":"Spouse&apos;s Details (if applicable)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[30016,30048],"text":"Spouse&lsquo;s Details (if applicable)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[30016,30048],"text":"Spouse&#39;s Details (if applicable)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[30016,30048],"text":"Spouse&rsquo;s Details (if applicable)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1083,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click &quot;Add Amenity\" to add staff amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click &ldquo;Add Amenity\" to add staff amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click &#34;Add Amenity\" to add staff amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click &rdquo;Add Amenity\" to add staff amenities."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1083,"column":101,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click \"Add Amenity&quot; to add staff amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click \"Add Amenity&ldquo; to add staff amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click \"Add Amenity&#34; to add staff amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[42448,42511],"text":"No amenities added. Click \"Add Amenity&rdquo; to add staff amenities."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { AlertCircle } from 'lucide-react';\r\nimport { staffApi, type StaffFormData, type StaffAmenity } from '@/lib/api/staff.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SingleImageUploadEdit,\r\n  MultipleImageUploadEdit,\r\n  ImageModal\r\n} from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function EditStaff() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const staffId = params.id as string;\r\n  \r\n  // Form state\r\n  const [formData, setFormData] = useState<StaffFormData>({\r\n    staff_name: '',\r\n    contact_number: '',\r\n    email: '',\r\n    date_of_birth: '',\r\n    district: '',\r\n    city_name: '',\r\n    ward_no: '',\r\n    street_name: '',\r\n    citizenship_no: '',\r\n    date_of_issue: '',\r\n    citizenship_issued_district: '',\r\n    educational_institution: '',\r\n    level_of_study: '',\r\n    blood_group: '',\r\n    food: '',\r\n    disease: '',\r\n    father_name: '',\r\n    father_contact: '',\r\n    father_occupation: '',\r\n    mother_name: '',\r\n    mother_contact: '',\r\n    mother_occupation: '',\r\n    spouse_name: '',\r\n    spouse_contact: '',\r\n    spouse_occupation: '',\r\n    local_guardian_name: '',\r\n    local_guardian_address: '',\r\n    local_guardian_contact: '',\r\n    local_guardian_occupation: '',\r\n    local_guardian_relation: '',\r\n    is_active: true,\r\n    staff_id: '',\r\n    position: '',\r\n    department: '',\r\n    joining_date: '',\r\n    salary_amount: '',\r\n    employment_type: '',\r\n    declaration_agreed: false,\r\n    contract_agreed: false,\r\n    verified_by: '',\r\n    verified_on: '',\r\n    amenities: []\r\n  });\r\n  \r\n  // Form processing state\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  // Image state\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n  const [staffImage, setStaffImage] = useState<File | null>(null);\r\n  \r\n  // Document state - Multiple file uploads\r\n  const [citizenshipDocuments, setCitizenshipDocuments] = useState<File[]>([]);\r\n  const [contractDocuments, setContractDocuments] = useState<File[]>([]);\r\n  const [existingCitizenshipDoc, setExistingCitizenshipDoc] = useState<{id: number; image: string; is_primary: boolean}[]>([]);\r\n  const [existingContractDoc, setExistingContractDoc] = useState<{id: number; image: string; is_primary: boolean}[]>([]);\r\n  const [removedCitizenshipDocIds, setRemovedCitizenshipDocIds] = useState<number[]>([]);\r\n  const [removedContractDocIds, setRemovedContractDocIds] = useState<number[]>([]);\r\n  const [removedAmenityIds, setRemovedAmenityIds] = useState<number[]>([]);\r\n  \r\n  // Amenities state\r\n  const [amenities, setAmenities] = useState<StaffAmenity[]>([]);\r\n\r\n  // Load staff data\r\n  useEffect(() => {\r\n    const loadStaffData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        const staff = await staffApi.getStaffMember(staffId);\r\n        \r\n        // Populate form data\r\n        setFormData({\r\n          staff_name: staff.staff_name || '',\r\n          contact_number: staff.contact_number || '',\r\n          email: staff.email || '',\r\n          date_of_birth: staff.date_of_birth || '',\r\n          district: staff.district || '',\r\n          city_name: staff.city_name || '',\r\n          ward_no: staff.ward_no || '',\r\n          street_name: staff.street_name || '',\r\n          citizenship_no: staff.citizenship_no || '',\r\n          date_of_issue: staff.date_of_issue || '',\r\n          citizenship_issued_district: staff.citizenship_issued_district || '',\r\n          educational_institution: staff.educational_institution || '',\r\n          level_of_study: staff.level_of_study || '',\r\n          blood_group: staff.blood_group || '',\r\n          food: staff.food || '',\r\n          disease: staff.disease || '',\r\n          father_name: staff.father_name || '',\r\n          father_contact: staff.father_contact || '',\r\n          father_occupation: staff.father_occupation || '',\r\n          mother_name: staff.mother_name || '',\r\n          mother_contact: staff.mother_contact || '',\r\n          mother_occupation: staff.mother_occupation || '',\r\n          spouse_name: staff.spouse_name || '',\r\n          spouse_contact: staff.spouse_contact || '',\r\n          spouse_occupation: staff.spouse_occupation || '',\r\n          local_guardian_name: staff.local_guardian_name || '',\r\n          local_guardian_address: staff.local_guardian_address || '',\r\n          local_guardian_contact: staff.local_guardian_contact || '',\r\n          local_guardian_occupation: staff.local_guardian_occupation || '',\r\n          local_guardian_relation: staff.local_guardian_relation || '',\r\n          is_active: staff.is_active !== undefined ? staff.is_active : true,\r\n          staff_id: staff.staff_id || '',\r\n          position: staff.position || '',\r\n          department: staff.department || '',\r\n          joining_date: staff.joining_date || '',\r\n          salary_amount: staff.salary_amount || '',\r\n          employment_type: staff.employment_type || '',\r\n          declaration_agreed: staff.declaration_agreed || false,\r\n          contract_agreed: staff.contract_agreed || false,\r\n          verified_by: staff.verified_by || '',\r\n          verified_on: staff.verified_on || '',\r\n          amenities: []\r\n        });\r\n\r\n        // Set existing amenities\r\n        if (staff.amenities && staff.amenities.length > 0) {\r\n          setAmenities(staff.amenities);\r\n        }\r\n\r\n        // Set existing image preview\r\n        if (staff.staff_image) {\r\n          setImagePreview(getImageUrl(staff.staff_image));\r\n        }\r\n\r\n        // Set citizenship document if available\r\n        if (staff.staff_citizenship_image) {\r\n          setExistingCitizenshipDoc([{\r\n            id: 1, // Using 1 as id since we don't have real IDs from the API\r\n            image: staff.staff_citizenship_image,\r\n            is_primary: true\r\n          }]);\r\n        }\r\n        \r\n        // Set contract document if available\r\n        if (staff.staff_contract_image) {\r\n          setExistingContractDoc([{\r\n            id: 1, // Using 1 as id since we don't have real IDs from the API\r\n            image: staff.staff_contract_image,\r\n            is_primary: true\r\n          }]);\r\n        }\r\n\r\n      } catch (error) {\r\n        console.error('Error loading staff data:', error);\r\n        setErrors({\r\n          submit: 'Failed to load staff data. Please try again.'\r\n        });\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (staffId) {\r\n      loadStaffData();\r\n    }\r\n  }, [staffId]);\r\n\r\n  // Process staff image file\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_image: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (2MB max)\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_image: 'File size must be less than 2MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setStaffImage(file);\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.staff_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_image: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Remove staff image\r\n  const removeImage = () => {\r\n    setStaffImage(null);\r\n    setImagePreview(null);\r\n  };\r\n  \r\n  // Validate citizenship document file\r\n  const validateCitizenshipFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_citizenship_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_citizenship_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.staff_citizenship_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_citizenship_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add citizenship documents\r\n  const addCitizenshipDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateCitizenshipFile(file));\r\n    if (validFiles.length > 0) {\r\n      setCitizenshipDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove citizenship document\r\n  const removeCitizenshipImage = (index: number) => {\r\n    setCitizenshipDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n  \r\n  // Validate contract form file\r\n  const validateContractFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_contract_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_contract_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.staff_contract_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_contract_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add contract documents\r\n  const addContractDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateContractFile(file));\r\n    if (validFiles.length > 0) {\r\n      setContractDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove contract document\r\n  const removeContractImage = (index: number) => {\r\n    setContractDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value, type } = e.target;\r\n\r\n    if (type === 'checkbox') {\r\n      const checkbox = e.target as HTMLInputElement;\r\n      setFormData({\r\n        ...formData,\r\n        [name]: checkbox.checked\r\n      });\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Handle amenity changes\r\n  const handleAmenityChange = (index: number, field: keyof StaffAmenity, value: string) => {\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities[index] = {\r\n      ...updatedAmenities[index],\r\n      [field]: value\r\n    };\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Add new amenity field\r\n  const addAmenity = () => {\r\n    setAmenities([...amenities, { name: '', description: '' }]);\r\n  };\r\n\r\n  // Remove amenity field\r\n  const removeAmenity = (index: number) => {\r\n    const amenityToRemove = amenities[index];\r\n    \r\n    // If the amenity has an ID (existing amenity), track it for deletion\r\n    if (amenityToRemove.id) {\r\n      const amenityId = typeof amenityToRemove.id === 'string' ? parseInt(amenityToRemove.id) : amenityToRemove.id;\r\n      if (!isNaN(amenityId)) {\r\n        setRemovedAmenityIds(prev => [...prev, amenityId]);\r\n      }\r\n    }\r\n    \r\n    // Remove from local state\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities.splice(index, 1);\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Form validation\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.staff_name.trim()) {\r\n      newErrors.staff_name = 'Staff name is required';\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      newErrors.email = 'Email address is required';\r\n    } else if (!/\\S+@\\S+\\.\\S+/.test(formData.email)) {\r\n      newErrors.email = 'Please enter a valid email address';\r\n    }\r\n\r\n    if (!formData.contact_number.trim()) {\r\n      newErrors.contact_number = 'Contact number is required';\r\n    } else if (!/^\\d{10}$/.test(formData.contact_number.trim())) {\r\n      newErrors.contact_number = 'Please enter a valid 10-digit phone number';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  // Form submission\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validate form\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    // Filter out empty amenities\r\n    const filteredAmenities = amenities.filter(item => item.name.trim() !== '');\r\n    \r\n    try {\r\n      // Prepare the form data with all files\r\n      const staffFormData = {\r\n        ...formData,\r\n        amenities: filteredAmenities,\r\n        removedAmenityIds: removedAmenityIds,\r\n        removedCitizenshipDocIds: removedCitizenshipDocIds,\r\n        removedContractDocIds: removedContractDocIds,\r\n        staff_image: staffImage,\r\n        // For now, we use the first file of multiple uploads as the API only accepts one file\r\n        // In the future, the API could be updated to handle multiple files\r\n        staff_citizenship_image: citizenshipDocuments.length > 0 ? citizenshipDocuments[0] : null,\r\n        staff_contract_image: contractDocuments.length > 0 ? contractDocuments[0] : null,\r\n      };\r\n      \r\n      // Update the staff member\r\n      const updatedStaff = await staffApi.updateStaff(staffId, staffFormData);\r\n\r\n      // Redirect to staff detail on success\r\n      router.push(`/admin/staff/${staffId}`);\r\n    } catch (error) {\r\n      console.error('Error updating staff:', error);\r\n      \r\n      if (error instanceof ApiError) {\r\n        if (error.validation && Object.keys(error.validation).length > 0) {\r\n          // Convert validation errors to our format\r\n          const formattedErrors: Record<string, string> = {};\r\n          \r\n          Object.entries(error.validation).forEach(([field, messages]) => {\r\n            formattedErrors[field] = Array.isArray(messages) ? messages[0] : messages;\r\n          });\r\n          \r\n          setErrors({\r\n            ...formattedErrors,\r\n            submit: `Failed to update staff: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            submit: `Failed to update staff: ${error.message}`\r\n          });\r\n        }\r\n      } else {\r\n        setErrors({\r\n          submit: 'An unexpected error occurred. Please try again later.'\r\n        });\r\n      }\r\n      \r\n      // Scroll to top to show error message\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Staff Member</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">Loading staff data...</p>\r\n          </div>\r\n          <div className=\"animate-pulse\">\r\n            <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-1/2 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-3/4 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-full mb-4\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Staff Member</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Update staff member information</p>\r\n        </div>\r\n\r\n        {/* Error Alert */}\r\n        {errors.submit && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">{errors.submit}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n          <div className=\"p-6\">\r\n            {/* Basic Information */}\r\n            <div className=\"mb-8\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Basic Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Staff Name */}\r\n                <FormField\r\n                  name=\"staff_name\"\r\n                  label=\"Staff Name\"\r\n                  required\r\n                  value={formData.staff_name}\r\n                  onChange={handleInputChange}\r\n                  error={errors.staff_name}\r\n                  placeholder=\"Enter full name\"\r\n                />\r\n                \r\n                {/* Email */}\r\n                <FormField\r\n                  name=\"email\"\r\n                  label=\"Email Address\"\r\n                  required\r\n                  type=\"email\"\r\n                  value={formData.email}\r\n                  onChange={handleInputChange}\r\n                  error={errors.email}\r\n                  placeholder=\"Enter email address\"\r\n                />\r\n                \r\n                {/* Contact Number */}\r\n                <FormField\r\n                  name=\"contact_number\"\r\n                  label=\"Contact Number\"\r\n                  required\r\n                  value={formData.contact_number}\r\n                  onChange={handleInputChange}\r\n                  error={errors.contact_number}\r\n                  placeholder=\"Enter 10-digit phone number\"\r\n                />\r\n                \r\n                {/* Date of Birth */}\r\n                <FormField\r\n                  name=\"date_of_birth\"\r\n                  label=\"Date of Birth\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_birth || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_birth}\r\n                  placeholder=\"YYYY-MM-DD\"\r\n                />\r\n                \r\n                {/* Blood Group */}\r\n                <FormField\r\n                  name=\"blood_group\"\r\n                  label=\"Blood Group\"\r\n                  type=\"select\"\r\n                  value={formData.blood_group || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.blood_group}\r\n                  options={[\r\n                    { value: '', label: 'Select Blood Group' },\r\n                    { value: 'A+', label: 'A+' },\r\n                    { value: 'A-', label: 'A-' },\r\n                    { value: 'B+', label: 'B+' },\r\n                    { value: 'B-', label: 'B-' },\r\n                    { value: 'AB+', label: 'AB+' },\r\n                    { value: 'AB-', label: 'AB-' },\r\n                    { value: 'O+', label: 'O+' },\r\n                    { value: 'O-', label: 'O-' }\r\n                  ]}\r\n                />\r\n\r\n                {/* Active Status */}\r\n                <div className=\"flex items-center mt-4\">\r\n                  <input\r\n                    id=\"is_active\"\r\n                    name=\"is_active\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.is_active || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"is_active\" className=\"ml-2 text-sm font-semibold text-neutral-900\">Active Staff Member</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Address Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Address Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* District */}\r\n                <FormField\r\n                  name=\"district\"\r\n                  label=\"District\"\r\n                  value={formData.district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.district}\r\n                  placeholder=\"Enter district name\"\r\n                />\r\n                \r\n                {/* City Name */}\r\n                <FormField\r\n                  name=\"city_name\"\r\n                  label=\"City\"\r\n                  value={formData.city_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.city_name}\r\n                  placeholder=\"Enter city name\"\r\n                />\r\n                \r\n                {/* Ward No */}\r\n                <FormField\r\n                  name=\"ward_no\"\r\n                  label=\"Ward Number\"\r\n                  value={formData.ward_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.ward_no}\r\n                  placeholder=\"Enter ward number\"\r\n                />\r\n                \r\n                {/* Street Name */}\r\n                <FormField\r\n                  name=\"street_name\"\r\n                  label=\"Street Name\"\r\n                  value={formData.street_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.street_name}\r\n                  placeholder=\"Enter street name\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Citizenship Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Citizenship Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Citizenship No */}\r\n                <FormField\r\n                  name=\"citizenship_no\"\r\n                  label=\"Citizenship Number\"\r\n                  value={formData.citizenship_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_no}\r\n                  placeholder=\"Enter citizenship number\"\r\n                />\r\n                \r\n                {/* Date of Issue */}\r\n                <FormField\r\n                  name=\"date_of_issue\"\r\n                  label=\"Date of Issue\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_issue || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_issue}\r\n                />\r\n                \r\n                {/* Citizenship Issued District */}\r\n                <FormField\r\n                  name=\"citizenship_issued_district\"\r\n                  label=\"Issued District\"\r\n                  value={formData.citizenship_issued_district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_issued_district}\r\n                  placeholder=\"Enter district where citizenship was issued\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Educational Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Educational Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Educational Institution */}\r\n                <FormField\r\n                  name=\"educational_institution\"\r\n                  label=\"Educational Institution\"\r\n                  value={formData.educational_institution || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.educational_institution}\r\n                  placeholder=\"Enter school/college name\"\r\n                />\r\n                \r\n                {/* Level of Study */}\r\n                <FormField\r\n                  name=\"level_of_study\"\r\n                  label=\"Level of Study\"\r\n                  value={formData.level_of_study || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.level_of_study}\r\n                  placeholder=\"e.g., Bachelors, Masters\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Health Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Health Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Food Preference */}\r\n                <FormField\r\n                  name=\"food\"\r\n                  label=\"Food Preference\"\r\n                  type=\"select\"\r\n                  value={formData.food || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.food}\r\n                  options={[\r\n                    { value: 'vegetarian', label: 'Vegetarian' },\r\n                    { value: 'non-vegetarian', label: 'Non-vegetarian' },\r\n                    { value: 'egg-only', label: 'Egg Only' }\r\n                  ]}\r\n                />\r\n                \r\n                {/* Disease/Health Issues */}\r\n                <div className=\"md:col-span-2\">\r\n                  <FormField\r\n                    name=\"disease\"\r\n                    label=\"Disease or Health Issues (if any)\"\r\n                    type=\"textarea\"\r\n                    value={formData.disease || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.disease}\r\n                    placeholder=\"Enter any health conditions or allergies\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Family Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Family Information</h2>\r\n              <div className=\"grid grid-cols-1 gap-4\">\r\n                {/* Father's Information */}\r\n                <div className=\"border-b border-gray-100 pb-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Father's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"father_name\"\r\n                      label=\"Father's Name\"\r\n                      value={formData.father_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_name}\r\n                      placeholder=\"Enter father's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_contact\"\r\n                      label=\"Father's Contact\"\r\n                      value={formData.father_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_contact}\r\n                      placeholder=\"Enter father's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_occupation\"\r\n                      label=\"Father's Occupation\"\r\n                      value={formData.father_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_occupation}\r\n                      placeholder=\"Enter father's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Mother's Information */}\r\n                <div className=\"border-b border-gray-100 py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Mother's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"mother_name\"\r\n                      label=\"Mother's Name\"\r\n                      value={formData.mother_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_name}\r\n                      placeholder=\"Enter mother's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_contact\"\r\n                      label=\"Mother's Contact\"\r\n                      value={formData.mother_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_contact}\r\n                      placeholder=\"Enter mother's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_occupation\"\r\n                      label=\"Mother's Occupation\"\r\n                      value={formData.mother_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_occupation}\r\n                      placeholder=\"Enter mother's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Spouse's Information */}\r\n                <div className=\"py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Spouse's Details (if applicable)</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"spouse_name\"\r\n                      label=\"Spouse's Name\"\r\n                      value={formData.spouse_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_name}\r\n                      placeholder=\"Enter spouse's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_contact\"\r\n                      label=\"Spouse's Contact\"\r\n                      value={formData.spouse_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_contact}\r\n                      placeholder=\"Enter spouse's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_occupation\"\r\n                      label=\"Spouse's Occupation\"\r\n                      value={formData.spouse_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_occupation}\r\n                      placeholder=\"Enter spouse's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Guardian Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Local Guardian Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <FormField\r\n                  name=\"local_guardian_name\"\r\n                  label=\"Guardian's Name\"\r\n                  value={formData.local_guardian_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_name}\r\n                  placeholder=\"Enter local guardian's name\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_relation\"\r\n                  label=\"Relation with Staff\"\r\n                  value={formData.local_guardian_relation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_relation}\r\n                  placeholder=\"e.g., Uncle, Aunt\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_contact\"\r\n                  label=\"Guardian's Contact\"\r\n                  value={formData.local_guardian_contact || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_contact}\r\n                  placeholder=\"Enter guardian's phone number\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_occupation\"\r\n                  label=\"Guardian's Occupation\"\r\n                  value={formData.local_guardian_occupation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_occupation}\r\n                  placeholder=\"Enter guardian's occupation\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_address\"\r\n                  label=\"Guardian's Address\"\r\n                  value={formData.local_guardian_address || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_address}\r\n                  placeholder=\"Enter guardian's address\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Document Uploads */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Document Uploads</h2>\r\n              \r\n              {/* Staff Photo */}\r\n              <div className=\"mb-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Staff Photo</h3>\r\n                <div className=\"w-full\">\r\n                  <SingleImageUploadEdit\r\n                    imagePreview={imagePreview}\r\n                    onFileSelect={(file) => processFile(file)}\r\n                    onRemove={removeImage}\r\n                    error={errors.staff_image}\r\n                    label=\"Staff Photo\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Citizenship Documents */}\r\n              <div className=\"mb-6 pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Citizenship Documents</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadEdit\r\n                    images={citizenshipDocuments}\r\n                    existingImages={existingCitizenshipDoc}\r\n                    removedImageIds={removedCitizenshipDocIds}\r\n                    onAddImages={addCitizenshipDocuments}\r\n                    onRemoveImage={removeCitizenshipImage}\r\n                    onRemoveExistingImage={(id) => {\r\n                      setRemovedCitizenshipDocIds(prev => [...prev, id]);\r\n                      setExistingCitizenshipDoc(prev => prev.filter(img => img.id !== id));\r\n                    }}\r\n                    error={errors.staff_citizenship_image}\r\n                    label=\"Citizenship Documents\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Contract Documents */}\r\n              <div className=\"pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Contract Documents</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadEdit\r\n                    images={contractDocuments}\r\n                    existingImages={existingContractDoc}\r\n                    removedImageIds={removedContractDocIds}\r\n                    onAddImages={addContractDocuments}\r\n                    onRemoveImage={removeContractImage}\r\n                    onRemoveExistingImage={(id) => {\r\n                      setRemovedContractDocIds(prev => [...prev, id]);\r\n                      setExistingContractDoc(prev => prev.filter(img => img.id !== id));\r\n                    }}\r\n                    error={errors.staff_contract_image}\r\n                    label=\"Contract Documents\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Administrative Details */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Administrative Details</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Staff ID */}\r\n                <FormField\r\n                  name=\"staff_id\"\r\n                  label=\"Staff ID\"\r\n                  value={formData.staff_id || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.staff_id}\r\n                />\r\n                \r\n                {/* Position */}\r\n                <FormField\r\n                  name=\"position\"\r\n                  label=\"Position\"\r\n                  value={formData.position || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.position}\r\n                  placeholder=\"e.g., Manager, Assistant, Guard\"\r\n                />\r\n                \r\n                {/* Department */}\r\n                <FormField\r\n                  name=\"department\"\r\n                  label=\"Department\"\r\n                  value={formData.department || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.department}\r\n                  placeholder=\"e.g., Administration, Security, Maintenance\"\r\n                />\r\n                \r\n                {/* Employment Type */}\r\n                <FormField\r\n                  name=\"employment_type\"\r\n                  label=\"Employment Type\"\r\n                  type=\"select\"\r\n                  value={formData.employment_type || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.employment_type}\r\n                  options={[\r\n                    { value: '', label: 'Select Employment Type' },\r\n                    { value: 'full-time', label: 'Full-time' },\r\n                    { value: 'part-time', label: 'Part-time' },\r\n                    { value: 'contract', label: 'Contract' },\r\n                    { value: 'intern', label: 'Intern' }\r\n                  ]}\r\n                />\r\n                \r\n                {/* Joining Date */}\r\n                <FormField\r\n                  name=\"joining_date\"\r\n                  label=\"Joining Date\"\r\n                  type=\"date\"\r\n                  value={formData.joining_date || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.joining_date}\r\n                />\r\n                \r\n                {/* Salary Amount */}\r\n                <FormField\r\n                  name=\"salary_amount\"\r\n                  label=\"Salary Amount\"\r\n                  value={formData.salary_amount || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.salary_amount}\r\n                  placeholder=\"Enter monthly salary\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Amenities */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900\">Staff Amenities</h2>\r\n                <Button \r\n                  type=\"button\" \r\n                  onClick={addAmenity}\r\n                  variant=\"secondary\"\r\n                  size=\"sm\"\r\n                >\r\n                  Add Amenity\r\n                </Button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-4\">\r\n                {amenities.length > 0 ? (\r\n                  amenities.map((amenity, index) => (\r\n                    <div key={index} className=\"flex space-x-4 items-start\">\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_name_${index}`}\r\n                          label={`Amenity ${index + 1} Name`}\r\n                          placeholder=\"Enter amenity name\"\r\n                          value={amenity.name || ''}\r\n                          onChange={(e) => handleAmenityChange(index, 'name', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_description_${index}`}\r\n                          label=\"Description (Optional)\"\r\n                          placeholder=\"Enter description\"\r\n                          value={amenity.description || ''}\r\n                          onChange={(e) => handleAmenityChange(index, 'description', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"pt-8\">\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => removeAmenity(index)}\r\n                          className=\"text-red-600 hover:text-red-800\"\r\n                        >\r\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                            <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                          </svg>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                ) : (\r\n                  <p className=\"text-gray-500 text-sm italic\">No amenities added. Click \"Add Amenity\" to add staff amenities.</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Verification */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Verification</h2>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"declaration_agreed\"\r\n                    name=\"declaration_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.declaration_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"declaration_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I hereby declare that all the information provided above is true and correct to the best of my knowledge.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"contract_agreed\"\r\n                    name=\"contract_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.contract_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"contract_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I agree to abide by all the terms and conditions of employment.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\r\n                  <FormField\r\n                    name=\"verified_by\"\r\n                    label=\"Verified By\"\r\n                    value={formData.verified_by || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.verified_by}\r\n                    placeholder=\"Name of verifying officer\"\r\n                  />\r\n                  \r\n                  <FormField\r\n                    name=\"verified_on\"\r\n                    label=\"Verification Date\"\r\n                    type=\"date\"\r\n                    value={formData.verified_on || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.verified_on}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Form Actions */}\r\n            <div className=\"px-6 py-4 bg-gray-50 flex justify-end space-x-4\">\r\n              <CancelButton onClick={() => router.push(`/admin/staff/${staffId}`)} />\r\n              <SubmitButton \r\n                loading={isSubmitting} \r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Staff Member\r\n              </SubmitButton>\r\n            </div>\r\n          </div>\r\n        </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ActionButtons' is defined but never used.","line":7,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":46},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":398,"column":88,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20740,20756],"text":"Father&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20740,20756],"text":"Father&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20740,20756],"text":"Father&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20740,20756],"text":"Father&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":402,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20993,21006],"text":"Father&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20993,21006],"text":"Father&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20993,21006],"text":"Father&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20993,21006],"text":"Father&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":408,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21368,21384],"text":"Father&apos;s Contact"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21368,21384],"text":"Father&lsquo;s Contact"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21368,21384],"text":"Father&#39;s Contact"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21368,21384],"text":"Father&rsquo;s Contact"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":414,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21752,21771],"text":"Father&apos;s Occupation"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21752,21771],"text":"Father&lsquo;s Occupation"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21752,21771],"text":"Father&#39;s Occupation"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21752,21771],"text":"Father&rsquo;s Occupation"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":425,"column":88,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22299,22315],"text":"Mother&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22299,22315],"text":"Mother&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22299,22315],"text":"Mother&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22299,22315],"text":"Mother&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":429,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22552,22565],"text":"Mother&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22552,22565],"text":"Mother&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22552,22565],"text":"Mother&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22552,22565],"text":"Mother&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":435,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22927,22943],"text":"Mother&apos;s Contact"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22927,22943],"text":"Mother&lsquo;s Contact"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22927,22943],"text":"Mother&#39;s Contact"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22927,22943],"text":"Mother&rsquo;s Contact"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":441,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[23311,23330],"text":"Mother&apos;s Occupation"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[23311,23330],"text":"Mother&lsquo;s Occupation"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[23311,23330],"text":"Mother&#39;s Occupation"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[23311,23330],"text":"Mother&rsquo;s Occupation"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":466,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[25100,25113],"text":"Spouse&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[25100,25113],"text":"Spouse&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[25100,25113],"text":"Spouse&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[25100,25113],"text":"Spouse&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":472,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[25451,25467],"text":"Spouse&apos;s Contact"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[25451,25467],"text":"Spouse&lsquo;s Contact"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[25451,25467],"text":"Spouse&#39;s Contact"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[25451,25467],"text":"Spouse&rsquo;s Contact"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":478,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[25811,25830],"text":"Spouse&apos;s Occupation"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[25811,25830],"text":"Spouse&lsquo;s Occupation"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[25811,25830],"text":"Spouse&#39;s Occupation"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[25811,25830],"text":"Spouse&rsquo;s Occupation"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":501,"column":83,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[27511,27526],"text":"Guardian&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[27511,27526],"text":"Guardian&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[27511,27526],"text":"Guardian&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[27511,27526],"text":"Guardian&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":555,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31049,31052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31049,31052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":555,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31057,31060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31057,31060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":159,"column":19,"nodeType":"JSXOpeningElement","endLine":163,"endColumn":21,"suppressions":[{"kind":"directive","justification":"server-hosted profile images are safe to render with native <img> here; next/image can be adopted later"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":678,"column":23,"nodeType":"JSXOpeningElement","endLine":683,"endColumn":25,"suppressions":[{"kind":"directive","justification":"server-hosted images shown as gallery/preview; keep native <img> to avoid layout shifts and support simple click handlers"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":696,"column":23,"nodeType":"JSXOpeningElement","endLine":701,"endColumn":25,"suppressions":[{"kind":"directive","justification":"server-hosted document previews; keep native <img> for direct preview and click-to-open behavior"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":714,"column":23,"nodeType":"JSXOpeningElement","endLine":719,"endColumn":25,"suppressions":[{"kind":"directive","justification":"server-hosted document previews; native <img> provides predictable behavior for click previews"}]}],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { staffApi, type StaffWithAmenities } from '@/lib/api/staff.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { Button, TableSkeleton, ActionButtons, ConfirmModal, ImageModal } from '@/components/ui';\r\nimport { formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function StaffDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = Array.isArray(params.id) ? params.id[0] : params.id || '';\r\n\r\n  const [staff, setStaff] = useState<StaffWithAmenities | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  useEffect(() => {\r\n    const fetchStaff = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch staff data from API\r\n        const data = await staffApi.getStaffMember(id);\r\n        \r\n        setStaff(data);\r\n      } catch (error) {\r\n        console.error('Error fetching staff details:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load staff details: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load staff details. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchStaff();\r\n  }, [id]);\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      \r\n      // Delete staff using API\r\n      await staffApi.deleteStaff(id);\r\n      \r\n      // Redirect to staff list\r\n      router.push('/admin/staff');\r\n    } catch (error) {\r\n      console.error('Error deleting staff:', error);\r\n      setError('Failed to delete staff record.');\r\n      setShowDeleteModal(false);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleImageClick = (imageUrl: string, alt: string) => {\r\n    setSelectedImage({ url: imageUrl, alt });\r\n    setImageModalOpen(true);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Staff Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading staff data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/staff')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Staff List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!staff) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-amber-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-amber-800\">Staff record not found.</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/staff')}\r\n            className=\"mt-3 bg-amber-100 hover:bg-amber-200 text-amber-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Staff List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Header with Actions */}\r\n        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n          <div>\r\n            <h1 className=\"text-xl font-semibold text-gray-900\">Staff Details</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">View complete staff information</p>\r\n          </div>\r\n          <div className=\"mt-4 md:mt-0 flex space-x-2\">\r\n            <Button\r\n              onClick={() => router.push(`/admin/staff/${staff.id}/edit`)}\r\n              variant=\"primary\"\r\n            >\r\n              Edit Staff\r\n            </Button>\r\n            <Button\r\n              onClick={() => setShowDeleteModal(true)}\r\n              disabled={isDeleting}\r\n              variant=\"danger\"\r\n              loading={isDeleting}\r\n            >\r\n              {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Staff Details Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-6\">\r\n          <div className=\"p-6\">\r\n            {/* Staff Profile Header */}\r\n            <div className=\"flex flex-col md:flex-row items-center md:items-start mb-6 pb-6 border-b border-gray-200\">\r\n              <div className=\"w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-4xl font-medium overflow-hidden mb-4 md:mb-0 md:mr-6\">\r\n                {staff.staff_image ? (\r\n                  /* eslint-disable-next-line @next/next/no-img-element -- server-hosted profile images are safe to render with native <img> here; next/image can be adopted later */\r\n                  <img \r\n                    src={getImageUrl(staff.staff_image)} \r\n                    alt={staff.staff_name}\r\n                    className=\"w-full h-full object-cover\" \r\n                  />\r\n                ) : (\r\n                  staff.staff_name.charAt(0).toUpperCase()\r\n                )}\r\n              </div>\r\n              <div className=\"text-center md:text-left flex-1\">\r\n                <div className=\"flex flex-col md:flex-row md:items-center md:justify-between\">\r\n                  <h2 className=\"text-2xl font-semibold text-gray-900\">{staff.staff_name}</h2>\r\n                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-2 md:mt-0 ${\r\n                    staff.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\r\n                  }`}>\r\n                    {staff.is_active ? 'Active' : 'Inactive'}\r\n                  </span>\r\n                </div>\r\n                \r\n                <div className=\"mt-2 text-gray-600 grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                  <div className=\"flex items-center\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2\" />\r\n                    </svg>\r\n                    ID: {staff.staff_id || 'Not assigned'}\r\n                  </div>\r\n                  <div className=\"flex items-center\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n                    </svg>\r\n                    {staff.email}\r\n                  </div>\r\n                  <div className=\"flex items-center\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\" />\r\n                    </svg>\r\n                    {staff.contact_number}\r\n                  </div>\r\n                  {staff.position && (\r\n                    <div className=\"flex items-center\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0H8m8 0v2a2 2 0 01-2 2H10a2 2 0 01-2-2V6m8 0h2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V6h2\" />\r\n                      </svg>\r\n                      {staff.position} {staff.department && `(${staff.department})`}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Staff Information Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6\">\r\n              {/* Personal Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Personal Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {staff.staff_id && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Staff ID #</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.staff_id}</dd>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"py-2 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-600\">Full Name</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{staff.staff_name}</dd>\r\n                  </div>\r\n                  {staff.date_of_birth && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Date of Birth</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(staff.date_of_birth)}</dd>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Contact Number</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{staff.contact_number}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Email</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{staff.email}</dd>\r\n                  </div>\r\n                  {staff.blood_group && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Blood Group</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.blood_group}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.food && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Food Preference</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.food}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.disease && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Medical Conditions</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.disease}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n              \r\n              {/* Address Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Address Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {staff.district && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">District</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.district}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.city_name && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">City</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.city_name}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.ward_no && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Ward No.</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.ward_no}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.street_name && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Street</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.street_name}</dd>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Show full address if all components are present */}\r\n                  {staff.street_name && staff.ward_no && staff.city_name && staff.district && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Full Address</dt>\r\n                      <dd className=\"text-sm text-gray-900 text-right\">\r\n                        {`${staff.street_name}, Ward ${staff.ward_no}, ${staff.city_name}, ${staff.district}`}\r\n                      </dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              {/* Citizenship & Identity */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Citizenship & Identity</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {staff.citizenship_no && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Citizenship No.</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.citizenship_no}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.date_of_issue && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Date of Issue</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(staff.date_of_issue)}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.citizenship_issued_district && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Issued District</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.citizenship_issued_district}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.staff_citizenship_image && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Citizenship Document</dt>\r\n                      <dd className=\"text-sm text-blue-600 cursor-pointer hover:underline\" onClick={() => handleImageClick(getImageUrl(staff.staff_citizenship_image!), 'Citizenship Document')}>View Document</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              {/* Job Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Job Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {staff.position && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Position</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.position}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.department && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Department</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.department}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.employment_type && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Employment Type</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.employment_type}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.joining_date && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Joining Date</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(staff.joining_date)}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.salary_amount && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Salary Amount</dt>\r\n                      <dd className=\"text-sm text-gray-900\">Rs {staff.salary_amount}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              {/* Education Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Education Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {staff.educational_institution && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Institution</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.educational_institution}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.level_of_study && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Level of Study</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.level_of_study}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n              \r\n              {/* Family Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Family Information</h3>\r\n                {(staff.father_name || staff.father_contact || staff.father_occupation || \r\n                  staff.mother_name || staff.mother_contact || staff.mother_occupation) ? (\r\n                  <dl className=\"divide-y divide-gray-100\">\r\n                    {/* Father's Information */}\r\n                    {(staff.father_name || staff.father_contact || staff.father_occupation) && (\r\n                      <>\r\n                        <div className=\"py-2\">\r\n                          <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Father's Details</h4>\r\n                        </div>\r\n                        {staff.father_name && (\r\n                          <div className=\"py-2 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-600\">Father's Name</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{staff.father_name}</dd>\r\n                          </div>\r\n                        )}\r\n                        {staff.father_contact && (\r\n                          <div className=\"py-2 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-600\">Father's Contact</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{staff.father_contact}</dd>\r\n                          </div>\r\n                        )}\r\n                        {staff.father_occupation && (\r\n                          <div className=\"py-2 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-600\">Father's Occupation</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{staff.father_occupation}</dd>\r\n                          </div>\r\n                        )}\r\n                      </>\r\n                    )}\r\n\r\n                    {/* Mother's Information */}\r\n                    {(staff.mother_name || staff.mother_contact || staff.mother_occupation) && (\r\n                      <>\r\n                        <div className=\"py-2 pt-4\">\r\n                          <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Mother's Details</h4>\r\n                        </div>\r\n                        {staff.mother_name && (\r\n                          <div className=\"py-2 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-600\">Mother's Name</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{staff.mother_name}</dd>\r\n                          </div>\r\n                        )}\r\n                        {staff.mother_contact && (\r\n                          <div className=\"py-2 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-600\">Mother's Contact</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{staff.mother_contact}</dd>\r\n                          </div>\r\n                        )}\r\n                        {staff.mother_occupation && (\r\n                          <div className=\"py-2 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-600\">Mother's Occupation</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{staff.mother_occupation}</dd>\r\n                          </div>\r\n                        )}\r\n                      </>\r\n                    )}\r\n                  </dl>\r\n                ) : (\r\n                  <div className=\"text-center py-8\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n                    </svg>\r\n                    <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No family information</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-500\">No family details have been provided for this staff member.</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Spouse Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Spouse Information</h3>\r\n                {(staff.spouse_name || staff.spouse_contact || staff.spouse_occupation) ? (\r\n                  <dl className=\"divide-y divide-gray-100\">\r\n                    {staff.spouse_name && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Spouse's Name</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{staff.spouse_name}</dd>\r\n                      </div>\r\n                    )}\r\n                    {staff.spouse_contact && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Spouse's Contact</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{staff.spouse_contact}</dd>\r\n                      </div>\r\n                    )}\r\n                    {staff.spouse_occupation && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Spouse's Occupation</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{staff.spouse_occupation}</dd>\r\n                      </div>\r\n                    )}\r\n                  </dl>\r\n                ) : (\r\n                  <div className=\"text-center py-8\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" />\r\n                    </svg>\r\n                    <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No spouse information</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-500\">No spouse details have been provided for this staff member.</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Local Guardian Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Local Guardian Information</h3>\r\n                {(staff.local_guardian_name || staff.local_guardian_contact || staff.local_guardian_address || staff.local_guardian_occupation || staff.local_guardian_relation) ? (\r\n                  <dl className=\"divide-y divide-gray-100\">\r\n                    {staff.local_guardian_name && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Guardian's Name</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{staff.local_guardian_name}</dd>\r\n                      </div>\r\n                    )}\r\n                    {staff.local_guardian_relation && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Relation</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{staff.local_guardian_relation}</dd>\r\n                      </div>\r\n                    )}\r\n                    {staff.local_guardian_contact && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Contact</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{staff.local_guardian_contact}</dd>\r\n                      </div>\r\n                    )}\r\n                    {staff.local_guardian_address && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Address</dt>\r\n                        <dd className=\"text-sm text-gray-900 text-right\">{staff.local_guardian_address}</dd>\r\n                      </div>\r\n                    )}\r\n                    {staff.local_guardian_occupation && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Occupation</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{staff.local_guardian_occupation}</dd>\r\n                      </div>\r\n                    )}\r\n                  </dl>\r\n                ) : (\r\n                  <div className=\"text-center py-8\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0121 12a8.966 8.966 0 00-2.037-5.725M15 9.75a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                    </svg>\r\n                    <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No guardian information</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-500\">No local guardian details have been provided for this staff member.</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Financial Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Financial Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {staff.salary_amount && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Current Salary</dt>\r\n                      <dd className=\"text-sm text-green-600 font-medium\">Rs {staff.salary_amount}</dd>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Display financial information from the latest financial record */}\r\n                  {staff.financials && staff.financials.length > 0 && (() => {\r\n                    // Get the latest financial record\r\n                    const latestFinancial = staff.financials.sort((a: any, b: any) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime())[0];\r\n                    \r\n                    return (\r\n                      <>\r\n                        {latestFinancial.bonus_amount && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Latest Bonus</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.bonus_amount}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.deduction_amount && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Latest Deduction</dt>\r\n                            <dd className=\"text-sm text-red-600\">Rs {latestFinancial.deduction_amount}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.net_salary && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Net Salary</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.net_salary}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.payment_date && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Last Payment Date</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{formatDate(latestFinancial.payment_date)}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.payment_type && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Payment Type</dt>\r\n                            <dd className=\"text-sm text-gray-900\">\r\n                              {typeof latestFinancial.payment_type === 'object' && latestFinancial.payment_type.name \r\n                                ? latestFinancial.payment_type.name \r\n                                : String(latestFinancial.payment_type)}\r\n                            </dd>\r\n                          </div>\r\n                        )}\r\n                      </>\r\n                    );\r\n                  })()}\r\n                </dl>\r\n              </div>\r\n              \r\n              {/* System Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">System Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  <div className=\"py-2 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-600\">Staff ID</dt>\r\n                    <dd className=\"text-sm text-gray-900 font-mono\">{staff.id}</dd>\r\n                  </div>\r\n                  {staff.user_id && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">User ID</dt>\r\n                      <dd className=\"text-sm text-gray-900 font-mono\">{staff.user_id}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.declaration_agreed !== undefined && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Declaration Agreed</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.declaration_agreed ? 'Yes' : 'No'}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.contract_agreed !== undefined && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Contract Agreed</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{staff.contract_agreed ? 'Yes' : 'No'}</dd>\r\n                    </div>\r\n                  )}\r\n                  {staff.verified_on && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Verified On</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(staff.verified_on)}</dd>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Created</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{formatDate(staff.created_at)}</dd>\r\n                  </div>\r\n                  {staff.updated_at && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Last Updated</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(staff.updated_at)}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Staff Amenities */}\r\n            {staff.amenities && staff.amenities.length > 0 && (\r\n              <div className=\"mt-8 pt-6 border-t border-gray-200\">\r\n                <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Staff Amenities</h3>\r\n                <div className=\"overflow-hidden bg-white border border-gray-200 rounded-lg shadow-sm\">\r\n                  <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                      <tr>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Name</th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                      {staff.amenities.map((amenity, index) => (\r\n                        <tr key={amenity.id || index} className=\"hover:bg-gray-50\">\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{amenity.name}</td>\r\n                          <td className=\"px-6 py-4 text-sm text-gray-500\">{amenity.description || 'No description'}</td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Staff Documents */}\r\n            <div className=\"mt-8 pt-6 border-t border-gray-200\">\r\n              <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Staff Documents</h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {staff.staff_image && (\r\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\r\n                    <div className=\"aspect-w-4 aspect-h-3 overflow-hidden\">\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted images shown as gallery/preview; keep native <img> to avoid layout shifts and support simple click handlers */}\r\n                      <img \r\n                        src={getImageUrl(staff.staff_image)} \r\n                        alt=\"Staff Photo\" \r\n                        className=\"object-cover w-full h-full cursor-pointer\"\r\n                        onClick={() => handleImageClick(getImageUrl(staff.staff_image!), 'Staff Photo')}\r\n                      />\r\n                    </div>\r\n                    <div className=\"p-3 bg-gray-50 border-t\">\r\n                      <p className=\"text-sm font-medium text-gray-800\">Staff Photo</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Profile photo of the staff member</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {staff.staff_citizenship_image && (\r\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\r\n                    <div className=\"aspect-w-4 aspect-h-3 overflow-hidden bg-gray-100 flex items-center justify-center\">\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted document previews; keep native <img> for direct preview and click-to-open behavior */}\r\n                      <img \r\n                        src={getImageUrl(staff.staff_citizenship_image)} \r\n                        alt=\"Citizenship Document\" \r\n                        className=\"object-contain w-full h-full cursor-pointer\"\r\n                        onClick={() => handleImageClick(getImageUrl(staff.staff_citizenship_image!), 'Citizenship Document')}\r\n                      />\r\n                    </div>\r\n                    <div className=\"p-3 bg-gray-50 border-t\">\r\n                      <p className=\"text-sm font-medium text-gray-800\">Citizenship Document</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Citizenship ID proof</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {staff.staff_contract_image && (\r\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\r\n                    <div className=\"aspect-w-4 aspect-h-3 overflow-hidden bg-gray-100 flex items-center justify-center\">\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted document previews; native <img> provides predictable behavior for click previews */}\r\n                      <img \r\n                        src={getImageUrl(staff.staff_contract_image)} \r\n                        alt=\"Employment Contract\" \r\n                        className=\"object-contain w-full h-full cursor-pointer\"\r\n                        onClick={() => handleImageClick(getImageUrl(staff.staff_contract_image!), 'Employment Contract')}\r\n                      />\r\n                    </div>\r\n                    <div className=\"p-3 bg-gray-50 border-t\">\r\n                      <p className=\"text-sm font-medium text-gray-800\">Employment Contract</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Signed employment contract</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {!staff.staff_image && !staff.staff_citizenship_image && !staff.staff_contract_image && (\r\n                  <div className=\"col-span-3 text-center py-12\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                    </svg>\r\n                    <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No documents</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-500\">No documents have been uploaded for this staff member.</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={showDeleteModal}\r\n        title=\"Delete Staff\"\r\n        message=\"Are you sure you want to delete this staff member? This action cannot be undone.\"\r\n        confirmText={isDeleting ? \"Deleting...\" : \"Delete\"}\r\n        cancelText=\"Cancel\"\r\n        isLoading={isDeleting}\r\n        onConfirm={handleDelete}\r\n        onCancel={() => setShowDeleteModal(false)}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertCircle' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'createdStaff' is assigned a value but never used.","line":321,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":321,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":616,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21064,21080],"text":"Father&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21064,21080],"text":"Father&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21064,21080],"text":"Father&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21064,21080],"text":"Father&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":647,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22528,22544],"text":"Mother&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22528,22544],"text":"Mother&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22528,22544],"text":"Mother&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22528,22544],"text":"Mother&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":678,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[23967,23999],"text":"Spouse&apos;s Details (if applicable)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[23967,23999],"text":"Spouse&lsquo;s Details (if applicable)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[23967,23999],"text":"Spouse&#39;s Details (if applicable)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[23967,23999],"text":"Spouse&rsquo;s Details (if applicable)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":937,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click &quot;Add Amenity\" to add staff amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click &ldquo;Add Amenity\" to add staff amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click &#34;Add Amenity\" to add staff amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click &rdquo;Add Amenity\" to add staff amenities."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":937,"column":101,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click \"Add Amenity&quot; to add staff amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click \"Add Amenity&ldquo; to add staff amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click \"Add Amenity&#34; to add staff amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[35653,35716],"text":"No amenities added. Click \"Add Amenity&rdquo; to add staff amenities."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { AlertCircle } from 'lucide-react';\r\nimport { staffApi, type StaffFormData, type StaffAmenity } from '@/lib/api/staff.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SingleImageUploadCreate,\r\n  MultipleImageUploadCreate,\r\n  ImageModal\r\n} from '@/components/ui';\r\n\r\nexport default function CreateStaff() {\r\n  const router = useRouter();\r\n  \r\n  // Form state\r\n  const [formData, setFormData] = useState<StaffFormData>({\r\n    staff_name: '',\r\n    contact_number: '',\r\n    email: '',\r\n    date_of_birth: '',\r\n    district: '',\r\n    city_name: '',\r\n    ward_no: '',\r\n    street_name: '',\r\n    citizenship_no: '',\r\n    date_of_issue: '',\r\n    citizenship_issued_district: '',\r\n    educational_institution: '',\r\n    level_of_study: '',\r\n    blood_group: '',\r\n    food: '',\r\n    disease: '',\r\n    father_name: '',\r\n    father_contact: '',\r\n    father_occupation: '',\r\n    mother_name: '',\r\n    mother_contact: '',\r\n    mother_occupation: '',\r\n    spouse_name: '',\r\n    spouse_contact: '',\r\n    spouse_occupation: '',\r\n    local_guardian_name: '',\r\n    local_guardian_address: '',\r\n    local_guardian_contact: '',\r\n    local_guardian_occupation: '',\r\n    local_guardian_relation: '',\r\n    is_active: true,\r\n    staff_id: '',\r\n    position: '',\r\n    department: '',\r\n    joining_date: '',\r\n    salary_amount: '',\r\n    employment_type: '',\r\n    declaration_agreed: false,\r\n    contract_agreed: false,\r\n    verified_by: '',\r\n    verified_on: '',\r\n    amenities: []\r\n  });\r\n  \r\n  // Form processing state\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  // Image state\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n  \r\n  // Document state - Multiple file uploads\r\n  const [citizenshipDocuments, setCitizenshipDocuments] = useState<File[]>([]);\r\n  const [contractDocuments, setContractDocuments] = useState<File[]>([]);\r\n  \r\n  // Amenities state\r\n  const [amenities, setAmenities] = useState<StaffAmenity[]>([]);\r\n\r\n  // Handle form field changes\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value, type } = e.target;\r\n\r\n    if (type === 'checkbox') {\r\n      const checkbox = e.target as HTMLInputElement;\r\n      setFormData({\r\n        ...formData,\r\n        [name]: checkbox.checked\r\n      });\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Process staff image file\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_image: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (2MB max)\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_image: 'File size must be less than 2MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      staff_image: file\r\n    }));\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.staff_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_image: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Remove staff image\r\n  const removeImage = () => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      staff_image: null\r\n    }));\r\n    setImagePreview(null);\r\n  };\r\n\r\n  // Validate citizenship document file\r\n  const validateCitizenshipFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_citizenship_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_citizenship_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.staff_citizenship_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_citizenship_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add citizenship documents\r\n  const addCitizenshipDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateCitizenshipFile(file));\r\n    if (validFiles.length > 0) {\r\n      setCitizenshipDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove citizenship document\r\n  const removeCitizenshipImage = (index: number) => {\r\n    setCitizenshipDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n  \r\n  // Validate contract form file\r\n  const validateContractFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_contract_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_contract_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.staff_contract_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        staff_contract_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add contract documents\r\n  const addContractDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateContractFile(file));\r\n    if (validFiles.length > 0) {\r\n      setContractDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove contract document\r\n  const removeContractImage = (index: number) => {\r\n    setContractDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  // Handle amenity changes\r\n  const handleAmenityChange = (index: number, field: keyof StaffAmenity, value: string) => {\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities[index] = {\r\n      ...updatedAmenities[index],\r\n      [field]: value\r\n    };\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Add new amenity field\r\n  const addAmenity = () => {\r\n    setAmenities([...amenities, { name: '', description: '' }]);\r\n  };\r\n\r\n  // Remove amenity field\r\n  const removeAmenity = (index: number) => {\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities.splice(index, 1);\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Form validation\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.staff_name.trim()) {\r\n      newErrors.staff_name = 'Staff name is required';\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      newErrors.email = 'Email address is required';\r\n    } else if (!/\\S+@\\S+\\.\\S+/.test(formData.email)) {\r\n      newErrors.email = 'Please enter a valid email address';\r\n    }\r\n\r\n    if (!formData.contact_number.trim()) {\r\n      newErrors.contact_number = 'Contact number is required';\r\n    } else if (!/^\\d{10}$/.test(formData.contact_number.trim())) {\r\n      newErrors.contact_number = 'Please enter a valid 10-digit phone number';\r\n    }\r\n    \r\n    // Staff amenities are optional - no validation required\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  // Form submission\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validate form\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    // Filter out empty amenities\r\n    const filteredAmenities = amenities.filter(item => item.name.trim() !== '');\r\n    \r\n    try {\r\n      // Create the staff member\r\n      const staffFormData = {\r\n        ...formData,\r\n        amenities: filteredAmenities,\r\n        staff_citizenship_image: citizenshipDocuments.length > 0 ? citizenshipDocuments[0] : null,\r\n        staff_contract_image: contractDocuments.length > 0 ? contractDocuments[0] : null\r\n      };\r\n      \r\n      const createdStaff = await staffApi.createStaff(staffFormData);\r\n\r\n      // Redirect to staff list on success\r\n      router.push('/admin/staff');\r\n    } catch (error) {\r\n      console.error('Error creating staff:', error);\r\n      \r\n      if (error instanceof ApiError) {\r\n        if (error.validation && Object.keys(error.validation).length > 0) {\r\n          // Convert validation errors to our format\r\n          const formattedErrors: Record<string, string> = {};\r\n          \r\n          Object.entries(error.validation).forEach(([field, messages]) => {\r\n            formattedErrors[field] = Array.isArray(messages) ? messages[0] : messages;\r\n          });\r\n          \r\n          setErrors({\r\n            ...formattedErrors,\r\n            submit: `Failed to create staff: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            submit: `Failed to create staff: ${error.message}`\r\n          });\r\n        }\r\n      } else {\r\n        setErrors({\r\n          submit: 'An unexpected error occurred. Please try again later.'\r\n        });\r\n      }\r\n      \r\n      // Scroll to top to show error message\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Add New Staff Member</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Enter staff details to register a new staff member</p>\r\n        </div>\r\n\r\n        {/* Error Alert */}\r\n        {errors.submit && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">{errors.submit}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit}>\r\n          <div className=\"p-6\">\r\n            {/* Basic Information */}\r\n            <div className=\"mb-8\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Basic Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Staff Name */}\r\n                <FormField\r\n                  name=\"staff_name\"\r\n                  label=\"Staff Name\"\r\n                  required\r\n                  value={formData.staff_name}\r\n                  onChange={handleInputChange}\r\n                  error={errors.staff_name}\r\n                  placeholder=\"Enter full name\"\r\n                />\r\n                \r\n                {/* Email */}\r\n                <FormField\r\n                  name=\"email\"\r\n                  label=\"Email Address\"\r\n                  required\r\n                  type=\"email\"\r\n                  value={formData.email}\r\n                  onChange={handleInputChange}\r\n                  error={errors.email}\r\n                  placeholder=\"Enter email address\"\r\n                />\r\n                \r\n                {/* Contact Number */}\r\n                <FormField\r\n                  name=\"contact_number\"\r\n                  label=\"Contact Number\"\r\n                  required\r\n                  value={formData.contact_number}\r\n                  onChange={handleInputChange}\r\n                  error={errors.contact_number}\r\n                  placeholder=\"Enter 10-digit phone number\"\r\n                />\r\n                \r\n                {/* Date of Birth */}\r\n                <FormField\r\n                  name=\"date_of_birth\"\r\n                  label=\"Date of Birth\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_birth || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_birth}\r\n                  placeholder=\"YYYY-MM-DD\"\r\n                />\r\n                \r\n                {/* Blood Group */}\r\n                <FormField\r\n                  name=\"blood_group\"\r\n                  label=\"Blood Group\"\r\n                  type=\"select\"\r\n                  value={formData.blood_group || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.blood_group}\r\n                  options={[\r\n                    { value: 'A+', label: 'A+' },\r\n                    { value: 'A-', label: 'A-' },\r\n                    { value: 'B+', label: 'B+' },\r\n                    { value: 'B-', label: 'B-' },\r\n                    { value: 'AB+', label: 'AB+' },\r\n                    { value: 'AB-', label: 'AB-' },\r\n                    { value: 'O+', label: 'O+' },\r\n                    { value: 'O-', label: 'O-' }\r\n                  ]}\r\n                />\r\n\r\n                {/* Active Status */}\r\n                <div className=\"flex items-center mt-4\">\r\n                  <input\r\n                    id=\"is_active\"\r\n                    name=\"is_active\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.is_active || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"is_active\" className=\"ml-2 text-sm font-semibold text-neutral-900\">Active Staff Member</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Address Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Address Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* District */}\r\n                <FormField\r\n                  name=\"district\"\r\n                  label=\"District\"\r\n                  value={formData.district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.district}\r\n                  placeholder=\"Enter district name\"\r\n                />\r\n                \r\n                {/* City Name */}\r\n                <FormField\r\n                  name=\"city_name\"\r\n                  label=\"City\"\r\n                  value={formData.city_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.city_name}\r\n                  placeholder=\"Enter city name\"\r\n                />\r\n                \r\n                {/* Ward No */}\r\n                <FormField\r\n                  name=\"ward_no\"\r\n                  label=\"Ward Number\"\r\n                  value={formData.ward_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.ward_no}\r\n                  placeholder=\"Enter ward number\"\r\n                />\r\n                \r\n                {/* Street Name */}\r\n                <FormField\r\n                  name=\"street_name\"\r\n                  label=\"Street Name\"\r\n                  value={formData.street_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.street_name}\r\n                  placeholder=\"Enter street name\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Citizenship Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Citizenship Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Citizenship No */}\r\n                <FormField\r\n                  name=\"citizenship_no\"\r\n                  label=\"Citizenship Number\"\r\n                  value={formData.citizenship_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_no}\r\n                  placeholder=\"Enter citizenship number\"\r\n                />\r\n                \r\n                {/* Date of Issue */}\r\n                <FormField\r\n                  name=\"date_of_issue\"\r\n                  label=\"Date of Issue\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_issue || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_issue}\r\n                />\r\n                \r\n                {/* Citizenship Issued District */}\r\n                <FormField\r\n                  name=\"citizenship_issued_district\"\r\n                  label=\"Issued District\"\r\n                  value={formData.citizenship_issued_district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_issued_district}\r\n                  placeholder=\"Enter district where citizenship was issued\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Educational Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Educational Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Educational Institution */}\r\n                <FormField\r\n                  name=\"educational_institution\"\r\n                  label=\"Educational Institution\"\r\n                  value={formData.educational_institution || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.educational_institution}\r\n                  placeholder=\"Enter school/college name\"\r\n                />\r\n                \r\n                {/* Level of Study */}\r\n                <FormField\r\n                  name=\"level_of_study\"\r\n                  label=\"Level of Study\"\r\n                  value={formData.level_of_study || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.level_of_study}\r\n                  placeholder=\"e.g., Bachelors, Masters\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Health Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Health Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Food Preference */}\r\n                <FormField\r\n                  name=\"food\"\r\n                  label=\"Food Preference\"\r\n                  type=\"select\"\r\n                  value={formData.food || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.food}\r\n                  options={[\r\n                    { value: 'vegetarian', label: 'Vegetarian' },\r\n                    { value: 'non-vegetarian', label: 'Non-vegetarian' },\r\n                    { value: 'egg-only', label: 'Egg Only' }\r\n                  ]}\r\n                />\r\n                \r\n                {/* Disease/Health Issues */}\r\n                <div className=\"md:col-span-2\">\r\n                  <FormField\r\n                    name=\"disease\"\r\n                    label=\"Disease or Health Issues (if any)\"\r\n                    type=\"textarea\"\r\n                    value={formData.disease || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.disease}\r\n                    placeholder=\"Enter any health conditions or allergies\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Family Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Family Information</h2>\r\n              <div className=\"grid grid-cols-1 gap-4\">\r\n                {/* Father's Information */}\r\n                <div className=\"border-b border-gray-100 pb-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Father's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"father_name\"\r\n                      label=\"Father's Name\"\r\n                      value={formData.father_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_name}\r\n                      placeholder=\"Enter father's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_contact\"\r\n                      label=\"Father's Contact\"\r\n                      value={formData.father_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_contact}\r\n                      placeholder=\"Enter father's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_occupation\"\r\n                      label=\"Father's Occupation\"\r\n                      value={formData.father_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_occupation}\r\n                      placeholder=\"Enter father's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Mother's Information */}\r\n                <div className=\"border-b border-gray-100 py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Mother's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"mother_name\"\r\n                      label=\"Mother's Name\"\r\n                      value={formData.mother_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_name}\r\n                      placeholder=\"Enter mother's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_contact\"\r\n                      label=\"Mother's Contact\"\r\n                      value={formData.mother_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_contact}\r\n                      placeholder=\"Enter mother's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_occupation\"\r\n                      label=\"Mother's Occupation\"\r\n                      value={formData.mother_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_occupation}\r\n                      placeholder=\"Enter mother's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Spouse's Information */}\r\n                <div className=\"py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Spouse's Details (if applicable)</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"spouse_name\"\r\n                      label=\"Spouse's Name\"\r\n                      value={formData.spouse_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_name}\r\n                      placeholder=\"Enter spouse's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_contact\"\r\n                      label=\"Spouse's Contact\"\r\n                      value={formData.spouse_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_contact}\r\n                      placeholder=\"Enter spouse's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_occupation\"\r\n                      label=\"Spouse's Occupation\"\r\n                      value={formData.spouse_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_occupation}\r\n                      placeholder=\"Enter spouse's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Guardian Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Local Guardian Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <FormField\r\n                  name=\"local_guardian_name\"\r\n                  label=\"Guardian's Name\"\r\n                  value={formData.local_guardian_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_name}\r\n                  placeholder=\"Enter local guardian's name\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_relation\"\r\n                  label=\"Relation with Staff\"\r\n                  value={formData.local_guardian_relation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_relation}\r\n                  placeholder=\"e.g., Uncle, Aunt\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_contact\"\r\n                  label=\"Guardian's Contact\"\r\n                  value={formData.local_guardian_contact || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_contact}\r\n                  placeholder=\"Enter guardian's phone number\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_occupation\"\r\n                  label=\"Guardian's Occupation\"\r\n                  value={formData.local_guardian_occupation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_occupation}\r\n                  placeholder=\"Enter guardian's occupation\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_address\"\r\n                  label=\"Guardian's Address\"\r\n                  value={formData.local_guardian_address || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_address}\r\n                  placeholder=\"Enter guardian's address\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Document Uploads */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Document Uploads</h2>\r\n              \r\n              {/* Staff Photo */}\r\n              <div className=\"mb-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Staff Photo</h3>\r\n                <div className=\"w-full\">\r\n                  <SingleImageUploadCreate\r\n                    imagePreview={imagePreview}\r\n                    onFileSelect={processFile}\r\n                    onRemove={removeImage}\r\n                    error={errors.staff_image}\r\n                    label=\"Staff Photo\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Citizenship Documents */}\r\n              <div className=\"mb-6 pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Citizenship Documents</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadCreate\r\n                    images={citizenshipDocuments}\r\n                    onAddImages={addCitizenshipDocuments}\r\n                    onRemoveImage={removeCitizenshipImage}\r\n                    error={errors.staff_citizenship_image}\r\n                    label=\"Citizenship Documents\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Contract Documents */}\r\n              <div className=\"pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Contract Documents</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadCreate\r\n                    images={contractDocuments}\r\n                    onAddImages={addContractDocuments}\r\n                    onRemoveImage={removeContractImage}\r\n                    error={errors.staff_contract_image}\r\n                    label=\"Contract Documents\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Administrative Details */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Administrative Details</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Staff ID */}\r\n                <FormField\r\n                  name=\"staff_id\"\r\n                  label=\"Staff ID\"\r\n                  value={formData.staff_id || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.staff_id}\r\n                />\r\n                \r\n                {/* Position */}\r\n                <FormField\r\n                  name=\"position\"\r\n                  label=\"Position\"\r\n                  value={formData.position || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.position}\r\n                  placeholder=\"e.g., Manager, Assistant, Guard\"\r\n                />\r\n                \r\n                {/* Department */}\r\n                <FormField\r\n                  name=\"department\"\r\n                  label=\"Department\"\r\n                  value={formData.department || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.department}\r\n                  placeholder=\"e.g., Administration, Security, Maintenance\"\r\n                />\r\n                \r\n                {/* Employment Type */}\r\n                <FormField\r\n                  name=\"employment_type\"\r\n                  label=\"Employment Type\"\r\n                  type=\"select\"\r\n                  value={formData.employment_type || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.employment_type}\r\n                  options={[\r\n                    { value: '', label: 'Select Employment Type' },\r\n                    { value: 'full-time', label: 'Full-time' },\r\n                    { value: 'part-time', label: 'Part-time' },\r\n                    { value: 'contract', label: 'Contract' },\r\n                    { value: 'intern', label: 'Intern' }\r\n                  ]}\r\n                />\r\n                \r\n                {/* Joining Date */}\r\n                <FormField\r\n                  name=\"joining_date\"\r\n                  label=\"Joining Date\"\r\n                  type=\"date\"\r\n                  value={formData.joining_date || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.joining_date}\r\n                />\r\n                \r\n                {/* Salary Amount */}\r\n                <FormField\r\n                  name=\"salary_amount\"\r\n                  label=\"Salary Amount\"\r\n                  value={formData.salary_amount || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.salary_amount}\r\n                  placeholder=\"Enter monthly salary\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Amenities */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900\">Staff Amenities</h2>\r\n                <Button \r\n                  type=\"button\" \r\n                  onClick={addAmenity}\r\n                  variant=\"secondary\"\r\n                  size=\"sm\"\r\n                >\r\n                  Add Amenity\r\n                </Button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-4\">\r\n                {amenities.length > 0 ? (\r\n                  amenities.map((amenity, index) => (\r\n                    <div key={index} className=\"flex space-x-4 items-start\">\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_name_${index}`}\r\n                          label={`Amenity ${index + 1} Name`}\r\n                          placeholder=\"Enter amenity name\"\r\n                          value={amenity.name}\r\n                          onChange={(e) => handleAmenityChange(index, 'name', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_description_${index}`}\r\n                          label=\"Description (Optional)\"\r\n                          placeholder=\"Enter description\"\r\n                          value={amenity.description || ''}\r\n                          onChange={(e) => handleAmenityChange(index, 'description', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"pt-8\">\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => removeAmenity(index)}\r\n                          className=\"text-red-600 hover:text-red-800\"\r\n                        >\r\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                            <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                          </svg>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                ) : (\r\n                  <p className=\"text-gray-500 text-sm italic\">No amenities added. Click \"Add Amenity\" to add staff amenities.</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Verification */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Verification</h2>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"declaration_agreed\"\r\n                    name=\"declaration_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.declaration_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"declaration_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I hereby declare that all the information provided above is true and correct to the best of my knowledge.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"contract_agreed\"\r\n                    name=\"contract_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.contract_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"contract_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I agree to abide by all the terms and conditions of employment.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\r\n                  <FormField\r\n                    name=\"verified_by\"\r\n                    label=\"Verified By\"\r\n                    value={formData.verified_by || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.verified_by}\r\n                    placeholder=\"Name of verifying officer\"\r\n                  />\r\n                  \r\n                  <FormField\r\n                    name=\"verified_on\"\r\n                    label=\"Verification Date\"\r\n                    type=\"date\"\r\n                    value={formData.verified_on || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.verified_on}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Form Actions */}\r\n            <div className=\"px-6 py-4 bg-gray-50 flex justify-end space-x-4\">\r\n              <CancelButton onClick={() => router.push('/admin/staff')} />\r\n              <SubmitButton \r\n                loading={isSubmitting} \r\n                loadingText=\"Creating...\"\r\n              >\r\n                Create Staff Member\r\n              </SubmitButton>\r\n            </div>\r\n          </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\staff\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3657,3660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3657,3660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4091,4094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4091,4094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":386,"column":31,"nodeType":"JSXOpeningElement","endLine":390,"endColumn":33,"suppressions":[{"kind":"directive","justification":"server-hosted staff thumbnails; native <img> used for quick previews and click-to-open modal"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":549,"column":13,"nodeType":"JSXOpeningElement","endLine":553,"endColumn":15,"suppressions":[{"kind":"directive","justification":"lightbox/modal uses native <img> for direct display"}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { staffApi, type StaffWithAmenities } from '@/lib/api/staff.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  TableSkeleton, \r\n  SearchBar, \r\n  Button,\r\n  ActionButtons,\r\n  ConfirmModal\r\n} from '@/components/ui';\r\nimport { formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function StaffList() {\r\n  const router = useRouter();\r\n  \r\n  const [staff, setStaff] = useState<StaffWithAmenities[]>([]);\r\n  const [filteredStaff, setFilteredStaff] = useState<StaffWithAmenities[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('');\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [staffToDelete, setStaffToDelete] = useState<string | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [selectedPhoto, setSelectedPhoto] = useState<string | null>(null);\r\n  const [showPhotoModal, setShowPhotoModal] = useState(false);\r\n  const [togglingStatusId, setTogglingStatusId] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchStaff = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Get staff data from API\r\n        const response = await staffApi.getStaff(currentPage);\r\n        console.log('Staff API Response:', response); // Debug log to see API response\r\n        \r\n        // Check if we have data before setting state\r\n        if (response && response.data) {\r\n          setStaff(response.data);\r\n          setFilteredStaff(response.data);\r\n          setTotalPages(response.last_page || 1);\r\n        } else {\r\n          console.error('No data returned from API');\r\n          setError('No staff data available. The API may be unavailable.');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching staff:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load staff: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load staff data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchStaff();\r\n  }, [currentPage]);\r\n\r\n  // Apply filters when searchTerm or statusFilter changes\r\n  useEffect(() => {\r\n    if (!staff.length) return;\r\n\r\n    let result = [...staff];\r\n    \r\n    console.log('Original staff:', staff.length);\r\n    console.log('Status filter:', statusFilter);\r\n\r\n    // Filter by search term\r\n    if (searchTerm) {\r\n      const lowercasedTerm = searchTerm.toLowerCase();\r\n      result = result.filter(staffMember => \r\n        staffMember.staff_name.toLowerCase().includes(lowercasedTerm) || \r\n        staffMember.email.toLowerCase().includes(lowercasedTerm) ||\r\n        staffMember.contact_number.toLowerCase().includes(lowercasedTerm) ||\r\n        (staffMember.staff_id && staffMember.staff_id.toLowerCase().includes(lowercasedTerm)) ||\r\n        (staffMember.position && staffMember.position.toLowerCase().includes(lowercasedTerm)) ||\r\n        (staffMember.department && staffMember.department.toLowerCase().includes(lowercasedTerm))\r\n      );\r\n    }\r\n\r\n    // Filter by status\r\n    if (statusFilter) {\r\n      console.log('Applying status filter:', statusFilter);\r\n      \r\n      if (statusFilter === 'active') {\r\n        result = result.filter(staffMember => {\r\n          const isActiveValue: any = staffMember.is_active;\r\n          const isActive = isActiveValue === true || \r\n                          isActiveValue === 1 || \r\n                          isActiveValue === '1' || \r\n                          String(isActiveValue).toLowerCase() === 'true';\r\n          return isActive;\r\n        });\r\n      } else if (statusFilter === 'inactive') {\r\n        result = result.filter(staffMember => {\r\n          const isActiveValue: any = staffMember.is_active;\r\n          const isInactive = isActiveValue === false || \r\n                            isActiveValue === 0 || \r\n                            isActiveValue === '0' || \r\n                            String(isActiveValue).toLowerCase() === 'false' ||\r\n                            isActiveValue === null ||\r\n                            isActiveValue === undefined;\r\n          return isInactive;\r\n        });\r\n      }\r\n      \r\n      console.log('Staff after status filtering:', result.length);\r\n    }\r\n    \r\n    console.log('Filtered staff:', result.length);\r\n    setFilteredStaff(result);\r\n  }, [searchTerm, statusFilter, staff]);\r\n\r\n  const handleSearch = (term: string) => {\r\n    setSearchTerm(term);\r\n  };\r\n\r\n  const handleStatusFilterChange = (value: string) => {\r\n    setStatusFilter(value);\r\n  };\r\n\r\n  const handlePageChange = (page: number) => {\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  const confirmDelete = (staffId: string) => {\r\n    setStaffToDelete(staffId);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!staffToDelete) return;\r\n\r\n    try {\r\n      setIsDeleting(true);\r\n      \r\n      // Delete staff using API\r\n      await staffApi.deleteStaff(staffToDelete);\r\n      \r\n      // Remove from local state\r\n      const updatedStaff = staff.filter(staffMember => staffMember.id !== staffToDelete);\r\n      setStaff(updatedStaff);\r\n      setFilteredStaff(updatedStaff);\r\n      \r\n      // Close modal\r\n      setShowDeleteModal(false);\r\n      setStaffToDelete(null);\r\n    } catch (error) {\r\n      console.error('Error deleting staff:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(`Failed to delete staff: ${error.message}`);\r\n      } else {\r\n        setError('Failed to delete staff. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleToggleStatus = async (staffId: string) => {\r\n    try {\r\n      setTogglingStatusId(staffId);\r\n      \r\n      // Toggle status using API\r\n      const response = await staffApi.toggleStaffStatus(staffId);\r\n      \r\n      // Update local state with new status\r\n      const updatedStaff = staff.map(staffMember => \r\n        staffMember.id === staffId \r\n          ? { ...staffMember, is_active: response.is_active }\r\n          : staffMember\r\n      );\r\n      \r\n      setStaff(updatedStaff);\r\n      setFilteredStaff(updatedStaff);\r\n    } catch (error) {\r\n      console.error('Error toggling staff status:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(`Failed to update staff status: ${error.message}`);\r\n      } else {\r\n        setError('Failed to update staff status. Please try again.');\r\n      }\r\n    } finally {\r\n      setTogglingStatusId(null);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (isActive: boolean) => {\r\n    return isActive ? (\r\n      <span className=\"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800\">\r\n        Active\r\n      </span>\r\n    ) : (\r\n      <span className=\"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800\">\r\n        Inactive\r\n      </span>\r\n    );\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Staff Management</h1>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-4 md:p-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header Section */}\r\n        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-6\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Staff</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">Manage all staff members</p>\r\n          </div>\r\n          <div className=\"mt-4 md:mt-0\">\r\n            <Button\r\n              onClick={() => router.push('/admin/staff/create')}\r\n              variant=\"primary\"\r\n            >\r\n              Add New Staff\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Summary Stats */}\r\n        {!isLoading && staff.length > 0 && (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">{staff.length}</p>\r\n                  <p className=\"text-sm text-gray-500\">Total Staff</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-green-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">\r\n                    {staff.filter(s => s.is_active).length}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">Active Staff</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-red-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">\r\n                    {staff.filter(s => !s.is_active).length}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">Inactive Staff</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-yellow-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">\r\n                    {staff.filter(s => s.position && s.position.trim() !== '').length}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">With Positions</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Search and Filter Bar */}\r\n        <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\r\n          <div className=\"flex flex-col md:flex-row gap-4\">\r\n            <div className=\"w-full md:w-1/2\">\r\n              <SearchBar\r\n                value={searchTerm}\r\n                onChange={handleSearch}\r\n                placeholder=\"Search by name, email, phone, ID, position, or department...\"\r\n              />\r\n            </div>\r\n            <div className=\"w-full md:w-1/2 md:flex md:justify-end\">\r\n              <select\r\n                value={statusFilter}\r\n                onChange={(e) => handleStatusFilterChange(e.target.value)}\r\n                className=\"w-full md:w-auto px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n              >\r\n                <option value=\"\">All Status</option>\r\n                <option value=\"active\">Active</option>\r\n                <option value=\"inactive\">Inactive</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Staff Table */}\r\n        <div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\r\n          {filteredStaff.length > 0 ? (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full text-sm text-left text-gray-800\">\r\n                <thead className=\"text-xs text-gray-700 uppercase bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3\">Staff Member</th>\r\n                    <th className=\"px-6 py-3\">Position/Department</th>\r\n                    <th className=\"px-6 py-3\">Contact</th>\r\n                    <th className=\"px-6 py-3\">Status</th>\r\n                    <th className=\"px-6 py-3\">Joining Date</th>\r\n                    <th className=\"px-6 py-3 text-right\">Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {filteredStaff.map(staffMember => (\r\n                    <tr \r\n                      key={staffMember.id}\r\n                      className=\"border-b hover:bg-gray-50\"\r\n                    >\r\n                      <td className=\"px-6 py-4\">\r\n                        <div className=\"flex items-center\">\r\n                          <div \r\n                            className=\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-sm mr-3 overflow-hidden cursor-pointer\"\r\n                            onClick={() => {\r\n                              if (staffMember.staff_image) {\r\n                                setSelectedPhoto(getImageUrl(staffMember.staff_image));\r\n                                setShowPhotoModal(true);\r\n                              }\r\n                            }}\r\n                            title={staffMember.staff_image ? \"Click to enlarge\" : \"No photo available\"}\r\n                          >\r\n                            {staffMember.staff_image ? (\r\n                              <>\r\n                              {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted staff thumbnails; native <img> used for quick previews and click-to-open modal */}\r\n                              <img \r\n                                src={getImageUrl(staffMember.staff_image)} \r\n                                alt={staffMember.staff_name}\r\n                                className=\"h-full w-full object-cover\" \r\n                              />\r\n                              </>\r\n                            ) : (\r\n                              staffMember.staff_name.charAt(0).toUpperCase()\r\n                            )}\r\n                          </div>\r\n                          <div>\r\n                            <div className=\"font-medium text-gray-900\">{staffMember.staff_name}</div>\r\n                            <div className=\"text-xs text-gray-500\">\r\n                              {staffMember.staff_id ? `ID: ${staffMember.staff_id}` : staffMember.email}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        <div>\r\n                          <div className=\"font-medium\">{staffMember.position || 'Not specified'}</div>\r\n                          <div className=\"text-xs text-gray-500\">\r\n                            {staffMember.department || 'No Department'}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        <div>\r\n                          <div>{staffMember.contact_number}</div>\r\n                          <div className=\"text-xs text-gray-500\">{staffMember.email}</div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        {getStatusBadge(staffMember.is_active)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        {staffMember.joining_date ? formatDate(staffMember.joining_date) : formatDate(staffMember.created_at)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 text-right\">\r\n                        <div className=\"flex items-center justify-end space-x-2\">\r\n                          {/* Toggle Status Button */}\r\n                          <button\r\n                            onClick={() => handleToggleStatus(staffMember.id)}\r\n                            disabled={togglingStatusId === staffMember.id}\r\n                            className={`p-2 rounded-lg transition-colors ${\r\n                              staffMember.is_active\r\n                                ? 'bg-red-50 text-red-600 hover:bg-red-100'\r\n                                : 'bg-green-50 text-green-600 hover:bg-green-100'\r\n                            } ${togglingStatusId === staffMember.id ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                            title={staffMember.is_active ? 'Deactivate' : 'Activate'}\r\n                          >\r\n                            {togglingStatusId === staffMember.id ? (\r\n                              <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                              </svg>\r\n                            ) : staffMember.is_active ? (\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\" />\r\n                              </svg>\r\n                            ) : (\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                              </svg>\r\n                            )}\r\n                          </button>\r\n                          \r\n                          <ActionButtons\r\n                            viewUrl={`/admin/staff/${staffMember.id}`}\r\n                            editUrl={`/admin/staff/${staffMember.id}/edit`}\r\n                            onDelete={() => confirmDelete(staffMember.id)}\r\n                            isDeleting={isDeleting && staffToDelete === staffMember.id}\r\n                            style=\"compact\"\r\n                          />\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-12\">\r\n              <svg className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\r\n              </svg>\r\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No staff found</h3>\r\n              <p className=\"mt-1 text-sm text-gray-500\">\r\n                {searchTerm || statusFilter ? 'Try adjusting your search or filter criteria.' : 'Get started by adding a new staff member.'}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Pagination */}\r\n          {totalPages > 1 && (\r\n            <div className=\"flex justify-between items-center px-6 py-3 bg-gray-50\">\r\n              <div className=\"text-sm text-gray-500\">\r\n                Showing page {currentPage} of {totalPages}\r\n              </div>\r\n              <div className=\"flex space-x-1\">\r\n                <button\r\n                  onClick={() => handlePageChange(Math.max(1, currentPage - 1))}\r\n                  disabled={currentPage === 1}\r\n                  className={`px-3 py-1 rounded ${\r\n                    currentPage === 1\r\n                      ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\r\n                      : 'bg-white text-gray-700 hover:bg-gray-100'\r\n                  }`}\r\n                >\r\n                  Previous\r\n                </button>\r\n                <button\r\n                  onClick={() => handlePageChange(Math.min(totalPages, currentPage + 1))}\r\n                  disabled={currentPage === totalPages}\r\n                  className={`px-3 py-1 rounded ${\r\n                    currentPage === totalPages\r\n                      ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\r\n                      : 'bg-white text-gray-700 hover:bg-gray-100'\r\n                  }`}\r\n                >\r\n                  Next\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={showDeleteModal}\r\n        title=\"Delete Staff Member\"\r\n        message=\"Are you sure you want to delete this staff member? This action cannot be undone.\"\r\n        confirmText={isDeleting ? \"Deleting...\" : \"Delete\"}\r\n        cancelText=\"Cancel\"\r\n        isLoading={isDeleting}\r\n        onConfirm={handleDelete}\r\n        onCancel={() => {\r\n          setShowDeleteModal(false);\r\n          setStaffToDelete(null);\r\n        }}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Photo Popup Modal */}\r\n      {showPhotoModal && selectedPhoto && (\r\n        <div \r\n          className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\"\r\n          onClick={() => setShowPhotoModal(false)}\r\n        >\r\n          <div \r\n            className=\"relative max-w-2xl max-h-[80vh] bg-white rounded-lg shadow-xl overflow-hidden\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <button\r\n              className=\"absolute top-2 right-2 bg-white rounded-full p-1 shadow-md hover:bg-gray-100\"\r\n              onClick={() => setShowPhotoModal(false)}\r\n            >\r\n              <svg className=\"w-6 h-6 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n            {/* eslint-disable-next-line @next/next/no-img-element -- lightbox/modal uses native <img> for direct display */}\r\n            <img \r\n              src={selectedPhoto} \r\n              alt=\"Staff Photo\" \r\n              className=\"max-h-[80vh] object-contain\"\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student-checkin-checkout\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2922,2925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2922,2925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { studentCheckInCheckOutApi, StudentCheckInCheckOut, StudentCheckInCheckOutFormData } from '@/lib/api/student-checkincheckout.api';\r\nimport { \r\n  SubmitButton, \r\n  CancelButton \r\n} from '@/components/ui';\r\n\r\nexport default function EditStudentCheckinCheckout() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const recordId = params.id as string;\r\n  \r\n  const [record, setRecord] = useState<StudentCheckInCheckOut | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  const [formData, setFormData] = useState<StudentCheckInCheckOutFormData>({\r\n    student_id: '',\r\n    block_id: '',\r\n    date: '',\r\n    checkin_time: '',\r\n    checkout_time: '',\r\n    remarks: '',\r\n  });\r\n\r\n  // Fetch initial data\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Fetch record details - use admin endpoint\r\n        const recordResponse = await studentCheckInCheckOutApi.getStudentCheckInCheckOutRecord(recordId);\r\n        const recordData = recordResponse.data;\r\n        setRecord(recordData);\r\n        \r\n        // Set form data for editable fields only\r\n        setFormData({\r\n          student_id: recordData.student_id,\r\n          block_id: recordData.block_id,\r\n          date: recordData.date,\r\n          checkin_time: recordData.checkin_time || '',\r\n          checkout_time: recordData.checkout_time || '',\r\n          remarks: recordData.remarks || '',\r\n        });\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        setErrors({ fetch: 'Failed to load record data' });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    if (recordId) {\r\n      fetchData();\r\n    }\r\n  }, [recordId]);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setErrors({});\r\n\r\n    try {\r\n      // Only submit the editable fields (times)\r\n      const updateData = {\r\n        checkin_time: formData.checkin_time || undefined,\r\n        checkout_time: formData.checkout_time || undefined,\r\n      };\r\n\r\n      await studentCheckInCheckOutApi.updateCheckInCheckOut(recordId, updateData);\r\n      router.push(`/admin/student-checkin-checkout/${recordId}`);\r\n    } catch (error: any) {\r\n      console.error('Error updating record:', error);\r\n      if (error.validation) {\r\n        setErrors(error.validation);\r\n      } else {\r\n        setErrors({ general: error.message || 'Failed to update record' });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Helper function to get original remarks without check-in appended text\r\n  const getOriginalRemarks = (remarks: string | null | undefined) => {\r\n    if (!remarks) return 'No remarks';\r\n    \r\n    // Remove check-in appended text patterns\r\n    const checkInPatterns = [\r\n      /\\.\\s*Check-in:\\s*Student self check-in$/i,\r\n      /Check-in:\\s*Student self check-in$/i,\r\n      /\\.\\s*Check-in:.*$/i,\r\n      /Check-in:.*$/i\r\n    ];\r\n    \r\n    let cleanedRemarks = remarks;\r\n    for (const pattern of checkInPatterns) {\r\n      cleanedRemarks = cleanedRemarks.replace(pattern, '').trim();\r\n    }\r\n    \r\n    return cleanedRemarks || 'No remarks';\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/student-checkin-checkout')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      <div className=\"w-full\">\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Check-in/Check-out Record</h1>\r\n            <p className=\"text-gray-600 mt-1\">\r\n              Update the check-in/check-out details for {record?.student?.student_name}\r\n            </p>\r\n          </div>\r\n\r\n          {errors.general && (\r\n            <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n              <div className=\"flex\">\r\n                <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-red-800\">{errors.general}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {/* Read-only Information Section */}\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Record Information</h2>\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Student */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Student</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">\r\n                    {record?.student?.student_name} ({record?.student?.student_id})\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Block */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Block</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{record?.block?.block_name}</p>\r\n                </div>\r\n\r\n                {/* Date */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Date</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">\r\n                    {record?.date ? new Date(record.date).toLocaleDateString('en-US', {\r\n                      year: 'numeric',\r\n                      month: 'long',\r\n                      day: 'numeric'\r\n                    }) : 'Not set'}\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Remarks */}\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Remarks</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{getOriginalRemarks(record?.remarks)}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Editable Time Fields Section */}\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Edit Times</h2>\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Checkout Time */}\r\n                <div className=\"space-y-1.5\">\r\n                  <label htmlFor=\"checkout_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Check-out Time\r\n                  </label>\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    id=\"checkout_time\"\r\n                    name=\"checkout_time\"\r\n                    value={formData.checkout_time || ''}\r\n                    onChange={handleChange}\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                  />\r\n                  {errors.checkout_time && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      {errors.checkout_time}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Checkin Time */}\r\n                <div className=\"space-y-1.5\">\r\n                  <label htmlFor=\"checkin_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Check-in Time\r\n                  </label>\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    id=\"checkin_time\"\r\n                    name=\"checkin_time\"\r\n                    value={formData.checkin_time || ''}\r\n                    onChange={handleChange}\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                  />\r\n                  {errors.checkin_time && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      {errors.checkin_time}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push(`/admin/student-checkin-checkout/${recordId}`)} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Record\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student-checkin-checkout\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":7,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecord'. Either include it or remove the dependency array.","line":38,"column":6,"nodeType":"ArrayExpression","endLine":38,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRecord, recordId]","fix":{"range":[1338,1348],"text":"[fetchRecord, recordId]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { studentCheckInCheckOutApi, StudentCheckInCheckOut } from '@/lib/api/student-checkincheckout.api';\r\nimport { Button, ConfirmModal } from '@/components/ui';\r\nimport { Check, X, ArrowLeft, Edit, Trash, Clock } from 'lucide-react';\r\n\r\nexport default function StudentCheckinCheckoutDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const recordId = params.id as string;\r\n  \r\n  const [record, setRecord] = useState<StudentCheckInCheckOut | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const fetchRecord = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await studentCheckInCheckOutApi.getStudentCheckInCheckOutRecord(recordId);\r\n      setRecord(response.data);\r\n      setError(null);\r\n    } catch (error) {\r\n      console.error('Error fetching record:', error);\r\n      setError('Failed to load record details');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (recordId) {\r\n      fetchRecord();\r\n    }\r\n  }, [recordId]);\r\n\r\n  const handleApproveCheckout = async () => {\r\n    try {\r\n      setActionLoading('approve');\r\n      await studentCheckInCheckOutApi.approveCheckout(recordId);\r\n      await fetchRecord(); // Refresh data\r\n    } catch (error) {\r\n      console.error('Error approving checkout:', error);\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleDeclineCheckout = async () => {\r\n    try {\r\n      setActionLoading('decline');\r\n      await studentCheckInCheckOutApi.declineCheckout(recordId, 'Checkout declined by admin');\r\n      await fetchRecord(); // Refresh data\r\n    } catch (error) {\r\n      console.error('Error declining checkout:', error);\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      // TODO: Implement delete functionality with proper admin endpoint\r\n      router.push('/admin/student-checkin-checkout');\r\n    } catch (error) {\r\n      console.error('Error deleting record:', error);\r\n    }\r\n  };\r\n\r\n  const formatDateTime = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return 'Not set';\r\n    return new Date(dateTime).toLocaleString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return 'Not set';\r\n    return new Date(dateTime).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const getOriginalReason = (remarks: string | null | undefined) => {\r\n    if (!remarks) return '';\r\n    \r\n    // Handle different check-in message formats\r\n    const checkInPatterns = [\r\n      '. Check-in:', \r\n      'Check-in:', \r\n      '. Student self check-in',\r\n      'Student self check-in',\r\n      '. Checked in from detail page',\r\n      'Checked in from detail page'\r\n    ];\r\n    \r\n    let originalReason = remarks;\r\n    \r\n    // Remove check-in information based on various patterns\r\n    for (const pattern of checkInPatterns) {\r\n      if (originalReason.includes(pattern)) {\r\n        originalReason = originalReason.split(pattern)[0];\r\n        break;\r\n      }\r\n    }\r\n    \r\n    // Clean up any trailing periods or whitespace\r\n    return originalReason.replace(/\\.$/, '').trim();\r\n  };\r\n\r\n  const calculateDuration = (estimatedCheckinDate: string | null | undefined, checkoutTime: string | null | undefined) => {\r\n    if (!estimatedCheckinDate || !checkoutTime) return 'N/A';\r\n    \r\n    const estimated = new Date(estimatedCheckinDate);\r\n    const checkout = new Date(checkoutTime);\r\n    const diffMs = estimated.getTime() - checkout.getTime();\r\n    \r\n    // Handle negative duration (if checkout is after estimated checkin)\r\n    const absDiffMs = Math.abs(diffMs);\r\n    const diffDays = Math.floor(absDiffMs / (1000 * 60 * 60 * 24));\r\n    const diffHours = Math.floor((absDiffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n    \r\n    if (diffDays > 0) {\r\n      return `${diffDays} days ${diffHours} hours`;\r\n    } else {\r\n      return `${diffHours} hours`;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = () => {\r\n    if (!record) return null;\r\n    \r\n    // Check admin approval status first\r\n    if (record.status === 'approved') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-4 h-4 mr-2\" />\r\n          Approved\r\n        </span>\r\n      );\r\n    } else if (record.status === 'declined') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800\">\r\n          <X className=\"w-4 h-4 mr-2\" />\r\n          Declined\r\n        </span>\r\n      );\r\n    } else if (record.status === 'pending') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800\">\r\n          <Clock className=\"w-4 h-4 mr-2\" />\r\n          Pending Approval\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time && record.checkin_time) {\r\n      // If both checkout and checkin exist and status is not pending/approved/declined\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-4 h-4 mr-2\" />\r\n          Complete\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time) {\r\n      // Only checkout exists, waiting for checkin\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800\">\r\n          <Clock className=\"w-4 h-4 mr-2\" />\r\n          Checked Out\r\n        </span>\r\n      );\r\n    } else if (record.checkin_time) {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800\">\r\n          <Clock className=\"w-4 h-4 mr-2\" />\r\n          Checked In\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800\">\r\n          <X className=\"w-4 h-4 mr-2\" />\r\n          Draft\r\n        </span>\r\n      );\r\n    }\r\n  };\r\n\r\n  const needsApproval = () => {\r\n    // Show approval actions if status is pending\r\n    return record?.status === 'pending';\r\n  };\r\n\r\n  const isCheckInApproval = () => {\r\n    // If both checkout_time and checkin_time exist, it's a check-in approval\r\n    return record?.checkout_time && record?.checkin_time;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !record) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-red-500 mb-4\">{error || 'Record not found'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">\r\n              Check-in/Check-out Details\r\n            </h1>\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            {getStatusBadge()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Main Details */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          {/* Student Information */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Student Information</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Student Name</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.student?.student_name || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Student ID</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.student?.student_id || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Contact Number</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.student?.contact_number || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Email</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.student?.email || 'N/A'}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Location Information */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Location Information</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Block</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.block?.block_name || 'N/A'}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Room</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{record.student?.room?.room_name || 'N/A'}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Check-in/Check-out Details */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Check-in/Check-out Details</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Date</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDate(record.date)}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Check-out Time</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.checkout_time)}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Check-in Time</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.checkin_time)}</p>\r\n              </div>\r\n              {record.estimated_checkin_date && (\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">Estimated Check-in Date</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{formatDate(record.estimated_checkin_date)}</p>\r\n                </div>\r\n              )}\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Duration</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">\r\n                  {calculateDuration(record.estimated_checkin_date, record.checkout_time)}\r\n                </p>\r\n              </div>\r\n              {record.remarks && getOriginalReason(record.remarks) && (\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-medium text-gray-500\">Reason</label>\r\n                  <div className=\"mt-2 bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                    <p className=\"text-blue-800 font-medium\">{getOriginalReason(record.remarks)}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Actions Sidebar */}\r\n        <div className=\"space-y-6\">\r\n          {/* Admin Actions */}\r\n          {needsApproval() && (\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Admin Actions</h3>\r\n              <div className=\"space-y-3\">\r\n                <Button\r\n                  onClick={handleApproveCheckout}\r\n                  disabled={actionLoading === 'approve'}\r\n                  loading={actionLoading === 'approve'}\r\n                  className=\"w-full bg-green-600 text-white hover:bg-green-700 border-0\"\r\n                  icon={<Check className=\"w-4 h-4\" />}\r\n                >\r\n                  {actionLoading === 'approve' \r\n                    ? 'Approving...' \r\n                    : isCheckInApproval() \r\n                      ? 'Approve Check-in' \r\n                      : 'Approve Checkout'}\r\n                </Button>\r\n                <Button\r\n                  variant=\"danger\"\r\n                  onClick={handleDeclineCheckout}\r\n                  disabled={actionLoading === 'decline'}\r\n                  loading={actionLoading === 'decline'}\r\n                  className=\"w-full\"\r\n                  icon={<X className=\"w-4 h-4\" />}\r\n                >\r\n                  {actionLoading === 'decline' \r\n                    ? 'Declining...' \r\n                    : isCheckInApproval() \r\n                      ? 'Decline Check-in' \r\n                      : 'Decline Checkout'}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Record Actions */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Record Actions</h3>\r\n            <div className=\"space-y-3\">\r\n              <Button\r\n                variant=\"edit\"\r\n                onClick={() => router.push(`/admin/student-checkin-checkout/${record.id}/edit`)}\r\n                className=\"w-full\"\r\n                icon={<Edit className=\"w-4 h-4\" />}\r\n              >\r\n                Edit Record\r\n              </Button>\r\n              <Button\r\n                variant=\"danger\"\r\n                onClick={() => setDeleteModal(true)}\r\n                className=\"w-full\"\r\n                icon={<Trash className=\"w-4 h-4\" />}\r\n              >\r\n                Delete Record\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Metadata */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Record Information</h3>\r\n            <div className=\"space-y-3\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Created</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.created_at)}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">Last Updated</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(record.updated_at)}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal}\r\n        onCancel={() => setDeleteModal(false)}\r\n        onConfirm={handleDelete}\r\n        title=\"Delete Check-in/Check-out Record\"\r\n        message={`Are you sure you want to delete this check-in/check-out record for ${record.student?.student_name}? This action cannot be undone.`}\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        variant=\"danger\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student-checkin-checkout\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2515,2518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2515,2518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { studentCheckInCheckOutApi, StudentCheckInCheckOutFormData } from '@/lib/api/student-checkincheckout.api';\r\nimport { blockApi, Block } from '@/lib/api/index';\r\nimport { studentApi, Student } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton \r\n} from '@/components/ui';\r\n\r\nexport default function CreateStudentCheckinCheckout() {\r\n  const router = useRouter();\r\n  \r\n  const [students, setStudents] = useState<Student[]>([]);\r\n  const [blocks, setBlocks] = useState<Block[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  // Get current date for default values\r\n  const currentDate = new Date().toISOString().split('T')[0];\r\n  \r\n  const [formData, setFormData] = useState<StudentCheckInCheckOutFormData>({\r\n    student_id: '',\r\n    block_id: '',\r\n    date: currentDate,\r\n    checkin_time: '',\r\n    checkout_time: '',\r\n    remarks: '',\r\n  });\r\n\r\n  // Fetch initial data\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Fetch students and blocks\r\n        const [studentsResponse, blocksResponse] = await Promise.all([\r\n          studentApi.getStudents(),\r\n          blockApi.getBlocks()\r\n        ]);\r\n        \r\n        setStudents(studentsResponse.data || []);\r\n        setBlocks(blocksResponse.data || []);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        setErrors({ fetch: 'Failed to load required data' });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setErrors({});\r\n\r\n    try {\r\n      await studentCheckInCheckOutApi.createCheckInCheckOut(formData);\r\n      router.push('/admin/student-checkin-checkout');\r\n    } catch (error: any) {\r\n      console.error('Error creating record:', error);\r\n      if (error.validation) {\r\n        setErrors(error.validation);\r\n      } else {\r\n        setErrors({ general: error.message || 'Failed to create record' });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/student-checkin-checkout')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      <div className=\"w-full\">\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Create Check-in/Check-out Record</h1>\r\n            <p className=\"text-gray-600 mt-1\">\r\n              Add a new student check-in/check-out record\r\n            </p>\r\n          </div>\r\n\r\n          {errors.general && (\r\n            <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n              <div className=\"flex\">\r\n                <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-red-800\">{errors.general}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n              {/* Student Selection */}\r\n              <FormField\r\n                label=\"Student\"\r\n                name=\"student_id\"\r\n                type=\"select\"\r\n                value={formData.student_id}\r\n                onChange={handleChange}\r\n                required\r\n                error={errors.student_id}\r\n                options={(Array.isArray(students) ? students : []).map(student => ({\r\n                  value: student.id,\r\n                  label: `${student.student_name} (${student.student_id})`\r\n                }))}\r\n              />\r\n\r\n              {/* Block Selection */}\r\n              <FormField\r\n                label=\"Block\"\r\n                name=\"block_id\"\r\n                type=\"select\"\r\n                value={formData.block_id}\r\n                onChange={handleChange}\r\n                required\r\n                error={errors.block_id}\r\n                options={blocks.map(block => ({\r\n                  value: block.id,\r\n                  label: block.block_name\r\n                }))}\r\n              />\r\n\r\n              {/* Date */}\r\n              <FormField\r\n                label=\"Date\"\r\n                name=\"date\"\r\n                type=\"date\"\r\n                value={formData.date}\r\n                onChange={handleChange}\r\n                required\r\n                error={errors.date}\r\n              />\r\n\r\n              {/* Checkout Time */}\r\n              <div className=\"space-y-1.5\">\r\n                <label htmlFor=\"checkout_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Check-out Time\r\n                </label>\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  id=\"checkout_time\"\r\n                  name=\"checkout_time\"\r\n                  value={formData.checkout_time || ''}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                />\r\n                {errors.checkout_time && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.checkout_time}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Checkin Time */}\r\n              <div className=\"space-y-1.5\">\r\n                <label htmlFor=\"checkin_time\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                  Check-in Time\r\n                </label>\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  id=\"checkin_time\"\r\n                  name=\"checkin_time\"\r\n                  value={formData.checkin_time || ''}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                />\r\n                {errors.checkin_time && (\r\n                  <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                    <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    {errors.checkin_time}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Remarks */}\r\n            <FormField\r\n              label=\"Remarks\"\r\n              name=\"remarks\"\r\n              type=\"textarea\"\r\n              value={formData.remarks || ''}\r\n              onChange={handleChange}\r\n              error={errors.remarks}\r\n              placeholder=\"Any additional notes or comments...\"\r\n              rows={3}\r\n            />\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push('/admin/student-checkin-checkout')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Creating...\"\r\n              >\r\n                Create Record\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student-checkin-checkout\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PaginatedResponse' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowRight' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'records' is assigned a value but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'actionLoading' is assigned a value but never used.","line":39,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setActionLoading' is assigned a value but never used.","line":39,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1648,1651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1648,1651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { StudentCheckInCheckOut } from '@/lib/api/student-checkincheckout.api';\r\nimport { PaginatedResponse, API_BASE_URL, handleResponse, safeFetch } from '@/lib/api/core';\r\nimport { getAuthHeaders } from '@/lib/api/auth.api';\r\nimport { Button, ConfirmModal, ActionButtons } from '@/components/ui';\r\nimport { \r\n  Plus, \r\n  ArrowRight, \r\n  ArrowLeft, \r\n  Search,\r\n  Check,\r\n  Clock,\r\n  X,\r\n  Eye,\r\n  Edit,\r\n  Trash\r\n} from 'lucide-react';\r\n\r\nexport default function StudentCheckinCheckoutList() {\r\n  const [records, setRecords] = useState<StudentCheckInCheckOut[]>([]);\r\n  const [filteredRecords, setFilteredRecords] = useState<StudentCheckInCheckOut[]>([]);\r\n  const [allRecords, setAllRecords] = useState<StudentCheckInCheckOut[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [deleteModal, setDeleteModal] = useState<{\r\n    show: boolean;\r\n    recordId: string | null;\r\n    studentName: string;\r\n  }>({\r\n    show: false,\r\n    recordId: null,\r\n    studentName: ''\r\n  });\r\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n\r\n  const fetchRecords = async (page: number = 1) => {\r\n    try {\r\n      setLoading(true);\r\n      // Use admin endpoint to fetch student checkin-checkout records\r\n      const response = await safeFetch(`${API_BASE_URL}/student-checkincheckouts?page=${page}`, {\r\n        headers: getAuthHeaders()\r\n      });\r\n      const result: any = await handleResponse(response);\r\n      \r\n      const fetchedRecords = result.data || [];\r\n      setAllRecords(fetchedRecords);\r\n      setRecords(fetchedRecords);\r\n      setFilteredRecords(fetchedRecords);\r\n      \r\n      // Set pagination info from PaginatedResponse structure\r\n      if (result.last_page) {\r\n        setTotalPages(result.last_page);\r\n      } else {\r\n        setTotalPages(1);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching records:', error);\r\n      setRecords([]);\r\n      setFilteredRecords([]);\r\n      setAllRecords([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Live search effect\r\n  useEffect(() => {\r\n    if (!searchTerm.trim()) {\r\n      setFilteredRecords(allRecords);\r\n    } else {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      const filtered = allRecords.filter(record => \r\n        record.student?.student_name?.toLowerCase().includes(searchLower)\r\n      );\r\n      setFilteredRecords(filtered);\r\n    }\r\n  }, [searchTerm, allRecords]);\r\n\r\n  useEffect(() => {\r\n    fetchRecords(currentPage);\r\n  }, [currentPage]);\r\n\r\n  const handleSearch = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    // Live search handles filtering, no need to fetch again\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!deleteModal.recordId) return;\r\n\r\n    try {\r\n      // Use admin endpoint to delete student checkin-checkout record\r\n      const response = await safeFetch(`${API_BASE_URL}/student-checkincheckouts/${deleteModal.recordId}`, {\r\n        method: 'DELETE',\r\n        headers: getAuthHeaders()\r\n      });\r\n      await handleResponse(response);\r\n      setDeleteModal({ show: false, recordId: null, studentName: '' });\r\n      fetchRecords(currentPage);\r\n    } catch (error) {\r\n      console.error('Error deleting record:', error);\r\n    }\r\n  };\r\n\r\n  const formatTime = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleTimeString('en-US', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const calculateDuration = (record: StudentCheckInCheckOut) => {\r\n    if (!record.checkout_time) return '-';\r\n    \r\n    // Use actual check-in time if available, otherwise use estimated check-in time\r\n    const endTime = record.checkin_time || record.estimated_checkin_date;\r\n    if (!endTime) return '-';\r\n    \r\n    const checkout = new Date(record.checkout_time);\r\n    const checkInOrEstimated = new Date(endTime);\r\n    const diffMs = checkInOrEstimated.getTime() - checkout.getTime();\r\n    \r\n    // Handle negative duration (if checkout is after check-in/estimated time)\r\n    const absDiffMs = Math.abs(diffMs);\r\n    const diffDays = Math.floor(absDiffMs / (1000 * 60 * 60 * 24));\r\n    const diffHours = Math.floor((absDiffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n    const diffMinutes = Math.floor((absDiffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n    \r\n    if (diffDays > 0) {\r\n      return `${diffDays}d ${diffHours}h ${diffMinutes}m`;\r\n    } else if (diffHours > 0) {\r\n      return `${diffHours}h ${diffMinutes}m`;\r\n    } else {\r\n      return `${diffMinutes}m`;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (record: StudentCheckInCheckOut) => {\r\n    // Check admin approval status first\r\n    if (record.status === 'approved') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Approved\r\n        </span>\r\n      );\r\n    } else if (record.status === 'declined') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Declined\r\n        </span>\r\n      );\r\n    } else if (record.status === 'pending') {\r\n      // Differentiate between pending checkout and pending check-in\r\n      if (record.checkout_time && record.checkin_time) {\r\n        // Both times exist - this is a pending check-in approval\r\n        return (\r\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            Pending In\r\n          </span>\r\n        );\r\n      } else if (record.checkout_time) {\r\n        // Only checkout time exists - this is a pending checkout approval\r\n        return (\r\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            Pending Out\r\n          </span>\r\n        );\r\n      } else {\r\n        // Generic pending\r\n        return (\r\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            Pending\r\n          </span>\r\n        );\r\n      }\r\n    } else if (record.checkout_time && record.checkin_time) {\r\n      // If both checkout and checkin exist and status is not pending/approved/declined\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Complete\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time) {\r\n      // Only checkout exists\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked Out\r\n        </span>\r\n      );\r\n    } else if (record.checkin_time) {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked In\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Draft\r\n        </span>\r\n      );\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Student Check-in/Check-out</h1>\r\n          <Link href=\"/admin/student-checkin-checkout/create\">\r\n            <Button \r\n              className=\"bg-[#235999] hover:bg-[#1e4d87] text-white\"\r\n              icon={<Plus className=\"w-4 h-4\" />}\r\n            >\r\n              Add New Record\r\n            </Button>\r\n          </Link>\r\n      </div>\r\n\r\n      <div className=\"mb-6\">\r\n        <form onSubmit={handleSearch} className=\"max-w-md\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Search by student name...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg text-sm text-gray-600 placeholder:text-gray-400 focus:border-gray-400 focus:ring-0 outline-none transition-all duration-200 bg-white\"\r\n            />\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Student Name\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Block\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Checkout Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Est. Check-in Date\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Check-in Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Duration\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Status\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {filteredRecords.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={8} className=\"px-6 py-8 text-center text-gray-500\">\r\n                    {searchTerm ? `No students found matching \"${searchTerm}\"` : 'No check-in/check-out records found.'}\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                filteredRecords.map((record) => (\r\n                  <tr key={record.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">\r\n                        {record.student?.student_name || 'N/A'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">\r\n                        {record.block?.block_name || 'N/A'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"flex flex-col\">\r\n                        <div className=\"text-sm text-gray-500\">\r\n                          {formatDate(record.checkout_time)}\r\n                        </div>\r\n                        <div className=\"text-sm font-medium text-gray-900\">\r\n                          {formatTime(record.checkout_time)}\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {record.estimated_checkin_date ? formatDate(record.estimated_checkin_date) : 'Not set'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"flex flex-col\">\r\n                        <div className=\"text-sm text-gray-500\">\r\n                          {formatDate(record.checkin_time)}\r\n                        </div>\r\n                        <div className=\"text-sm font-medium text-gray-900\">\r\n                          {formatTime(record.checkin_time)}\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {calculateDuration(record)}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      {getStatusBadge(record)}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <ActionButtons\r\n                        viewUrl={`/admin/student-checkin-checkout/${record.id}`}\r\n                        editUrl={`/admin/student-checkin-checkout/${record.id}/edit`}\r\n                        onDelete={() => setDeleteModal({\r\n                          show: true,\r\n                          recordId: record.id,\r\n                          studentName: record.student?.student_name || 'Unknown'\r\n                        })}\r\n                        style=\"compact\"\r\n                      />\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Pagination */}\r\n        {totalPages > 1 && (\r\n          <div className=\"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6\">\r\n            <div className=\"flex-1 flex justify-between sm:hidden\">\r\n              <Button\r\n                variant=\"secondary\"\r\n                onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\r\n                disabled={currentPage === 1}\r\n              >\r\n                Previous\r\n              </Button>\r\n              <Button\r\n                variant=\"secondary\"\r\n                onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\r\n                disabled={currentPage === totalPages}\r\n              >\r\n                Next\r\n              </Button>\r\n            </div>\r\n            <div className=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-gray-700\">\r\n                  Showing page <span className=\"font-medium\">{currentPage}</span> of{' '}\r\n                  <span className=\"font-medium\">{totalPages}</span>\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\" aria-label=\"Pagination\">\r\n                  <Button\r\n                    variant=\"secondary\"\r\n                    onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\r\n                    disabled={currentPage === 1}\r\n                    className=\"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\"\r\n                  >\r\n                    Previous\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"secondary\"\r\n                    onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\r\n                    disabled={currentPage === totalPages}\r\n                    className=\"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\"\r\n                  >\r\n                    Next\r\n                  </Button>\r\n                </nav>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        onCancel={() => setDeleteModal({ show: false, recordId: null, studentName: '' })}\r\n        onConfirm={handleDelete}\r\n        title=\"Delete Check-in/Check-out Record\"\r\n        message={`Are you sure you want to delete the check-in/check-out record for ${deleteModal.studentName}? This action cannot be undone.`}\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        variant=\"danger\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertCircle' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StudentWithAmenities' is defined but never used.","line":6,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":88},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StudentFinancialFormData' is defined but never used.","line":6,"column":117,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":141},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4054,4057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4054,4057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4062,4065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4062,4065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'validatePhysicalCopyFile' is assigned a value but never used.","line":384,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":384,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":515,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18098,18101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18098,18101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":515,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18106,18109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18106,18109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":870,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[32759,32775],"text":"Father&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[32759,32775],"text":"Father&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[32759,32775],"text":"Father&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[32759,32775],"text":"Father&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":901,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[34223,34239],"text":"Mother&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[34223,34239],"text":"Mother&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[34223,34239],"text":"Mother&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[34223,34239],"text":"Mother&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":932,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[35662,35694],"text":"Spouse&apos;s Details (if applicable)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[35662,35694],"text":"Spouse&lsquo;s Details (if applicable)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[35662,35694],"text":"Spouse&#39;s Details (if applicable)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[35662,35694],"text":"Spouse&rsquo;s Details (if applicable)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1304,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click &quot;Add Amenity\" to add student amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click &ldquo;Add Amenity\" to add student amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click &#34;Add Amenity\" to add student amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click &rdquo;Add Amenity\" to add student amenities."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1304,"column":101,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click \"Add Amenity&quot; to add student amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click \"Add Amenity&ldquo; to add student amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click \"Add Amenity&#34; to add student amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[53959,54024],"text":"No amenities added. Click \"Add Amenity&rdquo; to add student amenities."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { AlertCircle } from 'lucide-react';\r\nimport { studentApi, studentFinancialApi, roomApi, type Room, type StudentWithAmenities, type StudentFormData, type StudentFinancialFormData, type StudentAmenity } from '@/lib/api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SingleImageUploadEdit,\r\n  MultipleImageUploadEdit,\r\n  ImageModal\r\n} from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function EditStudent() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = Array.isArray(params.id) ? params.id[0] : params.id || '';\r\n\r\n  // Form state\r\n  const [formData, setFormData] = useState<StudentFormData>({\r\n    student_name: '',\r\n    email: '',\r\n    contact_number: '',\r\n    date_of_birth: '',\r\n    district: '',\r\n    city_name: '',\r\n    ward_no: '',\r\n    street_name: '',\r\n    citizenship_no: '',\r\n    date_of_issue: '',\r\n    citizenship_issued_district: '',\r\n    educational_institution: '',\r\n    class_time: '',\r\n    level_of_study: '',\r\n    expected_stay_duration: '',\r\n    blood_group: '',\r\n    food: '',\r\n    disease: '',\r\n    father_name: '',\r\n    father_contact: '',\r\n    father_occupation: '',\r\n    mother_name: '',\r\n    mother_contact: '',\r\n    mother_occupation: '',\r\n    spouse_name: '',\r\n    spouse_contact: '',\r\n    spouse_occupation: '',\r\n    local_guardian_name: '',\r\n    local_guardian_address: '',\r\n    local_guardian_contact: '',\r\n    local_guardian_occupation: '',\r\n    local_guardian_relation: '',\r\n    room_id: '',\r\n    is_active: true,\r\n    student_id: '',\r\n    is_existing_student: false,\r\n    declaration_agreed: false,\r\n    rules_agreed: false,\r\n    verified_on: '',\r\n    amenities: []\r\n  });\r\n  \r\n  // Separate state for financial data (display only, not editable in student form)\r\n  const [financialData, setFinancialData] = useState({\r\n    admission_fee: '',\r\n    form_fee: '',\r\n    security_deposit: '',\r\n    monthly_fee: '',\r\n    joining_date: ''\r\n  });\r\n  \r\n  // Form processing state\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [rooms, setRooms] = useState<Room[]>([]);\r\n  \r\n  // Image state\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n  const [studentImage, setStudentImage] = useState<File | null>(null);\r\n  \r\n  // Document state - Multiple file uploads\r\n  const [citizenshipDocuments, setCitizenshipDocuments] = useState<File[]>([]);\r\n  const [registrationFormDocuments, setRegistrationFormDocuments] = useState<File[]>([]);\r\n  const [existingCitizenshipDoc, setExistingCitizenshipDoc] = useState<{id: number; image: string; is_primary: boolean}[]>([]);\r\n  const [existingRegistrationDoc, setExistingRegistrationDoc] = useState<{id: number; image: string; is_primary: boolean}[]>([]);\r\n  const [removedCitizenshipDocIds, setRemovedCitizenshipDocIds] = useState<number[]>([]);\r\n  const [removedRegistrationDocIds, setRemovedRegistrationDocIds] = useState<number[]>([]);\r\n  const [removedAmenityIds, setRemovedAmenityIds] = useState<number[]>([]);\r\n  \r\n  // Amenities state\r\n  const [amenities, setAmenities] = useState<StudentAmenity[]>([]);\r\n\r\n  // Fetch student data and available options\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch student data\r\n        const studentData = await studentApi.getStudent(id);\r\n        \r\n        // Get the latest financial record if available\r\n        let latestFinancial = null;\r\n        if (studentData.financials && studentData.financials.length > 0) {\r\n          latestFinancial = studentData.financials.sort((a: any, b: any) => \r\n            new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\r\n          )[0];\r\n        }\r\n        \r\n        // Format student data for the form\r\n        setFormData({\r\n          student_name: studentData.student_name || '',\r\n          email: studentData.email || '',\r\n          contact_number: studentData.contact_number || '',\r\n          date_of_birth: studentData.date_of_birth || '',\r\n          district: studentData.district || '',\r\n          city_name: studentData.city_name || '',\r\n          ward_no: studentData.ward_no || '',\r\n          street_name: studentData.street_name || '',\r\n          citizenship_no: studentData.citizenship_no || '',\r\n          date_of_issue: studentData.date_of_issue || '',\r\n          citizenship_issued_district: studentData.citizenship_issued_district || '',\r\n          educational_institution: studentData.educational_institution || '',\r\n          class_time: studentData.class_time || '',\r\n          level_of_study: studentData.level_of_study || '',\r\n          expected_stay_duration: studentData.expected_stay_duration || '',\r\n          blood_group: studentData.blood_group || '',\r\n          food: studentData.food || '',\r\n          disease: studentData.disease || '',\r\n          father_name: studentData.father_name || '',\r\n          father_contact: studentData.father_contact || '',\r\n          father_occupation: studentData.father_occupation || '',\r\n          mother_name: studentData.mother_name || '',\r\n          mother_contact: studentData.mother_contact || '',\r\n          mother_occupation: studentData.mother_occupation || '',\r\n          spouse_name: studentData.spouse_name || '',\r\n          spouse_contact: studentData.spouse_contact || '',\r\n          spouse_occupation: studentData.spouse_occupation || '',\r\n          local_guardian_name: studentData.local_guardian_name || '',\r\n          local_guardian_address: studentData.local_guardian_address || '',\r\n          local_guardian_contact: studentData.local_guardian_contact || '',\r\n          local_guardian_occupation: studentData.local_guardian_occupation || '',\r\n          local_guardian_relation: studentData.local_guardian_relation || '',\r\n          room_id: studentData.room_id || '',\r\n          is_active: studentData.is_active !== undefined ? studentData.is_active : true,\r\n          \r\n          // Administrative Details - Remove financial fields from student data\r\n          student_id: studentData.student_id || '',\r\n          is_existing_student: studentData.is_existing_student || false,\r\n          \r\n          // Verification Details\r\n          declaration_agreed: studentData.declaration_agreed || false,\r\n          rules_agreed: studentData.rules_agreed || false,\r\n          verified_on: studentData.verified_on || '',\r\n          \r\n          // Initialize amenities array\r\n          amenities: []\r\n        });\r\n        \r\n        // Set financial data separately\r\n        setFinancialData({\r\n          admission_fee: latestFinancial?.admission_fee || studentData.admission_fee || '',\r\n          form_fee: latestFinancial?.form_fee || studentData.form_fee || '',\r\n          security_deposit: latestFinancial?.security_deposit || studentData.security_deposit || '',\r\n          monthly_fee: latestFinancial?.monthly_fee || studentData.monthly_fee || '',\r\n          joining_date: latestFinancial?.joining_date || studentData.joining_date || ''\r\n        });\r\n        \r\n        // Set image previews if available\r\n        if (studentData.student_image) {\r\n          setImagePreview(getImageUrl(studentData.student_image));\r\n        }\r\n        \r\n        // Set citizenship document if available\r\n        if (studentData.student_citizenship_image) {\r\n          setExistingCitizenshipDoc([{\r\n            id: 1, // Using 1 as id since we don't have real IDs from the API\r\n            image: studentData.student_citizenship_image,\r\n            is_primary: true\r\n          }]);\r\n        }\r\n        \r\n        // Set registration form if available\r\n        if (studentData.registration_form_image) {\r\n          setExistingRegistrationDoc([{\r\n            id: 1, // Using 1 as id since we don't have real IDs from the API\r\n            image: studentData.registration_form_image,\r\n            is_primary: true\r\n          }]);\r\n        }\r\n        \r\n        // Set amenities from student data\r\n        if (studentData.amenities && studentData.amenities.length > 0) {\r\n          setAmenities(studentData.amenities);\r\n        }\r\n        \r\n        // Fetch available rooms\r\n        const roomsData = await roomApi.getRooms();\r\n        setRooms(roomsData.data || []);\r\n\r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        setErrors({\r\n          submit: error instanceof ApiError ? error.message : 'Failed to load student data'\r\n        });\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [id]);\r\n\r\n  // Handle form field changes\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value, type } = e.target;\r\n\r\n    if (type === 'checkbox') {\r\n      const checkbox = e.target as HTMLInputElement;\r\n      setFormData({\r\n        ...formData,\r\n        [name]: checkbox.checked\r\n      });\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Process student image file\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_image: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (2MB max)\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_image: 'File size must be less than 2MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setStudentImage(file);\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.student_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_image: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Remove student image\r\n  const removeImage = () => {\r\n    setStudentImage(null);\r\n    setImagePreview(null);\r\n  };\r\n  \r\n  // Validate citizenship document file\r\n  const validateCitizenshipFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_citizenship_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_citizenship_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.student_citizenship_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_citizenship_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add citizenship documents\r\n  const addCitizenshipDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateCitizenshipFile(file));\r\n    if (validFiles.length > 0) {\r\n      setCitizenshipDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove citizenship document\r\n  const removeCitizenshipImage = (index: number) => {\r\n    setCitizenshipDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n  \r\n  // Validate registration form file\r\n  const validateRegistrationFormFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        registration_form_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        registration_form_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.registration_form_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        registration_form_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add registration form documents\r\n  const addRegistrationFormDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateRegistrationFormFile(file));\r\n    if (validFiles.length > 0) {\r\n      setRegistrationFormDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove registration form\r\n  const removeRegistrationFormImage = (index: number) => {\r\n    setRegistrationFormDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n  \r\n  // Validate physical copy file\r\n  const validatePhysicalCopyFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        physical_copy_images: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        physical_copy_images: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.physical_copy_images) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        physical_copy_images: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Handle amenity changes\r\n  const handleAmenityChange = (index: number, field: keyof StudentAmenity, value: string) => {\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities[index] = {\r\n      ...updatedAmenities[index],\r\n      [field]: value\r\n    };\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Add new amenity field\r\n  const addAmenity = () => {\r\n    setAmenities([...amenities, { name: '', description: '' }]);\r\n  };\r\n\r\n  // Remove amenity field\r\n  const removeAmenity = (index: number) => {\r\n    const amenityToRemove = amenities[index];\r\n    \r\n    // If the amenity has an ID (existing amenity), track it for deletion\r\n    if (amenityToRemove.id) {\r\n      const amenityId = typeof amenityToRemove.id === 'string' ? parseInt(amenityToRemove.id) : amenityToRemove.id;\r\n      if (!isNaN(amenityId)) {\r\n        setRemovedAmenityIds(prev => [...prev, amenityId]);\r\n      }\r\n    }\r\n    \r\n    // Remove from local state\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities.splice(index, 1);\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Form validation\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.student_name.trim()) {\r\n      newErrors.student_name = 'Student name is required';\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      newErrors.email = 'Email address is required';\r\n    } else if (!/\\S+@\\S+\\.\\S+/.test(formData.email)) {\r\n      newErrors.email = 'Please enter a valid email address';\r\n    }\r\n\r\n    if (!formData.contact_number.trim()) {\r\n      newErrors.contact_number = 'Contact number is required';\r\n    } else if (!/^\\d{10}$/.test(formData.contact_number.trim())) {\r\n      newErrors.contact_number = 'Please enter a valid 10-digit phone number';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  // Form submission\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validate form\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    // Filter out empty amenities\r\n    const filteredAmenities = amenities.filter(item => item.name.trim() !== '');\r\n\r\n    try {\r\n      // Prepare the form data with all files (excluding monthly_fee)\r\n      const studentFormData = {\r\n        ...formData,\r\n        amenities: filteredAmenities,\r\n        removedAmenityIds: removedAmenityIds,\r\n        removedCitizenshipDocIds: removedCitizenshipDocIds,\r\n        removedRegistrationDocIds: removedRegistrationDocIds,\r\n        student_image: studentImage,\r\n        // For now, we use the first file of multiple uploads as the API only accepts one file\r\n        // In the future, the API could be updated to handle multiple files\r\n        student_citizenship_image: citizenshipDocuments.length > 0 ? citizenshipDocuments[0] : null,\r\n        registration_form_image: registrationFormDocuments.length > 0 ? registrationFormDocuments[0] : null,\r\n      };\r\n      \r\n      // Debug logging\r\n      console.log('Registration form documents count:', registrationFormDocuments.length);\r\n      console.log('Registration form document:', registrationFormDocuments.length > 0 ? registrationFormDocuments[0] : 'None');\r\n      console.log('Removed registration doc IDs:', removedRegistrationDocIds);\r\n      \r\n      // Submit student form data (without financial fields)\r\n      await studentApi.updateStudent(id, studentFormData);\r\n\r\n      // Handle financial data separately if monthly_fee was changed\r\n      if (financialData.monthly_fee) {\r\n        // Get the student's latest financial record to update\r\n        const studentData = await studentApi.getStudent(id);\r\n        if (studentData.financials && studentData.financials.length > 0) {\r\n          // Update the latest financial record\r\n          const latestFinancial = studentData.financials.sort((a: any, b: any) => \r\n            new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\r\n          )[0];\r\n          \r\n          if (latestFinancial.id) {\r\n            await studentFinancialApi.updateStudentFinancial(latestFinancial.id, {\r\n              monthly_fee: financialData.monthly_fee,\r\n              // Keep existing values for required fields\r\n              admission_fee: latestFinancial.admission_fee,\r\n              form_fee: latestFinancial.form_fee,\r\n              security_deposit: latestFinancial.security_deposit,\r\n            });\r\n          }\r\n        } else {\r\n          // Create new financial record if none exists\r\n          await studentFinancialApi.createStudentFinancial({\r\n            student_id: id,\r\n            monthly_fee: financialData.monthly_fee,\r\n            payment_date: new Date().toISOString().split('T')[0],\r\n            amount: financialData.monthly_fee || '0'\r\n          });\r\n        }\r\n      }\r\n\r\n      // Redirect to student details page on success\r\n      router.push(`/admin/student/${id}`);\r\n    } catch (error) {\r\n      console.error('Error updating student:', error);\r\n      \r\n      if (error instanceof ApiError && error.validation) {\r\n        // Handle validation errors\r\n        const validationErrors: Record<string, string> = {};\r\n        Object.entries(error.validation).forEach(([field, messages]) => {\r\n          validationErrors[field] = Array.isArray(messages) ? messages[0] : messages as string;\r\n        });\r\n        setErrors(validationErrors);\r\n      } else {\r\n        setErrors({\r\n          submit: error instanceof ApiError \r\n            ? `Failed to update student: ${error.message}` \r\n            : 'Failed to update student. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Student</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">Loading student data...</p>\r\n          </div>\r\n          <div className=\"animate-pulse\">\r\n            <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-1/2 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-3/4 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-full mb-4\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Student</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Update student information</p>\r\n        </div>\r\n\r\n        {/* Error Alert */}\r\n        {errors.submit && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">{errors.submit}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n          <div className=\"p-6\">\r\n            {/* Basic Information */}\r\n            <div className=\"mb-8\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Basic Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Student Name */}\r\n                <FormField\r\n                  name=\"student_name\"\r\n                  label=\"Student Name\"\r\n                  required\r\n                  value={formData.student_name}\r\n                  onChange={handleInputChange}\r\n                  error={errors.student_name}\r\n                  placeholder=\"Enter full name\"\r\n                />\r\n                \r\n                {/* Email */}\r\n                <FormField\r\n                  name=\"email\"\r\n                  label=\"Email Address\"\r\n                  required\r\n                  type=\"email\"\r\n                  value={formData.email}\r\n                  onChange={handleInputChange}\r\n                  error={errors.email}\r\n                  placeholder=\"Enter email address\"\r\n                />\r\n                \r\n                {/* Contact Number */}\r\n                <FormField\r\n                  name=\"contact_number\"\r\n                  label=\"Contact Number\"\r\n                  required\r\n                  value={formData.contact_number}\r\n                  onChange={handleInputChange}\r\n                  error={errors.contact_number}\r\n                  placeholder=\"Enter 10-digit phone number\"\r\n                />\r\n                \r\n                {/* Date of Birth */}\r\n                <FormField\r\n                  name=\"date_of_birth\"\r\n                  label=\"Date of Birth\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_birth || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_birth}\r\n                  placeholder=\"YYYY-MM-DD\"\r\n                />\r\n                \r\n                {/* Blood Group */}\r\n                <FormField\r\n                  name=\"blood_group\"\r\n                  label=\"Blood Group\"\r\n                  type=\"select\"\r\n                  value={formData.blood_group || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.blood_group}\r\n                  options={[\r\n                    { value: 'A+', label: 'A+' },\r\n                    { value: 'A-', label: 'A-' },\r\n                    { value: 'B+', label: 'B+' },\r\n                    { value: 'B-', label: 'B-' },\r\n                    { value: 'AB+', label: 'AB+' },\r\n                    { value: 'AB-', label: 'AB-' },\r\n                    { value: 'O+', label: 'O+' },\r\n                    { value: 'O-', label: 'O-' },\r\n                  ]}\r\n                />\r\n\r\n                {/* Room Selection */}\r\n                <FormField\r\n                  name=\"room_id\"\r\n                  label=\"Room\"\r\n                  type=\"select\"\r\n                  value={formData.room_id || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.room_id}\r\n                  options={rooms.map(room => ({ value: room.id, label: room.room_name }))}\r\n                />\r\n                \r\n                {/* Active Status */}\r\n                <div className=\"flex items-center mt-4\">\r\n                  <input\r\n                    id=\"is_active\"\r\n                    name=\"is_active\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.is_active || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"is_active\" className=\"ml-2 text-sm font-semibold text-neutral-900\">Active Student</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Address Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Address Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* District */}\r\n                <FormField\r\n                  name=\"district\"\r\n                  label=\"District\"\r\n                  value={formData.district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.district}\r\n                  placeholder=\"Enter district name\"\r\n                />\r\n                \r\n                {/* City Name */}\r\n                <FormField\r\n                  name=\"city_name\"\r\n                  label=\"City\"\r\n                  value={formData.city_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.city_name}\r\n                  placeholder=\"Enter city name\"\r\n                />\r\n                \r\n                {/* Ward No */}\r\n                <FormField\r\n                  name=\"ward_no\"\r\n                  label=\"Ward Number\"\r\n                  value={formData.ward_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.ward_no}\r\n                  placeholder=\"Enter ward number\"\r\n                />\r\n                \r\n                {/* Street Name */}\r\n                <FormField\r\n                  name=\"street_name\"\r\n                  label=\"Street Name\"\r\n                  value={formData.street_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.street_name}\r\n                  placeholder=\"Enter street name\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Citizenship Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Citizenship Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Citizenship No */}\r\n                <FormField\r\n                  name=\"citizenship_no\"\r\n                  label=\"Citizenship Number\"\r\n                  value={formData.citizenship_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_no}\r\n                  placeholder=\"Enter citizenship number\"\r\n                />\r\n                \r\n                {/* Date of Issue */}\r\n                <FormField\r\n                  name=\"date_of_issue\"\r\n                  label=\"Date of Issue\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_issue || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_issue}\r\n                />\r\n                \r\n                {/* Citizenship Issued District */}\r\n                <FormField\r\n                  name=\"citizenship_issued_district\"\r\n                  label=\"Issued District\"\r\n                  value={formData.citizenship_issued_district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_issued_district}\r\n                  placeholder=\"Enter district where citizenship was issued\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Educational Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Educational Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Educational Institution */}\r\n                <FormField\r\n                  name=\"educational_institution\"\r\n                  label=\"Educational Institution\"\r\n                  value={formData.educational_institution || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.educational_institution}\r\n                  placeholder=\"Enter school/college name\"\r\n                />\r\n                \r\n                {/* Class Time */}\r\n                <FormField\r\n                  name=\"class_time\"\r\n                  label=\"Class Time\"\r\n                  value={formData.class_time || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.class_time}\r\n                  placeholder=\"e.g., Morning, Evening\"\r\n                />\r\n                \r\n                {/* Level of Study */}\r\n                <FormField\r\n                  name=\"level_of_study\"\r\n                  label=\"Level of Study\"\r\n                  value={formData.level_of_study || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.level_of_study}\r\n                  placeholder=\"e.g., Bachelors, Masters\"\r\n                />\r\n                \r\n                {/* Expected Stay Duration */}\r\n                <FormField\r\n                  name=\"expected_stay_duration\"\r\n                  label=\"Expected Stay Duration\"\r\n                  value={formData.expected_stay_duration || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.expected_stay_duration}\r\n                  placeholder=\"e.g., 6 months, 2 years\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Health Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Health Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Food Preference */}\r\n                <FormField\r\n                  name=\"food\"\r\n                  label=\"Food Preference\"\r\n                  type=\"select\"\r\n                  value={formData.food || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.food}\r\n                  options={[\r\n                    { value: 'vegetarian', label: 'Vegetarian' },\r\n                    { value: 'non-vegetarian', label: 'Non-vegetarian' },\r\n                    { value: 'egg-only', label: 'Egg Only' }\r\n                  ]}\r\n                />\r\n                \r\n                {/* Disease/Health Issues */}\r\n                <div className=\"md:col-span-2\">\r\n                  <FormField\r\n                    name=\"disease\"\r\n                    label=\"Disease or Health Issues (if any)\"\r\n                    type=\"textarea\"\r\n                    value={formData.disease || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.disease}\r\n                    placeholder=\"Enter any health conditions or allergies\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Family Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Family Information</h2>\r\n              <div className=\"grid grid-cols-1 gap-4\">\r\n                {/* Father's Information */}\r\n                <div className=\"border-b border-gray-100 pb-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Father's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"father_name\"\r\n                      label=\"Father's Name\"\r\n                      value={formData.father_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_name}\r\n                      placeholder=\"Enter father's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_contact\"\r\n                      label=\"Father's Contact\"\r\n                      value={formData.father_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_contact}\r\n                      placeholder=\"Enter father's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_occupation\"\r\n                      label=\"Father's Occupation\"\r\n                      value={formData.father_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_occupation}\r\n                      placeholder=\"Enter father's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Mother's Information */}\r\n                <div className=\"border-b border-gray-100 py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Mother's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"mother_name\"\r\n                      label=\"Mother's Name\"\r\n                      value={formData.mother_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_name}\r\n                      placeholder=\"Enter mother's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_contact\"\r\n                      label=\"Mother's Contact\"\r\n                      value={formData.mother_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_contact}\r\n                      placeholder=\"Enter mother's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_occupation\"\r\n                      label=\"Mother's Occupation\"\r\n                      value={formData.mother_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_occupation}\r\n                      placeholder=\"Enter mother's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Spouse's Information */}\r\n                <div className=\"py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Spouse's Details (if applicable)</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"spouse_name\"\r\n                      label=\"Spouse's Name\"\r\n                      value={formData.spouse_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_name}\r\n                      placeholder=\"Enter spouse's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_contact\"\r\n                      label=\"Spouse's Contact\"\r\n                      value={formData.spouse_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_contact}\r\n                      placeholder=\"Enter spouse's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_occupation\"\r\n                      label=\"Spouse's Occupation\"\r\n                      value={formData.spouse_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_occupation}\r\n                      placeholder=\"Enter spouse's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Guardian Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Local Guardian Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <FormField\r\n                  name=\"local_guardian_name\"\r\n                  label=\"Guardian's Name\"\r\n                  value={formData.local_guardian_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_name}\r\n                  placeholder=\"Enter local guardian's name\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_relation\"\r\n                  label=\"Relation with Student\"\r\n                  value={formData.local_guardian_relation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_relation}\r\n                  placeholder=\"e.g., Uncle, Aunt\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_contact\"\r\n                  label=\"Guardian's Contact\"\r\n                  value={formData.local_guardian_contact || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_contact}\r\n                  placeholder=\"Enter guardian's phone number\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_occupation\"\r\n                  label=\"Guardian's Occupation\"\r\n                  value={formData.local_guardian_occupation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_occupation}\r\n                  placeholder=\"Enter guardian's occupation\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_address\"\r\n                  label=\"Guardian's Address\"\r\n                  value={formData.local_guardian_address || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_address}\r\n                  placeholder=\"Enter guardian's address\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Document Uploads */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Document Uploads</h2>\r\n              \r\n              {/* Student Photo */}\r\n              <div className=\"mb-6\">\r\n                <div className=\"w-full\">\r\n                  <SingleImageUploadEdit\r\n                    imagePreview={imagePreview}\r\n                    onFileSelect={(file) => processFile(file)}\r\n                    onRemove={removeImage}\r\n                    error={errors.student_image}\r\n                    label=\"Student Photo\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Citizenship Documents */}\r\n              <div className=\"mb-6 pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Citizenship Documents</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadEdit\r\n                    images={citizenshipDocuments}\r\n                    existingImages={existingCitizenshipDoc}\r\n                    removedImageIds={removedCitizenshipDocIds}\r\n                    onAddImages={addCitizenshipDocuments}\r\n                    onRemoveImage={removeCitizenshipImage}\r\n                    onRemoveExistingImage={(id) => {\r\n                      setRemovedCitizenshipDocIds(prev => [...prev, id]);\r\n                      setExistingCitizenshipDoc(prev => prev.filter(img => img.id !== id));\r\n                    }}\r\n                    error={errors.student_citizenship_image}\r\n                    label=\"Citizenship Documents\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Registration Forms */}\r\n              <div className=\"pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Registration Forms</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadEdit\r\n                    images={registrationFormDocuments}\r\n                    existingImages={existingRegistrationDoc}\r\n                    removedImageIds={removedRegistrationDocIds}\r\n                    onAddImages={addRegistrationFormDocuments}\r\n                    onRemoveImage={removeRegistrationFormImage}\r\n                    onRemoveExistingImage={(id) => {\r\n                      setRemovedRegistrationDocIds(prev => [...prev, id]);\r\n                      setExistingRegistrationDoc(prev => prev.filter(img => img.id !== id));\r\n                    }}\r\n                    error={errors.registration_form_image}\r\n                    label=\"Registration Forms\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Administrative Details */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Administrative Details</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Student ID */}\r\n                <FormField\r\n                  name=\"student_id\"\r\n                  label=\"Student ID\"\r\n                  value={formData.student_id || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.student_id}\r\n                />\r\n                \r\n                <div className=\"flex items-center mt-4\">\r\n                  <input\r\n                    id=\"is_existing_student\"\r\n                    name=\"is_existing_student\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.is_existing_student || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"is_existing_student\" className=\"ml-2 text-sm font-semibold text-neutral-900\">\r\n                    This is an existing student (staying before system implementation)\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Financial Details */}\r\n              <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Admission Fee */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Admission Fee</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"admission_fee\"\r\n                      value={financialData.admission_fee || ''}\r\n                      disabled\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-400 bg-neutral-50 cursor-not-allowed\"\r\n                      title=\"Financial data is managed separately. Contact administrator to modify.\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"text-xs text-neutral-500 mt-1\">\r\n                    Financial data is read-only. Contact administrator to modify.\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Form Fee */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Form Fee</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"form_fee\"\r\n                      value={financialData.form_fee || ''}\r\n                      disabled\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-400 bg-neutral-50 cursor-not-allowed\"\r\n                      title=\"Financial data is managed separately. Contact administrator to modify.\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"text-xs text-neutral-500 mt-1\">\r\n                    Financial data is read-only. Contact administrator to modify.\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Security Deposit */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Security Deposit</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"security_deposit\"\r\n                      value={financialData.security_deposit || ''}\r\n                      disabled\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-400 bg-neutral-50 cursor-not-allowed\"\r\n                      title=\"Financial data is managed separately. Contact administrator to modify.\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"text-xs text-neutral-500 mt-1\">\r\n                    Financial data is read-only. Contact administrator to modify.\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Monthly Hostel Fee */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Monthly Hostel Fee</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"monthly_fee\"\r\n                      value={financialData.monthly_fee || ''}\r\n                      onChange={(e) => setFinancialData(prev => ({ ...prev, monthly_fee: e.target.value }))}\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-900 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                      placeholder=\"Enter monthly fee amount\"\r\n                    />\r\n                  </div>\r\n                  {errors.monthly_fee && (\r\n                    <div className=\"text-xs text-red-500 mt-1\">\r\n                      {errors.monthly_fee}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Joining Date */}\r\n              <div className=\"mt-4\">\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Joining Date</label>\r\n                  <input\r\n                    type=\"date\"\r\n                    name=\"joining_date\"\r\n                    value={financialData.joining_date || ''}\r\n                    disabled\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-400 bg-neutral-50 cursor-not-allowed\"\r\n                    title=\"Financial data is managed separately. Contact administrator to modify.\"\r\n                  />\r\n                  <div className=\"text-xs text-neutral-500 mt-1\">\r\n                    Financial data is read-only. Contact administrator to modify.\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Verification */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Verification</h2>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"declaration_agreed\"\r\n                    name=\"declaration_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.declaration_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"declaration_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I hereby declare that all the information provided above is true and correct to the best of my knowledge.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"rules_agreed\"\r\n                    name=\"rules_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.rules_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"rules_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I agree to abide by all the rules and regulations of the hostel.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"mt-4\">\r\n                  <FormField\r\n                    name=\"verified_on\"\r\n                    label=\"Verification Date (YYYY/MM/DD) AD\"\r\n                    type=\"date\"\r\n                    value={formData.verified_on || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.verified_on}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Amenities */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900\">Student Amenities</h2>\r\n                <Button \r\n                  type=\"button\" \r\n                  onClick={addAmenity}\r\n                  variant=\"secondary\"\r\n                  size=\"sm\"\r\n                >\r\n                  Add Amenity\r\n                </Button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-4\">\r\n                {amenities.length > 0 ? (\r\n                  amenities.map((amenity, index) => (\r\n                    <div key={index} className=\"flex space-x-4 items-start\">\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_name_${index}`}\r\n                          label={`Amenity ${index + 1} Name`}\r\n                          placeholder=\"Enter amenity name\"\r\n                          value={amenity.name || ''}\r\n                          onChange={(e) => handleAmenityChange(index, 'name', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_description_${index}`}\r\n                          label=\"Description (Optional)\"\r\n                          placeholder=\"Enter description\"\r\n                          value={amenity.description || ''}\r\n                          onChange={(e) => handleAmenityChange(index, 'description', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"pt-8\">\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => removeAmenity(index)}\r\n                          className=\"text-red-600 hover:text-red-800\"\r\n                        >\r\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                            <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                          </svg>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                ) : (\r\n                  <p className=\"text-gray-500 text-sm italic\">No amenities added. Click \"Add Amenity\" to add student amenities.</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Form Actions */}\r\n          <div className=\"px-6 py-4 bg-gray-50 flex justify-end space-x-4\">\r\n            <CancelButton onClick={() => router.push(`/admin/student/${id}`)} />\r\n            <SubmitButton \r\n              loading={isSubmitting} \r\n              loadingText=\"Updating...\"\r\n            >\r\n              Update Student\r\n            </SubmitButton>\r\n          </div>\r\n        </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ActionButtons' is defined but never used.","line":7,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":46},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":376,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[19697,19710],"text":"Father&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[19697,19710],"text":"Father&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[19697,19710],"text":"Father&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[19697,19710],"text":"Father&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":382,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20040,20056],"text":"Father&apos;s Contact"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20040,20056],"text":"Father&lsquo;s Contact"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20040,20056],"text":"Father&#39;s Contact"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20040,20056],"text":"Father&rsquo;s Contact"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":388,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20392,20411],"text":"Father&apos;s Occupation"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20392,20411],"text":"Father&lsquo;s Occupation"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20392,20411],"text":"Father&#39;s Occupation"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20392,20411],"text":"Father&rsquo;s Occupation"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":394,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20744,20757],"text":"Mother&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20744,20757],"text":"Mother&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20744,20757],"text":"Mother&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20744,20757],"text":"Mother&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":400,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21087,21103],"text":"Mother&apos;s Contact"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21087,21103],"text":"Mother&lsquo;s Contact"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21087,21103],"text":"Mother&#39;s Contact"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21087,21103],"text":"Mother&rsquo;s Contact"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":406,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21439,21458],"text":"Mother&apos;s Occupation"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21439,21458],"text":"Mother&lsquo;s Occupation"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21439,21458],"text":"Mother&#39;s Occupation"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21439,21458],"text":"Mother&rsquo;s Occupation"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":420,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22282,22295],"text":"Spouse&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22282,22295],"text":"Spouse&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22282,22295],"text":"Spouse&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22282,22295],"text":"Spouse&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":426,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22637,22653],"text":"Spouse&apos;s Contact"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22637,22653],"text":"Spouse&lsquo;s Contact"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22637,22653],"text":"Spouse&#39;s Contact"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22637,22653],"text":"Spouse&rsquo;s Contact"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":432,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[23001,23020],"text":"Spouse&apos;s Occupation"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[23001,23020],"text":"Spouse&lsquo;s Occupation"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[23001,23020],"text":"Spouse&#39;s Occupation"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[23001,23020],"text":"Spouse&rsquo;s Occupation"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":447,"column":83,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[23902,23917],"text":"Guardian&apos;s Name"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[23902,23917],"text":"Guardian&lsquo;s Name"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[23902,23917],"text":"Guardian&#39;s Name"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[23902,23917],"text":"Guardian&rsquo;s Name"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":535,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29180,29183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29180,29183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":535,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29188,29191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29188,29191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":159,"column":19,"nodeType":"JSXOpeningElement","endLine":163,"endColumn":21,"suppressions":[{"kind":"directive","justification":"server-hosted profile image; native <img> is acceptable for this preview"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":687,"column":23,"nodeType":"JSXOpeningElement","endLine":692,"endColumn":25,"suppressions":[{"kind":"directive","justification":"server-hosted student photo preview; keep native <img> for click-to-open behavior"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":705,"column":23,"nodeType":"JSXOpeningElement","endLine":710,"endColumn":25,"suppressions":[{"kind":"directive","justification":"server-hosted citizenship document preview; native <img> keeps click-preview and layout predictable"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":723,"column":23,"nodeType":"JSXOpeningElement","endLine":728,"endColumn":25,"suppressions":[{"kind":"directive","justification":"server-hosted registration form preview; native <img> keeps simple click preview behavior"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":741,"column":23,"nodeType":"JSXOpeningElement","endLine":746,"endColumn":25,"suppressions":[{"kind":"directive","justification":"server-hosted financial document preview; native <img> keeps simple click preview behavior"}]}],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { studentApi, type StudentWithAmenities } from '@/lib/api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { Button, TableSkeleton, ActionButtons, ConfirmModal, ImageModal } from '@/components/ui';\r\nimport { formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function StudentDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const id = Array.isArray(params.id) ? params.id[0] : params.id || '';\r\n\r\n  const [student, setStudent] = useState<StudentWithAmenities | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  useEffect(() => {\r\n    const fetchStudent = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch student data from API\r\n        const data = await studentApi.getStudent(id);\r\n        \r\n        setStudent(data);\r\n      } catch (error) {\r\n        console.error('Error fetching student details:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load student details: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load student details. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchStudent();\r\n  }, [id]);\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      \r\n      // Delete student using API\r\n      await studentApi.deleteStudent(id);\r\n      \r\n      // Redirect to students list\r\n      router.push('/admin/student');\r\n    } catch (error) {\r\n      console.error('Error deleting student:', error);\r\n      setError('Failed to delete student record.');\r\n      setShowDeleteModal(false);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleImageClick = (imageUrl: string, alt: string) => {\r\n    setSelectedImage({ url: imageUrl, alt });\r\n    setImageModalOpen(true);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Student Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading student data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/student')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Students List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!student) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-amber-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-amber-800\">Student record not found.</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/student')}\r\n            className=\"mt-3 bg-amber-100 hover:bg-amber-200 text-amber-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Students List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Header with Actions */}\r\n        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n          <div>\r\n            <h1 className=\"text-xl font-semibold text-gray-900\">Student Details</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">View complete student information</p>\r\n          </div>\r\n          <div className=\"mt-4 md:mt-0 flex space-x-2\">\r\n            <Button\r\n              onClick={() => router.push(`/admin/student/${student.id}/edit`)}\r\n              variant=\"primary\"\r\n            >\r\n              Edit Student\r\n            </Button>\r\n            <Button\r\n              onClick={() => setShowDeleteModal(true)}\r\n              disabled={isDeleting}\r\n              variant=\"danger\"\r\n              loading={isDeleting}\r\n            >\r\n              {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Student Details Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-6\">\r\n          <div className=\"p-6\">\r\n            {/* Student Profile Header */}\r\n            <div className=\"flex flex-col md:flex-row items-center md:items-start mb-6 pb-6 border-b border-gray-200\">\r\n              <div className=\"w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-4xl font-medium overflow-hidden mb-4 md:mb-0 md:mr-6\">\r\n                {student.student_image ? (\r\n                  // eslint-disable-next-line @next/next/no-img-element -- server-hosted profile image; native <img> is acceptable for this preview\r\n                  <img \r\n                    src={getImageUrl(student.student_image)} \r\n                    alt={student.student_name}\r\n                    className=\"w-full h-full object-cover\" \r\n                  />\r\n                ) : (\r\n                  student.student_name.charAt(0).toUpperCase()\r\n                )}\r\n              </div>\r\n              <div className=\"text-center md:text-left flex-1\">\r\n                <div className=\"flex flex-col md:flex-row md:items-center md:justify-between\">\r\n                  <h2 className=\"text-2xl font-semibold text-gray-900\">{student.student_name}</h2>\r\n                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-2 md:mt-0 ${\r\n                    student.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\r\n                  }`}>\r\n                    {student.is_active ? 'Active' : 'Inactive'}\r\n                  </span>\r\n                </div>\r\n                \r\n                <div className=\"mt-2 text-gray-600 grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                  <div className=\"flex items-center\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2\" />\r\n                    </svg>\r\n                    ID: {student.student_id || 'Not assigned'}\r\n                  </div>\r\n                  <div className=\"flex items-center\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n                    </svg>\r\n                    {student.email}\r\n                  </div>\r\n                  <div className=\"flex items-center\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\" />\r\n                    </svg>\r\n                    {student.contact_number}\r\n                  </div>\r\n                  {student.room ? (\r\n                    <div className=\"flex items-center\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 text-gray-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\r\n                      </svg>\r\n                      Room {student.room.room_name} ({student.room.block?.block_name || 'Unknown Block'})\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"flex items-center text-amber-600\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      No room assigned\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Student Information Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6\">\r\n              {/* Personal Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Personal Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {student.student_id && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Student ID #</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.student_id}</dd>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"py-2 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-600\">Full Name</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{student.student_name}</dd>\r\n                  </div>\r\n                  {student.date_of_birth && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Date of Birth</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(student.date_of_birth)}</dd>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Contact Number</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{student.contact_number}</dd>\r\n                  </div>\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Email</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{student.email}</dd>\r\n                  </div>\r\n                  {student.blood_group && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Blood Group</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.blood_group}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.food && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Food Preference</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.food}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.disease && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Medical Conditions</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.disease}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n              \r\n              {/* Address Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Address Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {student.district && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">District</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.district}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.city_name && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">City</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.city_name}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.ward_no && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Ward No.</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.ward_no}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.street_name && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Street</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.street_name}</dd>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Show full address if all components are present */}\r\n                  {student.street_name && student.ward_no && student.city_name && student.district && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Full Address</dt>\r\n                      <dd className=\"text-sm text-gray-900 text-right\">\r\n                        {`${student.street_name}, Ward ${student.ward_no}, ${student.city_name}, ${student.district}`}\r\n                      </dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              {/* Citizenship & Identity */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Citizenship & Identity</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {student.citizenship_no && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Citizenship No.</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.citizenship_no}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.date_of_issue && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Date of Issue</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(student.date_of_issue)}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.citizenship_issued_district && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Issued District</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.citizenship_issued_district}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.student_citizenship_image && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Citizenship Document</dt>\r\n                      <dd className=\"text-sm text-blue-600 cursor-pointer hover:underline\" onClick={() => handleImageClick(getImageUrl(student.student_citizenship_image!), 'Citizenship Document')}>View Document</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              {/* Education Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Education Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {student.educational_institution && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Institution</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.educational_institution}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.level_of_study && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Level of Study</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.level_of_study}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.class_time && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Class Time</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.class_time}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.expected_stay_duration && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Expected Stay</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.expected_stay_duration}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n              \r\n              {/* Family Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Family Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {student.father_name && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Father's Name</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.father_name}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.father_contact && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Father's Contact</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.father_contact}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.father_occupation && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Father's Occupation</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.father_occupation}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.mother_name && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Mother's Name</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.mother_name}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.mother_contact && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Mother's Contact</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.mother_contact}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.mother_occupation && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Mother's Occupation</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.mother_occupation}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              {/* Spouse Information (if available) */}\r\n              {(student.spouse_name || student.spouse_contact || student.spouse_occupation) && (\r\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                  <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Spouse Information</h3>\r\n                  <dl className=\"divide-y divide-gray-100\">\r\n                    {student.spouse_name && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Spouse's Name</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.spouse_name}</dd>\r\n                      </div>\r\n                    )}\r\n                    {student.spouse_contact && (\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Spouse's Contact</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.spouse_contact}</dd>\r\n                      </div>\r\n                    )}\r\n                    {student.spouse_occupation && (\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Spouse's Occupation</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.spouse_occupation}</dd>\r\n                      </div>\r\n                    )}\r\n                  </dl>\r\n                </div>\r\n              )}\r\n\r\n              {/* Local Guardian Information */}\r\n              {(student.local_guardian_name || student.local_guardian_contact || student.local_guardian_address) && (\r\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                  <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Local Guardian Information</h3>\r\n                  <dl className=\"divide-y divide-gray-100\">\r\n                    {student.local_guardian_name && (\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Guardian's Name</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.local_guardian_name}</dd>\r\n                      </div>\r\n                    )}\r\n                    {student.local_guardian_relation && (\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Relation</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.local_guardian_relation}</dd>\r\n                      </div>\r\n                    )}\r\n                    {student.local_guardian_contact && (\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Contact</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.local_guardian_contact}</dd>\r\n                      </div>\r\n                    )}\r\n                    {student.local_guardian_address && (\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Address</dt>\r\n                        <dd className=\"text-sm text-gray-900 text-right\">{student.local_guardian_address}</dd>\r\n                      </div>\r\n                    )}\r\n                    {student.local_guardian_occupation && (\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Occupation</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.local_guardian_occupation}</dd>\r\n                      </div>\r\n                    )}\r\n                  </dl>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Room Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Room Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {student.room ? (\r\n                    <>\r\n                      <div className=\"py-2 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-600\">Room Name</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.room.room_name}</dd>\r\n                      </div>\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Block</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.room.block?.block_name || 'N/A'}</dd>\r\n                      </div>\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Room Type</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.room.room_type}</dd>\r\n                      </div>\r\n                      <div className=\"py-3 flex justify-between\">\r\n                        <dt className=\"text-sm font-medium text-gray-500\">Room Capacity</dt>\r\n                        <dd className=\"text-sm text-gray-900\">{student.room.capacity} beds</dd>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Room</dt>\r\n                      <dd className=\"text-sm text-amber-600\">No room assigned</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n\r\n              {/* Payment & Financial Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">Financial Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  {student.due_amount !== undefined && (\r\n                    <div className=\"py-2 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-600\">Due Amount</dt>\r\n                      <dd className={`text-sm ${student.due_amount > 0 ? 'text-red-600 font-medium' : 'text-green-600 font-medium'}`}>\r\n                        {student.due_amount > 0 \r\n                          ? `Rs ${student.due_amount.toFixed(2)}` \r\n                          : 'No dues'}\r\n                      </dd>\r\n                    </div>\r\n                  )}\r\n                  {student.is_existing_student !== undefined && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Existing Student</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.is_existing_student ? 'Yes' : 'No'}</dd>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Display financial information from the latest financial record */}\r\n                  {student.financials && student.financials.length > 0 && (() => {\r\n                    // Get the latest financial record\r\n                    const latestFinancial = student.financials.sort((a: any, b: any) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime())[0];\r\n                    \r\n                    return (\r\n                      <>\r\n                        {latestFinancial.admission_fee && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Admission Fee</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.admission_fee}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.form_fee && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Form Fee</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.form_fee}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.security_deposit && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Security Deposit</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.security_deposit}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.monthly_fee && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Monthly Fee</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.monthly_fee}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.room_fee && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Room Fee</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.room_fee}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.other_fee && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Other Fee</dt>\r\n                            <dd className=\"text-sm text-gray-900\">Rs {latestFinancial.other_fee}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.discount_amount && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Discount Amount</dt>\r\n                            <dd className=\"text-sm text-green-600\">Rs {latestFinancial.discount_amount}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.joining_date && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Joining Date</dt>\r\n                            <dd className=\"text-sm text-gray-900\">{formatDate(latestFinancial.joining_date)}</dd>\r\n                          </div>\r\n                        )}\r\n                        {latestFinancial.payment_type && (\r\n                          <div className=\"py-3 flex justify-between\">\r\n                            <dt className=\"text-sm font-medium text-gray-500\">Payment Type</dt>\r\n                            <dd className=\"text-sm text-gray-900\">\r\n                              {typeof latestFinancial.payment_type === 'object' && latestFinancial.payment_type.name \r\n                                ? latestFinancial.payment_type.name \r\n                                : String(latestFinancial.payment_type)}\r\n                            </dd>\r\n                          </div>\r\n                        )}\r\n                      </>\r\n                    );\r\n                  })()}\r\n                  \r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Registered On</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{formatDate(student.created_at)}</dd>\r\n                  </div>\r\n                </dl>\r\n              </div>\r\n              \r\n              {/* System Information */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\r\n                <h3 className=\"text-base font-medium text-gray-700 mb-3 pb-2 border-b border-gray-200\">System Information</h3>\r\n                <dl className=\"divide-y divide-gray-100\">\r\n                  <div className=\"py-2 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-600\">Student ID</dt>\r\n                    <dd className=\"text-sm text-gray-900 font-mono\">{student.id}</dd>\r\n                  </div>\r\n                  {student.user_id && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">User ID</dt>\r\n                      <dd className=\"text-sm text-gray-900 font-mono\">{student.user_id}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.declaration_agreed !== undefined && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Declaration Agreed</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.declaration_agreed ? 'Yes' : 'No'}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.rules_agreed !== undefined && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Rules Agreed</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{student.rules_agreed ? 'Yes' : 'No'}</dd>\r\n                    </div>\r\n                  )}\r\n                  {student.verified_on && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Verified On</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(student.verified_on)}</dd>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"py-3 flex justify-between\">\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Created</dt>\r\n                    <dd className=\"text-sm text-gray-900\">{formatDate(student.created_at)}</dd>\r\n                  </div>\r\n                  {student.updated_at && (\r\n                    <div className=\"py-3 flex justify-between\">\r\n                      <dt className=\"text-sm font-medium text-gray-500\">Last Updated</dt>\r\n                      <dd className=\"text-sm text-gray-900\">{formatDate(student.updated_at)}</dd>\r\n                    </div>\r\n                  )}\r\n                </dl>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Student Amenities */}\r\n            {student.amenities && student.amenities.length > 0 && (\r\n              <div className=\"mt-8 pt-6 border-t border-gray-200\">\r\n                <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Student Amenities</h3>\r\n                <div className=\"overflow-hidden bg-white border border-gray-200 rounded-lg shadow-sm\">\r\n                  <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                      <tr>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Name</th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                      {student.amenities.map((amenity, index) => (\r\n                        <tr key={amenity.id || index} className=\"hover:bg-gray-50\">\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{amenity.name}</td>\r\n                          <td className=\"px-6 py-4 text-sm text-gray-500\">{amenity.description || 'No description'}</td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Student Documents */}\r\n            <div className=\"mt-8 pt-6 border-t border-gray-200\">\r\n              <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Student Documents</h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {student.student_image && (\r\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\r\n                    <div className=\"aspect-w-4 aspect-h-3 overflow-hidden\">\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted student photo preview; keep native <img> for click-to-open behavior */}\r\n                      <img \r\n                        src={getImageUrl(student.student_image)} \r\n                        alt=\"Student Photo\" \r\n                        className=\"object-cover w-full h-full cursor-pointer\"\r\n                        onClick={() => handleImageClick(getImageUrl(student.student_image!), 'Student Photo')}\r\n                      />\r\n                    </div>\r\n                    <div className=\"p-3 bg-gray-50 border-t\">\r\n                      <p className=\"text-sm font-medium text-gray-800\">Student Photo</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Profile photo of the student</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {student.student_citizenship_image && (\r\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\r\n                    <div className=\"aspect-w-4 aspect-h-3 overflow-hidden bg-gray-100 flex items-center justify-center\">\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted citizenship document preview; native <img> keeps click-preview and layout predictable */}\r\n                      <img \r\n                        src={getImageUrl(student.student_citizenship_image)} \r\n                        alt=\"Citizenship Document\" \r\n                        className=\"object-contain w-full h-full cursor-pointer\"\r\n                        onClick={() => handleImageClick(getImageUrl(student.student_citizenship_image!), 'Citizenship Document')}\r\n                      />\r\n                    </div>\r\n                    <div className=\"p-3 bg-gray-50 border-t\">\r\n                      <p className=\"text-sm font-medium text-gray-800\">Citizenship Document</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Citizenship ID proof</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {student.registration_form_image && (\r\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\r\n                    <div className=\"aspect-w-4 aspect-h-3 overflow-hidden bg-gray-100 flex items-center justify-center\">\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted registration form preview; native <img> keeps simple click preview behavior */}\r\n                      <img \r\n                        src={getImageUrl(student.registration_form_image)} \r\n                        alt=\"Registration Form\" \r\n                        className=\"object-contain w-full h-full cursor-pointer\"\r\n                        onClick={() => handleImageClick(getImageUrl(student.registration_form_image!), 'Registration Form')}\r\n                      />\r\n                    </div>\r\n                    <div className=\"p-3 bg-gray-50 border-t\">\r\n                      <p className=\"text-sm font-medium text-gray-800\">Registration Form</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Signed registration form</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {student.physical_copy_image && (\r\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\r\n                    <div className=\"aspect-w-4 aspect-h-3 overflow-hidden bg-gray-100 flex items-center justify-center\">\r\n                      {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted financial document preview; native <img> keeps simple click preview behavior */}\r\n                      <img \r\n                        src={getImageUrl(student.physical_copy_image)} \r\n                        alt=\"Financial Document\" \r\n                        className=\"object-contain w-full h-full cursor-pointer\"\r\n                        onClick={() => handleImageClick(getImageUrl(student.physical_copy_image!), 'Financial Document')}\r\n                      />\r\n                    </div>\r\n                    <div className=\"p-3 bg-gray-50 border-t\">\r\n                      <p className=\"text-sm font-medium text-gray-800\">Financial Document</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Payment receipt or financial record</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {!student.student_image && !student.student_citizenship_image && !student.registration_form_image && !student.physical_copy_image && (\r\n                  <div className=\"col-span-3 text-center py-12\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                    </svg>\r\n                    <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No documents</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-500\">No documents have been uploaded for this student.</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={showDeleteModal}\r\n        title=\"Delete Student\"\r\n        message=\"Are you sure you want to delete this student? This action cannot be undone.\"\r\n        confirmText={isDeleting ? \"Deleting...\" : \"Delete\"}\r\n        cancelText=\"Cancel\"\r\n        isLoading={isDeleting}\r\n        onConfirm={handleDelete}\r\n        onCancel={() => setShowDeleteModal(false)}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student\\create\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":744,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[26074,26090],"text":"Father&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[26074,26090],"text":"Father&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[26074,26090],"text":"Father&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[26074,26090],"text":"Father&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":775,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[27538,27554],"text":"Mother&apos;s Details"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[27538,27554],"text":"Mother&lsquo;s Details"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[27538,27554],"text":"Mother&#39;s Details"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[27538,27554],"text":"Mother&rsquo;s Details"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":806,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[28977,29009],"text":"Spouse&apos;s Details (if applicable)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[28977,29009],"text":"Spouse&lsquo;s Details (if applicable)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[28977,29009],"text":"Spouse&#39;s Details (if applicable)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[28977,29009],"text":"Spouse&rsquo;s Details (if applicable)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1120,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click &quot;Add Amenity\" to add student amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click &ldquo;Add Amenity\" to add student amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click &#34;Add Amenity\" to add student amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click &rdquo;Add Amenity\" to add student amenities."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1120,"column":101,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click \"Add Amenity&quot; to add student amenities."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click \"Add Amenity&ldquo; to add student amenities."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click \"Add Amenity&#34; to add student amenities."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[44167,44232],"text":"No amenities added. Click \"Add Amenity&rdquo; to add student amenities."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { AlertCircle } from 'lucide-react';\r\nimport { studentApi, studentFinancialApi, roomApi, type Room, type StudentFormData, type StudentFinancialFormData, type StudentAmenity } from '@/lib/api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SingleImageUploadCreate,\r\n  MultipleImageUploadCreate,\r\n  ImageModal\r\n} from '@/components/ui';\r\n\r\nexport default function CreateStudent() {\r\n  const router = useRouter();\r\n  \r\n  // Form state\r\n  const [formData, setFormData] = useState<StudentFormData>({\r\n    student_name: '',\r\n    contact_number: '',\r\n    email: '',\r\n    date_of_birth: '',\r\n    district: '',\r\n    city_name: '',\r\n    ward_no: '',\r\n    street_name: '',\r\n    citizenship_no: '',\r\n    date_of_issue: '',\r\n    citizenship_issued_district: '',\r\n    educational_institution: '',\r\n    class_time: '',\r\n    level_of_study: '',\r\n    expected_stay_duration: '',\r\n    blood_group: '',\r\n    food: '',\r\n    disease: '',\r\n    father_name: '',\r\n    father_contact: '',\r\n    father_occupation: '',\r\n    mother_name: '',\r\n    mother_contact: '',\r\n    mother_occupation: '',\r\n    spouse_name: '',\r\n    spouse_contact: '',\r\n    spouse_occupation: '',\r\n    local_guardian_name: '',\r\n    local_guardian_address: '',\r\n    local_guardian_contact: '',\r\n    local_guardian_occupation: '',\r\n    local_guardian_relation: '',\r\n    room_id: '',\r\n    is_active: true,\r\n    student_id: '',\r\n    is_existing_student: false,\r\n    declaration_agreed: false,\r\n    rules_agreed: false,\r\n    verified_on: '',\r\n    amenities: []\r\n  });\r\n  \r\n  // Financial form state\r\n  const [financialData, setFinancialData] = useState<StudentFinancialFormData>({\r\n    admission_fee: '',\r\n    form_fee: '',\r\n    security_deposit: '',\r\n    monthly_fee: '',\r\n    joining_date: '',\r\n    payment_date: new Date().toISOString().split('T')[0], // Default to today\r\n    amount: '',\r\n    payment_type_id: '',\r\n    remark: '',\r\n    is_existing_student: false\r\n  });\r\n  \r\n  // Form processing state\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [rooms, setRooms] = useState<Room[]>([]);\r\n  \r\n  // Image state\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n  \r\n  // Document state - Multiple file uploads\r\n  const [citizenshipDocuments, setCitizenshipDocuments] = useState<File[]>([]);\r\n  const [registrationFormDocuments, setRegistrationFormDocuments] = useState<File[]>([]);\r\n  \r\n  // Amenities state\r\n  const [amenities, setAmenities] = useState<StudentAmenity[]>([]);\r\n\r\n  // Fetch available rooms for selection\r\n  useEffect(() => {\r\n    const fetchRooms = async () => {\r\n      try {\r\n        // Use the proper API client to fetch rooms\r\n        const roomsData = await roomApi.getRooms();\r\n        setRooms(roomsData.data || []);\r\n      } catch (error) {\r\n        console.error('Error fetching rooms:', error);\r\n        // Don't show this error in the UI, just log it\r\n      }\r\n    };\r\n\r\n    fetchRooms();\r\n  }, []);\r\n\r\n  // Handle form field changes\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value, type } = e.target;\r\n\r\n    if (type === 'checkbox') {\r\n      const checkbox = e.target as HTMLInputElement;\r\n      setFormData({\r\n        ...formData,\r\n        [name]: checkbox.checked\r\n      });\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Handle financial form field changes\r\n  const handleFinancialInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value, type } = e.target;\r\n\r\n    if (type === 'checkbox') {\r\n      const checkbox = e.target as HTMLInputElement;\r\n      setFinancialData({\r\n        ...financialData,\r\n        [name]: checkbox.checked\r\n      });\r\n    } else {\r\n      setFinancialData({\r\n        ...financialData,\r\n        [name]: value\r\n      });\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Process student image file\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_image: 'Please select a valid image file (JPG, JPEG, PNG)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (2MB max)\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_image: 'File size must be less than 2MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      student_image: file\r\n    }));\r\n\r\n    // Create preview for images\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      setImagePreview(e.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // Clear file error\r\n    if (errors.student_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_image: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Remove student image\r\n  const removeImage = () => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      student_image: null\r\n    }));\r\n    setImagePreview(null);\r\n  };\r\n  \r\n  // Validate citizenship document file\r\n  const validateCitizenshipFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_citizenship_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_citizenship_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.student_citizenship_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        student_citizenship_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add citizenship documents\r\n  const addCitizenshipDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateCitizenshipFile(file));\r\n    if (validFiles.length > 0) {\r\n      setCitizenshipDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove citizenship document\r\n  const removeCitizenshipImage = (index: number) => {\r\n    setCitizenshipDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n  \r\n  // Validate registration form file\r\n  const validateRegistrationFormFile = (file: File): boolean => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        registration_form_image: 'Please select a valid file (JPG, JPEG, PNG, PDF)'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        registration_form_image: 'File size must be less than 5MB'\r\n      }));\r\n      return false;\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.registration_form_image) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        registration_form_image: ''\r\n      }));\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  // Add registration form documents\r\n  const addRegistrationFormDocuments = (files: File[]) => {\r\n    const validFiles = files.filter(file => validateRegistrationFormFile(file));\r\n    if (validFiles.length > 0) {\r\n      setRegistrationFormDocuments(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  // Remove registration form\r\n  const removeRegistrationFormImage = (index: number) => {\r\n    setRegistrationFormDocuments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  // Handle amenity changes\r\n  const handleAmenityChange = (index: number, field: keyof StudentAmenity, value: string) => {\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities[index] = {\r\n      ...updatedAmenities[index],\r\n      [field]: value\r\n    };\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Add new amenity field\r\n  const addAmenity = () => {\r\n    setAmenities([...amenities, { name: '', description: '' }]);\r\n  };\r\n\r\n  // Remove amenity field\r\n  const removeAmenity = (index: number) => {\r\n    const updatedAmenities = [...amenities];\r\n    updatedAmenities.splice(index, 1);\r\n    setAmenities(updatedAmenities);\r\n  };\r\n\r\n  // Form validation\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.student_name.trim()) {\r\n      newErrors.student_name = 'Student name is required';\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      newErrors.email = 'Email address is required';\r\n    } else if (!/\\S+@\\S+\\.\\S+/.test(formData.email)) {\r\n      newErrors.email = 'Please enter a valid email address';\r\n    }\r\n\r\n    if (!formData.contact_number.trim()) {\r\n      newErrors.contact_number = 'Contact number is required';\r\n    } else if (!/^\\d{10}$/.test(formData.contact_number.trim())) {\r\n      newErrors.contact_number = 'Please enter a valid 10-digit phone number';\r\n    }\r\n    \r\n    // Student amenities are now optional - no validation required\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  // Form submission\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validate form\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    // Filter out empty amenities\r\n    const filteredAmenities = amenities.filter(item => item.name.trim() !== '');\r\n    \r\n    try {\r\n      // Check authentication before making API call\r\n      const token = localStorage.getItem('auth_token');\r\n      if (!token) {\r\n        setErrors({\r\n          submit: 'Authentication token not found. Please log in again.'\r\n        });\r\n        setIsSubmitting(false);\r\n        return;\r\n      }\r\n\r\n      // Step 1: Create the student first (without financial data)\r\n      const studentFormData = {\r\n        ...formData,\r\n        amenities: filteredAmenities,\r\n        student_citizenship_image: citizenshipDocuments.length > 0 ? citizenshipDocuments[0] : null,\r\n        registration_form_image: registrationFormDocuments.length > 0 ? registrationFormDocuments[0] : null\r\n      };\r\n      \r\n      const createdStudent = await studentApi.createStudent(studentFormData);\r\n      \r\n      // Step 2: Create financial record if any financial data is provided\r\n      const hasFinancialData = Object.entries(financialData).some(([key, value]) => {\r\n        if (key === 'payment_date' || key === 'is_existing_student') return false; // These always have values\r\n        return value !== null && value !== undefined && value !== '';\r\n      });\r\n      \r\n      if (hasFinancialData) {\r\n        // Calculate total amount from individual fees\r\n        const admissionFee = parseFloat(financialData.admission_fee || '0');\r\n        const formFee = parseFloat(financialData.form_fee || '0');\r\n        const securityDeposit = parseFloat(financialData.security_deposit || '0');\r\n        const monthlyFee = parseFloat(financialData.monthly_fee || '0');\r\n        const totalAmount = (admissionFee + formFee + securityDeposit + monthlyFee).toString();\r\n        \r\n        const financialFormData = {\r\n          ...financialData,\r\n          student_id: createdStudent.id,\r\n          amount: financialData.amount || totalAmount // Use provided amount or calculated total\r\n        };\r\n        \r\n        await studentFinancialApi.createStudentFinancial(financialFormData);\r\n      }\r\n\r\n      // Redirect to student list on success\r\n      router.push('/admin/student');\r\n    } catch (error) {\r\n      console.error('Error creating student:', error);\r\n      \r\n      if (error instanceof ApiError) {\r\n        // Handle specific authentication errors\r\n        if (error.status === 401) {\r\n          setErrors({\r\n            submit: 'Authentication failed. Please log out and log back in, then try again.'\r\n          });\r\n        } else if (error.status === 403) {\r\n          setErrors({\r\n            submit: 'You do not have permission to create students. Please contact an administrator.'\r\n          });\r\n        } else if (error.validation && Object.keys(error.validation).length > 0) {\r\n          // Convert validation errors to our format\r\n          const formattedErrors: Record<string, string> = {};\r\n          \r\n          Object.entries(error.validation).forEach(([field, messages]) => {\r\n            formattedErrors[field] = Array.isArray(messages) ? messages[0] : messages;\r\n          });\r\n          \r\n          setErrors({\r\n            ...formattedErrors,\r\n            submit: `Failed to create student: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            submit: `Failed to create student: ${error.message}`\r\n          });\r\n        }\r\n      } else {\r\n        setErrors({\r\n          submit: 'An unexpected error occurred. Please try again later.'\r\n        });\r\n      }\r\n      \r\n      // Scroll to top to show error message\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Clean Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Add New Student</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Enter student details to register a new student</p>\r\n        </div>\r\n\r\n        {/* Error Alert */}\r\n        {errors.submit && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">{errors.submit}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n          <div className=\"p-6\">\r\n            {/* Basic Information */}\r\n            <div className=\"mb-8\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Basic Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Student Name */}\r\n                <FormField\r\n                  name=\"student_name\"\r\n                  label=\"Student Name\"\r\n                  required\r\n                  value={formData.student_name}\r\n                  onChange={handleInputChange}\r\n                  error={errors.student_name}\r\n                  placeholder=\"Enter full name\"\r\n                />\r\n                \r\n                {/* Email */}\r\n                <FormField\r\n                  name=\"email\"\r\n                  label=\"Email Address\"\r\n                  required\r\n                  type=\"email\"\r\n                  value={formData.email}\r\n                  onChange={handleInputChange}\r\n                  error={errors.email}\r\n                  placeholder=\"Enter email address\"\r\n                />\r\n                \r\n                {/* Contact Number */}\r\n                <FormField\r\n                  name=\"contact_number\"\r\n                  label=\"Contact Number\"\r\n                  required\r\n                  value={formData.contact_number}\r\n                  onChange={handleInputChange}\r\n                  error={errors.contact_number}\r\n                  placeholder=\"Enter 10-digit phone number\"\r\n                />\r\n                \r\n                {/* Date of Birth */}\r\n                <FormField\r\n                  name=\"date_of_birth\"\r\n                  label=\"Date of Birth\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_birth || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_birth}\r\n                  placeholder=\"YYYY-MM-DD\"\r\n                />\r\n                \r\n                {/* Blood Group */}\r\n                <FormField\r\n                  name=\"blood_group\"\r\n                  label=\"Blood Group\"\r\n                  type=\"select\"\r\n                  value={formData.blood_group || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.blood_group}\r\n                  options={[\r\n                    { value: 'A+', label: 'A+' },\r\n                    { value: 'A-', label: 'A-' },\r\n                    { value: 'B+', label: 'B+' },\r\n                    { value: 'B-', label: 'B-' },\r\n                    { value: 'AB+', label: 'AB+' },\r\n                    { value: 'AB-', label: 'AB-' },\r\n                    { value: 'O+', label: 'O+' },\r\n                    { value: 'O-', label: 'O-' },\r\n                  ]}\r\n                />\r\n\r\n                {/* Room Selection */}\r\n                <FormField\r\n                  name=\"room_id\"\r\n                  label=\"Room\"\r\n                  type=\"select\"\r\n                  value={formData.room_id || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.room_id}\r\n                  options={rooms.map(room => ({ value: room.id, label: room.room_name }))}\r\n                />\r\n                \r\n                {/* Active Status */}\r\n                <div className=\"flex items-center mt-4\">\r\n                  <input\r\n                    id=\"is_active\"\r\n                    name=\"is_active\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.is_active || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"is_active\" className=\"ml-2 text-sm font-semibold text-neutral-900\">Active Student</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Address Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Address Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* District */}\r\n                <FormField\r\n                  name=\"district\"\r\n                  label=\"District\"\r\n                  value={formData.district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.district}\r\n                  placeholder=\"Enter district name\"\r\n                />\r\n                \r\n                {/* City Name */}\r\n                <FormField\r\n                  name=\"city_name\"\r\n                  label=\"City\"\r\n                  value={formData.city_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.city_name}\r\n                  placeholder=\"Enter city name\"\r\n                />\r\n                \r\n                {/* Ward No */}\r\n                <FormField\r\n                  name=\"ward_no\"\r\n                  label=\"Ward Number\"\r\n                  value={formData.ward_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.ward_no}\r\n                  placeholder=\"Enter ward number\"\r\n                />\r\n                \r\n                {/* Street Name */}\r\n                <FormField\r\n                  name=\"street_name\"\r\n                  label=\"Street Name\"\r\n                  value={formData.street_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.street_name}\r\n                  placeholder=\"Enter street name\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Citizenship Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Citizenship Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Citizenship No */}\r\n                <FormField\r\n                  name=\"citizenship_no\"\r\n                  label=\"Citizenship Number\"\r\n                  value={formData.citizenship_no || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_no}\r\n                  placeholder=\"Enter citizenship number\"\r\n                />\r\n                \r\n                {/* Date of Issue */}\r\n                <FormField\r\n                  name=\"date_of_issue\"\r\n                  label=\"Date of Issue\"\r\n                  type=\"date\"\r\n                  value={formData.date_of_issue || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.date_of_issue}\r\n                />\r\n                \r\n                {/* Citizenship Issued District */}\r\n                <FormField\r\n                  name=\"citizenship_issued_district\"\r\n                  label=\"Issued District\"\r\n                  value={formData.citizenship_issued_district || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.citizenship_issued_district}\r\n                  placeholder=\"Enter district where citizenship was issued\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Educational Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Educational Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Educational Institution */}\r\n                <FormField\r\n                  name=\"educational_institution\"\r\n                  label=\"Educational Institution\"\r\n                  value={formData.educational_institution || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.educational_institution}\r\n                  placeholder=\"Enter school/college name\"\r\n                />\r\n                \r\n                {/* Class Time */}\r\n                <FormField\r\n                  name=\"class_time\"\r\n                  label=\"Class Time\"\r\n                  value={formData.class_time || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.class_time}\r\n                  placeholder=\"e.g., Morning, Evening\"\r\n                />\r\n                \r\n                {/* Level of Study */}\r\n                <FormField\r\n                  name=\"level_of_study\"\r\n                  label=\"Level of Study\"\r\n                  value={formData.level_of_study || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.level_of_study}\r\n                  placeholder=\"e.g., Bachelors, Masters\"\r\n                />\r\n                \r\n                {/* Expected Stay Duration */}\r\n                <FormField\r\n                  name=\"expected_stay_duration\"\r\n                  label=\"Expected Stay Duration\"\r\n                  value={formData.expected_stay_duration || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.expected_stay_duration}\r\n                  placeholder=\"e.g., 6 months, 2 years\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Health Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Health Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Food Preference */}\r\n                <FormField\r\n                  name=\"food\"\r\n                  label=\"Food Preference\"\r\n                  type=\"select\"\r\n                  value={formData.food || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.food}\r\n                  options={[\r\n                    { value: 'vegetarian', label: 'Vegetarian' },\r\n                    { value: 'non-vegetarian', label: 'Non-vegetarian' },\r\n                    { value: 'egg-only', label: 'Egg Only' }\r\n                  ]}\r\n                />\r\n                \r\n                {/* Disease/Health Issues */}\r\n                <div className=\"md:col-span-2\">\r\n                  <FormField\r\n                    name=\"disease\"\r\n                    label=\"Disease or Health Issues (if any)\"\r\n                    type=\"textarea\"\r\n                    value={formData.disease || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.disease}\r\n                    placeholder=\"Enter any health conditions or allergies\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Family Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Family Information</h2>\r\n              <div className=\"grid grid-cols-1 gap-4\">\r\n                {/* Father's Information */}\r\n                <div className=\"border-b border-gray-100 pb-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Father's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"father_name\"\r\n                      label=\"Father's Name\"\r\n                      value={formData.father_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_name}\r\n                      placeholder=\"Enter father's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_contact\"\r\n                      label=\"Father's Contact\"\r\n                      value={formData.father_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_contact}\r\n                      placeholder=\"Enter father's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"father_occupation\"\r\n                      label=\"Father's Occupation\"\r\n                      value={formData.father_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.father_occupation}\r\n                      placeholder=\"Enter father's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Mother's Information */}\r\n                <div className=\"border-b border-gray-100 py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Mother's Details</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"mother_name\"\r\n                      label=\"Mother's Name\"\r\n                      value={formData.mother_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_name}\r\n                      placeholder=\"Enter mother's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_contact\"\r\n                      label=\"Mother's Contact\"\r\n                      value={formData.mother_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_contact}\r\n                      placeholder=\"Enter mother's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"mother_occupation\"\r\n                      label=\"Mother's Occupation\"\r\n                      value={formData.mother_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.mother_occupation}\r\n                      placeholder=\"Enter mother's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Spouse's Information */}\r\n                <div className=\"py-4\">\r\n                  <h3 className=\"text-md font-medium text-gray-800 mb-3\">Spouse's Details (if applicable)</h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <FormField\r\n                      name=\"spouse_name\"\r\n                      label=\"Spouse's Name\"\r\n                      value={formData.spouse_name || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_name}\r\n                      placeholder=\"Enter spouse's name\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_contact\"\r\n                      label=\"Spouse's Contact\"\r\n                      value={formData.spouse_contact || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_contact}\r\n                      placeholder=\"Enter spouse's phone number\"\r\n                    />\r\n                    <FormField\r\n                      name=\"spouse_occupation\"\r\n                      label=\"Spouse's Occupation\"\r\n                      value={formData.spouse_occupation || ''}\r\n                      onChange={handleInputChange}\r\n                      error={errors.spouse_occupation}\r\n                      placeholder=\"Enter spouse's occupation\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Guardian Information */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Local Guardian Information</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <FormField\r\n                  name=\"local_guardian_name\"\r\n                  label=\"Guardian's Name\"\r\n                  value={formData.local_guardian_name || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_name}\r\n                  placeholder=\"Enter local guardian's name\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_relation\"\r\n                  label=\"Relation with Student\"\r\n                  value={formData.local_guardian_relation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_relation}\r\n                  placeholder=\"e.g., Uncle, Aunt\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_contact\"\r\n                  label=\"Guardian's Contact\"\r\n                  value={formData.local_guardian_contact || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_contact}\r\n                  placeholder=\"Enter guardian's phone number\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_occupation\"\r\n                  label=\"Guardian's Occupation\"\r\n                  value={formData.local_guardian_occupation || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_occupation}\r\n                  placeholder=\"Enter guardian's occupation\"\r\n                />\r\n                <FormField\r\n                  name=\"local_guardian_address\"\r\n                  label=\"Guardian's Address\"\r\n                  value={formData.local_guardian_address || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.local_guardian_address}\r\n                  placeholder=\"Enter guardian's address\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Document Uploads */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Document Uploads</h2>\r\n              \r\n              {/* Student Photo */}\r\n              <div className=\"mb-6\">\r\n                <div className=\"w-full\">\r\n                  <SingleImageUploadCreate\r\n                    imagePreview={imagePreview}\r\n                    onFileSelect={processFile}\r\n                    onRemove={removeImage}\r\n                    error={errors.student_image}\r\n                    label=\"Student Photo\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Citizenship Documents */}\r\n              <div className=\"mb-6 pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Citizenship Documents</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadCreate\r\n                    images={citizenshipDocuments}\r\n                    onAddImages={addCitizenshipDocuments}\r\n                    onRemoveImage={removeCitizenshipImage}\r\n                    error={errors.student_citizenship_image}\r\n                    label=\"Citizenship Documents\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Registration Forms */}\r\n              <div className=\"pt-4\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Registration Forms</h3>\r\n                <div className=\"w-full\">\r\n                  <MultipleImageUploadCreate\r\n                    images={registrationFormDocuments}\r\n                    onAddImages={addRegistrationFormDocuments}\r\n                    onRemoveImage={removeRegistrationFormImage}\r\n                    error={errors.registration_form_image}\r\n                    label=\"Registration Forms\"\r\n                    onImageClick={(imageUrl, alt) => {\r\n                      setSelectedImage({ url: imageUrl, alt });\r\n                      setImageModalOpen(true);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Administrative Details */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Administrative Details</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Student ID */}\r\n                <FormField\r\n                  name=\"student_id\"\r\n                  label=\"Student ID\"\r\n                  value={formData.student_id || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.student_id}\r\n                />\r\n                \r\n                <div className=\"flex items-center mt-4\">\r\n                  <input\r\n                    id=\"is_existing_student\"\r\n                    name=\"is_existing_student\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.is_existing_student || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"is_existing_student\" className=\"ml-2 text-sm font-semibold text-neutral-900\">\r\n                    This is an existing student (staying before system implementation)\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Financial Details */}\r\n              <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Admission Fee */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Admission Fee</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"admission_fee\"\r\n                      value={financialData.admission_fee || ''}\r\n                      onChange={handleFinancialInputChange}\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                    />\r\n                  </div>\r\n                  {errors.admission_fee && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <AlertCircle className=\"h-3.5 w-3.5 mr-2\" />\r\n                      {errors.admission_fee}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Form Fee */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Form Fee</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"form_fee\"\r\n                      value={financialData.form_fee || ''}\r\n                      onChange={handleFinancialInputChange}\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                    />\r\n                  </div>\r\n                  {errors.form_fee && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <AlertCircle className=\"h-3.5 w-3.5 mr-2\" />\r\n                      {errors.form_fee}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Security Deposit */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Security Deposit</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"security_deposit\"\r\n                      value={financialData.security_deposit || ''}\r\n                      onChange={handleFinancialInputChange}\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                    />\r\n                  </div>\r\n                  {errors.security_deposit && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <AlertCircle className=\"h-3.5 w-3.5 mr-2\" />\r\n                      {errors.security_deposit}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Monthly Hostel Fee */}\r\n                <div className=\"form-field\">\r\n                  <label className=\"block text-sm font-semibold text-neutral-900\">Monthly Hostel Fee</label>\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-sm font-medium mr-2\">Rs.</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"monthly_fee\"\r\n                      value={financialData.monthly_fee || ''}\r\n                      onChange={handleFinancialInputChange}\r\n                      className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                    />\r\n                  </div>\r\n                  {errors.monthly_fee && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <AlertCircle className=\"h-3.5 w-3.5 mr-2\" />\r\n                      {errors.monthly_fee}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Joining Date */}\r\n              <div className=\"mt-4\">\r\n                <FormField\r\n                  name=\"joining_date\"\r\n                  label=\"Joining Date\"\r\n                  type=\"date\"\r\n                  value={financialData.joining_date || ''}\r\n                  onChange={handleFinancialInputChange}\r\n                  error={errors.joining_date}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Amenities */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-lg font-medium text-gray-900\">Student Amenities</h2>\r\n                <Button \r\n                  type=\"button\" \r\n                  onClick={addAmenity}\r\n                  variant=\"secondary\"\r\n                  size=\"sm\"\r\n                >\r\n                  Add Amenity\r\n                </Button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-4\">\r\n                {amenities.length > 0 ? (\r\n                  amenities.map((amenity, index) => (\r\n                    <div key={index} className=\"flex space-x-4 items-start\">\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_name_${index}`}\r\n                          label={`Amenity ${index + 1} Name`}\r\n                          placeholder=\"Enter amenity name\"\r\n                          value={amenity.name}\r\n                          onChange={(e) => handleAmenityChange(index, 'name', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <FormField\r\n                          name={`amenity_description_${index}`}\r\n                          label=\"Description (Optional)\"\r\n                          placeholder=\"Enter description\"\r\n                          value={amenity.description || ''}\r\n                          onChange={(e) => handleAmenityChange(index, 'description', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"pt-8\">\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => removeAmenity(index)}\r\n                          className=\"text-red-600 hover:text-red-800\"\r\n                        >\r\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                            <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                          </svg>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                ) : (\r\n                  <p className=\"text-gray-500 text-sm italic\">No amenities added. Click \"Add Amenity\" to add student amenities.</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>            {/* Verification */}\r\n            <div className=\"mb-8 border-t border-gray-200 pt-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Verification</h2>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"declaration_agreed\"\r\n                    name=\"declaration_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.declaration_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"declaration_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I hereby declare that all the information provided above is true and correct to the best of my knowledge.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    id=\"rules_agreed\"\r\n                    name=\"rules_agreed\"\r\n                    type=\"checkbox\"\r\n                    className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                    checked={formData.rules_agreed || false}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label htmlFor=\"rules_agreed\" className=\"ml-2 text-sm text-neutral-800\">\r\n                    I agree to abide by all the rules and regulations of the hostel.\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"mt-4\">\r\n                  <FormField\r\n                    name=\"verified_on\"\r\n                    label=\"Verification Date (YYYY/MM/DD) AD\"\r\n                    type=\"date\"\r\n                    value={formData.verified_on || ''}\r\n                    onChange={handleInputChange}\r\n                    error={errors.verified_on}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Form Actions */}\r\n            <div className=\"px-6 py-4 bg-gray-50 flex justify-end space-x-4\">\r\n              <CancelButton onClick={() => router.push('/admin/student')} />\r\n              <SubmitButton \r\n                loading={isSubmitting} \r\n                loadingText=\"Creating...\"\r\n              >\r\n                Create Student\r\n              </SubmitButton>\r\n            </div>\r\n        </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\student\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1471,1474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1471,1474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4267,4270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4267,4270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4754,4757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4754,4757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":429,"column":31,"nodeType":"JSXOpeningElement","endLine":433,"endColumn":33,"suppressions":[{"kind":"directive","justification":"server-hosted student thumbnails; native <img> is used for preview and modal open behavior"}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":591,"column":13,"nodeType":"JSXOpeningElement","endLine":595,"endColumn":15,"suppressions":[{"kind":"directive","justification":"photo modal uses native <img> for direct preview"}]}],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { studentApi, type StudentWithAmenities } from '@/lib/api';\r\nimport { roomApi } from '@/lib/api/room.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  TableSkeleton, \r\n  SearchBar, \r\n  Button,\r\n  ActionButtons,\r\n  ConfirmModal\r\n} from '@/components/ui';\r\nimport { formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function Page() {\r\n  const router = useRouter();\r\n  \r\n  const [students, setStudents] = useState<StudentWithAmenities[]>([]);\r\n  const [filteredStudents, setFilteredStudents] = useState<StudentWithAmenities[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('');\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [studentToDelete, setStudentToDelete] = useState<string | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [selectedPhoto, setSelectedPhoto] = useState<string | null>(null);\r\n  const [showPhotoModal, setShowPhotoModal] = useState(false);\r\n  const [togglingStatusId, setTogglingStatusId] = useState<string | null>(null);\r\n  const [rooms, setRooms] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // Fetch both students and rooms data\r\n        const [studentsResponse, roomsResponse] = await Promise.all([\r\n          studentApi.getStudents(currentPage),\r\n          roomApi.getRooms(1, { per_page: 1000 }) // Fetch all rooms\r\n        ]);\r\n        \r\n        console.log('API Response:', studentsResponse); // Debug log to see API response\r\n        \r\n        // Check if we have data before setting state\r\n        if (studentsResponse && studentsResponse.data) {\r\n          setStudents(studentsResponse.data);\r\n          setFilteredStudents(studentsResponse.data);\r\n          setTotalPages(studentsResponse.last_page || 1);\r\n        } else {\r\n          console.error('No data returned from API');\r\n          setError('No student data available. The API may be unavailable.');\r\n        }\r\n        \r\n        // Set rooms data\r\n        if (roomsResponse && roomsResponse.data) {\r\n          setRooms(roomsResponse.data);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching data:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load data: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [currentPage]);\r\n\r\n  // Apply filters when searchTerm or statusFilter changes\r\n  useEffect(() => {\r\n    if (!students.length) return;\r\n\r\n    let result = [...students];\r\n    \r\n    console.log('Original students:', students.length);\r\n    console.log('Status filter:', statusFilter);\r\n    console.log('Sample student is_active values:', students.slice(0, 3).map(s => ({ name: s.student_name, is_active: s.is_active, type: typeof s.is_active })));\r\n\r\n    // Filter by search term\r\n    if (searchTerm) {\r\n      const lowercasedTerm = searchTerm.toLowerCase();\r\n      result = result.filter(student => \r\n        student.student_name.toLowerCase().includes(lowercasedTerm) || \r\n        student.email.toLowerCase().includes(lowercasedTerm) ||\r\n        student.contact_number.toLowerCase().includes(lowercasedTerm)\r\n      );\r\n    }\r\n\r\n    // Filter by status\r\n    if (statusFilter) {\r\n      console.log('Applying status filter:', statusFilter);\r\n      console.log('Sample students before filtering:', result.slice(0, 5).map(s => ({ \r\n        name: s.student_name, \r\n        is_active: s.is_active, \r\n        type: typeof s.is_active,\r\n        stringValue: String(s.is_active)\r\n      })));\r\n      \r\n      if (statusFilter === 'active') {\r\n        result = result.filter(student => {\r\n          // Handle different possible values for is_active\r\n          const isActiveValue: any = student.is_active;\r\n          const isActive = isActiveValue === true || \r\n                          isActiveValue === 1 || \r\n                          isActiveValue === '1' || \r\n                          String(isActiveValue).toLowerCase() === 'true';\r\n          return isActive;\r\n        });\r\n      } else if (statusFilter === 'inactive') {\r\n        result = result.filter(student => {\r\n          // Handle different possible values for is_active\r\n          const isActiveValue: any = student.is_active;\r\n          const isInactive = isActiveValue === false || \r\n                            isActiveValue === 0 || \r\n                            isActiveValue === '0' || \r\n                            String(isActiveValue).toLowerCase() === 'false' ||\r\n                            isActiveValue === null ||\r\n                            isActiveValue === undefined;\r\n          return isInactive;\r\n        });\r\n      }\r\n      \r\n      console.log('Students after status filtering:', result.length);\r\n    }\r\n    \r\n    console.log('Filtered students:', result.length);\r\n    setFilteredStudents(result);\r\n  }, [searchTerm, statusFilter, students]);\r\n\r\n  const handleSearch = (term: string) => {\r\n    setSearchTerm(term);\r\n  };\r\n\r\n  const handleStatusFilterChange = (value: string) => {\r\n    setStatusFilter(value);\r\n  };\r\n\r\n  const handlePageChange = (page: number) => {\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  const confirmDelete = (studentId: string) => {\r\n    setStudentToDelete(studentId);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!studentToDelete) return;\r\n\r\n    try {\r\n      setIsDeleting(true);\r\n      \r\n      // Delete student using API\r\n      await studentApi.deleteStudent(studentToDelete);\r\n      \r\n      // Remove from local state\r\n      const updatedStudents = students.filter(student => student.id !== studentToDelete);\r\n      setStudents(updatedStudents);\r\n      setFilteredStudents(updatedStudents);\r\n      \r\n      // Close modal\r\n      setShowDeleteModal(false);\r\n      setStudentToDelete(null);\r\n    } catch (error) {\r\n      console.error('Error deleting student:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(`Failed to delete student: ${error.message}`);\r\n      } else {\r\n        setError('Failed to delete student. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleToggleStatus = async (studentId: string) => {\r\n    try {\r\n      setTogglingStatusId(studentId);\r\n      \r\n      // Toggle status using API\r\n      const response = await studentApi.toggleStudentStatus(studentId);\r\n      \r\n      // Update local state with new status and room information\r\n      const updatedStudents = (Array.isArray(students) ? students : []).map(student => \r\n        student.id === studentId \r\n          ? { \r\n              ...student, \r\n              is_active: response.is_active,\r\n              room_id: response.student.room_id,\r\n              room: response.student.room\r\n            }\r\n          : student\r\n      );\r\n      \r\n      setStudents(updatedStudents);\r\n      setFilteredStudents(updatedStudents);\r\n      \r\n      // Show a success message if room was removed\r\n      if (response.room_removed) {\r\n        // You could add a toast notification here\r\n        console.log('Student deactivated and room assignment removed');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling student status:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(`Failed to update student status: ${error.message}`);\r\n      } else {\r\n        setError('Failed to update student status. Please try again.');\r\n      }\r\n    } finally {\r\n      setTogglingStatusId(null);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (isActive: boolean) => {\r\n    return isActive ? (\r\n      <span className=\"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800\">\r\n        Active\r\n      </span>\r\n    ) : (\r\n      <span className=\"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800\">\r\n        Inactive\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const getTotalAvailableBeds = () => {\r\n    // Calculate total available beds from all rooms based on their capacity and occupied beds\r\n    let totalAvailable = 0;\r\n    \r\n    rooms.forEach(room => {\r\n      const capacity = parseInt(String(room.capacity || 0));\r\n      // Use occupied_beds if available from backend, otherwise count students\r\n      const occupied = room.occupied_beds || students.filter(s => s.room_id === room.id && s.is_active).length;\r\n      const available = Math.max(0, capacity - occupied);\r\n      totalAvailable += available;\r\n    });\r\n    \r\n    return totalAvailable;\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Student Management</h1>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-4 md:p-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header Section */}\r\n        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-6\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Students</h1>\r\n            <p className=\"text-sm text-gray-600 mt-1\">Manage all students in the hostel</p>\r\n          </div>\r\n          <div className=\"mt-4 md:mt-0\">\r\n            <Button\r\n              onClick={() => router.push('/admin/student/create')}\r\n              variant=\"primary\"\r\n            >\r\n              Add New Student\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Summary Stats */}\r\n        {!isLoading && students.length > 0 && (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">{students.length}</p>\r\n                  <p className=\"text-sm text-gray-500\">Total Students</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-green-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">\r\n                    {students.filter(s => s.is_active).length}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">Active Students</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-red-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">\r\n                    {students.filter(s => !s.is_active).length}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">Inactive Students</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-lg shadow-sm p-4 border\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"p-2 bg-yellow-100 rounded-lg\">\r\n                  <svg className=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-2xl font-semibold text-gray-900\">\r\n                    {getTotalAvailableBeds()}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">Available Beds</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Search and Filter Bar */}\r\n        <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\r\n          <div className=\"flex flex-col md:flex-row gap-4\">\r\n            <div className=\"w-full md:w-1/2\">\r\n              <SearchBar\r\n                value={searchTerm}\r\n                onChange={handleSearch}\r\n                placeholder=\"Search by name, email, or phone number...\"\r\n              />\r\n            </div>\r\n            <div className=\"w-full md:w-1/2 md:flex md:justify-end\">\r\n              <select\r\n                value={statusFilter}\r\n                onChange={(e) => handleStatusFilterChange(e.target.value)}\r\n                className=\"w-full md:w-auto px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-[#235999] focus:border-[#235999] outline-none transition-all duration-200\"\r\n              >\r\n                <option value=\"\">All Status</option>\r\n                <option value=\"active\">Active</option>\r\n                <option value=\"inactive\">Inactive</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Students Table */}\r\n        <div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\r\n          {filteredStudents.length > 0 ? (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full text-sm text-left text-gray-800\">\r\n                <thead className=\"text-xs text-gray-700 uppercase bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3\">Student</th>\r\n                    <th className=\"px-6 py-3\">Room</th>\r\n                    <th className=\"px-6 py-3\">Contact</th>\r\n                    <th className=\"px-6 py-3\">Status</th>\r\n                    <th className=\"px-6 py-3\">Joined Date</th>\r\n                    <th className=\"px-6 py-3 text-right\">Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {(Array.isArray(filteredStudents) ? filteredStudents : []).map(student => (\r\n                    <tr \r\n                      key={student.id}\r\n                      className=\"border-b hover:bg-gray-50\"\r\n                    >\r\n                      <td className=\"px-6 py-4\">\r\n                        <div className=\"flex items-center\">\r\n                          <div \r\n                            className=\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-sm mr-3 overflow-hidden cursor-pointer\"\r\n                            onClick={() => {\r\n                              if (student.student_image) {\r\n                                setSelectedPhoto(getImageUrl(student.student_image));\r\n                                setShowPhotoModal(true);\r\n                              }\r\n                            }}\r\n                            title={student.student_image ? \"Click to enlarge\" : \"No photo available\"}\r\n                          >\r\n                            {student.student_image ? (\r\n                              <>\r\n                              {/* eslint-disable-next-line @next/next/no-img-element -- server-hosted student thumbnails; native <img> is used for preview and modal open behavior */}\r\n                              <img \r\n                                src={getImageUrl(student.student_image)} \r\n                                alt={student.student_name}\r\n                                className=\"h-full w-full object-cover\" \r\n                              />\r\n                              </>\r\n                            ) : (\r\n                              student.student_name.charAt(0).toUpperCase()\r\n                            )}\r\n                          </div>\r\n                          <div>\r\n                            <div className=\"font-medium text-gray-900\">{student.student_name}</div>\r\n                            <div className=\"text-xs text-gray-500\">{student.email}</div>\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        {student.room ? (\r\n                          <div>\r\n                            <div className=\"font-medium\">{student.room.room_name}</div>\r\n                            <div className=\"text-xs text-gray-500\">\r\n                              {student.room.block ? student.room.block.block_name : 'No Block'}\r\n                            </div>\r\n                          </div>\r\n                        ) : (\r\n                          <span className=\"text-gray-500\">Not assigned</span>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        <div>{student.contact_number}</div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        {getStatusBadge(student.is_active)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4\">\r\n                        {formatDate(student.created_at)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 text-right\">\r\n                        <div className=\"flex items-center justify-end space-x-2\">\r\n                          {/* Toggle Status Button */}\r\n                          <button\r\n                            onClick={() => handleToggleStatus(student.id)}\r\n                            disabled={togglingStatusId === student.id}\r\n                            className={`p-2 rounded-lg transition-colors ${\r\n                              student.is_active\r\n                                ? 'bg-red-50 text-red-600 hover:bg-red-100'\r\n                                : 'bg-green-50 text-green-600 hover:bg-green-100'\r\n                            } ${togglingStatusId === student.id ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                            title={student.is_active ? 'Deactivate' : 'Activate'}\r\n                          >\r\n                            {togglingStatusId === student.id ? (\r\n                              <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                              </svg>\r\n                            ) : student.is_active ? (\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\" />\r\n                              </svg>\r\n                            ) : (\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                              </svg>\r\n                            )}\r\n                          </button>\r\n                          \r\n                          <ActionButtons\r\n                            viewUrl={`/admin/student/${student.id}`}\r\n                            editUrl={`/admin/student/${student.id}/edit`}\r\n                            onDelete={() => confirmDelete(student.id)}\r\n                            isDeleting={isDeleting && studentToDelete === student.id}\r\n                            style=\"compact\"\r\n                          />\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-12\">\r\n              <svg className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\r\n              </svg>\r\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No students found</h3>\r\n              <p className=\"mt-1 text-sm text-gray-500\">\r\n                {searchTerm || statusFilter ? 'Try adjusting your search or filter criteria.' : 'Get started by adding a new student.'}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Pagination */}\r\n          {totalPages > 1 && (\r\n            <div className=\"flex justify-between items-center px-6 py-3 bg-gray-50\">\r\n              <div className=\"text-sm text-gray-500\">\r\n                Showing page {currentPage} of {totalPages}\r\n              </div>\r\n              <div className=\"flex space-x-1\">\r\n                <button\r\n                  onClick={() => handlePageChange(Math.max(1, currentPage - 1))}\r\n                  disabled={currentPage === 1}\r\n                  className={`px-3 py-1 rounded ${\r\n                    currentPage === 1\r\n                      ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\r\n                      : 'bg-white text-gray-700 hover:bg-gray-100'\r\n                  }`}\r\n                >\r\n                  Previous\r\n                </button>\r\n                <button\r\n                  onClick={() => handlePageChange(Math.min(totalPages, currentPage + 1))}\r\n                  disabled={currentPage === totalPages}\r\n                  className={`px-3 py-1 rounded ${\r\n                    currentPage === totalPages\r\n                      ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\r\n                      : 'bg-white text-gray-700 hover:bg-gray-100'\r\n                  }`}\r\n                >\r\n                  Next\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={showDeleteModal}\r\n        title=\"Delete Student\"\r\n        message=\"Are you sure you want to delete this student? This action cannot be undone.\"\r\n        confirmText={isDeleting ? \"Deleting...\" : \"Delete\"}\r\n        cancelText=\"Cancel\"\r\n        isLoading={isDeleting}\r\n        onConfirm={handleDelete}\r\n        onCancel={() => {\r\n          setShowDeleteModal(false);\r\n          setStudentToDelete(null);\r\n        }}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Photo Popup Modal */}\r\n      {showPhotoModal && selectedPhoto && (\r\n        <div \r\n          className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\"\r\n          onClick={() => setShowPhotoModal(false)}\r\n        >\r\n          <div \r\n            className=\"relative max-w-2xl max-h-[80vh] bg-white rounded-lg shadow-xl overflow-hidden\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <button\r\n              className=\"absolute top-2 right-2 bg-white rounded-full p-1 shadow-md hover:bg-gray-100\"\r\n              onClick={() => setShowPhotoModal(false)}\r\n            >\r\n              <svg className=\"w-6 h-6 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n            {/* eslint-disable-next-line @next/next/no-img-element -- photo modal uses native <img> for direct preview */}\r\n            <img \r\n              src={selectedPhoto} \r\n              alt=\"Student Photo\" \r\n              className=\"max-h-[80vh] object-contain\"\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\supplier\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentSupplier' is assigned a value but never used.","line":32,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { supplierApi, SupplierFormData, Supplier, ApiError } from '@/lib/api/index';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  TableSkeleton\r\n} from '@/components/ui';\r\n\r\nexport default function EditSupplier() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const supplierId = params.id as string;\r\n\r\n  const [formData, setFormData] = useState<SupplierFormData>({\r\n    name: '',\r\n    email: '',\r\n    contact_number: '',\r\n    address: '',\r\n    description: '',\r\n    pan_number: '',\r\n    opening_balance: 0,\r\n    balance_type: 'due',\r\n  });\r\n  \r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [currentSupplier, setCurrentSupplier] = useState<Supplier | null>(null);\r\n\r\n  // Fetch existing supplier data\r\n  useEffect(() => {\r\n    const fetchSupplierData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        const supplier = await supplierApi.getSupplier(supplierId);\r\n        setCurrentSupplier(supplier);\r\n        \r\n        setFormData({\r\n          name: supplier.name,\r\n          email: supplier.email || '',\r\n          contact_number: supplier.contact_number,\r\n          address: supplier.address,\r\n          description: supplier.description || '',\r\n          pan_number: supplier.pan_number || '',\r\n          opening_balance: supplier.opening_balance || 0,\r\n          balance_type: supplier.balance_type || 'due',\r\n        });\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching supplier data:', error);\r\n        if (error instanceof ApiError) {\r\n          setErrors({\r\n            fetch: `Failed to load supplier: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            fetch: 'Failed to load supplier data. Please try again.'\r\n          });\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (supplierId) {\r\n      fetchSupplierData();\r\n    }\r\n  }, [supplierId]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    if (name === 'opening_balance') {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value ? parseFloat(value) : 0\r\n      }));\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value\r\n      }));\r\n    }\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.name.trim()) {\r\n      newErrors.name = 'Supplier name is required';\r\n    }\r\n\r\n    if (formData.email && !/^\\S+@\\S+\\.\\S+$/.test(formData.email.trim())) {\r\n      newErrors.email = 'Please enter a valid email address';\r\n    }\r\n\r\n    if (!formData.contact_number.trim()) {\r\n      newErrors.contact_number = 'Contact number is required';\r\n    } else if (!/^\\d{10}$/.test(formData.contact_number.trim())) {\r\n      newErrors.contact_number = 'Please enter a valid 10-digit phone number';\r\n    }\r\n\r\n    if (!formData.address.trim()) {\r\n      newErrors.address = 'Address is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      await supplierApi.updateSupplier(supplierId, formData);\r\n      \r\n      // Redirect to suppliers list on success\r\n      router.push('/admin/supplier');\r\n      \r\n    } catch (error) {\r\n      console.error('Error updating supplier:', error);\r\n      if (error instanceof ApiError) {\r\n        // Handle validation errors from API\r\n        if (error.validation) {\r\n          const validationErrors: Record<string, string> = {};\r\n          \r\n          // Convert validation errors from API to form errors\r\n          Object.entries(error.validation).forEach(([field, messages]) => {\r\n            validationErrors[field] = Array.isArray(messages) ? messages[0] : messages;\r\n          });\r\n          \r\n          setErrors({\r\n            ...validationErrors,\r\n            submit: `Failed to update supplier: ${error.message}`\r\n          });\r\n        } else {\r\n          setErrors({\r\n            submit: `Failed to update supplier: ${error.message}`\r\n          });\r\n        }\r\n      } else {\r\n        setErrors({\r\n          submit: 'An error occurred while updating the supplier. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Edit Supplier</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading supplier data...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (errors.fetch) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{errors.fetch}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/admin/supplier')}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Back to Suppliers\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Supplier</h1>\r\n        </div>\r\n\r\n        {/* Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-700 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Basic Information Section */}\r\n            <div className=\"mb-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Basic Information</h2>\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Supplier Name */}\r\n                <FormField\r\n                  name=\"name\"\r\n                  label=\"Supplier Name\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={handleInputChange}\r\n                  error={errors.name}\r\n                  placeholder=\"Enter supplier name\"\r\n                />\r\n\r\n                {/* Email Address */}\r\n                <FormField\r\n                  name=\"email\"\r\n                  label=\"Email Address\"\r\n                  type=\"email\"\r\n                  value={formData.email || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.email}\r\n                  placeholder=\"Enter email address\"\r\n                />\r\n\r\n                {/* Contact Number */}\r\n                <FormField\r\n                  name=\"contact_number\"\r\n                  label=\"Contact Number\"\r\n                  required\r\n                  value={formData.contact_number}\r\n                  onChange={handleInputChange}\r\n                  error={errors.contact_number}\r\n                  placeholder=\"Enter contact number\"\r\n                />\r\n\r\n                {/* PAN Number */}\r\n                <FormField\r\n                  name=\"pan_number\"\r\n                  label=\"PAN Number\"\r\n                  value={formData.pan_number || ''}\r\n                  onChange={handleInputChange}\r\n                  error={errors.pan_number}\r\n                  placeholder=\"Enter PAN number\"\r\n                />\r\n\r\n                {/* Address - Full Width */}\r\n                <div className=\"md:col-span-2\">\r\n                  <FormField\r\n                    name=\"address\"\r\n                    label=\"Address\"\r\n                    required\r\n                    value={formData.address}\r\n                    onChange={handleInputChange}\r\n                    error={errors.address}\r\n                    placeholder=\"Enter address\"\r\n                    type=\"textarea\"\r\n                    rows={2}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Balance Information Section */}\r\n            <div className=\"mb-4\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Balance Information</h2>\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Opening Balance */}\r\n                <FormField\r\n                  name=\"opening_balance\"\r\n                  label=\"Opening Balance\"\r\n                  type=\"text\"\r\n                  value={formData.opening_balance?.toString() || '0'}\r\n                  onChange={handleInputChange}\r\n                  error={errors.opening_balance}\r\n                  placeholder=\"Enter opening balance\"\r\n                />\r\n\r\n                {/* Balance Type */}\r\n                <div>\r\n                  <label htmlFor=\"balance_type\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                    Balance Type\r\n                  </label>\r\n                  <select\r\n                    id=\"balance_type\"\r\n                    name=\"balance_type\"\r\n                    value={formData.balance_type || 'due'}\r\n                    onChange={handleInputChange}\r\n                    className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                  >\r\n                    <option value=\"due\">Due (Payable)</option>\r\n                    <option value=\"advance\">Advance (Receivable)</option>\r\n                  </select>\r\n                  {errors.balance_type && (\r\n                    <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                      <svg className=\"w-3.5 h-3.5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      {errors.balance_type}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-2 pt-4 border-t border-gray-200 mt-4\">\r\n              <CancelButton onClick={() => router.push('/admin/supplier')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Updating...\"\r\n              >\r\n                Update Supplier\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\supplier\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[906,909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[906,909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getDaysAgo' is assigned a value but never used.","line":74,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5618,5621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5618,5621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getBalanceTypeDisplay' is assigned a value but never used.","line":307,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":307,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":851,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":851,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33870,33873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33870,33873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { supplierApi, Supplier, ApiError } from '@/lib/api/index';\r\nimport { Button, ConfirmModal, TableSkeleton, SuccessToast } from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function SupplierDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const supplierId = params.id as string;\r\n\r\n  const [supplier, setSupplier] = useState<Supplier | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [uploadModalOpen, setUploadModalOpen] = useState(false);\r\n  const [editModalOpen, setEditModalOpen] = useState(false);\r\n  const [selectedAttachment, setSelectedAttachment] = useState<any>(null);\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n  const [uploadName, setUploadName] = useState('');\r\n  const [uploadType, setUploadType] = useState('');\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [deleteAttachmentModalOpen, setDeleteAttachmentModalOpen] = useState(false);\r\n  const [attachmentIdToDelete, setAttachmentIdToDelete] = useState<string>('');\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch supplier data\r\n  useEffect(() => {\r\n    const fetchSupplier = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const supplierData = await supplierApi.getSupplier(supplierId);\r\n        setSupplier(supplierData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching supplier:', error);\r\n        if (error instanceof ApiError) {\r\n          if (error.status === 404) {\r\n            setError(`Supplier with ID ${supplierId} not found. It may have been deleted or the ID is incorrect.`);\r\n          } else {\r\n            setError(`Failed to load supplier: ${error.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load supplier data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (supplierId) {\r\n      fetchSupplier();\r\n    }\r\n  }, [supplierId]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n  \r\n  const getDaysAgo = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    const today = new Date();\r\n    const diffTime = Math.abs(today.getTime() - date.getTime());\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n    return diffDays === 1 ? '1 day ago' : `${diffDays} days ago`;\r\n  };\r\n\r\n  const [deleteModal, setDeleteModal] = useState<boolean>(false);\r\n\r\n  const handleDeleteClick = () => {\r\n    setDeleteModal(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      await supplierApi.deleteSupplier(supplierId);\r\n      \r\n      // Redirect to suppliers list after successful deletion\r\n      router.push('/admin/supplier');\r\n    } catch (error) {\r\n      console.error('Error deleting supplier:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({\r\n          show: true,\r\n          message: `Failed to delete supplier: ${error.message}`,\r\n          type: 'error'\r\n        });\r\n      } else {\r\n        setAlert({\r\n          show: true,\r\n          message: 'Failed to delete supplier. Please try again.',\r\n          type: 'error'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteModal(false);\r\n    }\r\n  };\r\n  \r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files && e.target.files[0]) {\r\n      setSelectedFile(e.target.files[0]);\r\n    }\r\n  };\r\n  \r\n  const handleUploadSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!selectedFile || !uploadName || !uploadType) return;\r\n    \r\n    try {\r\n      setIsUploading(true);\r\n      await supplierApi.uploadAttachment(supplierId, selectedFile, uploadName, uploadType);\r\n      \r\n      // Refresh data\r\n      const updatedSupplier = await supplierApi.getSupplier(supplierId);\r\n      setSupplier(updatedSupplier);\r\n      \r\n      // Reset form\r\n      setSelectedFile(null);\r\n      setUploadName('');\r\n      setUploadType('');\r\n      setUploadModalOpen(false);\r\n      \r\n      // Show success message\r\n      setAlert({\r\n        show: true,\r\n        message: 'Attachment uploaded successfully!',\r\n        type: 'success'\r\n      });\r\n      \r\n      setTimeout(() => {\r\n        setAlert({ show: false, message: '', type: 'success' });\r\n      }, 3000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error uploading attachment:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({\r\n          show: true,\r\n          message: `Failed to upload attachment: ${error.message}`,\r\n          type: 'error'\r\n        });\r\n      } else {\r\n        setAlert({\r\n          show: true,\r\n          message: 'Failed to upload attachment. Please try again.',\r\n          type: 'error'\r\n        });\r\n      }\r\n      \r\n      setTimeout(() => {\r\n        setAlert({ show: false, message: '', type: 'success' });\r\n      }, 5000);\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n  \r\n  const handleEditAttachment = (attachment: any) => {\r\n    setSelectedAttachment(attachment);\r\n    setUploadName(attachment.name);\r\n    setUploadType(attachment.type);\r\n    setSelectedFile(null);\r\n    setEditModalOpen(true);\r\n  };\r\n  \r\n  const handleEditSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!selectedAttachment) return;\r\n    \r\n    try {\r\n      setIsUploading(true);\r\n      \r\n      const data: { file?: File, name?: string, type?: string } = {};\r\n      \r\n      if (uploadName !== selectedAttachment.name) {\r\n        data.name = uploadName;\r\n      }\r\n      \r\n      if (uploadType !== selectedAttachment.type) {\r\n        data.type = uploadType;\r\n      }\r\n      \r\n      if (selectedFile) {\r\n        data.file = selectedFile;\r\n      }\r\n      \r\n      await supplierApi.updateAttachment(supplierId, selectedAttachment.id.toString(), data);\r\n      \r\n      // Refresh data\r\n      const updatedSupplier = await supplierApi.getSupplier(supplierId);\r\n      setSupplier(updatedSupplier);\r\n      \r\n      // Reset form\r\n      setSelectedFile(null);\r\n      setUploadName('');\r\n      setUploadType('');\r\n      setSelectedAttachment(null);\r\n      setEditModalOpen(false);\r\n      \r\n      // Show success message\r\n      setAlert({\r\n        show: true,\r\n        message: 'Attachment updated successfully!',\r\n        type: 'success'\r\n      });\r\n      \r\n      setTimeout(() => {\r\n        setAlert({ show: false, message: '', type: 'success' });\r\n      }, 3000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error updating attachment:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({\r\n          show: true,\r\n          message: `Failed to update attachment: ${error.message}`,\r\n          type: 'error'\r\n        });\r\n      } else {\r\n        setAlert({\r\n          show: true,\r\n          message: 'Failed to update attachment. Please try again.',\r\n          type: 'error'\r\n        });\r\n      }\r\n      \r\n      setTimeout(() => {\r\n        setAlert({ show: false, message: '', type: 'success' });\r\n      }, 5000);\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n  \r\n  const handleDeleteAttachment = (attachmentId: string) => {\r\n    setAttachmentIdToDelete(attachmentId);\r\n    setDeleteAttachmentModalOpen(true);\r\n  };\r\n  \r\n  const confirmDeleteAttachment = async () => {\r\n    if (!attachmentIdToDelete) return;\r\n    \r\n    try {\r\n      setIsUploading(true);\r\n      await supplierApi.deleteAttachment(supplierId, attachmentIdToDelete);\r\n      \r\n      // Refresh data\r\n      const updatedSupplier = await supplierApi.getSupplier(supplierId);\r\n      setSupplier(updatedSupplier);\r\n      \r\n      // Reset state\r\n      setAttachmentIdToDelete('');\r\n      setDeleteAttachmentModalOpen(false);\r\n      \r\n      // Show success message\r\n      setAlert({\r\n        show: true,\r\n        message: 'Attachment deleted successfully!',\r\n        type: 'success'\r\n      });\r\n      \r\n      setTimeout(() => {\r\n        setAlert({ show: false, message: '', type: 'success' });\r\n      }, 3000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting attachment:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({\r\n          show: true,\r\n          message: `Failed to delete attachment: ${error.message}`,\r\n          type: 'error'\r\n        });\r\n      } else {\r\n        setAlert({\r\n          show: true,\r\n          message: 'Failed to delete attachment. Please try again.',\r\n          type: 'error'\r\n        });\r\n      }\r\n      \r\n      setTimeout(() => {\r\n        setAlert({ show: false, message: '', type: 'success' });\r\n      }, 5000);\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  const getBalanceTypeDisplay = (type?: string) => {\r\n    if (type === 'due') return 'Due (Payable)';\r\n    if (type === 'advance') return 'Advance (Receivable)';\r\n    return 'Not Set';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Supplier Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading supplier details...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <div className=\"mt-3 space-x-2\">\r\n            <Button\r\n              onClick={() => window.location.reload()}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Retry\r\n            </Button>\r\n            <Button\r\n              onClick={() => router.push('/admin/supplier')}\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n            >\r\n              Back to Suppliers\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!supplier) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-500\">Supplier not found</p>\r\n          <button\r\n            onClick={() => router.push('/admin/supplier')}\r\n            className=\"mt-2 text-[#235999] hover:text-[#1e4d87]\"\r\n          >\r\n            Back to Suppliers\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal}\r\n        title=\"Delete Supplier\"\r\n        message=\"Are you sure you want to delete this supplier? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={handleDelete}\r\n        onCancel={() => setDeleteModal(false)}\r\n        isLoading={isDeleting}\r\n        variant=\"danger\"\r\n      />\r\n      \r\n      {/* File Upload Modal */}\r\n      {uploadModalOpen && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4\">\r\n          <div className=\"bg-white rounded-lg w-full max-w-md\">\r\n            <div className=\"p-6\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Upload Attachment</h3>\r\n              <form onSubmit={handleUploadSubmit}>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <label htmlFor=\"upload-name\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Name\r\n                    </label>\r\n                    <input \r\n                      type=\"text\"\r\n                      id=\"upload-name\"\r\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                      value={uploadName}\r\n                      onChange={(e) => setUploadName(e.target.value)}\r\n                      required\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    <label htmlFor=\"upload-type\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Document Type\r\n                    </label>\r\n                    <select\r\n                      id=\"upload-type\"\r\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                      value={uploadType}\r\n                      onChange={(e) => setUploadType(e.target.value)}\r\n                      required\r\n                    >\r\n                      <option value=\"\">Select type...</option>\r\n                      <option value=\"Invoice\">Invoice</option>\r\n                      <option value=\"Contract\">Contract</option>\r\n                      <option value=\"Receipt\">Receipt</option>\r\n                      <option value=\"Agreement\">Agreement</option>\r\n                      <option value=\"Other\">Other</option>\r\n                    </select>\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    <label htmlFor=\"attachment-file\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      File\r\n                    </label>\r\n                    <input \r\n                      type=\"file\"\r\n                      id=\"attachment-file\"\r\n                      className=\"w-full text-sm text-gray-500\r\n                        file:mr-4 file:py-2 file:px-4\r\n                        file:rounded-md file:border-0\r\n                        file:text-sm file:font-medium\r\n                        file:bg-blue-50 file:text-blue-700\r\n                        hover:file:bg-blue-100\"\r\n                      onChange={handleFileChange}\r\n                      required\r\n                    />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"mt-6 flex items-center justify-end space-x-2\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setUploadModalOpen(false)}\r\n                    className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"px-4 py-2 text-sm font-medium text-white bg-[#235999] rounded-md hover:bg-[#1e4d87]\"\r\n                    disabled={isUploading}\r\n                  >\r\n                    {isUploading ? 'Uploading...' : 'Upload'}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Edit Attachment Modal */}\r\n      {editModalOpen && selectedAttachment && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4\">\r\n          <div className=\"bg-white rounded-lg w-full max-w-md\">\r\n            <div className=\"p-6\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Edit Attachment</h3>\r\n              <form onSubmit={handleEditSubmit}>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <label htmlFor=\"edit-name\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Name\r\n                    </label>\r\n                    <input \r\n                      type=\"text\"\r\n                      id=\"edit-name\"\r\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                      value={uploadName}\r\n                      onChange={(e) => setUploadName(e.target.value)}\r\n                      required\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    <label htmlFor=\"edit-type\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Document Type\r\n                    </label>\r\n                    <select\r\n                      id=\"edit-type\"\r\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                      value={uploadType}\r\n                      onChange={(e) => setUploadType(e.target.value)}\r\n                      required\r\n                    >\r\n                      <option value=\"\">Select type...</option>\r\n                      <option value=\"Invoice\">Invoice</option>\r\n                      <option value=\"Contract\">Contract</option>\r\n                      <option value=\"Receipt\">Receipt</option>\r\n                      <option value=\"Agreement\">Agreement</option>\r\n                      <option value=\"Other\">Other</option>\r\n                    </select>\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    <label htmlFor=\"edit-attachment-file\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Replace File (optional)\r\n                    </label>\r\n                    <input \r\n                      type=\"file\"\r\n                      id=\"edit-attachment-file\"\r\n                      className=\"w-full text-sm text-gray-500\r\n                        file:mr-4 file:py-2 file:px-4\r\n                        file:rounded-md file:border-0\r\n                        file:text-sm file:font-medium\r\n                        file:bg-blue-50 file:text-blue-700\r\n                        hover:file:bg-blue-100\"\r\n                      onChange={handleFileChange}\r\n                    />\r\n                    <p className=\"mt-1 text-xs text-gray-500\">Current file: {selectedAttachment.path.split('/').pop()}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"mt-6 flex items-center justify-end space-x-2\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      setEditModalOpen(false);\r\n                      setSelectedAttachment(null);\r\n                      setUploadName('');\r\n                      setUploadType('');\r\n                      setSelectedFile(null);\r\n                    }}\r\n                    className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"px-4 py-2 text-sm font-medium text-white bg-[#235999] rounded-md hover:bg-[#1e4d87]\"\r\n                    disabled={isUploading}\r\n                  >\r\n                    {isUploading ? 'Saving...' : 'Save Changes'}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Delete Attachment Confirmation Modal */}\r\n      {deleteAttachmentModalOpen && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4\">\r\n          <div className=\"bg-white rounded-lg w-full max-w-md\">\r\n            <div className=\"p-6\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Delete Attachment</h3>\r\n              <p className=\"text-gray-600 mb-4\">Are you sure you want to delete this attachment? This action cannot be undone.</p>\r\n              \r\n              <div className=\"flex items-center justify-end space-x-2\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setDeleteAttachmentModalOpen(false)}\r\n                  className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={confirmDeleteAttachment}\r\n                  className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700\"\r\n                  disabled={isUploading}\r\n                >\r\n                  {isUploading ? 'Deleting...' : 'Delete'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-semibold text-gray-900\">{supplier.name}</h1>\r\n              {supplier.email && (\r\n                <p className=\"text-sm text-gray-500\">{supplier.email}</p>\r\n              )}\r\n            </div>\r\n            <div className=\"flex space-x-2\">\r\n              <Button\r\n                onClick={() => setUploadModalOpen(true)}\r\n                variant=\"secondary\"\r\n              >\r\n                Upload Attachment\r\n              </Button>\r\n              <Button\r\n                onClick={() => router.push(`/admin/supplier/${supplier.id}/edit`)}\r\n                variant=\"primary\"\r\n              >\r\n                Edit Supplier\r\n              </Button>\r\n              <Button\r\n                onClick={handleDeleteClick}\r\n                disabled={isDeleting}\r\n                variant=\"danger\"\r\n                loading={isDeleting}\r\n              >\r\n                {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Information Cards */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\r\n          {/* Basic Information Card */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n            <div className=\"p-5 border-b border-gray-100\">\r\n              <h3 className=\"text-lg font-medium text-[#235999]\">Basic Information</h3>\r\n            </div>\r\n            <div className=\"p-5\">\r\n              <div className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-3 border-b border-gray-100 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Name</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm text-gray-900\">{supplier.name}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-3 border-b border-gray-100 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Contact</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm text-gray-900\">{supplier.contact_number}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-3 border-b border-gray-100 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Email</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm text-gray-900\">{supplier.email || 'N/A'}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-3 border-b border-gray-100 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Address</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm text-gray-900\">{supplier.address}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-3 border-b border-gray-100 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">PAN</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm text-gray-900\">{supplier.pan_number || 'N/A'}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-3 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Current Balance</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    {(() => {\r\n                      const totalDue = supplier.expenses?.reduce((acc, e) => acc + parseFloat(e.due_amount || 0), 0) || 0;\r\n                      return (\r\n                        <p className={`text-sm px-3 py-1 inline-block rounded-full ${\r\n                          totalDue > 0\r\n                            ? 'bg-orange-50 text-orange-700'\r\n                            : 'bg-green-50 text-green-700'\r\n                        }`}>\r\n                          NPR {totalDue.toFixed(2)} ({totalDue > 0 ? 'Due' : 'Paid'})\r\n                        </p>\r\n                      );\r\n                    })()}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Transaction Summary Card */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n            <div className=\"p-5 border-b border-gray-100\">\r\n              <h3 className=\"text-lg font-medium text-[#235999]\">Transaction Summary</h3>\r\n            </div>\r\n            <div className=\"p-5\">\r\n              <div className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-3 border-b border-gray-100 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Total Purchases</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm font-medium text-gray-900\">\r\n                      NPR {supplier.expenses?.reduce((acc, e) => acc + parseFloat(e.amount || 0), 0).toFixed(2) || '0.00'}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-3 border-b border-gray-100 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Total Payments</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm font-medium text-gray-900\">\r\n                      NPR {supplier.expenses?.reduce((acc, e) => acc + parseFloat(e.paid_amount || 0), 0).toFixed(2) || '0.00'}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-3 py-2\">\r\n                  <div className=\"col-span-1\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700\">Last Transaction</h4>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-sm text-gray-900\">\r\n                      {supplier.expenses && supplier.expenses.length > 0 \r\n                        ? formatDate(supplier.expenses[0].expense_date || supplier.expenses[0].created_at)\r\n                        : supplier.financials && supplier.financials.length > 0 \r\n                        ? formatDate(supplier.financials[0].payment_date)\r\n                        : 'No transactions yet'}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Attachments Section */}\r\n        {supplier.attachments && supplier.attachments.length > 0 && (\r\n          <div className=\"mt-8 pt-6 border-t border-gray-200\">\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Attachments</h3>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {supplier.attachments.map((attachment) => (\r\n                <div key={attachment.id} className=\"border border-gray-200 rounded-lg overflow-hidden\">\r\n                  <div className=\"p-4\">\r\n                    <p className=\"font-medium text-gray-900\">{attachment.name}</p>\r\n                    <p className=\"text-sm text-gray-500\">{attachment.type}</p>\r\n                    <div className=\"mt-3 flex items-center justify-between\">\r\n                      <a \r\n                        href={getImageUrl(attachment.path)}\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"text-[#235999] hover:text-[#1e4d87] text-sm\"\r\n                      >\r\n                        View Attachment\r\n                      </a>\r\n                      <div className=\"flex space-x-2\">\r\n                        <button\r\n                          onClick={() => handleEditAttachment(attachment)}\r\n                          className=\"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md\"\r\n                        >\r\n                          Edit\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDeleteAttachment(attachment.id.toString())}\r\n                          className=\"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded-md\"\r\n                        >\r\n                          Delete\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Supplier Transactions */}\r\n        <div className=\"mt-8 pt-6 border-t border-gray-200\">\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Supplier Transactions</h3>\r\n          {supplier.expenses && supplier.expenses.length > 0 ? (\r\n            <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Date\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Title\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Category\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Amount\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Payment Status\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {supplier.expenses.map((expense: any) => (\r\n                    <tr key={expense.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                        {new Date(expense.expense_date || expense.created_at).toLocaleDateString()}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                        {expense.title || 'N/A'}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\r\n                        {expense.expense_category?.name || expense.expense_type || 'N/A'}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                        <div className=\"font-semibold text-gray-900\">\r\n                          NPR {parseFloat(expense.amount || 0).toFixed(2)}\r\n                        </div>\r\n                        {expense.payment_status === 'partially_paid' && (\r\n                          <div className=\"text-xs text-gray-500 mt-0.5\">\r\n                            Paid: NPR {parseFloat(expense.paid_amount || 0).toFixed(2)}\r\n                          </div>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n                          expense.payment_status === 'paid' \r\n                            ? 'bg-green-100 text-green-800' \r\n                            : expense.payment_status === 'partially_paid'\r\n                            ? 'bg-yellow-100 text-yellow-800'\r\n                            : 'bg-red-100 text-red-800'\r\n                        }`}>\r\n                          {expense.payment_status === 'paid' ? 'Paid' : \r\n                           expense.payment_status === 'partially_paid' ? 'Partially Paid' : \r\n                           'Credit'}\r\n                        </span>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-gray-50 rounded-lg border border-gray-200 p-8 text-center\">\r\n              <svg className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n              </svg>\r\n              <p className=\"mt-2 text-gray-500\">No expense transactions found for this supplier</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Metadata */}\r\n        <div className=\"border-t border-gray-200 mt-8 pt-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n            <div>\r\n              <span className=\"font-medium text-gray-500\">Created:</span>\r\n              <span className=\"ml-2 text-gray-900\">{formatDate(supplier.created_at)}</span>\r\n            </div>\r\n            {supplier.updated_at && (\r\n              <div>\r\n                <span className=\"font-medium text-gray-500\">Last Updated:</span>\r\n                <span className=\"ml-2 text-gray-900\">{formatDate(supplier.updated_at)}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} // End of component\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\admin\\supplier\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCurrentPage' is assigned a value but never used.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalPages' is assigned a value but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getBalanceTypeDisplay' is assigned a value but never used.","line":136,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":136,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12844,12847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12844,12847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { supplierApi, Supplier, ApiError } from '@/lib/api/index';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  ConfirmModal, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\n\r\nexport default function SupplierList() {\r\n  const router = useRouter();\r\n  const [suppliers, setSuppliers] = useState<Supplier[]>([]);\r\n  const [filteredSuppliers, setFilteredSuppliers] = useState<Supplier[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteModal, setDeleteModal] = useState<{show: boolean, supplierId: string | null}>({\r\n    show: false,\r\n    supplierId: null\r\n  });\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch suppliers from API\r\n  useEffect(() => {\r\n    const fetchSuppliers = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const response = await supplierApi.getSuppliers(currentPage);\r\n        setSuppliers(response.data);\r\n        setFilteredSuppliers(response.data);\r\n        setTotalPages(response.last_page);\r\n      } catch (error) {\r\n        console.error('Error fetching suppliers:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch suppliers: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch suppliers. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchSuppliers();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredSuppliers(suppliers);\r\n    } else {\r\n      const filtered = suppliers.filter(supplier =>\r\n        supplier.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (supplier.email && supplier.email.toLowerCase().includes(searchQuery.toLowerCase())) ||\r\n        supplier.contact_number.toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredSuppliers(filtered);\r\n    }\r\n  }, [searchQuery, suppliers]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: '2-digit'\r\n    });\r\n  };\r\n\r\n  const handleDeleteSupplier = async (supplierId: string) => {\r\n    setDeleteModal({show: true, supplierId});\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    const supplierId = deleteModal.supplierId;\r\n    if (!supplierId) return;\r\n\r\n    try {\r\n      setIsDeleting(supplierId);\r\n      setDeleteModal({show: false, supplierId: null});\r\n      setAlert({show: true, message: 'Deleting supplier...', type: 'success'});\r\n      \r\n      await supplierApi.deleteSupplier(supplierId);\r\n      \r\n      // Remove from local state\r\n      const updatedSuppliers = suppliers.filter(supplier => supplier.id !== supplierId);\r\n      setSuppliers(updatedSuppliers);\r\n      setFilteredSuppliers(updatedSuppliers.filter(supplier =>\r\n        !searchQuery.trim() ||\r\n        supplier.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (supplier.email && supplier.email.toLowerCase().includes(searchQuery.toLowerCase())) ||\r\n        supplier.contact_number.toLowerCase().includes(searchQuery.toLowerCase())\r\n      ));\r\n      \r\n      setAlert({show: true, message: 'Supplier deleted successfully!', type: 'success'});\r\n      \r\n      // Hide alert after 2 seconds - optimized for faster UX\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error deleting supplier:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({show: true, message: `Failed to delete supplier: ${error.message}`, type: 'error'});\r\n      } else {\r\n        setAlert({show: true, message: 'Failed to delete supplier. Please try again.', type: 'error'});\r\n      }\r\n      \r\n      // Hide error alert after 3 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000);\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setDeleteModal({show: false, supplierId: null});\r\n  };\r\n\r\n  const getBalanceTypeDisplay = (type?: string) => {\r\n    if (type === 'due') return 'Due (Payable)';\r\n    if (type === 'advance') return 'Advance (Receivable)';\r\n    return 'Not Set';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Suppliers</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading suppliers...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Delete Confirmation Modal */}\r\n      <ConfirmModal\r\n        show={deleteModal.show}\r\n        title=\"Delete Supplier\"\r\n        message=\"Are you sure you want to delete this supplier? This action cannot be undone.\"\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={confirmDelete}\r\n        onCancel={cancelDelete}\r\n        isLoading={isDeleting !== null}\r\n        variant=\"danger\"\r\n      />\r\n\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Suppliers</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{suppliers.length} total suppliers</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/admin/supplier/create')}\r\n          icon={<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n          </svg>}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n        >\r\n          Add Supplier\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search suppliers...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredSuppliers.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No suppliers found' : 'No suppliers yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'Create your first supplier to get started'}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/admin/supplier/create')}\r\n              className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n            >\r\n              Create Supplier\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Name</div>\r\n              <div className=\"col-span-2\">Contact</div>\r\n              <div className=\"col-span-2\">PAN Number</div>\r\n              <div className=\"col-span-2\">Balance</div>\r\n              <div className=\"col-span-1 text-center pr-2\">Created</div>\r\n              <div className=\"col-span-2 text-center pl-2\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredSuppliers.map((supplier) => (\r\n              <div key={supplier.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Supplier Details */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{supplier.name}</div>\r\n                    <div className=\"flex items-center text-xs text-gray-500 mt-1\">\r\n                      <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n                      </svg>\r\n                      {supplier.email || 'No email provided'}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Contact */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700\">{supplier.contact_number}</div>\r\n                  </div>\r\n\r\n                  {/* PAN Number */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700\">{supplier.pan_number || 'Not provided'}</div>\r\n                  </div>\r\n\r\n                  {/* Balance */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-sm text-gray-700\">\r\n                      {(() => {\r\n                        const totalDue = supplier.expenses?.reduce((acc: number, e: any) => acc + parseFloat(e.due_amount || 0), 0) || 0;\r\n                        return (\r\n                          <>\r\n                            <span className={totalDue > 0 ? 'text-orange-600' : 'text-green-600'}>\r\n                              Rs. {totalDue.toFixed(2)}\r\n                            </span>\r\n                            <span className=\"ml-1 text-xs text-gray-500\">\r\n                              ({totalDue > 0 ? 'Due (Payable)' : 'Paid'})\r\n                            </span>\r\n                          </>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Created Date */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"text-xs text-gray-500 text-center pr-2\">\r\n                      {formatDate(supplier.created_at)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"pl-2 flex justify-center\">\r\n                      <ActionButtons \r\n                        viewUrl={`/admin/supplier/${supplier.id}`}\r\n                        editUrl={`/admin/supplier/${supplier.id}/edit`}\r\n                        onDelete={() => handleDeleteSupplier(supplier.id)}\r\n                        isDeleting={isDeleting === supplier.id}\r\n                        style=\"compact\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredSuppliers.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredSuppliers.length} of {suppliers.length} suppliers\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Image' is defined but never used.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'redirectToDashboard'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [mounted, isAuthenticated, user, redirectToDashboard]","fix":{"range":[1153,1185],"text":"[mounted, isAuthenticated, user, redirectToDashboard]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":76,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2236,2239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2236,2239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":229,"column":70,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[9369,9391],"text":"Don&apos;t have an account?"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[9369,9391],"text":"Don&lsquo;t have an account?"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[9369,9391],"text":"Don&#39;t have an account?"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[9369,9391],"text":"Don&rsquo;t have an account?"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/lib/auth';\r\nimport { Button } from '@/components/ui/button';\r\nimport { PasswordInput } from '@/components/ui/password-input';\r\nimport RegisterForm from '@/components/auth/RegisterForm';\r\nimport Image from \"next/image\";\r\n\r\ninterface LoginFormData {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport default function LoginPage() {\r\n  const [formData, setFormData] = useState<LoginFormData>({\r\n    email: '',\r\n    password: ''\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [mounted, setMounted] = useState(false);\r\n  const [showCreateAccount, setShowCreateAccount] = useState(false);\r\n  const { login, isAuthenticated, isLoading: authLoading, user } = useAuth();\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Only redirect after component is mounted to avoid hydration issues\r\n    if (mounted && isAuthenticated && user) {\r\n      redirectToDashboard(user.role);\r\n    }\r\n  }, [mounted, isAuthenticated, user]);\r\n\r\n  const redirectToDashboard = (role: string) => {\r\n    switch (role) {\r\n      case 'admin':\r\n        router.push('/admin');\r\n        break;\r\n      case 'student':\r\n        router.push('/student');\r\n        break;\r\n      case 'staff':\r\n        router.push('/staff');\r\n        break;\r\n      default:\r\n        router.push('/admin'); // Default to admin if role is unclear\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    // Clear error when user starts typing\r\n    if (error) setError('');\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const result = await login(formData.email, formData.password);\r\n      if (!result.success && result.message) {\r\n        setError(result.message);\r\n      }\r\n      // If successful, login function handles redirect automatically\r\n    } catch (error: any) {\r\n      // Handle any unexpected errors\r\n      setError('Login failed. Please check your credentials and try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const handleCreateAccountSuccess = () => {\r\n    setShowCreateAccount(false);\r\n    setError('');\r\n  };\r\n\r\n  const handleBackToLogin = () => {\r\n    setShowCreateAccount(false);\r\n    setError('');\r\n  };\r\n\r\n  // Prevent hydration mismatch by not rendering until mounted\r\n  if (!mounted) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-blue-50\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show loading while checking authentication\r\n  if (authLoading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-blue-50\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Don't render login form if already authenticated\r\n  if (isAuthenticated && user) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-blue-50\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-blue-50 py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full space-y-8\">\r\n        {/* Header */}\r\n        <div className=\"text-center\">\r\n          <div className=\"mx-auto h-16 w-16 bg-blue-600 rounded-xl flex items-center justify-center mb-6\">\r\n            <svg className=\"h-8 w-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\r\n            </svg>\r\n          </div>\r\n          <h2 className=\"text-3xl font-bold text-gray-900 mb-2\">\r\n            {showCreateAccount ? 'Create Account' : 'Welcome to HMS'}\r\n          </h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            {showCreateAccount \r\n              ? 'Create your account to access the system' \r\n              : 'Hostel Management System - Sign in to your account'\r\n            }\r\n          </p>\r\n        </div>\r\n\r\n        {/* Login or Register Form */}\r\n        {showCreateAccount ? (\r\n          <RegisterForm \r\n            onSuccess={handleCreateAccountSuccess} \r\n            onBackToLogin={handleBackToLogin} \r\n          />\r\n        ) : (\r\n          <>\r\n            {/* Login Form */}\r\n            <div className=\"bg-white shadow-xl rounded-2xl p-8 border border-gray-100\">\r\n              <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n                {error && (\r\n                  <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm\">\r\n                    <div className=\"flex items-center\">\r\n                      <svg className=\"h-4 w-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n                      </svg>\r\n                      {error}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Email\r\n                    </label>\r\n                    <input\r\n                      id=\"email\"\r\n                      name=\"email\"\r\n                      type=\"email\"\r\n                      autoComplete=\"email\"\r\n                      required\r\n                      value={formData.email}\r\n                      onChange={handleInputChange}\r\n                      className=\"appearance-none relative block w-full px-4 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\r\n                      placeholder=\"Enter your email\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <PasswordInput\r\n                      id=\"password\"\r\n                      name=\"password\"\r\n                      label=\"Password\"\r\n                      value={formData.password}\r\n                      onChange={handleInputChange}\r\n                      placeholder=\"Enter your password\"\r\n                      required\r\n                      autoComplete=\"current-password\"\r\n                      className=\"appearance-none relative block w-full px-4 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <Button\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                    className=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200\"\r\n                  >\r\n                    {loading ? (\r\n                      <div className=\"flex items-center\">\r\n                        <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                        Signing in...\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"flex items-center\">\r\n                        <svg className=\"h-4 w-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\r\n                        </svg>\r\n                        Sign In\r\n                      </div>\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n              </form>\r\n\r\n              {/* Create Account Option */}\r\n              <div className=\"mt-6\">\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-0 flex items-center\">\r\n                    <div className=\"w-full border-t border-gray-300\" />\r\n                  </div>\r\n                  <div className=\"relative flex justify-center text-sm\">\r\n                    <span className=\"px-2 bg-white text-gray-500\">Don't have an account?</span>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"mt-4\">\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"secondary\"\r\n                    onClick={() => setShowCreateAccount(true)}\r\n                    className=\"w-full flex justify-center py-3 px-4 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200\"\r\n                  >\r\n                    <div className=\"flex items-center\">\r\n                      <svg className=\"h-4 w-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\" />\r\n                      </svg>\r\n                      Create Account\r\n                    </div>\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {/* Footer */}\r\n        <div className=\"text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            Hostel Management System v1.0\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\checkin-checkout\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":7},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecord'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRecord, recordId]","fix":{"range":[971,981],"text":"[fetchRecord, recordId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1188,1191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1188,1191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2090,2093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2090,2093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { staffCheckInCheckOutApi, StaffCheckInCheckOut } from '@/lib/api/staff-checkincheckout.api';\r\nimport { Button } from '@/components/ui';\r\nimport { \r\n  ArrowLeft, \r\n  Clock, \r\n  Check, \r\n  X, \r\n  AlertCircle,\r\n  ArrowRight,\r\n  Calendar,\r\n  User,\r\n  Home\r\n} from 'lucide-react';\r\n\r\nexport default function StaffCheckinCheckoutDetailPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const recordId = params.id as string;\r\n  \r\n  const [loading, setLoading] = useState(true);\r\n  const [record, setRecord] = useState<StaffCheckInCheckOut | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [checkingIn, setCheckingIn] = useState(false);\r\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (recordId) {\r\n      fetchRecord();\r\n    }\r\n  }, [recordId]);\r\n\r\n  const fetchRecord = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await staffCheckInCheckOutApi.getMyRecord(recordId);\r\n      setRecord(response.data);\r\n    } catch (err: any) {\r\n      console.error('Failed to fetch record:', err);\r\n      setError(err.message || 'Failed to load record details');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCheckIn = async () => {\r\n    if (!record) return;\r\n    \r\n    try {\r\n      setCheckingIn(true);\r\n      setError(null);\r\n      \r\n      // Use current date and time for check-in\r\n      const now = new Date();\r\n      \r\n      await staffCheckInCheckOutApi.checkIn({\r\n        block_id: String(record.block?.id || ''),\r\n        remarks: `Checked in from detail page at ${now.toLocaleString()}`\r\n      });\r\n      \r\n      setSuccessMessage(`Successfully checked in at ${now.toLocaleString()}!`);\r\n      \r\n      // Refresh the record to get updated data\r\n      await fetchRecord();\r\n      \r\n      // Clear success message after 5 seconds\r\n      setTimeout(() => setSuccessMessage(null), 5000);\r\n    } catch (err: any) {\r\n      console.error('Failed to check in:', err);\r\n      setError(err.message || 'Failed to check in');\r\n    } finally {\r\n      setCheckingIn(false);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = () => {\r\n    if (!record) return null;\r\n    \r\n    switch (record.status) {\r\n      case 'pending':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 border border-yellow-200\">\r\n            <Clock className=\"w-4 h-4 mr-2\" />\r\n            Pending\r\n          </span>\r\n        );\r\n      case 'approved':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-800 border border-green-200\">\r\n            <Check className=\"w-4 h-4 mr-2\" />\r\n            Approved\r\n          </span>\r\n        );\r\n      case 'declined':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-red-100 text-red-800 border border-red-200\">\r\n            <X className=\"w-4 h-4 mr-2\" />\r\n            Declined\r\n          </span>\r\n        );\r\n      case 'checked_in':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-blue-100 text-blue-800 border border-blue-200\">\r\n            <ArrowRight className=\"w-4 h-4 mr-2\" />\r\n            Checked In\r\n          </span>\r\n        );\r\n      default:\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-800 border border-gray-200\">\r\n            <AlertCircle className=\"w-4 h-4 mr-2\" />\r\n            Unknown Status\r\n          </span>\r\n        );\r\n    }\r\n  };\r\n\r\n  const formatDateTime = (dateString: string) => {\r\n    return new Date(dateString).toLocaleString('en-US', {\r\n      weekday: 'short',\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      weekday: 'long',\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const calculateDuration = () => {\r\n    if (!record || !record.checkout_time) {\r\n      return 'N/A';\r\n    }\r\n    \r\n    // If staff has checked in, calculate duration between checkout and checkin\r\n    if (record.checkin_time) {\r\n      const checkoutTime = new Date(record.checkout_time);\r\n      const checkinTime = new Date(record.checkin_time);\r\n      const diffMs = checkinTime.getTime() - checkoutTime.getTime();\r\n      \r\n      const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n      \r\n      if (days > 0) {\r\n        return `${days}d ${hours}h ${minutes}m`;\r\n      } else if (hours > 0) {\r\n        return `${hours}h ${minutes}m`;\r\n      }\r\n      return `${minutes}m`;\r\n    }\r\n    \r\n    // If not checked in yet, calculate duration between checkout and estimated return\r\n    if (record.estimated_checkin_date) {\r\n      const checkoutTime = new Date(record.checkout_time);\r\n      const estimatedReturn = new Date(record.estimated_checkin_date);\r\n      const diffMs = estimatedReturn.getTime() - checkoutTime.getTime();\r\n      \r\n      const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      \r\n      if (days > 0) {\r\n        return `${days}d ${hours}h (estimated)`;\r\n      } else if (hours > 0) {\r\n        return `${hours}h (estimated)`;\r\n      }\r\n      return 'Less than 1 hour (estimated)';\r\n    }\r\n    \r\n    return 'N/A';\r\n  };\r\n\r\n  const getCheckoutReason = () => {\r\n    if (!record || !record.remarks) return '';\r\n    \r\n    // Extract only the original checkout reason, exclude check-in information\r\n    const remarks = record.remarks;\r\n    \r\n    // Split by \". Check-in:\" to separate original reason from check-in timestamp\r\n    const parts = remarks.split('. Check-in:');\r\n    return parts[0]; // Return only the original checkout reason\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"w-full\">\r\n          <div className=\"animate-pulse\">\r\n            <div className=\"h-6 bg-gray-200 rounded w-32 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-64 mb-6\"></div>\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <div className=\"h-6 bg-gray-200 rounded w-48 mb-4\"></div>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"h-4 bg-gray-200 rounded w-full\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !record) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"w-full\">\r\n          <button\r\n            onClick={() => router.back()}\r\n            className=\"flex items-center text-gray-600 hover:text-gray-900 mb-6\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            Back to Check-in/Checkout\r\n          </button>\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"text-center\">\r\n              <AlertCircle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Record Not Found</h3>\r\n              <p className=\"text-gray-600 mb-4\">{error || 'The requested record could not be found.'}</p>\r\n              <Button\r\n                onClick={() => router.push('/staff/checkin-checkout')}\r\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n              >\r\n                Back to Check-in/Checkout\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">Check-in/Checkout Details</h1>\r\n              <div className=\"flex items-center gap-4 mt-2 text-sm text-gray-600\">\r\n                <span>Created: {formatDateTime(record.created_at)}</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              {getStatusBadge()}\r\n              {record.status === 'approved' && !record.checkin_time && (\r\n                <button\r\n                  onClick={handleCheckIn}\r\n                  disabled={checkingIn}\r\n                  className=\"inline-flex items-center justify-center px-3 py-1.5 border border-transparent rounded-md bg-green-600 text-sm font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  title=\"Check In\"\r\n                >\r\n                  {checkingIn ? (\r\n                    <>\r\n                      <svg className=\"w-4 h-4 mr-1.5 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                      </svg>\r\n                      Checking In...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <ArrowRight className=\"w-4 h-4 mr-1.5\" />\r\n                      Check In\r\n                    </>\r\n                  )}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Success Message */}\r\n          {successMessage && (\r\n            <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-600 mr-2\" />\r\n              <p className=\"text-green-800 text-sm font-medium\">{successMessage}</p>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Error Message */}\r\n          {error && (\r\n            <div className=\"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center\">\r\n              <AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" />\r\n              <p className=\"text-red-800 text-sm font-medium\">{error}</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Time Details */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n              <Clock className=\"w-5 h-5 mr-2\" />\r\n              Time Details\r\n            </h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              {record.checkout_time && (\r\n                <div className=\"p-4 bg-orange-50 rounded-lg border border-orange-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <ArrowLeft className=\"w-4 h-4 text-orange-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-orange-900\">Checkout Time</p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-orange-800 ml-11\">{formatDateTime(record.checkout_time)}</p>\r\n                </div>\r\n              )}\r\n\r\n              {record.checkin_time && (\r\n                <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <ArrowRight className=\"w-4 h-4 text-blue-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-blue-900\">Check-in Time</p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-blue-800 ml-11\">{formatDateTime(record.checkin_time)}</p>\r\n                </div>\r\n              )}\r\n\r\n              {record.estimated_checkin_date && (\r\n                <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <Calendar className=\"w-4 h-4 text-blue-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-blue-900\">Estimated Return</p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-blue-800 ml-11\">{formatDate(record.estimated_checkin_date)}</p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Always show duration if checkout time exists */}\r\n              {record.checkout_time && (\r\n                <div className=\"p-4 bg-gray-50 rounded-lg border border-gray-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <Clock className=\"w-4 h-4 text-gray-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-gray-700\">\r\n                      {record.checkin_time ? 'Total Duration' : 'Expected Duration'}\r\n                    </p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-gray-900 ml-11\">{calculateDuration()}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Additional Info */}\r\n            <div className=\"mt-4 pt-4 border-t border-gray-200\">\r\n              <div className=\"flex flex-wrap gap-4 text-sm\">\r\n                {record.block && (\r\n                  <div className=\"flex items-center text-gray-600\">\r\n                    <Home className=\"w-4 h-4 mr-1\" />\r\n                    <span className=\"font-medium\">Block:</span>\r\n                    <span className=\"ml-1\">{record.block.block_name}</span>\r\n                  </div>\r\n                )}\r\n                {record.checkout_duration && (\r\n                  <div className=\"flex items-center text-gray-600\">\r\n                    <Clock className=\"w-4 h-4 mr-1\" />\r\n                    <span className=\"font-medium\">Duration:</span>\r\n                    <span className=\"ml-1\">{record.checkout_duration}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Reason */}\r\n          {record.remarks && getCheckoutReason() && (\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n                <AlertCircle className=\"w-5 h-5 mr-2\" />\r\n                Reason\r\n              </h2>\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                <p className=\"text-blue-800 font-medium\">{getCheckoutReason()}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\checkin-checkout\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2336,2339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2336,2339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { staffCheckInCheckOutApi } from '@/lib/api/staff-checkincheckout.api';\r\nimport { \r\n  SubmitButton, \r\n  CancelButton \r\n} from '@/components/ui';\r\nimport { Calendar, Clock, AlertCircle } from 'lucide-react';\r\n\r\nexport default function CreateStaffCheckout() {\r\n  const router = useRouter();\r\n  \r\n  const [loading, setLoading] = useState(false); // No need to load external data\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  \r\n  // Get current date for default values\r\n  const currentDate = new Date().toISOString().split('T')[0];\r\n  \r\n  const [formData, setFormData] = useState({\r\n    estimated_checkin_date: '',\r\n    remarks: '',\r\n  });\r\n\r\n  // Fetch blocks data\r\n  useEffect(() => {\r\n    // No external data loading needed\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setErrors({});\r\n\r\n    // Client-side validation\r\n    const newErrors: Record<string, string> = {};\r\n    \r\n    if (!formData.estimated_checkin_date) {\r\n      newErrors.estimated_checkin_date = 'Estimated return date is required';\r\n    } else if (formData.estimated_checkin_date < currentDate) {\r\n      newErrors.estimated_checkin_date = 'Return date cannot be in the past';\r\n    }\r\n\r\n    if (!formData.remarks.trim()) {\r\n      newErrors.remarks = 'Reason for checkout is required';\r\n    }\r\n\r\n    if (Object.keys(newErrors).length > 0) {\r\n      setErrors(newErrors);\r\n      setIsSubmitting(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await staffCheckInCheckOutApi.checkOut({\r\n        estimated_checkin_date: formData.estimated_checkin_date,\r\n        remarks: formData.remarks.trim()\r\n      });\r\n      router.push('/staff/checkin-checkout');\r\n    } catch (error: any) {\r\n      console.error('Error creating checkout request:', error);\r\n      if (error.validation) {\r\n        setErrors(error.validation);\r\n      } else {\r\n        setErrors({ general: error.message || 'Failed to create checkout request' });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"w-full flex justify-center items-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Request Checkout</h1>\r\n          <p className=\"text-gray-600 mt-1\">\r\n            Submit a request to checkout from the hostel\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n          {errors.general && (\r\n            <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n              <div className=\"flex\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n                <p className=\"text-red-800\">{errors.general}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Information Card */}\r\n          <div className=\"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n            <div className=\"flex items-start\">\r\n              <div className=\"flex-shrink-0\">\r\n                <Clock className=\"w-5 h-5 text-blue-600 mt-0.5\" />\r\n              </div>\r\n              <div className=\"ml-3\">\r\n                <h3 className=\"text-sm font-medium text-blue-900\">Important Information</h3>\r\n                <div className=\"mt-2 text-sm text-blue-800\">\r\n                  <ul className=\"list-disc list-inside space-y-1\">\r\n                    <li>Your checkout request will be submitted to admin for approval</li>\r\n                    <li>Checkout time will be recorded as current system time when approved</li>\r\n                    <li>You can check back in once your request is approved and you return</li>\r\n                    <li>Estimated return date is required to track checkout duration</li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {/* Checkout Date and Time */}\r\n            <div className=\"space-y-1.5\">\r\n              <label className=\"block text-sm font-semibold text-neutral-900 flex items-center\">\r\n                <Clock className=\"w-4 h-4 mr-2\" />\r\n                Checkout Date & Time\r\n              </label>\r\n              <div className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 bg-gray-50\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <span className=\"font-medium text-gray-700\">Date: </span>\r\n                    <span>{new Date().toLocaleDateString('en-US', { \r\n                      month: '2-digit',\r\n                      day: '2-digit', \r\n                      year: 'numeric'\r\n                    })}</span>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"font-medium text-gray-700\">Time: </span>\r\n                    <span>{new Date().toLocaleTimeString('en-US', { \r\n                      hour: '2-digit', \r\n                      minute: '2-digit',\r\n                      second: '2-digit',\r\n                      hour12: true \r\n                    })}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-xs text-gray-500\">\r\n                This will be recorded as your checkout time when the request is approved.\r\n              </p>\r\n            </div>\r\n\r\n            {/* Estimated Return Date */}\r\n            <div className=\"space-y-1.5\">\r\n              <label htmlFor=\"estimated_checkin_date\" className=\"block text-sm font-semibold text-neutral-900 flex items-center\">\r\n                <Calendar className=\"w-4 h-4 mr-2\" />\r\n                Estimated Return Date *\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                id=\"estimated_checkin_date\"\r\n                name=\"estimated_checkin_date\"\r\n                value={formData.estimated_checkin_date}\r\n                onChange={handleChange}\r\n                min={currentDate}\r\n                className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                required\r\n              />\r\n              <p className=\"text-xs text-gray-500\">\r\n                This helps track your checkout duration and is required for approval.\r\n              </p>\r\n              {errors.estimated_checkin_date && (\r\n                <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                  <AlertCircle className=\"w-3.5 h-3.5 mr-2\" />\r\n                  {errors.estimated_checkin_date}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Reason/Remarks */}\r\n            <div className=\"space-y-1.5\">\r\n              <label htmlFor=\"remarks\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                Reason for Checkout *\r\n              </label>\r\n              <textarea\r\n                id=\"remarks\"\r\n                name=\"remarks\"\r\n                value={formData.remarks}\r\n                onChange={handleChange}\r\n                placeholder=\"Please provide the reason for your checkout request (e.g., going home for weekend, medical appointment, family emergency, etc.)\"\r\n                rows={4}\r\n                className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200 resize-none\"\r\n                required\r\n              />\r\n              <p className=\"text-xs text-gray-500\">\r\n                A clear reason helps admin process your request faster\r\n              </p>\r\n              {errors.remarks && (\r\n                <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                  <AlertCircle className=\"w-3.5 h-3.5 mr-2\" />\r\n                  {errors.remarks}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push('/staff/checkin-checkout')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Submitting Request...\"\r\n              >\r\n                Submit Checkout Request\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\checkin-checkout\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentStatus' is assigned a value but never used.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'checkingOut' is assigned a value but never used.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCheckingOut' is assigned a value but never used.","line":24,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":62,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2850,2853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2850,2853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleQuickCheckout' is assigned a value but never used.","line":100,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":28}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { staffCheckInCheckOutApi, StaffCheckInCheckOut } from '@/lib/api/staff-checkincheckout.api';\r\nimport { Button, ActionButtons } from '@/components/ui';\r\nimport { \r\n  Plus, \r\n  Clock, \r\n  Check, \r\n  X, \r\n  AlertCircle,\r\n  ArrowRight,\r\n  Search\r\n} from 'lucide-react';\r\n\r\nexport default function StaffCheckinCheckoutPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [records, setRecords] = useState<StaffCheckInCheckOut[]>([]);\r\n  const [filteredRecords, setFilteredRecords] = useState<StaffCheckInCheckOut[]>([]);\r\n  const [currentStatus, setCurrentStatus] = useState<StaffCheckInCheckOut | null>(null);\r\n  const [checkingIn, setCheckingIn] = useState(false);\r\n  const [checkingOut, setCheckingOut] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n\r\n  useEffect(() => {\r\n    fetchStaffRecords();\r\n  }, []);\r\n\r\n  // Live search effect\r\n  useEffect(() => {\r\n    if (!searchTerm.trim()) {\r\n      setFilteredRecords(records);\r\n    } else {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      const filtered = records.filter(record => \r\n        record.status?.toLowerCase().includes(searchLower) ||\r\n        record.block?.block_name?.toLowerCase().includes(searchLower) ||\r\n        record.remarks?.toLowerCase().includes(searchLower)\r\n      );\r\n      setFilteredRecords(filtered);\r\n    }\r\n  }, [searchTerm, records]);\r\n\r\n  const fetchStaffRecords = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const response = await staffCheckInCheckOutApi.getMyRecords();\r\n      \r\n      setRecords(response.data || []);\r\n      setFilteredRecords(response.data || []);\r\n      \r\n      // Find the most recent active record (checked_in, pending, or approved)\r\n      const activeRecord = (response.data || []).find(record => \r\n        record.status === 'checked_in' || record.status === 'pending' || record.status === 'approved'\r\n      );\r\n      \r\n      setCurrentStatus(activeRecord || null);\r\n    } catch (err) {\r\n      setError('Failed to load check-in/checkout data');\r\n      // Don't let API failures prevent the page from loading\r\n      setRecords([]);\r\n      setFilteredRecords([]);\r\n      setCurrentStatus(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleQuickCheckin = async () => {\r\n    try {\r\n      setCheckingIn(true);\r\n      setError(null);\r\n      \r\n      // In a real app, this would come from the staff's work assignment\r\n      await staffCheckInCheckOutApi.checkIn({\r\n        block_id: \"1\", // This should come from staff's assignment data\r\n        remarks: \"Staff self check-in\"\r\n      });\r\n      \r\n      await fetchStaffRecords();\r\n    } catch (err: any) {\r\n      console.error('Check-in failed:', err);\r\n      \r\n      // If staff is already checked in, refresh the records to get updated status\r\n      if (err.message && err.message.includes('already checked in')) {\r\n        await fetchStaffRecords();\r\n        return;\r\n      }\r\n      \r\n      setError(err.message || 'Failed to check in');\r\n    } finally {\r\n      setCheckingIn(false);\r\n    }\r\n  };\r\n\r\n  const handleQuickCheckout = async () => {\r\n    // This method is no longer used since we have a dedicated create page\r\n    // Redirect to create page instead\r\n    router.push('/staff/checkin-checkout/create');\r\n  };\r\n\r\n  const handleSearch = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    // Live search handles filtering, no need to fetch again\r\n  };\r\n\r\n  const formatTime = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleTimeString('en-US', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const calculateDuration = (record: StaffCheckInCheckOut) => {\r\n    if (!record.checkout_time) return '-';\r\n    \r\n    // If staff has checked in, calculate actual duration between checkout and checkin\r\n    if (record.checkin_time) {\r\n      const checkout = new Date(record.checkout_time);\r\n      const checkin = new Date(record.checkin_time);\r\n      const diffMs = checkin.getTime() - checkout.getTime();\r\n      \r\n      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n      \r\n      if (diffDays > 0) {\r\n        return `${diffDays}d ${diffHours}h`;\r\n      } else if (diffHours > 0) {\r\n        return `${diffHours}h ${diffMinutes}m`;\r\n      } else {\r\n        return `${diffMinutes}m`;\r\n      }\r\n    }\r\n    \r\n    // If not checked in yet, calculate estimated duration between checkout and estimated checkin\r\n    if (record.estimated_checkin_date) {\r\n      const checkout = new Date(record.checkout_time);\r\n      const estimated = new Date(record.estimated_checkin_date);\r\n      const diffMs = estimated.getTime() - checkout.getTime();\r\n      \r\n      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      \r\n      if (diffDays > 0) {\r\n        return `${diffDays}d ${diffHours}h (est.)`;\r\n      } else if (diffHours > 0) {\r\n        return `${diffHours}h (est.)`;\r\n      } else {\r\n        return 'Less than 1h (est.)';\r\n      }\r\n    }\r\n    \r\n    return '-';\r\n  };\r\n\r\n  const getStatusBadge = (record: StaffCheckInCheckOut) => {\r\n    // Check admin approval status first\r\n    if (record.status === 'approved') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Approved\r\n        </span>\r\n      );\r\n    } else if (record.status === 'declined') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Declined\r\n        </span>\r\n      );\r\n    } else if (record.status === 'pending') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Pending\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time && record.checkin_time) {\r\n      // If both checkout and checkin exist and status is not pending/approved/declined\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Complete\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time) {\r\n      // Only checkout exists\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked Out\r\n        </span>\r\n      );\r\n    } else if (record.checkin_time) {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked In\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Draft\r\n        </span>\r\n      );\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">Check-in/Check-out</h1>\r\n        <Button\r\n          onClick={() => router.push('/staff/checkin-checkout/create')}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87] text-white\"\r\n          icon={<Plus className=\"w-4 h-4\" />}\r\n        >\r\n          Request Checkout\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Error Message */}\r\n      {error && (\r\n        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" />\r\n            <span className=\"text-red-800\">{error}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Search Bar */}\r\n      <div className=\"mb-6\">\r\n        <form onSubmit={handleSearch} className=\"max-w-md\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Search by status, block, or remarks...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg text-sm text-gray-600 placeholder:text-gray-400 focus:border-gray-400 focus:ring-0 outline-none transition-all duration-200 bg-white\"\r\n            />\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Block\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Checkout Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Est. Check-in Date\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Check-in Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Duration\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Status\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {filteredRecords.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={7} className=\"px-6 py-8 text-center text-gray-500\">\r\n                    {searchTerm ? `No records found matching \"${searchTerm}\"` : 'No check-in/checkout records found.'}\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                filteredRecords\r\n                  .sort((a, b) => {\r\n                    // Sort by priority: active statuses first, then by date (newest first)\r\n                    const priorityOrder = { 'checked_in': 1, 'pending': 2, 'approved': 3, 'declined': 4 };\r\n                    const aPriority = priorityOrder[a.status as keyof typeof priorityOrder] || 5;\r\n                    const bPriority = priorityOrder[b.status as keyof typeof priorityOrder] || 5;\r\n                    \r\n                    if (aPriority !== bPriority) {\r\n                      return aPriority - bPriority;\r\n                    }\r\n                    \r\n                    // If same priority, sort by date (newest first)\r\n                    return new Date(b.date).getTime() - new Date(a.date).getTime();\r\n                  })\r\n                  .map((record) => (\r\n                    <tr key={record.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"text-sm font-medium text-gray-900\">\r\n                          {record.block?.block_name || 'N/A'}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"flex flex-col\">\r\n                          <div className=\"text-sm text-gray-500\">\r\n                            {formatDate(record.checkout_time)}\r\n                          </div>\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            {formatTime(record.checkout_time)}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"text-sm text-gray-900\">\r\n                          {record.estimated_checkin_date ? formatDate(record.estimated_checkin_date) : 'Not set'}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"flex flex-col\">\r\n                          <div className=\"text-sm text-gray-500\">\r\n                            {formatDate(record.checkin_time)}\r\n                          </div>\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            {formatTime(record.checkin_time)}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"text-sm text-gray-900\">\r\n                          {calculateDuration(record)}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        {getStatusBadge(record)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <ActionButtons\r\n                            viewUrl={`/staff/checkin-checkout/${record.id}`}\r\n                            style=\"compact\"\r\n                            hideEdit={true}\r\n                            hideDelete={true}\r\n                          />\r\n                          \r\n                          {/* Show Check In button only for approved records that have checkout but no checkin yet */}\r\n                          {record.status === 'approved' && record.checkout_time && !record.checkin_time && (\r\n                            <Button\r\n                              onClick={handleQuickCheckin}\r\n                              disabled={checkingIn}\r\n                              size=\"sm\"\r\n                              className=\"bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1\"\r\n                              icon={checkingIn ? (\r\n                                <div className=\"animate-spin rounded-full h-3 w-3 border-2 border-white border-t-transparent\" />\r\n                              ) : (\r\n                                <ArrowRight className=\"w-3 h-3\" />\r\n                              )}\r\n                            >\r\n                              {checkingIn ? 'Checking In...' : 'Check In'}\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\complain\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ConfirmModal' is defined but never used.","line":9,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":30}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { useAuth } from '@/lib/auth';\r\nimport { staffApi } from '@/lib/api/staff.api';\r\nimport { Complain } from '@/lib/api/complain.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { Button, ConfirmModal, TableSkeleton } from '@/components/ui';\r\nimport ChatInterface from '@/components/ui/ChatInterface';\r\nimport { \r\n  ArrowLeft, \r\n  AlertCircle,\r\n  Check,\r\n  X,\r\n  Loader,\r\n  Clock\r\n} from 'lucide-react';\r\n\r\nexport default function StaffComplainDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const { user } = useAuth();\r\n  const complainId = params.id as string;\r\n\r\n  const [complain, setComplain] = useState<Complain | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Fetch complain data\r\n  useEffect(() => {\r\n    const fetchComplain = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const complainData = await staffApi.getStaffComplaint(complainId);\r\n        setComplain(complainData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching complain:', error);\r\n        if (error instanceof ApiError) {\r\n          if (error.status === 404) {\r\n            setError(`Complaint with ID ${complainId} not found. It may have been deleted or the ID is incorrect.`);\r\n          } else {\r\n            setError(`Failed to load complaint: ${error.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load complaint data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (complainId) {\r\n      fetchComplain();\r\n    }\r\n  }, [complainId]);\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'pending':\r\n        return <Clock className=\"w-4 h-4 text-yellow-600\" />;\r\n      case 'in_progress':\r\n        return <Loader className=\"w-4 h-4 text-blue-600\" />;\r\n      case 'resolved':\r\n        return <Check className=\"w-4 h-4 text-green-600\" />;\r\n      case 'rejected':\r\n        return <X className=\"w-4 h-4 text-red-600\" />;\r\n      default:\r\n        return <AlertCircle className=\"w-4 h-4 text-gray-600\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const baseClasses = \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium gap-1\";\r\n    \r\n    switch (status) {\r\n      case 'pending':\r\n        return (\r\n          <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>\r\n            {getStatusIcon(status)}\r\n            Pending Review\r\n          </span>\r\n        );\r\n      case 'in_progress':\r\n        return (\r\n          <span className={`${baseClasses} bg-blue-100 text-blue-800`}>\r\n            {getStatusIcon(status)}\r\n            In Progress\r\n          </span>\r\n        );\r\n      case 'resolved':\r\n        return (\r\n          <span className={`${baseClasses} bg-green-100 text-green-800`}>\r\n            {getStatusIcon(status)}\r\n            Resolved\r\n          </span>\r\n        );\r\n      case 'rejected':\r\n        return (\r\n          <span className={`${baseClasses} bg-red-100 text-red-800`}>\r\n            {getStatusIcon(status)}\r\n            Rejected\r\n          </span>\r\n        );\r\n      default:\r\n        return (\r\n          <span className={`${baseClasses} bg-gray-100 text-gray-800`}>\r\n            {getStatusIcon(status)}\r\n            Unknown\r\n          </span>\r\n        );\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-6 px-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <TableSkeleton />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-6 px-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"flex items-center gap-4 mb-6\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={() => router.push('/staff/complain')}\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4\" />\r\n              Back to Complaints\r\n            </Button>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"text-center\">\r\n              <AlertCircle className=\"w-16 h-16 text-red-500 mx-auto mb-4\" />\r\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Error Loading Complaint</h2>\r\n              <p className=\"text-gray-600 mb-4\">{error}</p>\r\n              <Button onClick={() => window.location.reload()}>\r\n                Try Again\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!complain) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-6 px-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"text-center\">\r\n              <AlertCircle className=\"w-16 h-16 text-gray-500 mx-auto mb-4\" />\r\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Complaint Not Found</h2>\r\n              <p className=\"text-gray-600 mb-4\">The requested complaint could not be found.</p>\r\n              <Button onClick={() => router.push('/staff/complain')}>\r\n                Back to Complaints\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200 shadow-sm\">\r\n        <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div>\r\n                <h1 className=\"text-xl font-bold text-gray-900\">{complain.title}</h1>\r\n                <div className=\"flex items-center gap-4 mt-2\">\r\n                  {getStatusBadge(complain.status)}\r\n                  <span className=\"text-sm text-gray-500\"></span>\r\n                  <span className=\"text-sm text-gray-600\">{formatDate(complain.created_at)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n        <div className=\"grid grid-cols-1 xl:grid-cols-5 gap-4\">\r\n          {/* Left Sidebar - Complaint Details */}\r\n          <div className=\"xl:col-span-3\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200\" style={{height: '550px'}}>\r\n              {/* Info Section */}\r\n              <div className=\"p-5 h-full overflow-y-auto\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900\">Complain Details</h3>\r\n                </div>\r\n                \r\n                <div className=\"space-y-6\">\r\n                  <div>\r\n                    <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z\" />\r\n                      </svg>\r\n                      Title\r\n                    </label>\r\n                    <p className=\"text-base text-gray-900 leading-relaxed font-medium bg-gray-50 p-3 rounded-lg border-l-4 border-blue-500\">{complain.title}</p>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                      </svg>\r\n                      Description\r\n                    </label>\r\n                    <div className=\"bg-gray-50 p-3 rounded-lg border-l-4 border-green-500\">\r\n                      <p className=\"text-sm text-gray-800 leading-relaxed whitespace-pre-wrap\">{complain.description}</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Metadata */}\r\n                  <div className=\"pt-4 border-t border-gray-200\">\r\n                    <h4 className=\"text-xs font-bold text-gray-700 mb-3 flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      Information\r\n                    </h4>\r\n                    <div className=\"grid grid-cols-2 gap-3 text-xs\">\r\n                      <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                        <span className=\"text-gray-700 font-medium block text-xs mb-1\">Created</span>\r\n                        <span className=\"text-gray-900 font-semibold text-xs\">{formatDate(complain.created_at)}</span>\r\n                      </div>\r\n                      {complain.updated_at && (\r\n                        <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                          <span className=\"text-gray-700 font-medium block text-xs mb-1\">Updated</span>\r\n                          <span className=\"text-gray-900 font-semibold text-xs\">{formatDate(complain.updated_at)}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right Main Area - Chat Interface */}\r\n          <div className=\"xl:col-span-2\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden\" style={{height: '550px'}}>\r\n              <div className=\"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl flex-shrink-0\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <h3 className=\"text-base font-semibold text-gray-900\">Chat Messages</h3>\r\n                    <p className=\"text-xs text-gray-600 mt-1\">Communicate directly with the administration about this complaint</p>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\r\n                    <span className=\"text-xs font-medium text-green-600\">Online</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1 min-h-0 overflow-hidden\">\r\n                <ChatInterface\r\n                  complainId={complain.id}\r\n                  currentUserId={user?.id || 0}\r\n                  currentUserType=\"staff\"\r\n                  currentUserName={user?.name || 'Staff Member'}\r\n                  className=\"h-full\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\inquiry\\[id]\\edit\\page.tsx","messages":[{"ruleId":"react/no-children-prop","severity":2,"message":"Do not pass children as props. Instead, nest children between the opening and closing tags.","line":273,"column":15,"nodeType":"JSXAttribute","messageId":"nestChildren","endLine":273,"endColumn":32}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect, use } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { staffInquiryApi } from '@/lib/api/staff-inquiry.api';\r\nimport { InquiryFormData } from '@/lib/api/types/inquiry.types';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SuccessToast,\r\n  TableSkeleton\r\n} from '@/components/ui';\r\n\r\nexport default function StaffEditInquiry({ params }: { params: Promise<{ id: string }> }) {\r\n  const router = useRouter();\r\n  const { id: inquiryId } = use(params);\r\n  const [formData, setFormData] = useState<InquiryFormData>({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    seater_type: 1\r\n  });\r\n  \r\n  const [isFormLoaded, setIsFormLoaded] = useState(false);\r\n  const [isCustomSeater, setIsCustomSeater] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n  \r\n  // Load inquiry data\r\n  useEffect(() => {\r\n    const fetchInquiry = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        const inquiryData = await staffInquiryApi.getInquiry(inquiryId);\r\n        \r\n        if (!inquiryData) {\r\n          throw new Error('No inquiry data received');\r\n        }\r\n        \r\n        const seaterType = inquiryData.seater_type || 1;\r\n        \r\n        const formDataToSet = {\r\n          name: inquiryData.name || '',\r\n          email: inquiryData.email || '',\r\n          phone: inquiryData.phone || '',\r\n          seater_type: seaterType\r\n        };\r\n        \r\n        setFormData(formDataToSet);\r\n        setIsCustomSeater(seaterType > 4 || seaterType < 1);\r\n        setIsFormLoaded(true);\r\n      } catch (error) {\r\n        console.error('Error fetching inquiry:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to load inquiry: ${error.message}`);\r\n        } else {\r\n          setError('Failed to load inquiry data. Please try refreshing the page.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    fetchInquiry();\r\n  }, [inquiryId]);\r\n  \r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    if (name === 'seater_type') {\r\n      const numValue = value ? parseInt(value) : 0;\r\n      if (!isNaN(numValue) && numValue > 0) {\r\n        setFormData({\r\n          ...formData,\r\n          seater_type: numValue\r\n        });\r\n      }\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n  };\r\n  \r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!formData.name || !formData.phone) {\r\n      setError('Please fill in all required fields.');\r\n      return;\r\n    }\r\n    \r\n    setIsSubmitting(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      await staffInquiryApi.updateInquiry(inquiryId, formData);\r\n      setSuccess('Inquiry updated successfully!');\r\n      setTimeout(() => {\r\n        router.push('/staff/inquiry');\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error('Error updating inquiry:', error);\r\n      if (error instanceof ApiError) {\r\n        setError(`Failed to update inquiry: ${error.message}`);\r\n      } else {\r\n        setError('Failed to update inquiry. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading || !isFormLoaded) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Inquiry</h1>\r\n            <p className=\"text-sm text-gray-500 mt-1\">Loading inquiry data...</p>\r\n          </div>\r\n          <TableSkeleton />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  if (!formData || (!formData.name && !formData.phone && !isLoading)) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p className=\"text-red-800\">No inquiry data found</p>\r\n            </div>\r\n            <button\r\n              onClick={() => router.push('/staff/inquiry')}\r\n              className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n            >\r\n              Back to Inquiries\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      {/* Success Toast */}\r\n      {success && (\r\n        <SuccessToast\r\n          show={!!success}\r\n          message={success}\r\n          progress={100}\r\n          onClose={() => setSuccess(null)}\r\n        />\r\n      )}\r\n      \r\n      <div className=\"w-full max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Edit Inquiry</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Modify inquiry details for {formData.name}</p>\r\n        </div>\r\n        \r\n        {/* Error Alert */}\r\n        {error && (\r\n          <div className=\"mb-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded\">\r\n            <p className=\"font-medium\">Error</p>\r\n            <p>{error}</p>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n          <div className=\"grid grid-cols-1 gap-6 mb-6 md:grid-cols-2\">\r\n            {/* Student Name */}\r\n            <FormField\r\n              label=\"Student Name\"\r\n              name=\"name\"\r\n              value={formData.name}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter student name\"\r\n              required\r\n              error={!formData.name && error ? 'Name is required' : ''}\r\n            />\r\n            \r\n            {/* Phone */}\r\n            <FormField\r\n              label=\"Phone Number\"\r\n              name=\"phone\"\r\n              value={formData.phone}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter phone number\"\r\n              required\r\n              error={!formData.phone && error ? 'Phone number is required' : ''}\r\n            />\r\n            \r\n            {/* Email */}\r\n            <FormField\r\n              label=\"Email Address\"\r\n              name=\"email\"\r\n              value={formData.email || ''}\r\n              onChange={handleInputChange}\r\n              type=\"email\"\r\n              placeholder=\"Enter email address (optional)\"\r\n            />\r\n            \r\n            {/* Number of Seaters */}\r\n            <div className=\"space-y-2\">\r\n              <FormField\r\n                label=\"Number of Seaters\"\r\n                name=\"seater_type_select\"\r\n                value={isCustomSeater ? 'custom' : String(formData.seater_type || 1)}\r\n                onChange={(e) => {\r\n                  const value = e.target.value;\r\n                  if (value === 'custom') {\r\n                    setIsCustomSeater(true);\r\n                    return;\r\n                  }\r\n                  setIsCustomSeater(false);\r\n                  setFormData({\r\n                    ...formData,\r\n                    seater_type: parseInt(value) || 1\r\n                  });\r\n                }}\r\n                type=\"select\"\r\n                options={[\r\n                  { value: '1', label: '1-Seater' },\r\n                  { value: '2', label: '2-Seater' },\r\n                  { value: '3', label: '3-Seater' },\r\n                  { value: '4', label: '4-Seater' },\r\n                  { value: 'custom', label: 'Custom Seater' }\r\n                ]}\r\n                required\r\n                error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n              />\r\n              {isCustomSeater && (\r\n                <FormField\r\n                  label=\"Custom Seater Number\"\r\n                  name=\"seater_type\"\r\n                  value={String(formData.seater_type || '')}\r\n                  onChange={(e) => {\r\n                    const numValue = e.target.value ? parseInt(e.target.value) : 1;\r\n                    if (!isNaN(numValue) && numValue > 0) {\r\n                      setFormData({\r\n                        ...formData,\r\n                        seater_type: numValue\r\n                      });\r\n                    }\r\n                  }}\r\n                  type=\"text\"\r\n                  placeholder=\"Enter custom number of seaters\"\r\n                  required\r\n                  error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        \r\n          {/* Form Actions */}\r\n          <div className=\"flex justify-end items-center gap-3 pt-6 mt-6 border-t border-gray-200\">\r\n            <CancelButton \r\n              onClick={() => router.push('/staff/inquiry')} \r\n              children=\"Cancel\"\r\n            />\r\n            <SubmitButton \r\n              loading={isSubmitting} \r\n              loadingText=\"Updating...\"\r\n            >\r\n              Update Inquiry\r\n            </SubmitButton>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\inquiry\\create\\page.tsx","messages":[{"ruleId":"react/no-children-prop","severity":2,"message":"Do not pass children as props. Instead, nest children between the opening and closing tags.","line":211,"column":15,"nodeType":"JSXAttribute","messageId":"nestChildren","endLine":211,"endColumn":32}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { staffInquiryApi } from '@/lib/api/staff-inquiry.api';\r\nimport { InquiryFormData } from '@/lib/api/types/inquiry.types';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  FormField, \r\n  SubmitButton, \r\n  CancelButton, \r\n  SuccessToast,\r\n} from '@/components/ui';\r\n\r\nexport default function StaffCreateInquiry() {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState<InquiryFormData>({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    seater_type: 1\r\n  });\r\n  const [isCustomSeater, setIsCustomSeater] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n  \r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    if (name === 'seater_type') {\r\n      const numValue = value ? parseInt(value) : 0;\r\n      if (!isNaN(numValue) && numValue > 0) {\r\n        setFormData({\r\n          ...formData,\r\n          seater_type: numValue\r\n        });\r\n      }\r\n    } else {\r\n      setFormData({\r\n        ...formData,\r\n        [name]: value\r\n      });\r\n    }\r\n  };\r\n  \r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validate required fields\r\n    if (!formData.name || !formData.phone || !formData.seater_type) {\r\n      setError('Please fill in all required fields.');\r\n      return;\r\n    }\r\n    \r\n    setIsSubmitting(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      console.log('Submitting data:', formData);\r\n      const response = await staffInquiryApi.createInquiry(formData);\r\n      console.log('Create response:', response);\r\n      \r\n      setSuccess('Inquiry created successfully!');\r\n      \r\n      // Reset form\r\n      setFormData({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        seater_type: 1\r\n      });\r\n      \r\n      // Redirect after delay\r\n      setTimeout(() => {\r\n        router.push('/staff/inquiry');\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating inquiry:', error);\r\n      if (error instanceof ApiError && error.validation) {\r\n        const validationMessages = Object.values(error.validation).flat();\r\n        setError(validationMessages.join('\\n'));\r\n      } else if (error instanceof ApiError) {\r\n        setError(`Failed to create inquiry: ${error.message}`);\r\n      } else {\r\n        setError('Failed to create inquiry. Please try again.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      {/* Success Toast */}\r\n      {success && (\r\n        <SuccessToast\r\n          show={!!success}\r\n          message={success}\r\n          progress={100}\r\n          onClose={() => setSuccess(null)}\r\n        />\r\n      )}\r\n      \r\n      <div className=\"w-full max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Create New Inquiry</h1>\r\n          <p className=\"text-sm text-gray-600 mt-1\">Record a new student inquiry for accommodation</p>\r\n        </div>\r\n        \r\n        {/* Error Alert */}\r\n        {error && (\r\n          <div className=\"mb-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded\">\r\n            <p className=\"font-medium\">Error</p>\r\n            <p>{error}</p>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"bg-white rounded-lg border border-gray-200 p-6\">\r\n          <div className=\"grid grid-cols-1 gap-6 mb-6 md:grid-cols-2\">\r\n            {/* Student Name */}\r\n            <FormField\r\n              label=\"Student Name\"\r\n              name=\"name\"\r\n              value={formData.name}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter student name\"\r\n              required\r\n              error={!formData.name && error ? 'Name is required' : ''}\r\n            />\r\n            \r\n            {/* Phone */}\r\n            <FormField\r\n              label=\"Phone Number\"\r\n              name=\"phone\"\r\n              value={formData.phone}\r\n              onChange={handleInputChange}\r\n              placeholder=\"Enter phone number\"\r\n              required\r\n              error={!formData.phone && error ? 'Phone number is required' : ''}\r\n            />\r\n            \r\n            {/* Email */}\r\n            <FormField\r\n              label=\"Email Address\"\r\n              name=\"email\"\r\n              value={formData.email || ''}\r\n              onChange={handleInputChange}\r\n              type=\"email\"\r\n              placeholder=\"Enter email address (optional)\"\r\n            />\r\n            \r\n            {/* Number of Seaters */}\r\n            <div className=\"space-y-2\">\r\n              <FormField\r\n                label=\"Number of Seaters\"\r\n                name=\"seater_type_select\"\r\n                value={isCustomSeater ? 'custom' : formData.seater_type.toString()}\r\n                onChange={(e) => {\r\n                  const value = e.target.value;\r\n                  if (value === 'custom') {\r\n                    setIsCustomSeater(true);\r\n                    return;\r\n                  }\r\n                  setIsCustomSeater(false);\r\n                  setFormData({\r\n                    ...formData,\r\n                    seater_type: parseInt(value)\r\n                  });\r\n                }}\r\n                type=\"select\"\r\n                options={[\r\n                  { value: '1', label: '1-Seater' },\r\n                  { value: '2', label: '2-Seater' },\r\n                  { value: '3', label: '3-Seater' },\r\n                  { value: '4', label: '4-Seater' },\r\n                  { value: 'custom', label: 'Custom Seater' }\r\n                ]}\r\n                required\r\n                error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n              />\r\n              {isCustomSeater && (\r\n                <FormField\r\n                  label=\"Custom Seater Number\"\r\n                  name=\"seater_type\"\r\n                  value={formData.seater_type?.toString() || ''}\r\n                  onChange={(e) => {\r\n                    const numValue = e.target.value ? parseInt(e.target.value) : 0;\r\n                    if (!isNaN(numValue) && numValue > 0) {\r\n                      setFormData({\r\n                        ...formData,\r\n                        seater_type: numValue\r\n                      });\r\n                    }\r\n                  }}\r\n                  type=\"text\"\r\n                  placeholder=\"Enter custom number of seaters\"\r\n                  required\r\n                  error={!formData.seater_type && error ? 'Number of seaters is required' : ''}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        \r\n          {/* Form Actions */}\r\n          <div className=\"flex justify-end items-center gap-3 pt-6 mt-6 border-t border-gray-200\">\r\n            <CancelButton \r\n              onClick={() => router.push('/staff/inquiry')} \r\n              children=\"Cancel\"\r\n            />\r\n            <SubmitButton \r\n              loading={isSubmitting} \r\n              loadingText=\"Creating...\"\r\n            >\r\n              Create Inquiry\r\n            </SubmitButton>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\notice\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ExternalLink' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getTargetDisplay' is assigned a value but never used.","line":111,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":25}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { staffApi } from '@/lib/api/staff.api';\r\nimport { Notice, ApiError } from '@/lib/api';\r\nimport { Button, ImageModal } from '@/components/ui';\r\nimport { \r\n  ArrowLeft, \r\n  Calendar, \r\n  User,\r\n  Clock, \r\n  File,\r\n  AlertCircle,\r\n  Check,\r\n  X,\r\n  ExternalLink,\r\n  Download,\r\n  Eye\r\n} from 'lucide-react';\r\nimport { formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function StaffNoticeDetail() {\r\n  const router = useRouter();\r\n  const { id } = useParams();\r\n  const noticeId = Array.isArray(id) ? id[0] : id || '';\r\n  \r\n  const [notice, setNotice] = useState<Notice | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n  \r\n  // Fetch notice data\r\n  useEffect(() => {\r\n    if (!noticeId) {\r\n      setError('Notice ID is missing');\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    \r\n    const fetchNotice = async () => {\r\n      try {\r\n        const data = await staffApi.getStaffNotice(noticeId);\r\n        setNotice(data);\r\n      } catch (err) {\r\n        if (err instanceof ApiError) {\r\n          if (err.status === 403) {\r\n            setError('This notice is no longer active and cannot be viewed.');\r\n          } else if (err.status === 404) {\r\n            setError('Notice not found or you do not have permission to view it.');\r\n          } else {\r\n            setError(`Failed to load notice: ${err.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load notice details');\r\n        }\r\n        console.error('Error fetching notice:', err);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchNotice();\r\n  }, [noticeId]);\r\n\r\n  const handleAttachmentClick = (url: string, name: string) => {\r\n    // For all file types, show in the modal\r\n    setSelectedImage({ url: getImageUrl(url), alt: name });\r\n    setImageModalOpen(true);\r\n  };\r\n\r\n  // Function to get file type icon\r\n  const getFileIcon = (fileName: string) => {\r\n    const extension = fileName.split('.').pop()?.toLowerCase();\r\n    \r\n    switch(extension) {\r\n      case 'pdf':\r\n        return (\r\n          <div className=\"bg-red-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-red-600\" />\r\n          </div>\r\n        );\r\n      case 'doc':\r\n      case 'docx':\r\n        return (\r\n          <div className=\"bg-blue-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-blue-600\" />\r\n          </div>\r\n        );\r\n      case 'jpg':\r\n      case 'jpeg':\r\n      case 'png':\r\n      case 'gif':\r\n        return (\r\n          <div className=\"bg-green-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-green-600\" />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div className=\"bg-gray-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-gray-600\" />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  // Function to get target audience display text\r\n  const getTargetDisplay = (notice: Notice): string => {\r\n    if (notice.target_info) {\r\n      switch (notice.target_info.type) {\r\n        case 'specific_student':\r\n          return `Specific Student: ${notice.target_info.name}`;\r\n        case 'specific_staff':\r\n          return `Specific Staff: ${notice.target_info.name}`;\r\n        case 'block':\r\n          return `Specific Block: ${notice.target_info.name}`;\r\n        default:\r\n          return notice.target_info.name || notice.target_info.type;\r\n      }\r\n    }\r\n    \r\n    switch (notice.target_type) {\r\n      case 'all':\r\n        return 'Everyone';\r\n      case 'student':\r\n        return 'All Students';\r\n      case 'staff':\r\n        return 'All Staff';\r\n      case 'specific_student':\r\n        return notice.student ? `Specific Student: ${notice.student.name}` : 'Specific Student';\r\n      case 'specific_staff':\r\n        return notice.staff ? `Specific Staff: ${notice.staff.name}` : 'Specific Staff';\r\n      case 'block':\r\n        return notice.block ? `Specific Block: ${notice.block.name}` : 'Specific Block';\r\n      default:\r\n        return notice.target_type;\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 p-4 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading notice details...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !notice) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 p-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          {/* Header with back button */}\r\n          <div className=\"mb-6\">\r\n            <Link \r\n              href=\"/staff/notice\" \r\n              className=\"inline-flex items-center text-sm text-gray-500 hover:text-gray-700 mb-4\"\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4 mr-1\" />\r\n              Back to Notices\r\n            </Link>\r\n          </div>\r\n          \r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\r\n            <div className=\"flex items-center text-red-700 mb-4\">\r\n              <AlertCircle className=\"w-6 h-6 mr-2\" />\r\n              <h2 className=\"text-lg font-semibold\">Unable to Load Notice</h2>\r\n            </div>\r\n            <p className=\"text-red-600 mb-4\">{error || 'Notice not found'}</p>\r\n            <div className=\"flex gap-3\">\r\n              <Button \r\n                onClick={() => router.push('/staff/notice')}\r\n                variant=\"secondary\"\r\n                size=\"sm\"\r\n              >\r\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                Back to Notice List\r\n              </Button>\r\n              <Button \r\n                onClick={() => window.location.reload()}\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n              >\r\n                Try Again\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Notice Details</h1>\r\n            <p className=\"text-sm text-gray-500\">View notice information and attachments</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Notice Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n          {/* Notice Header */}\r\n          <div className=\"bg-gray-50 border-b border-gray-200 px-6 py-4\">\r\n            <div className=\"flex justify-between items-start\">\r\n              <h2 className=\"text-xl font-medium text-gray-900\">{notice.title}</h2>\r\n              <div className=\"flex items-center\">\r\n                {notice.status === 'active' ? (\r\n                  <div className=\"bg-green-100 text-green-700 px-3 py-1 rounded-full flex items-center text-sm font-medium\">\r\n                    <Check className=\"h-3.5 w-3.5 mr-1\" />\r\n                    Active\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"bg-gray-100 text-gray-700 px-3 py-1 rounded-full flex items-center text-sm font-medium\">\r\n                    <X className=\"h-3.5 w-3.5 mr-1\" />\r\n                    Inactive\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Notice Content */}\r\n          <div className=\"p-6\">\r\n            {/* Notice Metadata */}\r\n            <div className=\"grid grid-cols-1 gap-4 mb-6 text-sm\">\r\n              <div className=\"flex items-center text-gray-600\">\r\n                <Clock className=\"h-4 w-4 mr-2 text-gray-500\" />\r\n                <span className=\"font-medium mr-2\">Date & Time:</span>\r\n                {new Date(notice.created_at).toLocaleDateString(\"en-US\", {\r\n                  year: \"numeric\",\r\n                  month: \"long\",\r\n                  day: \"numeric\",\r\n                })} at {new Date(notice.created_at).toLocaleTimeString(\"en-US\", {\r\n                  hour: \"2-digit\",\r\n                  minute: \"2-digit\",\r\n                  hour12: true\r\n                })}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Target Details - Show only for specific targets */}\r\n            {(notice.target_type === 'specific_student' || \r\n              notice.target_type === 'specific_staff' || \r\n              notice.target_type === 'block') && (\r\n              <div className=\"mb-6 border-t border-gray-100 pt-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-2\">\r\n                  {notice.target_type === 'specific_student' ? 'Student' : \r\n                   notice.target_type === 'specific_staff' ? 'Staff' : 'Block'} Information\r\n                </h3>\r\n                <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-100\">\r\n                  {notice.target_info ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.target_info.name}</span>\r\n                      </div>\r\n                      {notice.target_info.identifier && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">\r\n                            {notice.target_info.type === 'specific_student' ? 'Student ID:' : 'ID:'}\r\n                          </span>\r\n                          <span>{notice.target_info.identifier}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.contact && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Contact:</span>\r\n                          <span>{notice.target_info.contact}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.location && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Location:</span>\r\n                          <span>{notice.target_info.location}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.rooms_count !== undefined && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Rooms:</span>\r\n                          <span>{notice.target_info.rooms_count}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : notice.student && notice.target_type === 'specific_student' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.student.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Student ID:</span>\r\n                        <span>{notice.student.student_id}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.student.contact}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Email:</span>\r\n                        <span>{notice.student.email}</span>\r\n                      </div>\r\n                      {notice.student.room && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Room:</span>\r\n                          <span>{notice.student.room.room_number}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : notice.staff && notice.target_type === 'specific_staff' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.staff.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Staff ID:</span>\r\n                        <span>{notice.staff.staff_id}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.staff.contact}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Email:</span>\r\n                        <span>{notice.staff.email}</span>\r\n                      </div>\r\n                    </div>\r\n                  ) : notice.block && notice.target_type === 'block' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.block.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Location:</span>\r\n                        <span>{notice.block.location}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Manager:</span>\r\n                        <span>{notice.block.manager_name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.block.manager_contact}</span>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-gray-500\">No detailed information available.</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Description */}\r\n            <div className=\"mb-6 border-t border-gray-100 pt-6\">\r\n              <h3 className=\"text-md font-medium text-gray-800 mb-2\">Description</h3>\r\n              <div className=\"text-gray-700 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg border border-gray-100\">\r\n                {notice.description}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Attachments */}\r\n            {notice.attachments && notice.attachments.length > 0 && (\r\n              <div className=\"mb-4 border-t border-gray-100 pt-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Attachments</h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                  {notice.attachments.map((attachment) => (\r\n                    <div \r\n                      key={attachment.id} \r\n                      className=\"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors\"\r\n                    >\r\n                      {getFileIcon(attachment.name)}\r\n                      <div \r\n                        className=\"ml-3 flex-grow truncate cursor-pointer\"\r\n                        onClick={() => handleAttachmentClick(attachment.path, attachment.name)}\r\n                      >\r\n                        <div className=\"text-sm font-medium text-gray-700 truncate\">{attachment.name}</div>\r\n                        <div className=\"text-xs text-gray-500\">Click to view</div>\r\n                      </div>\r\n                      <div className=\"flex space-x-2 ml-2\">\r\n                        <button \r\n                          className=\"p-1 rounded hover:bg-blue-100 transition-colors\" \r\n                          title=\"View\"\r\n                          onClick={() => handleAttachmentClick(attachment.path, attachment.name)}\r\n                        >\r\n                          <Eye className=\"w-4 h-4 text-blue-500\" />\r\n                        </button>\r\n                        <a \r\n                          href={getImageUrl(attachment.path)} \r\n                          download={attachment.name}\r\n                          className=\"p-1 rounded hover:bg-green-100 transition-colors\" \r\n                          title=\"Download\"\r\n                          onClick={(e) => e.stopPropagation()}\r\n                        >\r\n                          <Download className=\"w-4 h-4 text-green-500\" />\r\n                        </a>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Footer Info */}\r\n            <div className=\"border-t border-gray-100 pt-4 mt-6\">\r\n              <div className=\"flex justify-between items-center text-xs text-gray-500\">\r\n                <div>\r\n                  Notice ID: #{notice.id}\r\n                </div>\r\n                <div>\r\n                  Last updated: {formatDate(notice.updated_at)}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image/File Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\notice\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertCircle' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Home' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":38,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getTargetDisplay' is assigned a value but never used.","line":84,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":25}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { staffApi } from '@/lib/api/staff.api';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\nimport { \r\n  AlertCircle, \r\n  Calendar, \r\n  Eye,\r\n  Clock,\r\n  User,\r\n  Home,\r\n  Settings,\r\n  Check,\r\n  X\r\n} from 'lucide-react';\r\n\r\ninterface Notice {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  description?: string;\r\n  type: 'general' | 'urgent' | 'announcement' | 'maintenance';\r\n  target_audience: 'all' | 'staff' | 'students';\r\n  created_at: string;\r\n  updated_at: string;\r\n  status?: string; // Match admin interface - 'active', 'inactive'\r\n  is_active?: boolean; // Keep for backward compatibility\r\n}\r\n\r\nexport default function StaffNoticePage() {\r\n  const router = useRouter();\r\n  const [notices, setNotices] = useState<Notice[]>([]);\r\n  const [filteredNotices, setFilteredNotices] = useState<Notice[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [totalNotices, setTotalNotices] = useState(0);\r\n\r\n  useEffect(() => {\r\n    fetchNotices();\r\n  }, []);\r\n\r\n  const fetchNotices = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      const response = await staffApi.getStaffNotices();\r\n      const noticesData = response.data || [];\r\n      \r\n      setNotices(noticesData);\r\n      setFilteredNotices(noticesData);\r\n      setTotalNotices(noticesData.length);\r\n    } catch (err) {\r\n      console.error('Error fetching notices:', err);\r\n      setError('Failed to load notices. Please try again.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredNotices(notices);\r\n    } else {\r\n      const filtered = notices.filter(notice =>\r\n        notice.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        notice.type.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (notice.description && notice.description.toLowerCase().includes(searchQuery.toLowerCase()))\r\n      );\r\n      setFilteredNotices(filtered);\r\n    }\r\n  }, [searchQuery, notices]);\r\n\r\n  // Function to get target audience display text\r\n  const getTargetDisplay = (targetType: string): string => {\r\n    switch (targetType) {\r\n      case 'all':\r\n        return 'Everyone';\r\n      case 'students':\r\n        return 'Students Only';\r\n      case 'staff':\r\n        return 'Staff Only';\r\n      default:\r\n        return targetType;\r\n    }\r\n  };\r\n\r\n  // Function to get the sent time display\r\n  const getSentTimeDisplay = (notice: Notice) => {\r\n    const dateObj = new Date(notice.created_at);\r\n    \r\n    // Format date and time separately\r\n    const dateStr = dateObj.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric'\r\n    });\r\n    \r\n    const timeStr = dateObj.toLocaleTimeString('en-US', {\r\n      hour: 'numeric',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n    \r\n    return (\r\n      <div className=\"flex flex-col\">\r\n        <span className=\"text-sm text-gray-900\">{dateStr}</span>\r\n        <span className=\"text-sm text-gray-500\">{timeStr}</span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Determine status badge based on notice status (matching admin page)\r\n  const renderStatusBadge = (status: string) => {\r\n    if (status === 'active') {\r\n      return (\r\n        <div className=\"inline-flex items-center bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Active\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"inline-flex items-center bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Inactive\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Staff Notices</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading notices...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Staff Notices</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{totalNotices} total notices</p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search notices...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredNotices.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No notices found' : 'No notices yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'No notices have been posted yet'}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-10 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Title</div>\r\n              <div className=\"col-span-3\">Description</div>\r\n              <div className=\"col-span-2\">Posted Date</div>\r\n              <div className=\"col-span-1 text-center\">Status</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredNotices.map((notice) => (\r\n              <div key={notice.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-10 gap-2 items-center\">\r\n                  {/* Notice Title */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{notice.title}</div>\r\n                    <div className=\"text-xs text-gray-500 mt-1\">\r\n                      {notice.type && (\r\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800\">\r\n                          {notice.type.charAt(0).toUpperCase() + notice.type.slice(1)}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"text-sm text-gray-600 truncate\">\r\n                      {notice.description \r\n                        ? notice.description.length > 15 \r\n                          ? `${notice.description.substring(0, 15)}...` \r\n                          : notice.description\r\n                        : 'No description'\r\n                      }\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Posted Date */}\r\n                  <div className=\"col-span-2\">\r\n                    {getSentTimeDisplay(notice)}\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex justify-center\">\r\n                      {renderStatusBadge(notice.status || (notice.is_active ? 'active' : 'inactive'))}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex justify-center\">\r\n                      <ActionButtons \r\n                        viewUrl={`/staff/notice/${notice.id}`}\r\n                        hideEdit={true}\r\n                        hideDelete={true}\r\n                        style=\"compact\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredNotices.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredNotices.length} of {totalNotices} notices\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'staffCheckInCheckOutApi' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'staffId' is assigned a value but never used.","line":71,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchDashboardData'. Either include it or remove the dependency array.","line":75,"column":6,"nodeType":"ArrayExpression","endLine":75,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchDashboardData]","fix":{"range":[1989,1991],"text":"[fetchDashboardData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2209,2212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2209,2212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2224,2227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2224,2227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'complaintsData' is assigned a value but never used.","line":101,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'noticesData' is assigned a value but never used.","line":102,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'today' is assigned a value but never used.","line":114,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":114,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3736,3739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3736,3739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3827,3830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3827,3830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3835,3838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3835,3838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3992,3995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3992,3995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4033,4036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4033,4036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4748,4751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4748,4751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4901,4904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4901,4904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4909,4912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4909,4912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5439,5442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5439,5442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7522,7525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7522,7525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":218,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7589,7592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7589,7592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8159,8162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8159,8162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { staffCheckInCheckOutApi } from '@/lib/api/staff-checkincheckout.api';\r\nimport { SalaryApi } from '@/lib/api/salary.api';\r\nimport { staffApi } from '@/lib/api/staff.api';\r\nimport { \r\n  Calendar,\r\n  Clock,\r\n  User,\r\n  AlertCircle,\r\n  Home,\r\n  Settings\r\n} from 'lucide-react';\r\n\r\ninterface StaffDashboardStats {\r\n  currentStatus: 'checked-in' | 'checked-out' | 'pending';\r\n  workShift: string;\r\n  department: string;\r\n  position: string;\r\n  lastCheckIn: string;\r\n  lastCheckOut: string;\r\n  totalRooms: number;\r\n  occupiedRooms: number;\r\n  availableRooms: number;\r\n  totalCapacity: number;\r\n  occupiedBeds: number;\r\n  availableBeds: number;\r\n  totalStudents: number;\r\n  monthlySalary: number;\r\n  lastSalaryDate: string;\r\n  lastSalaryAmount: number;\r\n  recentActivities: Array<{\r\n    type: 'checkin' | 'checkout' | 'salary' | 'maintenance' | 'student';\r\n    message: string;\r\n    time: string;\r\n    status?: string;\r\n  }>;\r\n  pendingTasks: Array<{\r\n    task: string;\r\n    priority: 'high' | 'medium' | 'low';\r\n    dueDate: string;\r\n  }>;\r\n  hasPendingCheckout?: boolean;\r\n}\r\n\r\nexport default function StaffDashboardPage() {\r\n  const [stats, setStats] = useState<StaffDashboardStats>({\r\n    currentStatus: 'checked-out',\r\n    workShift: 'Day Shift (8AM - 4PM)',\r\n    department: 'General',\r\n    position: 'Staff Member',\r\n    lastCheckIn: '',\r\n    lastCheckOut: '',\r\n    totalRooms: 0,\r\n    occupiedRooms: 0,\r\n    availableRooms: 0,\r\n    totalCapacity: 0,\r\n    occupiedBeds: 0,\r\n    availableBeds: 0,\r\n    totalStudents: 0,\r\n    monthlySalary: 0,\r\n    lastSalaryDate: '',\r\n    lastSalaryAmount: 0,\r\n    recentActivities: [],\r\n    pendingTasks: [],\r\n    hasPendingCheckout: false,\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [staffId] = useState('1'); // This should come from auth context\r\n\r\n  useEffect(() => {\r\n    fetchDashboardData();\r\n  }, []);\r\n\r\n  const fetchDashboardData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Fetch staff-specific data with optimized timeouts (2 seconds each)\r\n      const fetchWithTimeout = async (apiCall: any, fallback: any) => {\r\n        try {\r\n          return await Promise.race([\r\n            apiCall(),\r\n            new Promise((_, reject) => \r\n              setTimeout(() => reject(new Error('Timeout after 2 seconds')), 2000)\r\n            )\r\n          ]);\r\n        } catch (error) {\r\n          console.warn('API call failed, using fallback:', error);\r\n          return fallback;\r\n        }\r\n      };\r\n      \r\n      // Fetch staff-specific data using optimized API calls\r\n      const [\r\n        profileData,\r\n        checkInOutData,\r\n        salaryData,\r\n        complaintsData,\r\n        noticesData,\r\n        dashboardStats\r\n      ] = await Promise.all([\r\n        fetchWithTimeout(() => staffApi.getStaffProfile(), null),\r\n        fetchWithTimeout(() => staffApi.getStaffCheckInOuts(), { data: [] }),\r\n        fetchWithTimeout(() => SalaryApi.getMySalaryHistory(), []),\r\n        fetchWithTimeout(() => staffApi.getStaffComplains(), { data: [], total: 0 }),\r\n        fetchWithTimeout(() => staffApi.getStaffNotices(), { data: [] }),\r\n        // Call dashboard stats directly without timeout wrapper\r\n        staffApi.getDashboardStats()\r\n      ]);\r\n\r\n      const today = new Date().toISOString().split('T')[0];\r\n      const currentMonth = new Date().getMonth();\r\n      const currentYear = new Date().getFullYear();\r\n\r\n      // Calculate current status from check-in/out data\r\n      const myCheckIns = checkInOutData.data || [];\r\n      \r\n      const latestCheckIn = myCheckIns.length > 0 ? myCheckIns\r\n        .filter((record: any) => record.status === 'approved' || record.status === 'checked_in')\r\n        .sort((a: any, b: any) => new Date(b.date || b.created_at).getTime() - new Date(a.date || a.created_at).getTime())[0] : null;\r\n\r\n      const currentStatus = (latestCheckIn as any)?.checkin_time && !(latestCheckIn as any)?.checkout_time ? 'checked-in' : 'checked-out';\r\n\r\n      // Use real data from API for room and student stats\r\n      const totalRooms = dashboardStats.rooms.total;\r\n      const occupiedRooms = dashboardStats.rooms.occupied;\r\n      const availableRooms = dashboardStats.rooms.available;\r\n      const totalCapacity = dashboardStats.rooms.total_capacity;\r\n      const occupiedBeds = dashboardStats.rooms.occupied_beds;\r\n      const availableBeds = dashboardStats.rooms.available_beds;\r\n      const totalStudents = dashboardStats.students.total;\r\n\r\n      // Calculate salary statistics\r\n      const mySalaries = Array.isArray(salaryData) ? salaryData : [];\r\n\r\n      const thisMonthSalary = mySalaries.find((salary: any) => \r\n        salary.month === (currentMonth + 1) && salary.year === currentYear\r\n      );\r\n\r\n      const lastSalary = mySalaries\r\n        .sort((a: any, b: any) => {\r\n          const aDate = new Date(a.year, a.month - 1);\r\n          const bDate = new Date(b.year, b.month - 1);\r\n          return bDate.getTime() - aDate.getTime();\r\n        })[0];\r\n\r\n      // Generate recent activities\r\n      const recentActivities: Array<{\r\n        type: 'checkin' | 'checkout' | 'salary' | 'maintenance' | 'student';\r\n        message: string;\r\n        time: string;\r\n        status?: string;\r\n      }> = [];\r\n\r\n      // Add recent check-ins/check-outs\r\n      myCheckIns.slice(0, 2).forEach((checkIn: any) => {\r\n        if (checkIn.checkin_time) {\r\n          const checkInDate = new Date(checkIn.date || checkIn.created_at);\r\n          const timeAgo = formatTimeAgo(checkInDate);\r\n          recentActivities.push({\r\n            type: 'checkin' as const,\r\n            message: `Checked in for ${checkIn.shift || 'work shift'}`,\r\n            time: timeAgo,\r\n            status: checkIn.status,\r\n          });\r\n        }\r\n\r\n        if (checkIn.checkout_time) {\r\n          const checkOutDate = new Date(checkIn.date || checkIn.created_at);\r\n          const timeAgo = formatTimeAgo(checkOutDate);\r\n          recentActivities.push({\r\n            type: 'checkout' as const,\r\n            message: `Checked out from ${checkIn.shift || 'work shift'}`,\r\n            time: timeAgo,\r\n            status: 'completed',\r\n          });\r\n        }\r\n      });\r\n\r\n      // Add recent salary information\r\n      if (lastSalary) {\r\n        const salaryDate = new Date(lastSalary.year, lastSalary.month - 1);\r\n        const timeAgo = formatTimeAgo(salaryDate);\r\n        recentActivities.push({\r\n          type: 'salary' as const,\r\n          message: `Salary of Rs.${parseFloat(String(lastSalary.amount || '0')).toLocaleString()} processed`,\r\n          time: timeAgo,\r\n          status: lastSalary.status,\r\n        });\r\n      }\r\n\r\n      // Add work-related activities for staff\r\n      recentActivities.push(\r\n        {\r\n          type: 'maintenance' as const,\r\n          message: `Current work shift active`,\r\n          time: 'Current',\r\n          status: 'active',\r\n        }\r\n      );\r\n\r\n      // Sort activities by most recent first\r\n      recentActivities.sort((a, b) => {\r\n        if (a.time === 'Current') return -1;\r\n        if (b.time === 'Current') return 1;\r\n        return a.time.localeCompare(b.time);\r\n      });\r\n\r\n      setStats({\r\n        currentStatus,\r\n        workShift: 'Day Shift (8AM - 4PM)', // This should come from staff data\r\n        department: profileData?.department || 'General',\r\n        position: profileData?.position || 'Staff Member',\r\n        lastCheckIn: (latestCheckIn as any)?.checkin_time || '',\r\n        lastCheckOut: (latestCheckIn as any)?.checkout_time || '',\r\n        totalRooms,\r\n        occupiedRooms,\r\n        availableRooms,\r\n        totalCapacity,\r\n        occupiedBeds,\r\n        availableBeds,\r\n        totalStudents,\r\n        monthlySalary: thisMonthSalary ? parseFloat(String(thisMonthSalary.amount || '0')) : 0,\r\n        lastSalaryDate: lastSalary ? `${lastSalary.year}-${String(lastSalary.month).padStart(2, '0')}-01` : '',\r\n        lastSalaryAmount: lastSalary ? parseFloat(String(lastSalary.amount || '0')) : 0,\r\n        hasPendingCheckout: checkInOutData?.length > 0 && !(latestCheckIn as any)?.checkout_time,\r\n        recentActivities: recentActivities.slice(0, 5),\r\n        pendingTasks: [\r\n          { task: 'Review student check-in requests', priority: 'high', dueDate: '2025-07-29' },\r\n          { task: 'Update room maintenance records', priority: 'medium', dueDate: '2025-07-30' },\r\n          { task: 'Submit monthly activity report', priority: 'low', dueDate: '2025-08-01' },\r\n        ],\r\n      });\r\n    } catch (error) {\r\n      console.error('Error fetching dashboard data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatTimeAgo = (date: Date): string => {\r\n    const now = new Date();\r\n    const diffInMs = now.getTime() - date.getTime();\r\n    const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\r\n    \r\n    if (diffInDays === 0) return 'Today';\r\n    if (diffInDays === 1) return '1 day ago';\r\n    if (diffInDays < 7) return `${diffInDays} days ago`;\r\n    if (diffInDays < 14) return '1 week ago';\r\n    if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;\r\n    if (diffInDays < 60) return '1 month ago';\r\n    return `${Math.floor(diffInDays / 30)} months ago`;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50\">\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"relative\">\r\n            <div className=\"w-20 h-20 border-4 border-blue-200 rounded-full animate-spin\"></div>\r\n            <div className=\"absolute top-0 left-0 w-20 h-20 border-4 border-blue-600 rounded-full animate-spin\" style={{clipPath: 'polygon(0% 0%, 50% 0%, 50% 100%, 0% 100%)'}}></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50\">\r\n      <div className=\"container mx-auto px-6 py-8\">\r\n        {/* Welcome Header */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-8 text-white shadow-xl\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold mb-2\">Welcome back, Staff Member!</h1>\r\n                <p className=\"text-blue-100 text-lg flex items-center gap-4\">\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <Home className=\"w-5 h-5\" />\r\n                    {stats.department}\r\n                  </span>\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <User className=\"w-5 h-5\" />\r\n                    {stats.position}\r\n                  </span>\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Cards */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8\">\r\n          <div className=\"bg-white rounded-xl p-6 shadow-lg border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"flex items-center gap-3 mb-3\">\r\n                  <div className=\"bg-blue-100 text-blue-600 p-2 rounded-lg\">\r\n                    <Home className=\"w-6 h-6\" />\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"font-semibold text-gray-900\">Room Capacity</h3>\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      {stats.availableBeds > 0 ? `${stats.availableBeds} beds vacant` : 'All beds occupied'}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <p className=\"text-2xl font-bold text-gray-900\">{stats.totalCapacity}</p>\r\n                {stats.totalCapacity > 0 && (\r\n                  <p className=\"text-sm text-gray-600 mt-1\">\r\n                    {stats.occupiedBeds} occupied  {stats.availableBeds} vacant\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-xl p-6 shadow-lg border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"flex items-center gap-3 mb-3\">\r\n                  <div className=\"bg-blue-100 text-blue-600 p-2 rounded-lg\">\r\n                    <User className=\"w-6 h-6\" />\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"font-semibold text-gray-900\">Students</h3>\r\n                    <p className=\"text-sm text-gray-500\">Total active students</p>\r\n                  </div>\r\n                </div>\r\n                <p className=\"text-2xl font-bold text-gray-900\">{stats.totalStudents}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-xl p-6 shadow-lg border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"flex items-center gap-3 mb-3\">\r\n                  <div className=\"bg-emerald-100 text-emerald-600 p-2 rounded-lg\">\r\n                    <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"font-semibold text-gray-900\">Salary</h3>\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      {stats.lastSalaryDate ? `Last: ${new Date(stats.lastSalaryDate).toLocaleDateString()}` : 'No record'}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <p className=\"text-2xl font-bold text-gray-900\">\r\n                  {stats.monthlySalary > 0 ? `Rs.${Math.round(stats.monthlySalary).toLocaleString()}` : 'N/A'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Checkout Status Alert */}\r\n        {stats.hasPendingCheckout && (\r\n          <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-8\">\r\n            <div className=\"flex items-center\">\r\n              <Clock className=\"w-8 h-8 text-yellow-600 mr-3\" />\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-yellow-800\">Checkout Request Pending</h3>\r\n                <p className=\"text-yellow-600\">Your checkout request is awaiting admin approval</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n          {/* Activities Feed */}\r\n          <div className=\"lg:col-span-2\">\r\n            <div className=\"bg-white rounded-xl p-6 shadow-lg border border-gray-100\">\r\n              <div className=\"flex items-center justify-between mb-6\">\r\n                <div>\r\n                  <h2 className=\"text-xl font-bold text-gray-900\">Recent Activity</h2>\r\n                  <p className=\"text-gray-500 mt-1\">Your latest work activities and updates</p>\r\n                </div>\r\n                <Button variant=\"secondary\" size=\"sm\">\r\n                  <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\r\n                  </svg>\r\n                  View All\r\n                </Button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-4\">\r\n                {stats.recentActivities.map((activity, index) => (\r\n                  <div key={index} className=\"flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors\">\r\n                    <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${\r\n                      activity.type === 'salary' \r\n                        ? 'bg-emerald-100 text-emerald-600' \r\n                        : activity.type === 'checkin'\r\n                        ? 'bg-blue-100 text-blue-600'\r\n                        : activity.type === 'checkout'\r\n                        ? 'bg-red-100 text-red-600'\r\n                        : activity.type === 'student'\r\n                        ? 'bg-blue-100 text-blue-600'\r\n                        : 'bg-amber-100 text-amber-600'\r\n                    }`}>\r\n                      {activity.type === 'salary' ? (\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                        </svg>\r\n                      ) : activity.type === 'checkin' ? (\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                        </svg>\r\n                      ) : activity.type === 'checkout' ? (\r\n                        <Clock className=\"w-5 h-5\" />\r\n                      ) : activity.type === 'student' ? (\r\n                        <User className=\"w-5 h-5\" />\r\n                      ) : (\r\n                        <AlertCircle className=\"w-5 h-5\" />\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"text-sm font-medium text-gray-900\">{activity.message}</p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">{activity.time}</p>\r\n                      {activity.status && (\r\n                        <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-2 ${\r\n                          activity.status === 'completed' || activity.status === 'approved' || activity.status === 'paid'\r\n                            ? 'bg-emerald-100 text-emerald-800'\r\n                            : activity.status === 'pending'\r\n                            ? 'bg-amber-100 text-amber-800'\r\n                            : activity.status === 'active' || activity.status === 'available'\r\n                            ? 'bg-blue-100 text-blue-800'\r\n                            : 'bg-red-100 text-red-800'\r\n                        }`}>\r\n                          {activity.status}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n                {stats.recentActivities.length === 0 && (\r\n                  <div className=\"text-center py-12\">\r\n                    <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                      <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\r\n                      </svg>\r\n                    </div>\r\n                    <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No activities yet</h3>\r\n                    <p className=\"text-gray-500\">Your activities will appear here as you use the system</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Sidebar */}\r\n          <div className=\"space-y-6\">\r\n            {/* Quick Actions */}\r\n            <div className=\"bg-white rounded-xl p-6 shadow-lg border border-gray-100\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Quick Actions</h3>\r\n              <div className=\"space-y-3\">\r\n                <Button \r\n                  onClick={() => window.location.href = '/staff/checkin-checkout'}\r\n                  variant=\"secondary\" \r\n                  className=\"w-full justify-start\"\r\n                >\r\n                  <Clock className=\"w-4 h-4 mr-3\" />\r\n                  Check-In/Out\r\n                </Button>\r\n                <Button \r\n                  onClick={() => window.location.href = '/staff/salary'}\r\n                  variant=\"secondary\" \r\n                  className=\"w-full justify-start\"\r\n                >\r\n                  <svg className=\"w-4 h-4 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  Salary Details\r\n                </Button>\r\n                <Button \r\n                  onClick={() => window.location.href = '/staff/complain'}\r\n                  variant=\"secondary\" \r\n                  className=\"w-full justify-start\"\r\n                >\r\n                  <svg className=\"w-4 h-4 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n                  </svg>\r\n                  Submit Complain\r\n                </Button>\r\n                <Button \r\n                  onClick={() => window.location.href = '/staff/notice'}\r\n                  variant=\"secondary\" \r\n                  className=\"w-full justify-start\"\r\n                >\r\n                  <svg className=\"w-4 h-4 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                  </svg>\r\n                  View Notices\r\n                </Button>\r\n                <Button \r\n                  onClick={() => window.location.href = '/staff/payment-history'}\r\n                  variant=\"secondary\" \r\n                  className=\"w-full justify-start\"\r\n                >\r\n                  <svg className=\"w-4 h-4 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\r\n                  </svg>\r\n                  Payment History\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'UpdateProfileData' is defined but never used.","line":4,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChangePasswordData' is defined but never used.","line":4,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":87},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2283,2286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2283,2286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3534,3537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3534,3537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { profileApi, type UserProfile, type UpdateProfileData, type ChangePasswordData } from '@/lib/api';\r\nimport { Button, TableSkeleton } from '@/components/ui';\r\nimport { PasswordInput } from '@/components/ui/password-input';\r\nimport { User, AlertCircle } from 'lucide-react';\r\n\r\nexport default function StaffProfile() {\r\n  const [profile, setProfile] = useState<UserProfile | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Email update state\r\n  const [email, setEmail] = useState('');\r\n  const [isUpdatingEmail, setIsUpdatingEmail] = useState(false);\r\n  const [emailError, setEmailError] = useState<string | null>(null);\r\n  const [emailSuccess, setEmailSuccess] = useState(false);\r\n  \r\n  // Password change state\r\n  const [currentPassword, setCurrentPassword] = useState('');\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [isChangingPassword, setIsChangingPassword] = useState(false);\r\n  const [passwordError, setPasswordError] = useState<string | null>(null);\r\n  const [passwordSuccess, setPasswordSuccess] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchProfile();\r\n  }, []);\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const data = await profileApi.getProfile();\r\n      setProfile(data);\r\n      setEmail(data.email || '');\r\n    } catch (err) {\r\n      console.error('Error fetching profile:', err);\r\n      setError('Failed to load profile. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUpdateEmail = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setEmailError(null);\r\n    setEmailSuccess(false);\r\n\r\n    if (!email || !email.includes('@')) {\r\n      setEmailError('Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsUpdatingEmail(true);\r\n      const updatedProfile = await profileApi.updateProfile({ email });\r\n      setProfile(updatedProfile);\r\n      setEmailSuccess(true);\r\n      \r\n      setTimeout(() => {\r\n        setEmailSuccess(false);\r\n      }, 3000);\r\n    } catch (err: any) {\r\n      console.error('Error updating email:', err);\r\n      setEmailError(err.message || 'Failed to update email. Please try again.');\r\n    } finally {\r\n      setIsUpdatingEmail(false);\r\n    }\r\n  };\r\n\r\n  const handleChangePassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setPasswordError(null);\r\n    setPasswordSuccess(false);\r\n\r\n    if (!currentPassword || !newPassword || !confirmPassword) {\r\n      setPasswordError('All password fields are required');\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 8) {\r\n      setPasswordError('New password must be at least 8 characters long');\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      setPasswordError('New password and confirmation do not match');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsChangingPassword(true);\r\n      await profileApi.changePassword({\r\n        current_password: currentPassword,\r\n        new_password: newPassword,\r\n        new_password_confirmation: confirmPassword,\r\n      });\r\n      \r\n      setPasswordSuccess(true);\r\n      setCurrentPassword('');\r\n      setNewPassword('');\r\n      setConfirmPassword('');\r\n      \r\n      setTimeout(() => {\r\n        setPasswordSuccess(false);\r\n      }, 3000);\r\n    } catch (err: any) {\r\n      console.error('Error changing password:', err);\r\n      setPasswordError(err.message || 'Failed to change password. Please check your current password.');\r\n    } finally {\r\n      setIsChangingPassword(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Profile Settings</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading profile information...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !profile) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n            <p className=\"text-red-800\">{error || 'Profile not found'}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-xl font-medium text-gray-900\">Profile Settings</h1>\r\n        <p className=\"text-sm text-gray-500 mt-1\">Manage your account settings and preferences</p>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Profile Information Card */}\r\n        <div className=\"lg:col-span-1\">\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                <User className=\"w-6 h-6 text-blue-600\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-lg font-medium text-gray-900\">Account Info</h2>\r\n                <p className=\"text-sm text-gray-500\">\r\n                  {profile.role === 'staff' && profile.staff_name ? profile.staff_name : \r\n                   profile.role === 'student' && profile.student_name ? profile.student_name :\r\n                   profile.role}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">User ID</label>\r\n                <p className=\"text-sm font-medium text-gray-900 mt-1\">{profile.user_id}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Email</label>\r\n                <p className=\"text-sm text-gray-900 mt-1\">{profile.email}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Role</label>\r\n                <p className=\"text-sm text-gray-900 mt-1 capitalize\">\r\n                  {profile.role === 'staff' ? 'Staff' : \r\n                   profile.role === 'student' ? 'Student' : \r\n                   profile.role}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Member Since</label>\r\n                <p className=\"text-sm text-gray-900 mt-1\">\r\n                  {new Date(profile.created_at).toLocaleDateString('en-US', {\r\n                    year: 'numeric',\r\n                    month: 'long',\r\n                    day: 'numeric'\r\n                  })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Email Update and Password Change Forms */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          {/* Update Email Form */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n              </svg>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Update Email Address</h2>\r\n            </div>\r\n\r\n            {emailSuccess && (\r\n              <div className=\"mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-sm text-green-800\">Email updated successfully!</p>\r\n              </div>\r\n            )}\r\n\r\n            {emailError && (\r\n              <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-600\" />\r\n                <p className=\"text-sm text-red-800\">{emailError}</p>\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleUpdateEmail}>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Email Address\r\n                  </label>\r\n                  <input\r\n                    type=\"email\"\r\n                    id=\"email\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"Enter your email address\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={isUpdatingEmail || email === profile.email}\r\n                  className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n                >\r\n                  {isUpdatingEmail ? 'Updating...' : 'Update Email'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n\r\n          {/* Change Password Form */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n              </svg>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Change Password</h2>\r\n            </div>\r\n\r\n            {passwordSuccess && (\r\n              <div className=\"mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-sm text-green-800\">Password changed successfully!</p>\r\n              </div>\r\n            )}\r\n\r\n            {passwordError && (\r\n              <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-600\" />\r\n                <p className=\"text-sm text-red-800\">{passwordError}</p>\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleChangePassword}>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"current-password\"\r\n                    label=\"Current Password\"\r\n                    value={currentPassword}\r\n                    onChange={(e) => setCurrentPassword(e.target.value)}\r\n                    placeholder=\"Enter your current password\"\r\n                    required\r\n                    autoComplete=\"current-password\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"new-password\"\r\n                    label=\"New Password\"\r\n                    value={newPassword}\r\n                    onChange={(e) => setNewPassword(e.target.value)}\r\n                    placeholder=\"Enter new password (min 8 characters)\"\r\n                    required\r\n                    minLength={8}\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"confirm-password\"\r\n                    label=\"Confirm New Password\"\r\n                    value={confirmPassword}\r\n                    onChange={(e) => setConfirmPassword(e.target.value)}\r\n                    placeholder=\"Confirm new password\"\r\n                    required\r\n                    minLength={8}\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                </div>\r\n\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={isChangingPassword}\r\n                  className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n                >\r\n                  {isChangingPassword ? 'Changing Password...' : 'Change Password'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\salary\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSalary'. Either include it or remove the dependency array.","line":19,"column":6,"nodeType":"ArrayExpression","endLine":19,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSalary, salaryId]","fix":{"range":[546,556],"text":"[fetchSalary, salaryId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { SalaryApi, type Salary } from '@/lib/api';\r\n\r\nexport default function StaffSalaryDetail() {\r\n  const params = useParams();\r\n  const salaryId = parseInt(params.id as string);\r\n  \r\n  const [salary, setSalary] = useState<Salary | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (salaryId) {\r\n      fetchSalary();\r\n    }\r\n  }, [salaryId]);\r\n\r\n  const fetchSalary = async () => {\r\n    try {\r\n      setLoading(true);\r\n      // Use the getMySalaryHistory and filter by ID since staff can only view their own salary\r\n      const salaries = await SalaryApi.getMySalaryHistory();\r\n      const salaryData = salaries.find(s => s.id === salaryId);\r\n      \r\n      if (!salaryData) {\r\n        throw new Error('Salary record not found or you do not have permission to view it');\r\n      }\r\n      \r\n      setSalary(salaryData);\r\n      setError(null);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to load salary details');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `Rs.${Math.round(amount).toLocaleString()}`;\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getMonthName = (month: number): string => {\r\n    const months = [\r\n      'January', 'February', 'March', 'April', 'May', 'June',\r\n      'July', 'August', 'September', 'October', 'November', 'December'\r\n    ];\r\n    return months[month - 1] || '';\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Salary Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading salary information...</p>\r\n        </div>\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !salary) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error || 'Salary record not found'}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-4\">\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">\r\n            {getMonthName(salary.month)} {salary.year}\r\n          </h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">\r\n            Viewing salary details\r\n          </p>\r\n        </div>\r\n\r\n        {/* Main Content */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <div className=\"p-6\">\r\n            {/* Main Content */}\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-6\">Payment Information</h3>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Payment Month</h4>\r\n                  <p className=\"text-lg text-gray-900 font-medium\">\r\n                    {getMonthName(salary.month)} {salary.year}\r\n                  </p>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Amount</h4>\r\n                  <p className=\"text-2xl font-bold text-green-600\">\r\n                    {formatCurrency(parseFloat(String(salary.amount || '0')))}\r\n                  </p>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Payment Date</h4>\r\n                  <p className=\"text-lg text-gray-900\">\r\n                    {formatDate(salary.created_at)}\r\n                  </p>\r\n                </div>\r\n\r\n                {salary.description && (\r\n                  <div>\r\n                    <h4 className=\"text-sm font-medium text-gray-500 mb-1\">Description</h4>\r\n                    <p className=\"text-lg text-gray-900\">{salary.description}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Metadata */}\r\n            <div className=\"border-t border-gray-200 mt-8 pt-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n                <div>\r\n                  <span className=\"font-medium text-gray-500\">Created:</span>\r\n                  <span className=\"ml-2 text-gray-900\">{formatDate(salary.created_at)}</span>\r\n                </div>\r\n                {salary.updated_at && (\r\n                  <div>\r\n                    <span className=\"font-medium text-gray-500\">Last Updated:</span>\r\n                    <span className=\"ml-2 text-gray-900\">{formatDate(salary.updated_at)}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\staff\\salary\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":5,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":9},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSalaries'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSalaries]","fix":{"range":[793,795],"text":"[fetchSalaries]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  TableSkeleton,\r\n  ActionButtons\r\n} from '@/components/ui';\r\nimport { SalaryApi, Salary } from '@/lib/api/salary.api';\r\nimport { \r\n  Calendar, \r\n  User,\r\n  AlertCircle\r\n} from 'lucide-react';\r\n\r\nexport default function StaffSalaryPage() {\r\n  const [salaries, setSalaries] = useState<Salary[]>([]);\r\n  const [filteredSalaries, setFilteredSalaries] = useState<Salary[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [stats, setStats] = useState({\r\n    thisMonthSalary: 0,\r\n    lastMonthSalary: 0\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchSalaries();\r\n  }, []);\r\n\r\n  const fetchSalaries = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      // Optimized API call with timeout\r\n      const fetchWithTimeout = async () => {\r\n        return await Promise.race([\r\n          SalaryApi.getMySalaryHistory(),\r\n          new Promise((_, reject) => \r\n            setTimeout(() => reject(new Error('Timeout after 3 seconds')), 3000)\r\n          )\r\n        ]);\r\n      };\r\n      \r\n      const response = await fetchWithTimeout().catch(() => []);\r\n      const salariesArray = Array.isArray(response) ? response : [];\r\n      \r\n      // No need to filter since getMySalaryHistory() already returns only current staff's salaries\r\n      const mySalaries = salariesArray;\r\n      \r\n      setSalaries(mySalaries);\r\n      setFilteredSalaries(mySalaries);\r\n      calculateStats(mySalaries);\r\n    } catch (err) {\r\n      console.error('Error fetching salaries:', err);\r\n      setError('Failed to load salary information. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Filter salaries based on search query\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredSalaries(salaries);\r\n    } else {\r\n      const filtered = salaries.filter(salary =>\r\n        getMonthName(salary.month).toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        salary.year.toString().includes(searchQuery)\r\n      );\r\n      setFilteredSalaries(filtered);\r\n    }\r\n  }, [searchQuery, salaries]);\r\n\r\n  const handleSearch = (query: string) => {\r\n    setSearchQuery(query);\r\n  };\r\n\r\n  const calculateStats = (salariesData: Salary[]) => {\r\n    const currentMonth = new Date().getMonth() + 1;\r\n    const currentYear = new Date().getFullYear();\r\n    const lastMonth = currentMonth === 1 ? 12 : currentMonth - 1;\r\n    const lastMonthYear = currentMonth === 1 ? currentYear - 1 : currentYear;\r\n\r\n    const thisMonthSalary = salariesData.find(salary => \r\n      salary.month === currentMonth && salary.year === currentYear\r\n    );\r\n\r\n    const lastMonthSalary = salariesData.find(salary => \r\n      salary.month === lastMonth && salary.year === lastMonthYear\r\n    );\r\n\r\n    setStats({\r\n      thisMonthSalary: thisMonthSalary ? parseFloat(String(thisMonthSalary.amount || '0')) : 0,\r\n      lastMonthSalary: lastMonthSalary ? parseFloat(String(lastMonthSalary.amount || '0')) : 0\r\n    });\r\n  };\r\n\r\n  const getMonthName = (month: number): string => {\r\n    const months = [\r\n      'January', 'February', 'March', 'April', 'May', 'June',\r\n      'July', 'August', 'September', 'October', 'November', 'December'\r\n    ];\r\n    return months[month - 1] || '';\r\n  };\r\n\r\n  if (loading && filteredSalaries.length === 0) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Salary Information</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading your earnings and payment history...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex justify-between items-start\">\r\n          <div>\r\n            <h1 className=\"text-xl font-medium text-gray-900\">Salary Information</h1>\r\n            <p className=\"text-sm text-gray-500 mt-1\">Your earnings and payment history</p>\r\n          </div>\r\n          <div className=\"text-right\">\r\n            <p className=\"text-xs text-gray-500\">Current Month Salary</p>\r\n            <p className=\"text-xl font-bold text-green-600\">\r\n              Rs.{Math.round(stats.thisMonthSalary).toLocaleString()}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\r\n        <div className=\"bg-white border border-gray-200 rounded-lg p-4 shadow-sm\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-xs font-medium text-gray-500\">This Month</p>\r\n              <p className=\"text-xl font-bold text-gray-900 mt-1\">\r\n                Rs.{Math.round(stats.thisMonthSalary).toLocaleString()}\r\n              </p>\r\n            </div>\r\n            <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center\">\r\n              <User className=\"w-5 h-5 text-green-600\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-200 rounded-lg p-4 shadow-sm\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-xs font-medium text-gray-500\">Last Month</p>\r\n              <p className=\"text-xl font-bold text-gray-900 mt-1\">\r\n                Rs.{Math.round(stats.lastMonthSalary).toLocaleString()}\r\n              </p>\r\n            </div>\r\n            <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n              <Calendar className=\"w-5 h-5 text-blue-600\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={handleSearch}\r\n          placeholder=\"Search by month or year...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Salary History */}\r\n      {filteredSalaries.length === 0 ? (\r\n        <div className=\"text-center py-12 bg-white rounded-lg border border-gray-200\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <User className=\"w-12 h-12 mx-auto\" />\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">No salary records found</h3>\r\n          <p className=\"text-sm text-gray-500\">\r\n            {searchQuery \r\n              ? 'Try adjusting your search criteria' \r\n              : 'Your salary information will appear here once it\\'s processed'\r\n            }\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredSalaries.map((salary) => (\r\n              <div\r\n                key={salary.id}\r\n                className=\"px-6 py-4 hover:bg-gray-50 transition-colors\"\r\n              >\r\n                <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    {/* Salary Header */}\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                      <User className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                      <h3 className=\"text-base font-semibold text-gray-900\">\r\n                        {getMonthName(salary.month)} {salary.year}\r\n                      </h3>\r\n                    </div>\r\n\r\n                    {/* Amount and Date */}\r\n                    <div className=\"flex flex-wrap items-center gap-4\">\r\n                      <p className=\"text-xl font-bold text-gray-900\">\r\n                        Rs.{parseFloat(String(salary.amount || '0')).toLocaleString()}\r\n                      </p>\r\n                      <div className=\"flex items-center gap-1 text-xs text-gray-500\">\r\n                        <Calendar className=\"w-3.5 h-3.5\" />\r\n                        <span>{new Date(salary.updated_at || salary.created_at).toLocaleDateString()}</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Action Button */}\r\n                  <div className=\"flex sm:block justify-end\">\r\n                    <ActionButtons \r\n                      viewUrl={`/staff/salary/${salary.id}`}\r\n                      hideEdit={true}\r\n                      hideDelete={true}\r\n                      style=\"compact\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\checkin-checkout\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Home' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Loader' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":9},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecord'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRecord, recordId]","fix":{"range":[992,1002],"text":"[fetchRecord, recordId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1218,1221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1218,1221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2107,2110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2107,2110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { studentCheckInCheckOutApi, StudentCheckInCheckOut } from '@/lib/api/student-checkincheckout.api';\r\nimport { Button } from '@/components/ui';\r\nimport { \r\n  ArrowLeft, \r\n  Clock, \r\n  Check, \r\n  X, \r\n  AlertCircle,\r\n  ArrowRight,\r\n  Calendar,\r\n  User,\r\n  Home,\r\n  Loader\r\n} from 'lucide-react';\r\n\r\nexport default function StudentCheckinCheckoutDetailPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const recordId = params.id as string;\r\n  \r\n  const [loading, setLoading] = useState(true);\r\n  const [record, setRecord] = useState<StudentCheckInCheckOut | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [checkingIn, setCheckingIn] = useState(false);\r\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (recordId) {\r\n      fetchRecord();\r\n    }\r\n  }, [recordId]);\r\n\r\n  const fetchRecord = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await studentCheckInCheckOutApi.getCheckInCheckOut(recordId);\r\n      setRecord(response.data);\r\n    } catch (err: any) {\r\n      console.error('Failed to fetch record:', err);\r\n      setError(err.message || 'Failed to load record details');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCheckIn = async () => {\r\n    if (!record) return;\r\n    \r\n    try {\r\n      setCheckingIn(true);\r\n      setError(null);\r\n      \r\n      // Use current date and time for check-in\r\n      const now = new Date();\r\n      \r\n      await studentCheckInCheckOutApi.checkIn({\r\n        block_id: record.block_id,\r\n        remarks: `Checked in from detail page at ${now.toLocaleString()}`\r\n      });\r\n      \r\n      setSuccessMessage(`Successfully checked in at ${now.toLocaleString()}!`);\r\n      \r\n      // Refresh the record to get updated data\r\n      await fetchRecord();\r\n      \r\n      // Clear success message after 5 seconds\r\n      setTimeout(() => setSuccessMessage(null), 5000);\r\n    } catch (err: any) {\r\n      console.error('Failed to check in:', err);\r\n      setError(err.message || 'Failed to check in');\r\n    } finally {\r\n      setCheckingIn(false);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = () => {\r\n    if (!record) return null;\r\n    \r\n    switch (record.status) {\r\n      case 'pending':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 border border-yellow-200\">\r\n            <Clock className=\"w-4 h-4 mr-2\" />\r\n            Pending\r\n          </span>\r\n        );\r\n      case 'approved':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-800 border border-green-200\">\r\n            <Check className=\"w-4 h-4 mr-2\" />\r\n            Approved\r\n          </span>\r\n        );\r\n      case 'declined':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-red-100 text-red-800 border border-red-200\">\r\n            <X className=\"w-4 h-4 mr-2\" />\r\n            Declined\r\n          </span>\r\n        );\r\n      case 'checked_in':\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-blue-100 text-blue-800 border border-blue-200\">\r\n            <ArrowRight className=\"w-4 h-4 mr-2\" />\r\n            Checked In\r\n          </span>\r\n        );\r\n      default:\r\n        return (\r\n          <span className=\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-800 border border-gray-200\">\r\n            <AlertCircle className=\"w-4 h-4 mr-2\" />\r\n            Unknown Status\r\n          </span>\r\n        );\r\n    }\r\n  };\r\n\r\n  const formatDateTime = (dateString: string) => {\r\n    return new Date(dateString).toLocaleString('en-US', {\r\n      weekday: 'short',\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      weekday: 'long',\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const calculateDuration = () => {\r\n    if (!record || !record.checkout_time) {\r\n      return 'N/A';\r\n    }\r\n    \r\n    // If student has checked in, calculate duration between checkout and checkin\r\n    if (record.checkin_time) {\r\n      const checkoutTime = new Date(record.checkout_time);\r\n      const checkinTime = new Date(record.checkin_time);\r\n      const diffMs = checkinTime.getTime() - checkoutTime.getTime();\r\n      \r\n      const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n      \r\n      if (days > 0) {\r\n        return `${days}d ${hours}h ${minutes}m`;\r\n      } else if (hours > 0) {\r\n        return `${hours}h ${minutes}m`;\r\n      }\r\n      return `${minutes}m`;\r\n    }\r\n    \r\n    // If not checked in yet, calculate duration between checkout and estimated return\r\n    if (record.estimated_checkin_date) {\r\n      const checkoutTime = new Date(record.checkout_time);\r\n      const estimatedReturn = new Date(record.estimated_checkin_date);\r\n      const diffMs = estimatedReturn.getTime() - checkoutTime.getTime();\r\n      \r\n      const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      \r\n      if (days > 0) {\r\n        return `${days}d ${hours}h (estimated)`;\r\n      } else if (hours > 0) {\r\n        return `${hours}h (estimated)`;\r\n      }\r\n      return 'Less than 1 hour (estimated)';\r\n    }\r\n    \r\n    return 'N/A';\r\n  };\r\n\r\n  const getCheckoutReason = () => {\r\n    if (!record || !record.remarks) return '';\r\n    \r\n    // Extract only the original checkout reason, exclude check-in information\r\n    const remarks = record.remarks;\r\n    \r\n    // Split by \". Check-in:\" to separate original reason from check-in timestamp\r\n    const parts = remarks.split('. Check-in:');\r\n    return parts[0]; // Return only the original checkout reason\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"w-full\">\r\n          <div className=\"animate-pulse\">\r\n            <div className=\"h-6 bg-gray-200 rounded w-32 mb-4\"></div>\r\n            <div className=\"h-8 bg-gray-200 rounded w-64 mb-6\"></div>\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <div className=\"h-6 bg-gray-200 rounded w-48 mb-4\"></div>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"h-4 bg-gray-200 rounded w-full\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !record) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"w-full\">\r\n          <button\r\n            onClick={() => router.back()}\r\n            className=\"flex items-center text-gray-600 hover:text-gray-900 mb-6\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            Back to Check-in/Checkout\r\n          </button>\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"text-center\">\r\n              <AlertCircle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Record Not Found</h3>\r\n              <p className=\"text-gray-600 mb-4\">{error || 'The requested record could not be found.'}</p>\r\n              <Button\r\n                onClick={() => router.push('/student/checkin-checkout')}\r\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n              >\r\n                Back to Check-in/Checkout\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">Check-in/Checkout Details</h1>\r\n              <div className=\"flex items-center gap-4 mt-2 text-sm text-gray-600\">\r\n                <span>Created: {formatDateTime(record.created_at)}</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              {getStatusBadge()}\r\n              {record.status === 'approved' && !record.checkin_time && (\r\n                <button\r\n                  onClick={handleCheckIn}\r\n                  disabled={checkingIn}\r\n                  className=\"inline-flex items-center justify-center px-3 py-1.5 border border-transparent rounded-md bg-green-600 text-sm font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  title=\"Check In\"\r\n                >\r\n                  {checkingIn ? (\r\n                    <>\r\n                      <svg className=\"w-4 h-4 mr-1.5 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                      </svg>\r\n                      Checking In...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <ArrowRight className=\"w-4 h-4 mr-1.5\" />\r\n                      Check In\r\n                    </>\r\n                  )}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Success Message */}\r\n          {successMessage && (\r\n            <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-600 mr-2\" />\r\n              <p className=\"text-green-800 text-sm font-medium\">{successMessage}</p>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Error Message */}\r\n          {error && (\r\n            <div className=\"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center\">\r\n              <AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" />\r\n              <p className=\"text-red-800 text-sm font-medium\">{error}</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Time Details */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n              <Clock className=\"w-5 h-5 mr-2\" />\r\n              Time Details\r\n            </h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              {record.checkout_time && (\r\n                <div className=\"p-4 bg-orange-50 rounded-lg border border-orange-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <ArrowLeft className=\"w-4 h-4 text-orange-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-orange-900\">Checkout Time</p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-orange-800 ml-11\">{formatDateTime(record.checkout_time)}</p>\r\n                </div>\r\n              )}\r\n\r\n              {record.checkin_time && (\r\n                <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <ArrowRight className=\"w-4 h-4 text-blue-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-blue-900\">Check-in Time</p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-blue-800 ml-11\">{formatDateTime(record.checkin_time)}</p>\r\n                </div>\r\n              )}\r\n\r\n              {record.estimated_checkin_date && (\r\n                <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <Calendar className=\"w-4 h-4 text-blue-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-blue-900\">Estimated Return</p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-blue-800 ml-11\">{formatDate(record.estimated_checkin_date)}</p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Always show duration if checkout time exists */}\r\n              {record.checkout_time && (\r\n                <div className=\"p-4 bg-gray-50 rounded-lg border border-gray-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <div className=\"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-3\">\r\n                      <Clock className=\"w-4 h-4 text-gray-600\" />\r\n                    </div>\r\n                    <p className=\"text-sm font-medium text-gray-700\">\r\n                      {record.checkin_time ? 'Total Duration' : 'Expected Duration'}\r\n                    </p>\r\n                  </div>\r\n                  <p className=\"text-lg font-semibold text-gray-900 ml-11\">{calculateDuration()}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Additional Info */}\r\n            <div className=\"mt-4 pt-4 border-t border-gray-200\">\r\n              <div className=\"flex flex-wrap gap-4 text-sm\">\r\n                {record.checkout_duration && (\r\n                  <div className=\"flex items-center text-gray-600\">\r\n                    <Clock className=\"w-4 h-4 mr-1\" />\r\n                    <span className=\"font-medium\">Duration:</span>\r\n                    <span className=\"ml-1\">{record.checkout_duration}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Reason */}\r\n          {record.remarks && getCheckoutReason() && (\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n                <AlertCircle className=\"w-5 h-5 mr-2\" />\r\n                Reason\r\n              </h2>\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                <p className=\"text-blue-800 font-medium\">{getCheckoutReason()}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\checkin-checkout\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[702,705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[702,705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1164,1167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1164,1167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3000,3003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3000,3003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { studentCheckInCheckOutApi } from '@/lib/api/student-checkincheckout.api';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { \r\n  SubmitButton, \r\n  CancelButton \r\n} from '@/components/ui';\r\nimport { Calendar, Clock, AlertCircle } from 'lucide-react';\r\n\r\nexport default function CreateStudentCheckout() {\r\n  const router = useRouter();\r\n  \r\n  const [loading, setLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [studentProfile, setStudentProfile] = useState<any>(null);\r\n  \r\n  // Get current date for default values\r\n  const currentDate = new Date().toISOString().split('T')[0];\r\n  \r\n  const [formData, setFormData] = useState({\r\n    estimated_checkin_date: '',\r\n    remarks: '',\r\n  });\r\n\r\n  useEffect(() => {\r\n    const fetchStudentProfile = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const profile = await studentApi.getStudentProfile();\r\n        setStudentProfile(profile);\r\n      } catch (error: any) {\r\n        console.error('Error fetching student profile:', error);\r\n        setErrors({ general: 'Failed to load student profile. Please try again.' });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchStudentProfile();\r\n  }, []);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setErrors({});\r\n\r\n    // Client-side validation\r\n    const newErrors: Record<string, string> = {};\r\n    \r\n    if (!formData.estimated_checkin_date) {\r\n      newErrors.estimated_checkin_date = 'Estimated return date is required';\r\n    } else if (formData.estimated_checkin_date < currentDate) {\r\n      newErrors.estimated_checkin_date = 'Return date cannot be in the past';\r\n    }\r\n\r\n    if (!formData.remarks.trim()) {\r\n      newErrors.remarks = 'Reason for checkout is required';\r\n    }\r\n\r\n    if (Object.keys(newErrors).length > 0) {\r\n      setErrors(newErrors);\r\n      setIsSubmitting(false);\r\n      return;\r\n    }\r\n\r\n    if (!studentProfile || !studentProfile.id) {\r\n      setErrors({ general: 'Student profile not loaded. Please refresh the page.' });\r\n      setIsSubmitting(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await studentCheckInCheckOutApi.checkOut({\r\n        estimated_checkin_date: formData.estimated_checkin_date,\r\n        remarks: formData.remarks.trim()\r\n      });\r\n      router.push('/student/checkin-checkout');\r\n    } catch (error: any) {\r\n      console.error('Error creating checkout request:', error);\r\n      if (error.validation) {\r\n        setErrors(error.validation);\r\n      } else {\r\n        setErrors({ general: error.message || 'Failed to create checkout request' });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n        <div className=\"w-full flex justify-center items-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\r\n      <div className=\"w-full\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Request Checkout</h1>\r\n          <p className=\"text-gray-600 mt-1\">\r\n            Submit a request to checkout from the hostel\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n          {errors.general && (\r\n            <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n              <div className=\"flex\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n                <p className=\"text-red-800\">{errors.general}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Information Card */}\r\n          <div className=\"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n            <div className=\"flex items-start\">\r\n              <div className=\"flex-shrink-0\">\r\n                <Clock className=\"w-5 h-5 text-blue-600 mt-0.5\" />\r\n              </div>\r\n              <div className=\"ml-3\">\r\n                <h3 className=\"text-sm font-medium text-blue-900\">Important Information</h3>\r\n                <div className=\"mt-2 text-sm text-blue-800\">\r\n                  <ul className=\"list-disc list-inside space-y-1\">\r\n                    <li>Your checkout request will be submitted to admin for approval</li>\r\n                    <li>Checkout time will be recorded as current system time when approved</li>\r\n                    <li>You can check back in once your request is approved and you return</li>\r\n                    <li>Estimated return date is required to track checkout duration</li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {/* Checkout Date and Time */}\r\n            <div className=\"space-y-1.5\">\r\n              <label className=\"block text-sm font-semibold text-neutral-900 flex items-center\">\r\n                <Clock className=\"w-4 h-4 mr-2\" />\r\n                Checkout Date & Time\r\n              </label>\r\n              <div className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 bg-gray-50\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <span className=\"font-medium text-gray-700\">Date: </span>\r\n                    <span>{new Date().toLocaleDateString('en-US', { \r\n                      month: '2-digit',\r\n                      day: '2-digit', \r\n                      year: 'numeric'\r\n                    })}</span>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"font-medium text-gray-700\">Time: </span>\r\n                    <span>{new Date().toLocaleTimeString('en-US', { \r\n                      hour: '2-digit', \r\n                      minute: '2-digit',\r\n                      second: '2-digit',\r\n                      hour12: true \r\n                    })}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-xs text-gray-500\">\r\n                This will be recorded as your checkout time when the request is approved.\r\n              </p>\r\n            </div>\r\n\r\n            {/* Estimated Return Date */}\r\n            <div className=\"space-y-1.5\">\r\n              <label htmlFor=\"estimated_checkin_date\" className=\"block text-sm font-semibold text-neutral-900 flex items-center\">\r\n                <Calendar className=\"w-4 h-4 mr-2\" />\r\n                Estimated Return Date *\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                id=\"estimated_checkin_date\"\r\n                name=\"estimated_checkin_date\"\r\n                value={formData.estimated_checkin_date}\r\n                onChange={handleChange}\r\n                min={currentDate}\r\n                className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200\"\r\n                required\r\n              />\r\n              <p className=\"text-xs text-gray-500\">\r\n                This helps track your checkout duration and is required for approval.\r\n              </p>\r\n              {errors.estimated_checkin_date && (\r\n                <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                  <AlertCircle className=\"w-3.5 h-3.5 mr-2\" />\r\n                  {errors.estimated_checkin_date}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Reason/Remarks */}\r\n            <div className=\"space-y-1.5\">\r\n              <label htmlFor=\"remarks\" className=\"block text-sm font-semibold text-neutral-900\">\r\n                Reason for Checkout *\r\n              </label>\r\n              <textarea\r\n                id=\"remarks\"\r\n                name=\"remarks\"\r\n                value={formData.remarks}\r\n                onChange={handleChange}\r\n                placeholder=\"Please provide the reason for your checkout request (e.g., going home for weekend, medical appointment, family emergency, etc.)\"\r\n                rows={4}\r\n                className=\"w-full px-4 py-4 border border-neutral-200/60 rounded-lg text-sm text-neutral-600 focus:border-neutral-400 focus:ring-0 outline-none transition-all duration-200 resize-none\"\r\n                required\r\n              />\r\n              <p className=\"text-xs text-gray-500\">\r\n                A clear reason helps admin process your request faster\r\n              </p>\r\n              {errors.remarks && (\r\n                <div className=\"flex items-center mt-1.5 text-xs text-red-600\">\r\n                  <AlertCircle className=\"w-3.5 h-3.5 mr-2\" />\r\n                  {errors.remarks}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push('/student/checkin-checkout')} />\r\n              <SubmitButton \r\n                loading={isSubmitting}\r\n                loadingText=\"Submitting Request...\"\r\n              >\r\n                Submit Checkout Request\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\checkin-checkout\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentStatus' is assigned a value but never used.","line":25,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'checkingOut' is assigned a value but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCheckingOut' is assigned a value but never used.","line":27,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":65,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3210,3213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3210,3213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleQuickCheckout' is assigned a value but never used.","line":111,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":28}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { studentCheckInCheckOutApi, StudentCheckInCheckOut } from '@/lib/api/student-checkincheckout.api';\r\nimport { Button, ActionButtons } from '@/components/ui';\r\nimport { \r\n  Plus, \r\n  Clock, \r\n  Check, \r\n  X, \r\n  AlertCircle,\r\n  ArrowRight,\r\n  ArrowLeft,\r\n  Search,\r\n  Eye\r\n} from 'lucide-react';\r\n\r\nexport default function StudentCheckinCheckoutPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [records, setRecords] = useState<StudentCheckInCheckOut[]>([]);\r\n  const [filteredRecords, setFilteredRecords] = useState<StudentCheckInCheckOut[]>([]);\r\n  const [currentStatus, setCurrentStatus] = useState<StudentCheckInCheckOut | null>(null);\r\n  const [checkingIn, setCheckingIn] = useState(false);\r\n  const [checkingOut, setCheckingOut] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n\r\n  useEffect(() => {\r\n    fetchStudentRecords();\r\n  }, []);\r\n\r\n  // Live search effect\r\n  useEffect(() => {\r\n    if (!searchTerm.trim()) {\r\n      setFilteredRecords(records);\r\n    } else {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      const filtered = records.filter(record => \r\n        record.status?.toLowerCase().includes(searchLower) ||\r\n        record.block?.block_name?.toLowerCase().includes(searchLower) ||\r\n        record.remarks?.toLowerCase().includes(searchLower)\r\n      );\r\n      setFilteredRecords(filtered);\r\n    }\r\n  }, [searchTerm, records]);\r\n\r\n  const fetchStudentRecords = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const response = await studentCheckInCheckOutApi.getMyRecords();\r\n      \r\n      setRecords(response.data || []);\r\n      setFilteredRecords(response.data || []);\r\n      \r\n      // Find the most recent active record (checked_in, pending, or approved)\r\n      const activeRecord = (response.data || []).find(record => \r\n        record.status === 'checked_in' || record.status === 'pending' || record.status === 'approved'\r\n      );\r\n      \r\n      setCurrentStatus(activeRecord || null);\r\n    } catch (err) {\r\n      setError('Failed to load check-in/checkout data');\r\n      // Don't let API failures prevent the page from loading\r\n      setRecords([]);\r\n      setFilteredRecords([]);\r\n      setCurrentStatus(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleQuickCheckin = async () => {\r\n    try {\r\n      setCheckingIn(true);\r\n      setError(null);\r\n      \r\n      // Find the most recent approved record to get block_id\r\n      const approvedRecord = records.find(record => record.status === 'approved');\r\n      \r\n      if (!approvedRecord || !approvedRecord.block_id) {\r\n        setError('No approved checkout record found to check in');\r\n        return;\r\n      }\r\n      \r\n      // Student check-in (backend will get student info from auth)\r\n      await studentCheckInCheckOutApi.checkIn({\r\n        block_id: approvedRecord.block_id,\r\n        remarks: \"Student self check-in\"\r\n      });\r\n      \r\n      await fetchStudentRecords();\r\n    } catch (err: any) {\r\n      console.error('Check-in failed:', err);\r\n      \r\n      // If student is already checked in, refresh the records to get updated status\r\n      if (err.message && err.message.includes('already checked in')) {\r\n        await fetchStudentRecords();\r\n        return;\r\n      }\r\n      \r\n      setError(err.message || 'Failed to check in');\r\n    } finally {\r\n      setCheckingIn(false);\r\n    }\r\n  };\r\n\r\n  const handleQuickCheckout = async () => {\r\n    // This method is no longer used since we have a dedicated create page\r\n    // Redirect to create page instead\r\n    router.push('/student/checkin-checkout/create');\r\n  };\r\n\r\n  const handleSearch = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    // Live search handles filtering, no need to fetch again\r\n  };\r\n\r\n  const formatTime = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleTimeString('en-US', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  const formatDate = (dateTime: string | null | undefined) => {\r\n    if (!dateTime) return '-';\r\n    return new Date(dateTime).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const calculateDuration = (record: StudentCheckInCheckOut) => {\r\n    if (!record.checkout_time) return '-';\r\n    \r\n    // If student has checked in, calculate actual duration between checkout and checkin\r\n    if (record.checkin_time) {\r\n      const checkout = new Date(record.checkout_time);\r\n      const checkin = new Date(record.checkin_time);\r\n      const diffMs = checkin.getTime() - checkout.getTime();\r\n      \r\n      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n      \r\n      if (diffDays > 0) {\r\n        return `${diffDays}d ${diffHours}h ${diffMinutes}m`;\r\n      } else if (diffHours > 0) {\r\n        return `${diffHours}h ${diffMinutes}m`;\r\n      } else {\r\n        return `${diffMinutes}m`;\r\n      }\r\n    }\r\n    \r\n    // If not checked in yet, calculate estimated duration between checkout and estimated checkin\r\n    if (record.estimated_checkin_date) {\r\n      const checkout = new Date(record.checkout_time);\r\n      const estimated = new Date(record.estimated_checkin_date);\r\n      const diffMs = estimated.getTime() - checkout.getTime();\r\n      \r\n      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n      const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n      const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\r\n      \r\n      if (diffDays > 0) {\r\n        return `${diffDays}d ${diffHours}h ${diffMinutes}m (est.)`;\r\n      } else if (diffHours > 0) {\r\n        return `${diffHours}h ${diffMinutes}m (est.)`;\r\n      } else {\r\n        return `${diffMinutes}m (est.)`;\r\n      }\r\n    }\r\n    \r\n    return '-';\r\n  };\r\n\r\n  const getStatusBadge = (record: StudentCheckInCheckOut) => {\r\n    // Check admin approval status first\r\n    if (record.status === 'approved') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Approved\r\n        </span>\r\n      );\r\n    } else if (record.status === 'declined') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Declined\r\n        </span>\r\n      );\r\n    } else if (record.status === 'pending') {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Pending\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time && record.checkin_time) {\r\n      // If both checkout and checkin exist and status is not pending/approved/declined\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Complete\r\n        </span>\r\n      );\r\n    } else if (record.checkout_time) {\r\n      // Only checkout exists\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked Out\r\n        </span>\r\n      );\r\n    } else if (record.checkin_time) {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\r\n          <Clock className=\"w-3 h-3 mr-1\" />\r\n          Checked In\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Draft\r\n        </span>\r\n      );\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">Check-in/Check-out</h1>\r\n        <Button\r\n          onClick={() => router.push('/student/checkin-checkout/create')}\r\n          className=\"bg-[#235999] hover:bg-[#1e4d87] text-white\"\r\n          icon={<Plus className=\"w-4 h-4\" />}\r\n        >\r\n          Request Checkout\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Error Message */}\r\n      {error && (\r\n        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" />\r\n            <span className=\"text-red-800\">{error}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Search Bar */}\r\n      <div className=\"mb-6\">\r\n        <form onSubmit={handleSearch} className=\"max-w-md\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Search by status, block, or remarks...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg text-sm text-gray-600 placeholder:text-gray-400 focus:border-gray-400 focus:ring-0 outline-none transition-all duration-200 bg-white\"\r\n            />\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Block\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Checkout Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Est. Check-in Date\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Check-in Time\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Duration\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Status\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {filteredRecords.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={7} className=\"px-6 py-8 text-center text-gray-500\">\r\n                    {searchTerm ? `No records found matching \"${searchTerm}\"` : 'No check-in/checkout records found.'}\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                filteredRecords\r\n                  .sort((a, b) => {\r\n                    // Get the most recent activity timestamp for each record\r\n                    const getLatestActivity = (record: StudentCheckInCheckOut) => {\r\n                      const times = [\r\n                        record.checkout_time,\r\n                        record.checkin_time,\r\n                        record.created_at\r\n                      ].filter(Boolean).map(time => new Date(time!).getTime());\r\n                      \r\n                      return Math.max(...times);\r\n                    };\r\n                    \r\n                    const aLatest = getLatestActivity(a);\r\n                    const bLatest = getLatestActivity(b);\r\n                    \r\n                    // Sort by most recent activity first\r\n                    return bLatest - aLatest;\r\n                  })\r\n                  .map((record) => (\r\n                    <tr key={record.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"text-sm font-medium text-gray-900\">\r\n                          {record.block?.block_name || 'N/A'}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"flex flex-col\">\r\n                          <div className=\"text-sm text-gray-500\">\r\n                            {formatDate(record.checkout_time)}\r\n                          </div>\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            {formatTime(record.checkout_time)}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"text-sm text-gray-900\">\r\n                          {record.estimated_checkin_date ? formatDate(record.estimated_checkin_date) : 'Not set'}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"flex flex-col\">\r\n                          <div className=\"text-sm text-gray-500\">\r\n                            {formatDate(record.checkin_time)}\r\n                          </div>\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            {formatTime(record.checkin_time)}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"text-sm text-gray-900\">\r\n                          {calculateDuration(record)}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        {getStatusBadge(record)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <ActionButtons\r\n                            viewUrl={`/student/checkin-checkout/${record.id}`}\r\n                            style=\"compact\"\r\n                            hideEdit={true}\r\n                            hideDelete={true}\r\n                          />\r\n                          \r\n                          {/* Show Check In button only for approved records that have checkout but no checkin yet */}\r\n                          {record.status === 'approved' && record.checkout_time && !record.checkin_time && (\r\n                            <Button\r\n                              onClick={handleQuickCheckin}\r\n                              disabled={checkingIn}\r\n                              size=\"sm\"\r\n                              className=\"bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1\"\r\n                              icon={checkingIn ? (\r\n                                <div className=\"animate-spin rounded-full h-3 w-3 border-2 border-white border-t-transparent\" />\r\n                              ) : (\r\n                                <ArrowRight className=\"w-3 h-3\" />\r\n                              )}\r\n                            >\r\n                              {checkingIn ? 'Checking In...' : 'Check In'}\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\complain\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[695,698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[695,698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4903,4906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4903,4906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'alt' is defined but never used.","line":389,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":389,"endColumn":42},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":442,"column":56,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in &apos;pending' or 'in progress' status"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in &lsquo;pending' or 'in progress' status"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in &#39;pending' or 'in progress' status"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in &rsquo;pending' or 'in progress' status"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":442,"column":64,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending&apos; or 'in progress' status"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending&lsquo; or 'in progress' status"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending&#39; or 'in progress' status"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending&rsquo; or 'in progress' status"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":442,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or &apos;in progress' status"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or &lsquo;in progress' status"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or &#39;in progress' status"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or &rsquo;in progress' status"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":442,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or 'in progress&apos; status"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or 'in progress&lsquo; status"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or 'in progress&#39; status"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16339,16407],"text":"You can edit complains that are in 'pending' or 'in progress&rsquo; status"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SuccessToast,\r\n  TableSkeleton,\r\n  SingleImageUploadEdit\r\n} from '@/components/ui';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\ninterface ComplainFormData {\r\n  title: string;\r\n  description: string;\r\n  complain_attachment?: File;\r\n}\r\n\r\nexport default function EditComplain() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const complainId = params.id as string;\r\n\r\n  const [complain, setComplain] = useState<any | null>(null);\r\n  const [formData, setFormData] = useState<ComplainFormData>({\r\n    title: '',\r\n    description: '',\r\n  });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n  const [attachment, setAttachment] = useState<File | null>(null);\r\n  const [existingAttachment, setExistingAttachment] = useState<string | null>(null);\r\n\r\n  // Fetch complain data\r\n  useEffect(() => {\r\n    const fetchComplain = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        const complainData = await studentApi.getStudentComplaint(complainId);\r\n        setComplain(complainData);\r\n        \r\n        // Populate form with existing data\r\n        setFormData({\r\n          title: complainData.title,\r\n          description: complainData.description,\r\n        });\r\n        \r\n        if (complainData.complain_attachment) {\r\n          setExistingAttachment(complainData.complain_attachment);\r\n        }\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching complain:', error);\r\n        if (error instanceof ApiError) {\r\n          if (error.status === 404) {\r\n            setAlert({\r\n              show: true, \r\n              message: `Complain with ID ${complainId} not found.`, \r\n              type: 'error'\r\n            });\r\n          } else {\r\n            setAlert({\r\n              show: true, \r\n              message: `Failed to load complain: ${error.message}`, \r\n              type: 'error'\r\n            });\r\n          }\r\n        } else {\r\n          setAlert({\r\n            show: true, \r\n            message: 'Failed to load complain data. Please try again.', \r\n            type: 'error'\r\n          });\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (complainId) {\r\n      fetchComplain();\r\n    }\r\n  }, [complainId]);\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.title.trim()) {\r\n      newErrors.title = 'Title is required';\r\n    } else if (formData.title.length > 255) {\r\n      newErrors.title = 'Title must be less than 255 characters';\r\n    }\r\n\r\n    if (!formData.description.trim()) {\r\n      newErrors.description = 'Description is required';\r\n    } else if (formData.description.length > 1000) {\r\n      newErrors.description = 'Description must be less than 1000 characters';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n      \r\n      const submitData: ComplainFormData = {\r\n        ...formData,\r\n        complain_attachment: attachment || undefined\r\n      };\r\n\r\n      await studentApi.updateStudentComplaint(complainId, submitData);\r\n      \r\n      setAlert({\r\n        show: true, \r\n        message: 'Complain updated successfully!', \r\n        type: 'success'\r\n      });\r\n\r\n      // Redirect to the complain detail page after a short delay - optimized\r\n      setTimeout(() => {\r\n        router.push(`/student/complain/${complainId}`);\r\n      }, 1500); // Reduced from 2000ms\r\n\r\n    } catch (error) {\r\n      console.error('Error updating complain:', error);\r\n      if (error instanceof ApiError) {\r\n        setAlert({\r\n          show: true, \r\n          message: `Failed to update complain: ${error.message}`, \r\n          type: 'error'\r\n        });\r\n      } else {\r\n        setAlert({\r\n          show: true, \r\n          message: 'Failed to update complain. Please try again.', \r\n          type: 'error'\r\n        });\r\n      }\r\n      \r\n      // Hide error alert after 3 seconds - optimized\r\n      setTimeout(() => {\r\n        setAlert({show: false, message: '', type: 'success'});\r\n      }, 3000); // Reduced from 5000ms\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (field: keyof ComplainFormData, value: any) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [field]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[field]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [field]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusColors = {\r\n      pending: 'bg-amber-100 text-amber-800',\r\n      in_progress: 'bg-blue-100 text-blue-800',\r\n      resolved: 'bg-green-100 text-green-800'\r\n    };\r\n    \r\n    return (\r\n      <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${statusColors[status as keyof typeof statusColors] || 'bg-gray-100 text-gray-800'}`}>\r\n        {status.replace('_', ' ')}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Edit Complain</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading complain details...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!complain) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">Complain not found or failed to load</p>\r\n          </div>\r\n          <div className=\"mt-3 space-x-2\">\r\n            <Button\r\n              onClick={() => router.push('/student/complain')}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Back to My Complains\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Check if complain can be edited\r\n  if (complain.status === 'resolved') {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100\">\r\n        <div className=\"w-full px-6 py-8\">\r\n          <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-6\">\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-6 h-6 text-amber-600 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z\" />\r\n              </svg>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-amber-800\">Cannot Edit Resolved Complain</h3>\r\n                <p className=\"text-amber-700 mt-1\">\r\n                  This complain has been marked as resolved and cannot be edited anymore.\r\n                  If you have additional concerns, please create a new complain.\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4 space-x-3\">\r\n              <Button\r\n                onClick={() => router.push(`/student/complain/${complainId}`)}\r\n                variant=\"secondary\"\r\n              >\r\n                View Complain\r\n              </Button>\r\n              <Button\r\n                onClick={() => router.push('/student/complain/create')}\r\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n              >\r\n                Create New Complain\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100\">\r\n      {/* Alert Notifications */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200 shadow-sm\">\r\n        <div className=\"w-full px-6 py-5\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">Edit Complain</h1>\r\n              <div className=\"flex items-center gap-4 mt-2\">\r\n                {getStatusBadge(complain.status)}\r\n                <span className=\"text-sm text-gray-600 font-medium\">ID: #{complain.id}</span>\r\n              </div>\r\n            </div>\r\n            <Button\r\n              onClick={() => router.push(`/student/complain/${complainId}`)}\r\n              variant=\"secondary\"\r\n              className=\"text-gray-600 hover:text-gray-800\"\r\n            >\r\n              Cancel Edit\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"w-full px-6 py-8\">\r\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-8\">\r\n            {/* Form Header */}\r\n            <div className=\"mb-8\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Update Complain Details</h2>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Modify your complain information. Note that editing is not allowed for resolved complains.\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"space-y-6\">\r\n              {/* Title Field */}\r\n              <FormField\r\n                label=\"Complain Title\"\r\n                name=\"title\"\r\n                value={formData.title}\r\n                onChange={(e) => handleInputChange('title', e.target.value)}\r\n                error={errors.title}\r\n                placeholder=\"e.g., Room WiFi not working, Broken window glass, Food quality issue...\"\r\n                required\r\n              />\r\n              <div className=\"mt-1 text-xs text-gray-500 text-right\">\r\n                {formData.title.length}/255 characters\r\n              </div>\r\n\r\n              {/* Description Field */}\r\n              <FormField\r\n                label=\"Description\"\r\n                name=\"description\"\r\n                value={formData.description}\r\n                onChange={(e) => handleInputChange('description', e.target.value)}\r\n                error={errors.description}\r\n                type=\"textarea\"\r\n                rows={6}\r\n                placeholder=\"Please describe your issue in detail...\"\r\n                required\r\n              />\r\n              <div className=\"mt-1 text-xs text-gray-500 text-right\">\r\n                {formData.description.length}/1000 characters\r\n              </div>\r\n\r\n              {/* Attachment Field */}\r\n              <div className=\"space-y-1.5\">\r\n                <label className=\"block text-sm font-semibold text-gray-900\">\r\n                  Attachment (Optional)\r\n                </label>\r\n                <p className=\"text-sm text-gray-600 mb-3\">\r\n                  Upload an image or document to help illustrate your issue\r\n                </p>\r\n                <SingleImageUploadEdit\r\n                  existingImageUrl={existingAttachment ? getImageUrl(existingAttachment) : null}\r\n                  imagePreview={attachment ? URL.createObjectURL(attachment) : null}\r\n                  onFileSelect={setAttachment}\r\n                  onRemove={() => {\r\n                    setAttachment(null);\r\n                    setExistingAttachment(null);\r\n                  }}\r\n                  onImageClick={(url, alt) => {\r\n                    window.open(url, '_blank');\r\n                  }}\r\n                  label=\"\"\r\n                />\r\n              </div>\r\n\r\n              {/* Status Display */}\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                <div className=\"flex items-center\">\r\n                  <svg className=\"w-5 h-5 text-blue-600 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  <div>\r\n                    <p className=\"text-sm font-medium text-blue-800\">\r\n                      Current Status: {getStatusBadge(complain.status)}\r\n                    </p>\r\n                    <p className=\"text-xs text-blue-700\">\r\n                      Status is managed by admin team and cannot be changed by students.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"flex justify-end space-x-4\">\r\n            <Button\r\n              type=\"button\"\r\n              onClick={() => router.push(`/student/complain/${complainId}`)}\r\n              variant=\"secondary\"\r\n              disabled={isSubmitting}\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              loading={isSubmitting}\r\n              disabled={isSubmitting}\r\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            >\r\n              {isSubmitting ? 'Updating...' : 'Update Complain'}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n\r\n        {/* Status Info */}\r\n        <div className=\"mt-8 bg-amber-50 border border-amber-200 rounded-lg p-6\">\r\n          <h3 className=\"text-sm font-semibold text-amber-900 mb-3\"> Edit Guidelines</h3>\r\n          <ul className=\"text-sm text-amber-800 space-y-2\">\r\n            <li className=\"flex items-start\">\r\n              <span className=\"w-1.5 h-1.5 bg-amber-600 rounded-full mt-2 mr-3 flex-shrink-0\"></span>\r\n              <span>You can edit complains that are in 'pending' or 'in progress' status</span>\r\n            </li>\r\n            <li className=\"flex items-start\">\r\n              <span className=\"w-1.5 h-1.5 bg-amber-600 rounded-full mt-2 mr-3 flex-shrink-0\"></span>\r\n              <span>Resolved complains cannot be edited - create a new one if needed</span>\r\n            </li>\r\n            <li className=\"flex items-start\">\r\n              <span className=\"w-1.5 h-1.5 bg-amber-600 rounded-full mt-2 mr-3 flex-shrink-0\"></span>\r\n              <span>Admins will be notified of your updates through the chat system</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\complain\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":13,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[659,662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[659,662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getStatusDescription' is assigned a value but never used.","line":78,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":78,"endColumn":29},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":333,"column":19,"nodeType":"JSXOpeningElement","endLine":354,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { useAuth } from '@/lib/auth';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { Button, TableSkeleton } from '@/components/ui';\r\nimport ChatInterface from '@/components/ui/ChatInterface';\r\nimport { getImageUrl } from '@/lib/utils';\r\n\r\nexport default function StudentComplainDetail() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const { user } = useAuth();\r\n  const complainId = params.id as string;\r\n\r\n  const [complain, setComplain] = useState<any | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showImageModal, setShowImageModal] = useState(false);\r\n\r\n  // Fetch complain data\r\n  useEffect(() => {\r\n    const fetchComplain = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        const complainData = await studentApi.getStudentComplaint(complainId);\r\n        setComplain(complainData);\r\n        \r\n      } catch (error) {\r\n        console.error('Error fetching complain:', error);\r\n        if (error instanceof ApiError) {\r\n          if (error.status === 404) {\r\n            setError(`Complain with ID ${complainId} not found. It may have been deleted or the ID is incorrect.`);\r\n          } else {\r\n            setError(`Failed to load complain: ${error.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load complain data. Please try again.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (complainId) {\r\n      fetchComplain();\r\n    }\r\n  }, [complainId]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusColors = {\r\n      pending: 'bg-amber-100 text-amber-800 border-amber-200',\r\n      in_progress: 'bg-blue-100 text-blue-800 border-blue-200',\r\n      resolved: 'bg-green-100 text-green-800 border-green-200'\r\n    };\r\n    \r\n    return (\r\n      <span className={`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium border ${statusColors[status as keyof typeof statusColors] || 'bg-gray-100 text-gray-800 border-gray-200'}`}>\r\n        {status.replace('_', ' ')}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const getStatusDescription = (status: string) => {\r\n    const descriptions = {\r\n      pending: 'Your complain has been submitted and is waiting for admin review.',\r\n      in_progress: 'Admin is actively working on resolving your issue.',\r\n      resolved: 'Your issue has been resolved by the admin team.'\r\n    };\r\n    \r\n    return descriptions[status as keyof typeof descriptions] || 'Status unknown';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Complain Details</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading complain details...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <div className=\"mt-3\">\r\n            <Button\r\n              onClick={() => window.location.reload()}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Retry\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!complain) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-500\">Complain not found</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200 shadow-sm\">\r\n        <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n          <div className=\"flex items-center\">\r\n            <div>\r\n              <h1 className=\"text-xl font-bold text-gray-900\">{complain.title}</h1>\r\n              <div className=\"flex items-center gap-4 mt-2\">\r\n                {getStatusBadge(complain.status)}\r\n                <span className=\"text-sm text-gray-500\"></span>\r\n                <span className=\"text-sm text-gray-600\">{formatDate(complain.created_at)}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n        <div className=\"grid grid-cols-1 xl:grid-cols-5 gap-4\">\r\n          {/* Left Sidebar - Complain Details */}\r\n          <div className=\"xl:col-span-3\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200\" style={{height: '550px'}}>\r\n              {/* Info Section */}\r\n              <div className=\"p-5 h-full overflow-y-auto\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900\">Complain Details</h3>\r\n                </div>\r\n                \r\n                <div className=\"space-y-6\">\r\n                  <div>\r\n                    <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z\" />\r\n                      </svg>\r\n                      Title\r\n                    </label>\r\n                    <p className=\"text-base text-gray-900 leading-relaxed font-medium bg-gray-50 p-3 rounded-lg border-l-4 border-blue-500\">{complain.title}</p>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                      </svg>\r\n                      Description\r\n                    </label>\r\n                    <div className=\"bg-gray-50 p-3 rounded-lg border-l-4 border-green-500\">\r\n                      <p className=\"text-sm text-gray-800 leading-relaxed whitespace-pre-wrap\">{complain.description}</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Attachment */}\r\n                  {complain.complain_attachment && (\r\n                    <div>\r\n                      <label className=\"text-xs font-bold text-gray-700 uppercase tracking-wider mb-2 block flex items-center\">\r\n                        <svg className=\"w-3 h-3 mr-2 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\r\n                        </svg>\r\n                        Attachment\r\n                      </label>\r\n                      <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-3 hover:bg-gray-100 transition-colors\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div className=\"flex items-center space-x-3\">\r\n                            <div className=\"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center\">\r\n                              {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? (\r\n                                <svg className=\"w-5 h-5 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                                </svg>\r\n                              ) : (\r\n                                <svg className=\"w-5 h-5 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                                </svg>\r\n                              )}\r\n                            </div>\r\n                            <div>\r\n                              <p className=\"text-sm font-medium text-gray-900\">\r\n                                {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? 'Image File' : 'Document File'}\r\n                              </p>\r\n                              <p className=\"text-xs text-gray-500\">Click to view attachment</p>\r\n                            </div>\r\n                          </div>\r\n                          <Button\r\n                            onClick={() => setShowImageModal(true)}\r\n                            variant=\"secondary\"\r\n                            size=\"sm\"\r\n                            icon={\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                              </svg>\r\n                            }\r\n                          >\r\n                            View\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Metadata */}\r\n                  <div className=\"pt-4 border-t border-gray-200\">\r\n                    <h4 className=\"text-xs font-bold text-gray-700 mb-3 flex items-center\">\r\n                      <svg className=\"w-3 h-3 mr-2 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      Information\r\n                    </h4>\r\n                    <div className=\"grid grid-cols-2 gap-3 text-xs\">\r\n                      <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                        <span className=\"text-gray-700 font-medium block text-xs mb-1\">Created</span>\r\n                        <span className=\"text-gray-900 font-semibold text-xs\">{formatDate(complain.created_at)}</span>\r\n                      </div>\r\n                      {complain.updated_at && (\r\n                        <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                          <span className=\"text-gray-700 font-medium block text-xs mb-1\">Updated</span>\r\n                          <span className=\"text-gray-900 font-semibold text-xs\">{formatDate(complain.updated_at)}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right Main Area - Chat Interface */}\r\n          <div className=\"xl:col-span-2\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden\" style={{height: '550px'}}>\r\n              <div className=\"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl flex-shrink-0\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <h3 className=\"text-base font-semibold text-gray-900\">Chat Messages</h3>\r\n                    <p className=\"text-xs text-gray-600 mt-1\">Communicate directly with the administration about this complaint</p>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\r\n                    <span className=\"text-xs font-medium text-green-600\">Online</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1 min-h-0 overflow-hidden\">\r\n                <ChatInterface\r\n                  complainId={parseInt(complainId)}\r\n                  currentUserId={user?.id || 0}\r\n                  currentUserType=\"student\"\r\n                  currentUserName={user?.name || 'Student'}\r\n                  className=\"h-full\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Attachment Modal */}\r\n      {complain?.complain_attachment && showImageModal && (\r\n        <div \r\n          className=\"fixed inset-0 bg-black/75 flex items-center justify-center p-4 z-50\"\r\n          onClick={() => setShowImageModal(false)}\r\n        >\r\n          <div className=\"relative max-w-4xl max-h-full bg-white rounded-xl overflow-hidden shadow-2xl\" onClick={(e) => e.stopPropagation()}>\r\n            {/* Modal Header */}\r\n            <div className=\"px-6 py-4 border-b border-gray-200 bg-gray-50\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? (\r\n                    <svg className=\"w-5 h-5 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                    </svg>\r\n                  ) : (\r\n                    <svg className=\"w-5 h-5 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                    </svg>\r\n                  )}\r\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                    {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? 'Image Attachment' : 'Document Attachment'}\r\n                  </h3>\r\n                </div>\r\n                <Button\r\n                  onClick={() => setShowImageModal(false)}\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  icon={\r\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                    </svg>\r\n                  }\r\n                >\r\n                  Close\r\n                </Button>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Modal Content */}\r\n            <div className=\"max-h-[70vh] overflow-auto\">\r\n              {complain.complain_attachment.match(/\\.(jpg|jpeg|png|gif)$/i) ? (\r\n                <div className=\"p-6 flex justify-center\">\r\n                  <img\r\n                    src={getImageUrl(complain.complain_attachment)}\r\n                    alt=\"Complaint Attachment\"\r\n                    className=\"max-w-full max-h-[60vh] object-contain rounded-lg cursor-zoom-in hover:scale-105 transition-transform duration-200\"\r\n                    onClick={(e) => {\r\n                      const img = e.target as HTMLImageElement;\r\n                      if (img.style.transform === 'scale(2)') {\r\n                        img.style.transform = 'scale(1)';\r\n                        img.style.cursor = 'zoom-in';\r\n                        img.parentElement!.style.overflow = 'hidden';\r\n                      } else {\r\n                        img.style.transform = 'scale(2)';\r\n                        img.style.cursor = 'zoom-out';\r\n                        img.parentElement!.style.overflow = 'auto';\r\n                      }\r\n                    }}\r\n                    onError={(e) => {\r\n                      console.error('Image failed to load');\r\n                      const target = e.target as HTMLImageElement;\r\n                      target.style.display = 'none';\r\n                    }}\r\n                  />\r\n                </div>\r\n              ) : (\r\n                <div className=\"p-12 text-center\">\r\n                  <svg className=\"w-16 h-16 mx-auto text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                  </svg>\r\n                  <h4 className=\"text-lg font-medium text-gray-900 mb-2\">Document File</h4>\r\n                  <p className=\"text-gray-600 mb-6\">This file cannot be previewed directly. You can download it to view.</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Modal Actions */}\r\n            <div className=\"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3\">\r\n              <Button\r\n                onClick={() => {\r\n                  const link = document.createElement('a');\r\n                  link.href = getImageUrl(complain.complain_attachment);\r\n                  link.download = 'attachment';\r\n                  document.body.appendChild(link);\r\n                  link.click();\r\n                  document.body.removeChild(link);\r\n                }}\r\n                variant=\"primary\"\r\n                size=\"sm\"\r\n                icon={\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                  </svg>\r\n                }\r\n              >\r\n                Download\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\complain\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SuccessToast' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'alert' is assigned a value but never used.","line":32,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setAlert' is assigned a value but never used.","line":32,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'newComplain' is assigned a value but never used.","line":75,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":24}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  FormField, \r\n  SuccessToast,\r\n  SingleImageUploadCreate,\r\n  SubmitButton,\r\n  CancelButton,\r\n  ImageModal\r\n} from '@/components/ui';\r\n\r\ninterface ComplainFormData {\r\n  title: string;\r\n  description: string;\r\n  complain_attachment?: File;\r\n}\r\n\r\nexport default function CreateComplain() {\r\n  const router = useRouter();\r\n  const [formData, setFormData] = useState<ComplainFormData>({\r\n    title: '',\r\n    description: '',\r\n  });\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n  const [attachment, setAttachment] = useState<File | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.title.trim()) {\r\n      newErrors.title = 'Title is required';\r\n    } else if (formData.title.length > 255) {\r\n      newErrors.title = 'Title must be less than 255 characters';\r\n    }\r\n\r\n    if (!formData.description.trim()) {\r\n      newErrors.description = 'Description is required';\r\n    } else if (formData.description.length > 1000) {\r\n      newErrors.description = 'Description must be less than 1000 characters';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      const submitData = {\r\n        title: formData.title,\r\n        description: formData.description,\r\n        complain_attachment: attachment || undefined\r\n      };\r\n\r\n      const newComplain = await studentApi.createStudentComplaint(submitData);\r\n      \r\n      // Redirect to complains list on success\r\n      router.push('/student/complain');\r\n      \r\n    } catch (error) {\r\n      console.error('Error creating complain:', error);\r\n      \r\n      if (error instanceof ApiError) {\r\n        if (error.validation) {\r\n          const validationErrors: Record<string, string> = {};\r\n          Object.entries(error.validation).forEach(([key, value]) => {\r\n            validationErrors[key] = Array.isArray(value) ? value[0] : value;\r\n          });\r\n          setErrors(validationErrors);\r\n        } else {\r\n          setErrors({\r\n            submit: `Failed to create complaint: ${error.message}`\r\n          });\r\n        }\r\n      } else {\r\n        setErrors({\r\n          submit: 'Failed to create complaint. Please try again.'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const processFile = (file: File) => {\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        complain_attachment: 'Please select a valid file (JPG, PNG, PDF, DOC, DOCX)'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Validate file size (5MB max)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        complain_attachment: 'File size must be less than 5MB'\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setAttachment(file);\r\n\r\n    // Create preview for images\r\n    if (file.type.startsWith('image/')) {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        setImagePreview(e.target?.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    } else {\r\n      setImagePreview(null);\r\n    }\r\n\r\n    // Clear file error\r\n    if (errors.complain_attachment) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        complain_attachment: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const removeAttachment = () => {\r\n    setAttachment(null);\r\n    setImagePreview(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        <h1 className=\"text-2xl font-semibold mb-6\">Create New Complain</h1>\r\n\r\n        {/* Alert for success or error messages */}\r\n\r\n        {/* Modern Form Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          <form onSubmit={handleSubmit} className=\"p-4\">\r\n            {/* Submit Error */}\r\n            {errors.submit && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                <p className=\"text-red-700 text-sm\">{errors.submit}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"space-y-4\">\r\n              {/* Form Grid */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Complaint Title */}\r\n                <FormField\r\n                  name=\"title\"\r\n                  label=\"Complaint Title\"\r\n                  required\r\n                  value={formData.title}\r\n                  onChange={handleInputChange}\r\n                  error={errors.title}\r\n                  placeholder=\"Brief summary of your complaint\"\r\n                />\r\n\r\n                {/* Empty column for spacing consistency */}\r\n                <div></div>\r\n              </div>\r\n\r\n              {/* Complaint Description - Full Width */}\r\n              <FormField\r\n                name=\"description\"\r\n                label=\"Detailed Description\"\r\n                required\r\n                value={formData.description}\r\n                onChange={handleInputChange}\r\n                error={errors.description}\r\n                placeholder=\"Provide detailed information about your complaint, including when it occurred, what happened, and any relevant context...\"\r\n                type=\"textarea\"\r\n                rows={6}\r\n              />\r\n\r\n              {/* Attachment Upload Component */}\r\n              <div>\r\n                <SingleImageUploadCreate\r\n                  imagePreview={imagePreview}\r\n                  onFileSelect={processFile}\r\n                  onRemove={removeAttachment}\r\n                  error={errors.complain_attachment}\r\n                  label=\"Supporting Document (Optional)\"\r\n                  onImageClick={(imageUrl, alt) => {\r\n                    setSelectedImage({ url: imageUrl, alt });\r\n                    setImageModalOpen(true);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Actions */}\r\n            <div className=\"flex justify-between items-center pt-4 mt-4 border-t border-gray-200\">\r\n              <CancelButton onClick={() => router.push('/student/complain')} />\r\n              <SubmitButton \r\n                loading={isSubmitting} \r\n                loadingText=\"Creating...\"\r\n              >\r\n                Create Complaint\r\n              </SubmitButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\complain\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[458,461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[458,461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[532,535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[532,535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCurrentPage' is assigned a value but never used.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalPages' is assigned a value but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  SuccessToast, \r\n  TableSkeleton,\r\n  ActionButtons\r\n} from '@/components/ui';\r\n\r\nexport default function StudentComplainList() {\r\n  const router = useRouter();\r\n  const [complains, setComplains] = useState<any[]>([]);\r\n  const [filteredComplains, setFilteredComplains] = useState<any[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [alert, setAlert] = useState<{show: boolean, message: string, type: 'success' | 'error'}>({\r\n    show: false,\r\n    message: '',\r\n    type: 'success'\r\n  });\r\n\r\n  // Fetch student's complains from API\r\n  useEffect(() => {\r\n    const fetchComplains = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        // Use student-specific endpoint to get only the student's complaints\r\n        const response = await studentApi.getStudentComplains();\r\n        \r\n        // Handle different response structures\r\n        const complainsData = Array.isArray(response) ? response : (response.data || []);\r\n        setComplains(complainsData);\r\n        setFilteredComplains(complainsData);\r\n        setTotalPages(Math.ceil(complainsData.length / 10)); // Assuming 10 per page\r\n      } catch (error) {\r\n        console.error('Error fetching complains:', error);\r\n        if (error instanceof ApiError) {\r\n          setError(`Failed to fetch your complains: ${error.message}`);\r\n        } else {\r\n          setError('Failed to fetch your complains. Please check your connection.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchComplains();\r\n  }, [currentPage]);\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredComplains(complains);\r\n    } else {\r\n      const filtered = complains.filter(complain =>\r\n        complain.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        complain.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        complain.status.toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n      setFilteredComplains(filtered);\r\n    }\r\n  }, [searchQuery, complains]);\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusColors = {\r\n      pending: 'bg-amber-100 text-amber-800',\r\n      in_progress: 'bg-blue-100 text-blue-800',\r\n      resolved: 'bg-green-100 text-green-800'\r\n    };\r\n    \r\n    return (\r\n      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColors[status as keyof typeof statusColors] || 'bg-gray-100 text-gray-800'}`}>\r\n        {status.replace('_', ' ')}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">My Complains</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading your complains...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 w-full\">\r\n      {/* Alert Notification */}\r\n      {alert.type === 'success' && alert.show && (\r\n        <SuccessToast\r\n          show={alert.show}\r\n          message={alert.message}\r\n          progress={100}\r\n          onClose={() => setAlert({show: false, message: '', type: 'success'})}\r\n        />\r\n      )}\r\n      {alert.type === 'error' && alert.show && (\r\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full bg-red-100 border-red-500 text-red-700 border-l-4 p-4 rounded-lg shadow-lg\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm font-medium\">{alert.message}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <div className=\"-mx-1.5 -my-1.5\">\r\n                <button\r\n                  onClick={() => setAlert({show: false, message: '', type: 'success'})}\r\n                  className=\"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\"\r\n                >\r\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">My Complains</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{complains.length} total complains</p>\r\n        </div>\r\n        <Button\r\n          onClick={() => router.push('/student/complain/create')}\r\n          className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n        >\r\n          Create New Complain\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search your complains...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Complains List */}\r\n      {filteredComplains.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No complains found' : 'No complains yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : \"You haven't submitted any complaints yet\"}\r\n          </p>\r\n          {!searchQuery && (\r\n            <Button\r\n              onClick={() => router.push('/student/complain/create')}\r\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            >\r\n              Create Your First Complain\r\n            </Button>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Complain Title</div>\r\n              <div className=\"col-span-4\">Description</div>\r\n              <div className=\"col-span-2\">Status</div>\r\n              <div className=\"col-span-2\">Date</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredComplains.map((complain) => (\r\n              <div key={complain.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-12 gap-2 items-center\">\r\n                  {/* Complain Title */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">\r\n                      {complain.title.length > 40 ? `${complain.title.substring(0, 40)}...` : complain.title}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  <div className=\"col-span-4\">\r\n                    <div className=\"text-xs text-gray-600 line-clamp-2\">\r\n                      {complain.description.length > 15 \r\n                        ? `${complain.description.substring(0, 15)}...` \r\n                        : complain.description}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"col-span-2\">\r\n                    {getStatusBadge(complain.status)}\r\n                  </div>\r\n\r\n                  {/* Date */}\r\n                  <div className=\"col-span-2\">\r\n                    <div className=\"text-xs text-gray-500\">\r\n                      {formatDate(complain.created_at)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <ActionButtons \r\n                      viewUrl={`/student/complain/${complain.id}`}\r\n                      hideEdit={true}\r\n                      hideDelete={true}\r\n                      style=\"compact\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Footer */}\r\n      {filteredComplains.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredComplains.length} of {complains.length} complains\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\notice\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ExternalLink' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[742,745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[742,745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getTargetDisplay' is assigned a value but never used.","line":112,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3256,3259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3256,3259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":377,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15661,15664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15661,15664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { Button, ImageModal } from '@/components/ui';\r\nimport { \r\n  ArrowLeft, \r\n  Calendar, \r\n  User,\r\n  Clock, \r\n  File,\r\n  AlertCircle,\r\n  Check,\r\n  X,\r\n  ExternalLink,\r\n  Download,\r\n  Eye\r\n} from 'lucide-react';\r\nimport { formatDate, getImageUrl } from '@/lib/utils';\r\n\r\nexport default function StudentNoticeDetail() {\r\n  const router = useRouter();\r\n  const { id } = useParams();\r\n  const noticeId = Array.isArray(id) ? id[0] : id || '';\r\n  \r\n  const [notice, setNotice] = useState<any | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [imageModalOpen, setImageModalOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState({ url: '', alt: '' });\r\n\r\n  \r\n  // Fetch notice data\r\n  useEffect(() => {\r\n    if (!noticeId) {\r\n      setError('Notice ID is missing');\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    \r\n    const fetchNotice = async () => {\r\n      try {\r\n        const data = await studentApi.getStudentNotice(noticeId);\r\n        setNotice(data);\r\n      } catch (err) {\r\n        if (err instanceof ApiError) {\r\n          if (err.status === 403) {\r\n            setError('This notice is no longer active and cannot be viewed.');\r\n          } else if (err.status === 404) {\r\n            setError('Notice not found or you do not have permission to view it.');\r\n          } else {\r\n            setError(`Failed to load notice: ${err.message}`);\r\n          }\r\n        } else {\r\n          setError('Failed to load notice details');\r\n        }\r\n        console.error('Error fetching notice:', err);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchNotice();\r\n  }, [noticeId]);\r\n\r\n  const handleAttachmentClick = (url: string, name: string) => {\r\n    // For all file types, show in the modal\r\n    setSelectedImage({ url: getImageUrl(url), alt: name });\r\n    setImageModalOpen(true);\r\n  };\r\n\r\n  // Function to get file type icon\r\n  const getFileIcon = (fileName: string) => {\r\n    const extension = fileName.split('.').pop()?.toLowerCase();\r\n    \r\n    switch(extension) {\r\n      case 'pdf':\r\n        return (\r\n          <div className=\"bg-red-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-red-600\" />\r\n          </div>\r\n        );\r\n      case 'doc':\r\n      case 'docx':\r\n        return (\r\n          <div className=\"bg-blue-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-blue-600\" />\r\n          </div>\r\n        );\r\n      case 'jpg':\r\n      case 'jpeg':\r\n      case 'png':\r\n      case 'gif':\r\n        return (\r\n          <div className=\"bg-green-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-green-600\" />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div className=\"bg-gray-100 rounded p-1\">\r\n            <File className=\"h-4 w-4 text-gray-600\" />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  // Function to get target audience display text\r\n  const getTargetDisplay = (notice: any): string => {\r\n    if (notice.target_info) {\r\n      switch (notice.target_info.type) {\r\n        case 'specific_student':\r\n          return `Specific Student: ${notice.target_info.name}`;\r\n        case 'specific_staff':\r\n          return `Specific Staff: ${notice.target_info.name}`;\r\n        case 'block':\r\n          return `Specific Block: ${notice.target_info.name}`;\r\n        default:\r\n          return notice.target_info.name || notice.target_info.type;\r\n      }\r\n    }\r\n    \r\n    switch (notice.target_type) {\r\n      case 'all':\r\n        return 'Everyone';\r\n      case 'student':\r\n        return 'All Students';\r\n      case 'staff':\r\n        return 'All Staff';\r\n      case 'specific_student':\r\n        return notice.student ? `Specific Student: ${notice.student.name}` : 'Specific Student';\r\n      case 'specific_staff':\r\n        return notice.staff ? `Specific Staff: ${notice.staff.name}` : 'Specific Staff';\r\n      case 'block':\r\n        return notice.block ? `Specific Block: ${notice.block.name}` : 'Specific Block';\r\n      default:\r\n        return notice.target_type;\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 p-4 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading notice details...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !notice) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 p-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          {/* Header with back button */}\r\n          <div className=\"mb-6\">\r\n            <Link \r\n              href=\"/student/notice\" \r\n              className=\"inline-flex items-center text-sm text-gray-500 hover:text-gray-700 mb-4\"\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4 mr-1\" />\r\n              Back to Notices\r\n            </Link>\r\n          </div>\r\n          \r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\r\n            <div className=\"flex items-center text-red-700 mb-4\">\r\n              <AlertCircle className=\"w-6 h-6 mr-2\" />\r\n              <h2 className=\"text-lg font-semibold\">Unable to Load Notice</h2>\r\n            </div>\r\n            <p className=\"text-red-600 mb-4\">{error || 'Notice not found'}</p>\r\n            <div className=\"flex gap-3\">\r\n              <Button \r\n                onClick={() => router.push('/student/notice')}\r\n                variant=\"secondary\"\r\n                size=\"sm\"\r\n              >\r\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                Back to Notice List\r\n              </Button>\r\n              <Button \r\n                onClick={() => window.location.reload()}\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n              >\r\n                Try Again\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 px-2 py-4\">\r\n      <div className=\"max-w-5xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Notice Details</h1>\r\n            <p className=\"text-sm text-gray-500\">View notice information and attachments</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Notice Card */}\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n          {/* Notice Header */}\r\n          <div className=\"bg-gray-50 border-b border-gray-200 px-6 py-4\">\r\n            <div className=\"flex justify-between items-start\">\r\n              <h2 className=\"text-xl font-medium text-gray-900\">{notice.title}</h2>\r\n              <div className=\"flex items-center\">\r\n                {notice.status === 'active' ? (\r\n                  <div className=\"bg-green-100 text-green-700 px-3 py-1 rounded-full flex items-center text-sm font-medium\">\r\n                    <Check className=\"h-3.5 w-3.5 mr-1\" />\r\n                    Active\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"bg-gray-100 text-gray-700 px-3 py-1 rounded-full flex items-center text-sm font-medium\">\r\n                    <X className=\"h-3.5 w-3.5 mr-1\" />\r\n                    Inactive\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Notice Content */}\r\n          <div className=\"p-6\">\r\n            {/* Notice Metadata */}\r\n            <div className=\"grid grid-cols-1 gap-4 mb-6 text-sm\">\r\n              <div className=\"flex items-center text-gray-600\">\r\n                <Clock className=\"h-4 w-4 mr-2 text-gray-500\" />\r\n                <span className=\"font-medium mr-2\">Date & Time:</span>\r\n                {new Date(notice.created_at).toLocaleDateString(\"en-US\", {\r\n                  year: \"numeric\",\r\n                  month: \"long\",\r\n                  day: \"numeric\",\r\n                })} at {new Date(notice.created_at).toLocaleTimeString(\"en-US\", {\r\n                  hour: \"2-digit\",\r\n                  minute: \"2-digit\",\r\n                  hour12: true\r\n                })}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Target Details - Show only for specific targets */}\r\n            {(notice.target_type === 'specific_student' || \r\n              notice.target_type === 'specific_staff' || \r\n              notice.target_type === 'block') && (\r\n              <div className=\"mb-6 border-t border-gray-100 pt-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-2\">\r\n                  {notice.target_type === 'specific_student' ? 'Student' : \r\n                   notice.target_type === 'specific_staff' ? 'Staff' : 'Block'} Information\r\n                </h3>\r\n                <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-100\">\r\n                  {notice.target_info ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.target_info.name}</span>\r\n                      </div>\r\n                      {notice.target_info.identifier && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">\r\n                            {notice.target_info.type === 'specific_student' ? 'Student ID:' : 'ID:'}\r\n                          </span>\r\n                          <span>{notice.target_info.identifier}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.contact && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Contact:</span>\r\n                          <span>{notice.target_info.contact}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.location && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Location:</span>\r\n                          <span>{notice.target_info.location}</span>\r\n                        </div>\r\n                      )}\r\n                      {notice.target_info.rooms_count !== undefined && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Rooms:</span>\r\n                          <span>{notice.target_info.rooms_count}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : notice.student && notice.target_type === 'specific_student' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.student.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Student ID:</span>\r\n                        <span>{notice.student.student_id}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.student.contact}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Email:</span>\r\n                        <span>{notice.student.email}</span>\r\n                      </div>\r\n                      {notice.student.room && (\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-2\">Room:</span>\r\n                          <span>{notice.student.room.room_number}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : notice.staff && notice.target_type === 'specific_staff' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.staff.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Staff ID:</span>\r\n                        <span>{notice.staff.staff_id}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.staff.contact}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Email:</span>\r\n                        <span>{notice.staff.email}</span>\r\n                      </div>\r\n                    </div>\r\n                  ) : notice.block && notice.target_type === 'block' ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Name:</span>\r\n                        <span>{notice.block.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Location:</span>\r\n                        <span>{notice.block.location}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Manager:</span>\r\n                        <span>{notice.block.manager_name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center\">\r\n                        <span className=\"font-medium mr-2\">Contact:</span>\r\n                        <span>{notice.block.manager_contact}</span>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-gray-500\">No detailed information available.</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Description */}\r\n            <div className=\"mb-6 border-t border-gray-100 pt-6\">\r\n              <h3 className=\"text-md font-medium text-gray-800 mb-2\">Description</h3>\r\n              <div className=\"text-gray-700 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg border border-gray-100\">\r\n                {notice.description}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Attachments */}\r\n            {notice.attachments && notice.attachments.length > 0 && (\r\n              <div className=\"mb-4 border-t border-gray-100 pt-6\">\r\n                <h3 className=\"text-md font-medium text-gray-800 mb-3\">Attachments</h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                  {notice.attachments.map((attachment: any) => (\r\n                    <div \r\n                      key={attachment.id} \r\n                      className=\"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors\"\r\n                    >\r\n                      {getFileIcon(attachment.name)}\r\n                      <div \r\n                        className=\"ml-3 flex-grow truncate cursor-pointer\"\r\n                        onClick={() => handleAttachmentClick(attachment.path, attachment.name)}\r\n                      >\r\n                        <div className=\"text-sm font-medium text-gray-700 truncate\">{attachment.name}</div>\r\n                        <div className=\"text-xs text-gray-500\">Click to view</div>\r\n                      </div>\r\n                      <div className=\"flex space-x-2 ml-2\">\r\n                        <button \r\n                          className=\"p-1 rounded hover:bg-blue-100 transition-colors\" \r\n                          title=\"View\"\r\n                          onClick={() => handleAttachmentClick(attachment.path, attachment.name)}\r\n                        >\r\n                          <Eye className=\"w-4 h-4 text-blue-500\" />\r\n                        </button>\r\n                        <a \r\n                          href={getImageUrl(attachment.path)} \r\n                          download={attachment.name}\r\n                          className=\"p-1 rounded hover:bg-green-100 transition-colors\" \r\n                          title=\"Download\"\r\n                          onClick={(e) => e.stopPropagation()}\r\n                        >\r\n                          <Download className=\"w-4 h-4 text-green-500\" />\r\n                        </a>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Footer Info */}\r\n            <div className=\"border-t border-gray-100 pt-4 mt-6\">\r\n              <div className=\"flex justify-center items-center text-xs text-gray-500\">\r\n                <div>\r\n                  Last updated: {formatDate(notice.updated_at)}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image/File Modal */}\r\n      <ImageModal\r\n        show={imageModalOpen}\r\n        onClose={() => setImageModalOpen(false)}\r\n        imageUrl={selectedImage.url}\r\n        alt={selectedImage.alt}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\notice\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ApiError' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertCircle' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Home' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":27,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getTargetDisplay' is assigned a value but never used.","line":88,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":25}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { Notice } from '@/lib/api/notice.api';\r\nimport { ApiError } from '@/lib/api/core';\r\nimport { \r\n  Button, \r\n  SearchBar, \r\n  TableSkeleton,\r\n  ActionButtons \r\n} from '@/components/ui';\r\nimport { \r\n  AlertCircle, \r\n  Calendar, \r\n  Eye,\r\n  Clock,\r\n  User,\r\n  Home,\r\n  Settings,\r\n  Check,\r\n  X\r\n} from 'lucide-react';\r\n\r\nexport default function StudentNoticeList() {\r\n  const router = useRouter();\r\n  const [notices, setNotices] = useState<Notice[]>([]);\r\n  const [filteredNotices, setFilteredNotices] = useState<Notice[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [totalNotices, setTotalNotices] = useState(0);\r\n\r\n  useEffect(() => {\r\n    fetchNotices();\r\n  }, []);\r\n\r\n  const fetchNotices = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      // Use direct API call for student notices\r\n      const response = await studentApi.getStudentNotices();\r\n      \r\n      // Handle the backend response format: {data: [...], total: count}\r\n      let noticesData: Notice[] = [];\r\n      \r\n      if (response) {\r\n        if (Array.isArray(response)) {\r\n          // If response is directly an array\r\n          noticesData = response;\r\n        } else if (response.data && Array.isArray(response.data)) {\r\n          // If response has data property with array\r\n          noticesData = response.data;\r\n        } else if (typeof response === 'object' && response.data) {\r\n          // Handle case where data might not be an array\r\n          noticesData = Array.isArray(response.data) ? response.data : [response.data];\r\n        }\r\n      }\r\n      \r\n      setNotices(noticesData);\r\n      setFilteredNotices(noticesData);\r\n      setTotalNotices(noticesData.length);\r\n    } catch (err) {\r\n      console.error('Error fetching notices:', err);\r\n      setError('Failed to load notices. Please try again.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle search\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredNotices(notices);\r\n    } else {\r\n      const filtered = notices.filter(notice =>\r\n        notice.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (notice.description && notice.description.toLowerCase().includes(searchQuery.toLowerCase()))\r\n      );\r\n      setFilteredNotices(filtered);\r\n    }\r\n  }, [searchQuery, notices]);\r\n\r\n  // Function to get target audience display text\r\n  const getTargetDisplay = (notice: Notice): string => {\r\n    if (notice.target_info) {\r\n      return notice.target_info.name;\r\n    }\r\n    \r\n    switch (notice.target_type) {\r\n      case 'all':\r\n        return 'Everyone';\r\n      case 'student':\r\n        return 'All Students';\r\n      case 'staff':\r\n        return 'All Staff';\r\n      case 'specific_student':\r\n        return notice.student ? notice.student.name : 'Specific Student';\r\n      case 'specific_staff':\r\n        return notice.staff ? notice.staff.name : 'Specific Staff';\r\n      case 'block':\r\n        return notice.block ? notice.block.name : 'Specific Block';\r\n      default:\r\n        return 'Everyone';\r\n    }\r\n  };\r\n\r\n  // Function to get the sent time display\r\n  const getSentTimeDisplay = (notice: Notice) => {\r\n    const dateObj = new Date(notice.created_at);\r\n    \r\n    // Format date and time separately\r\n    const dateStr = dateObj.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric'\r\n    });\r\n    \r\n    const timeStr = dateObj.toLocaleTimeString('en-US', {\r\n      hour: 'numeric',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n    \r\n    return (\r\n      <div className=\"flex flex-col\">\r\n        <span className=\"text-sm text-gray-900\">{dateStr}</span>\r\n        <span className=\"text-sm text-gray-500\">{timeStr}</span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Determine status badge based on notice status (matching admin page)\r\n  const renderStatusBadge = (status: string) => {\r\n    if (status === 'active') {\r\n      return (\r\n        <div className=\"inline-flex items-center bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full\">\r\n          <Check className=\"w-3 h-3 mr-1\" />\r\n          Active\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"inline-flex items-center bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full\">\r\n          <X className=\"w-3 h-3 mr-1\" />\r\n          Inactive\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Student Notices</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading notices...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-red-400 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Minimal Header */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Student Notices</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">{totalNotices} total notices</p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Compact Search */}\r\n      <div className=\"mb-4\">\r\n        <SearchBar\r\n          value={searchQuery}\r\n          onChange={setSearchQuery}\r\n          placeholder=\"Search notices...\"\r\n        />\r\n      </div>\r\n\r\n      {/* Clean List View */}\r\n      {filteredNotices.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white rounded-lg border border-gray-100\">\r\n          <div className=\"text-gray-300 mb-3\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n            </svg>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">\r\n            {searchQuery ? 'No notices found' : 'No notices yet'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            {searchQuery ? 'Try a different search term' : 'No notices have been posted yet'}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n          {/* Table Header */}\r\n          <div className=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\r\n            <div className=\"grid grid-cols-10 gap-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n              <div className=\"col-span-3\">Title</div>\r\n              <div className=\"col-span-3\">Description</div>\r\n              <div className=\"col-span-2\">Posted Date</div>\r\n              <div className=\"col-span-1 text-center\">Status</div>\r\n              <div className=\"col-span-1 text-center\">Actions</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* List Items */}\r\n          <div className=\"divide-y divide-gray-100\">\r\n            {filteredNotices.map((notice) => (\r\n              <div key={notice.id} className=\"px-6 py-4 hover:bg-gray-50 transition-colors\">\r\n                <div className=\"grid grid-cols-10 gap-2 items-center\">\r\n                  {/* Notice Title */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"font-medium text-sm text-gray-900\">{notice.title}</div>\r\n                    <div className=\"text-xs text-gray-500 mt-1\">\r\n                      {notice.notice_type && (\r\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800\">\r\n                          {notice.notice_type.charAt(0).toUpperCase() + notice.notice_type.slice(1)}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  <div className=\"col-span-3\">\r\n                    <div className=\"text-sm text-gray-600 truncate\">\r\n                      {notice.description \r\n                        ? notice.description.length > 15 \r\n                          ? `${notice.description.substring(0, 15)}...` \r\n                          : notice.description\r\n                        : 'No description'\r\n                      }\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Posted Date */}\r\n                  <div className=\"col-span-2\">\r\n                    {getSentTimeDisplay(notice)}\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex justify-center\">\r\n                      {renderStatusBadge(notice.status || 'active')}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"col-span-1\">\r\n                    <div className=\"flex justify-center\">\r\n                      <ActionButtons \r\n                        viewUrl={`/student/notice/${notice.id}`}\r\n                        hideEdit={true}\r\n                        hideDelete={true}\r\n                        style=\"compact\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Minimal Footer */}\r\n      {filteredNotices.length > 0 && (\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            {filteredNotices.length} of {totalNotices} notices\r\n            {searchQuery && ` matching \"${searchQuery}\"`}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'studentCheckInCheckOutApi' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'studentId' is assigned a value but never used.","line":52,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchDashboardData'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchDashboardData]","fix":{"range":[1570,1572],"text":"[fetchDashboardData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1792,1795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1792,1795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1807,1810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1807,1810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'noticesData' is assigned a value but never used.","line":83,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'today' is assigned a value but never used.","line":94,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3854,3857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3854,3857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3986,3989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3986,3989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4247,4250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4247,4250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4517,4520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4517,4520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5536,5539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5536,5539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6639,6642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6639,6642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7118,7121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7118,7121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":339,"column":54,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[13796,13843],"text":"Here&apos;s your hostel status and recent activities"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[13796,13843],"text":"Here&lsquo;s your hostel status and recent activities"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[13796,13843],"text":"Here&#39;s your hostel status and recent activities"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[13796,13843],"text":"Here&rsquo;s your hostel status and recent activities"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { studentCheckInCheckOutApi } from '@/lib/api/student-checkincheckout.api';\r\nimport { studentApi } from '@/lib/api/student.api';\r\n\r\ninterface StudentDashboardStats {\r\n  currentStatus: 'checked-in' | 'checked-out' | 'pending';\r\n  roomNumber: string;\r\n  bedNumber: string;\r\n  lastCheckIn: string;\r\n  lastCheckOut: string;\r\n  myComplaints: number;\r\n  pendingComplaints: number;\r\n  resolvedComplaints: number;\r\n  thisMonthPayments: number;\r\n  outstandingDues: number;\r\n  lastPaymentDate: string;\r\n  lastPaymentAmount: number;\r\n  recentActivities: Array<{\r\n    type: 'payment' | 'complaint' | 'checkout' | 'checkin';\r\n    message: string;\r\n    time: string;\r\n    status?: string;\r\n  }>;\r\n  upcomingPayments: Array<{\r\n    type: string;\r\n    amount: number;\r\n    dueDate: string;\r\n  }>;\r\n}\r\n\r\nexport default function StudentDashboardPage() {\r\n  const [stats, setStats] = useState<StudentDashboardStats>({\r\n    currentStatus: 'checked-out',\r\n    roomNumber: '',\r\n    bedNumber: '',\r\n    lastCheckIn: '',\r\n    lastCheckOut: '',\r\n    myComplaints: 0,\r\n    pendingComplaints: 0,\r\n    resolvedComplaints: 0,\r\n    thisMonthPayments: 0,\r\n    outstandingDues: 0,\r\n    lastPaymentDate: '',\r\n    lastPaymentAmount: 0,\r\n    recentActivities: [],\r\n    upcomingPayments: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [studentId] = useState('1'); // This should come from auth context\r\n\r\n  useEffect(() => {\r\n    fetchDashboardData();\r\n  }, []);\r\n\r\n  const fetchDashboardData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Fetch student-specific data with optimized timeouts (2 seconds each)\r\n      const fetchWithTimeout = async (apiCall: any, fallback: any) => {\r\n        try {\r\n          return await Promise.race([\r\n            apiCall(),\r\n            new Promise((_, reject) => \r\n              setTimeout(() => reject(new Error('Timeout after 2 seconds')), 2000)\r\n            )\r\n          ]);\r\n        } catch (error) {\r\n          console.warn('API call failed, using fallback:', error);\r\n          return fallback;\r\n        }\r\n      };\r\n      \r\n      // Fetch student-specific data using optimized API calls\r\n      const [\r\n        profileData,\r\n        checkInOutData,\r\n        complaintsData,\r\n        paymentsData,\r\n        noticesData,\r\n        outstandingDuesData\r\n      ] = await Promise.all([\r\n        fetchWithTimeout(() => studentApi.getStudentProfile(), null),\r\n        fetchWithTimeout(() => studentApi.getStudentCheckInOuts(), { data: [] }),\r\n        fetchWithTimeout(() => studentApi.getStudentComplains(), { data: [], total: 0 }),\r\n        fetchWithTimeout(() => studentApi.getStudentPayments(), { data: [] }),\r\n        fetchWithTimeout(() => studentApi.getStudentNotices(), { data: [] }),\r\n        fetchWithTimeout(() => studentApi.getStudentOutstandingDues(), { outstanding_dues: 0 })\r\n      ]);\r\n\r\n      const today = new Date().toISOString().split('T')[0];\r\n      const currentMonth = new Date().getMonth();\r\n      const currentYear = new Date().getFullYear();\r\n\r\n      // Calculate current status from check-in/out data\r\n      const myCheckIns = checkInOutData.data || [];\r\n      \r\n      // Get the latest check-in/out record\r\n      const latestRecord = myCheckIns.length > 0 ? myCheckIns[0] : null;\r\n      let currentStatus: 'checked-in' | 'checked-out' | 'pending' = 'checked-out';\r\n      \r\n      if (latestRecord) {\r\n        if (latestRecord.checkout_time) {\r\n          currentStatus = 'checked-out';\r\n        } else if (latestRecord.checkin_time) {\r\n          currentStatus = 'checked-in';\r\n        }\r\n      }\r\n\r\n      // Calculate complaint statistics\r\n      const myComplaints = complaintsData.data || [];\r\n      const pendingComplaints = myComplaints.filter((complaint: any) => \r\n        complaint.status === 'pending'\r\n      ).length;\r\n      const resolvedComplaints = myComplaints.filter((complaint: any) => \r\n        complaint.status === 'resolved'\r\n      ).length;\r\n\r\n      // Calculate payment statistics from student's payment history\r\n      const myPayments = paymentsData.data || [];\r\n      const thisMonthPayments = myPayments\r\n        .filter((payment: any) => {\r\n          const paymentDate = new Date(payment.payment_date || payment.created_at);\r\n          return paymentDate.getMonth() === currentMonth && \r\n                 paymentDate.getFullYear() === currentYear;\r\n        })\r\n        .reduce((sum: number, payment: any) => sum + parseFloat(payment.amount || '0'), 0);\r\n\r\n      // Get latest payment info\r\n      const latestPayment = myPayments.length > 0 ? myPayments[0] : null;\r\n      const lastPaymentDate = latestPayment ? latestPayment.payment_date || latestPayment.created_at : '';\r\n      const lastPaymentAmount = latestPayment ? parseFloat(latestPayment.amount || '0') : 0;\r\n\r\n      // Calculate outstanding dues from API data\r\n      const outstandingDues = outstandingDuesData?.outstanding_dues || 0;\r\n\r\n      // Get room information from profile\r\n      const roomNumber = profileData?.room?.room_name || '';\r\n      const bedNumber = ''; // This would need to come from specific bed assignment logic\r\n\r\n      // Generate recent activities\r\n      const recentActivities: Array<{\r\n        type: 'payment' | 'complaint' | 'checkout' | 'checkin';\r\n        message: string;\r\n        time: string;\r\n        status?: string;\r\n      }> = [];\r\n\r\n      // Add recent check-ins/check-outs\r\n      myCheckIns.slice(0, 2).forEach((checkIn: any) => {\r\n        if (checkIn.checkin_time) {\r\n          const checkInDate = new Date(checkIn.date || checkIn.created_at);\r\n          const timeAgo = formatTimeAgo(checkInDate);\r\n          recentActivities.push({\r\n            type: 'checkin' as const,\r\n            message: `Checked in to Room ${(checkIn.student && checkIn.student.room && checkIn.student.room.room_name) ? checkIn.student.room.room_name : 'N/A'}`,\r\n            time: timeAgo,\r\n            status: checkIn.status,\r\n          });\r\n        }\r\n\r\n        if (checkIn.checkout_time) {\r\n          const checkOutDate = new Date(checkIn.date || checkIn.created_at);\r\n          const timeAgo = formatTimeAgo(checkOutDate);\r\n          recentActivities.push({\r\n            type: 'checkout' as const,\r\n            message: `Checked out from Room ${(checkIn.student && checkIn.student.room && checkIn.student.room.room_name) ? checkIn.student.room.room_name : 'N/A'}`,\r\n            time: timeAgo,\r\n            status: 'completed',\r\n          });\r\n        }\r\n      });\r\n\r\n      // Add recent payments\r\n      myPayments.slice(0, 2).forEach((payment: any) => {\r\n        const paymentDate = new Date(payment.income_date || payment.created_at);\r\n        const timeAgo = formatTimeAgo(paymentDate);\r\n        recentActivities.push({\r\n          type: 'payment' as const,\r\n          message: `Payment of Rs.${parseFloat(payment.amount || '0').toLocaleString()} made`,\r\n          time: timeAgo,\r\n          status: 'completed',\r\n        });\r\n      });\r\n\r\n      // Add recent complaints\r\n      myComplaints.slice(0, 2).forEach((complaint: any) => {\r\n        const complaintDate = new Date(complaint.complaint_date || complaint.created_at);\r\n        const timeAgo = formatTimeAgo(complaintDate);\r\n        recentActivities.push({\r\n          type: 'complaint' as const,\r\n          message: `Complaint: ${complaint.title}`,\r\n          time: timeAgo,\r\n          status: complaint.status,\r\n        });\r\n      });\r\n\r\n      // Sort activities by most recent first\r\n      recentActivities.sort((a, b) => {\r\n        // This is a simple sort, in real app you'd parse the time strings properly\r\n        return a.time.localeCompare(b.time);\r\n      });\r\n\r\n      setStats({\r\n        currentStatus,\r\n        roomNumber: roomNumber || 'Not Assigned',\r\n        bedNumber: bedNumber || 'Not Assigned',\r\n        lastCheckIn: latestRecord?.checkin_time || '',\r\n        lastCheckOut: latestRecord?.checkout_time || '',\r\n        myComplaints: myComplaints.length,\r\n        pendingComplaints,\r\n        resolvedComplaints,\r\n        thisMonthPayments,\r\n        outstandingDues,\r\n        lastPaymentDate,\r\n        lastPaymentAmount,\r\n        recentActivities: recentActivities.slice(0, 5),\r\n        upcomingPayments: [\r\n          { type: 'Monthly Fee', amount: 15000, dueDate: '2025-08-01' },\r\n          { type: 'Room Fee', amount: 5000, dueDate: '2025-08-15' },\r\n        ],\r\n      });\r\n    } catch (error) {\r\n      console.error('Error fetching dashboard data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatTimeAgo = (date: Date): string => {\r\n    const now = new Date();\r\n    const diffInMs = now.getTime() - date.getTime();\r\n    const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\r\n    \r\n    if (diffInDays === 0) return 'Today';\r\n    if (diffInDays === 1) return '1 day ago';\r\n    if (diffInDays < 7) return `${diffInDays} days ago`;\r\n    if (diffInDays < 14) return '1 week ago';\r\n    if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;\r\n    if (diffInDays < 60) return '1 month ago';\r\n    return `${Math.floor(diffInDays / 30)} months ago`;\r\n  };\r\n\r\n  const StatusCard = ({ title, value, subtitle, icon, color = 'blue', action }: {\r\n    title: string;\r\n    value: number | string;\r\n    subtitle?: string;\r\n    icon?: string;\r\n    color?: 'blue' | 'green' | 'red' | 'yellow' | 'purple' | 'indigo';\r\n    action?: { label: string; href: string };\r\n  }) => {\r\n    const colorClasses = {\r\n      blue: { bg: 'bg-blue-50', text: 'text-blue-600', border: 'border-blue-100' },\r\n      green: { bg: 'bg-green-50', text: 'text-green-600', border: 'border-green-100' },\r\n      red: { bg: 'bg-red-50', text: 'text-red-600', border: 'border-red-100' },\r\n      yellow: { bg: 'bg-yellow-50', text: 'text-yellow-600', border: 'border-yellow-100' },\r\n      purple: { bg: 'bg-purple-50', text: 'text-purple-600', border: 'border-purple-100' },\r\n      indigo: { bg: 'bg-indigo-50', text: 'text-indigo-600', border: 'border-indigo-100' },\r\n    };\r\n\r\n    const getIcon = (iconName: string) => {\r\n      const iconMap = {\r\n        'status': (\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n          </svg>\r\n        ),\r\n        'room': (\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\r\n          </svg>\r\n        ),\r\n        'complaint': (\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n          </svg>\r\n        ),\r\n        'payment': (\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\" />\r\n          </svg>\r\n        ),\r\n      };\r\n      return iconMap[iconName as keyof typeof iconMap] || null;\r\n    };\r\n\r\n    return (\r\n      <div className=\"bg-white border border-gray-100 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-200 hover:scale-[1.02]\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <div className=\"flex-1\">\r\n            {icon && (\r\n              <div className={`inline-flex items-center justify-center w-12 h-12 rounded-lg mb-4 ${colorClasses[color].bg} ${colorClasses[color].text}`}>\r\n                {getIcon(icon)}\r\n              </div>\r\n            )}\r\n            <p className=\"text-3xl font-bold text-gray-900 mb-1\">{value}</p>\r\n            <p className=\"text-sm font-medium text-gray-600\">{title}</p>\r\n            {subtitle && <p className=\"text-xs text-gray-500 mt-1\">{subtitle}</p>}\r\n          </div>\r\n          {action && (\r\n            <Button \r\n              onClick={() => window.location.href = action.href}\r\n              className=\"text-xs px-3 py-2 rounded-lg\"\r\n              variant=\"secondary\"\r\n            >\r\n              {action.label}\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen\">\r\n        <div className=\"text-center py-20\">\r\n          <div className=\"relative\">\r\n            <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-blue-200 border-t-blue-600 mx-auto\"></div>\r\n            <div className=\"absolute inset-0 rounded-full h-16 w-16 border-4 border-transparent border-t-blue-300 mx-auto animate-ping\"></div>\r\n          </div>\r\n          <p className=\"mt-6 text-gray-600 font-medium\">Loading your dashboard...</p>\r\n          <p className=\"mt-2 text-sm text-gray-500\">Please wait while we fetch your information</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen\">\r\n      {/* Header Section */}\r\n      <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-8 mb-8 shadow-lg\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-white mb-2\">Welcome back, Student!</h1>\r\n            <p className=\"text-blue-100 text-lg\">Here's your hostel status and recent activities</p>\r\n          </div>\r\n          <div className=\"flex gap-4\">\r\n            <Button \r\n              onClick={() => window.location.href = '/student/checkin-checkout/create'}\r\n              variant=\"secondary\"\r\n              size=\"lg\"\r\n              className=\"bg-white/90 backdrop-blur-sm text-blue-700 hover:bg-white border-0 px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105\"\r\n            >\r\n              {stats.currentStatus === 'checked-in' ? 'Check Out' : 'Check In'}\r\n            </Button>\r\n            <Button \r\n              onClick={() => window.location.href = '/student/complain/create'}\r\n              variant=\"secondary\"\r\n              size=\"lg\"\r\n              className=\"bg-white/90 backdrop-blur-sm text-blue-700 hover:bg-white border-0 px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105\"\r\n            >\r\n              New Complaint\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Status Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n        <StatusCard\r\n          title=\"Check-In Status\"\r\n          value={stats.currentStatus === 'checked-in' ? 'Checked In' : 'Checked Out'}\r\n          subtitle={stats.roomNumber ? `Room ${stats.roomNumber}` : 'No room assigned'}\r\n          icon=\"status\"\r\n          color={stats.currentStatus === 'checked-in' ? 'green' : 'red'}\r\n          action={{ label: 'Manage', href: '/student/checkin-checkout' }}\r\n        />\r\n        <StatusCard\r\n          title=\"Current Room\"\r\n          value={stats.roomNumber || 'Not Assigned'}\r\n          subtitle={stats.bedNumber ? `Bed ${stats.bedNumber}` : 'No bed assigned'}\r\n          icon=\"room\"\r\n          color=\"blue\"\r\n        />\r\n        <StatusCard\r\n          title=\"My Complaints\"\r\n          value={stats.myComplaints}\r\n          subtitle={`${stats.pendingComplaints} pending, ${stats.resolvedComplaints} resolved`}\r\n          icon=\"complaint\"\r\n          color=\"yellow\"\r\n          action={{ label: 'View All', href: '/student/complain' }}\r\n        />\r\n        <StatusCard\r\n          title=\"This Month Payments\"\r\n          value={`Rs.${Math.round(stats.thisMonthPayments).toLocaleString()}`}\r\n          subtitle=\"Total paid this month\"\r\n          icon=\"payment\"\r\n          color=\"green\"\r\n          action={{ label: 'History', href: '/student/payment-history' }}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n        {/* Left Column - Recent Activities */}\r\n        <div className=\"lg:col-span-2\">\r\n          <div className=\"bg-white border border-gray-100 rounded-2xl p-8 shadow-sm\">\r\n            <div className=\"mb-6\">\r\n              <h2 className=\"text-xl font-bold text-gray-900\">Recent Activities</h2>\r\n              <p className=\"text-gray-500 mt-1\">Your latest check-ins, payments, and complaints</p>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              {stats.recentActivities.map((activity, index) => (\r\n                <div key={index} className=\"flex items-start gap-4 p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors\">\r\n                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${\r\n                    activity.type === 'payment' \r\n                      ? 'bg-green-100 text-green-600' \r\n                      : activity.type === 'complaint'\r\n                      ? 'bg-yellow-100 text-yellow-600'\r\n                      : activity.type === 'checkin'\r\n                      ? 'bg-blue-100 text-blue-600'\r\n                      : 'bg-red-100 text-red-600'\r\n                  }`}>\r\n                    {activity.type === 'payment' ? (\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\" />\r\n                      </svg>\r\n                    ) : activity.type === 'complaint' ? (\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n                      </svg>\r\n                    ) : activity.type === 'checkin' ? (\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\r\n                      </svg>\r\n                    ) : (\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                      </svg>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"text-sm font-medium text-gray-900\">{activity.message}</p>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">{activity.time}</p>\r\n                    {activity.status && (\r\n                      <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ${\r\n                        activity.status === 'completed' || activity.status === 'approved'\r\n                          ? 'bg-green-100 text-green-800'\r\n                          : activity.status === 'pending'\r\n                          ? 'bg-yellow-100 text-yellow-800'\r\n                          : 'bg-red-100 text-red-800'\r\n                      }`}>\r\n                        {activity.status}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              {stats.recentActivities.length === 0 && (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  <p className=\"text-sm\">No recent activities to display</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Column - Upcoming Payments & Quick Actions */}\r\n        <div className=\"space-y-6\">\r\n          {/* Outstanding Dues */}\r\n          <div className=\"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-100 rounded-2xl p-6 shadow-sm\">\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n              <div>\r\n                <h2 className=\"text-lg font-bold text-gray-900\">Outstanding Dues</h2>\r\n                <div className=\"flex items-center mt-2\">\r\n                  <div className=\"w-2 h-2 bg-orange-500 rounded-full mr-2\"></div>\r\n                  <span className=\"text-sm text-orange-700 font-medium\">Immediate attention required</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <p className=\"text-4xl font-bold text-gray-900 mb-3\">Rs.{Math.round(stats.outstandingDues).toLocaleString()}</p>\r\n            <Button \r\n              onClick={() => window.location.href = '/student/payment-history'}\r\n              className=\"w-full bg-orange-600 hover:bg-orange-700 text-white\"\r\n            >\r\n              View Payment Details\r\n            </Button>\r\n          </div>\r\n\r\n          {/* Upcoming Payments */}\r\n          <div className=\"bg-white border border-gray-100 rounded-2xl p-6 shadow-sm\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n              <h2 className=\"text-lg font-bold text-gray-900\">Upcoming Payments</h2>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              {stats.upcomingPayments.map((payment, index) => (\r\n                <div key={index} className=\"flex justify-between items-center p-3 bg-blue-50 rounded-lg\">\r\n                  <div>\r\n                    <p className=\"text-sm font-medium text-gray-900\">{payment.type}</p>\r\n                    <p className=\"text-xs text-gray-500\">Due: {new Date(payment.dueDate).toLocaleDateString()}</p>\r\n                  </div>\r\n                  <span className=\"font-bold text-gray-900\">Rs.{payment.amount.toLocaleString()}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Quick Actions */}\r\n          <div className=\"bg-white border border-gray-100 rounded-2xl p-6 shadow-sm\">\r\n            <h2 className=\"text-lg font-bold text-gray-900 mb-6\">Quick Actions</h2>\r\n            <div className=\"space-y-3\">\r\n              <Button \r\n                onClick={() => window.location.href = '/student/checkin-checkout'}\r\n                className=\"w-full justify-start bg-blue-50 text-blue-700 hover:bg-blue-100\"\r\n                variant=\"secondary\"\r\n              >\r\n                <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\r\n                </svg>\r\n                Check-In/Out History\r\n              </Button>\r\n              <Button \r\n                onClick={() => window.location.href = '/student/notice'}\r\n                className=\"w-full justify-start bg-green-50 text-green-700 hover:bg-green-100\"\r\n                variant=\"secondary\"\r\n              >\r\n                <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 17h5l-5 5v-5zM4 1h5l5 5V1H4z\" />\r\n                </svg>\r\n                View Notices\r\n              </Button>\r\n              <Button \r\n                onClick={() => window.location.href = '/student/complain'}\r\n                className=\"w-full justify-start bg-yellow-50 text-yellow-700 hover:bg-yellow-100\"\r\n                variant=\"secondary\"\r\n              >\r\n                <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n                </svg>\r\n                My Complaints\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\payment-history\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":175,"column":51,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[7065,7099],"text":"You haven&apos;t made any payments yet."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[7065,7099],"text":"You haven&lsquo;t made any payments yet."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[7065,7099],"text":"You haven&#39;t made any payments yet."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[7065,7099],"text":"You haven&rsquo;t made any payments yet."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { studentApi } from '@/lib/api/student.api';\r\nimport { formatCurrency, formatDate } from '@/lib/utils';\r\n\r\ninterface PaymentRecord {\r\n  id: string;\r\n  amount: number;\r\n  income_date: string;\r\n  payment_type?: {\r\n    name: string;\r\n  };\r\n  paymentType?: {\r\n    name: string;\r\n  };\r\n  income_type?: {\r\n    title: string;\r\n  };\r\n  incomeType?: {\r\n    title: string;\r\n  };\r\n  received_amount?: number;\r\n  due_amount?: number;\r\n  payment_status?: 'paid' | 'partial';\r\n  title?: string;\r\n  description?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport default function StudentPaymentHistoryPage() {\r\n  const [payments, setPayments] = useState<PaymentRecord[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n\r\n  useEffect(() => {\r\n    fetchPaymentHistory();\r\n  }, [currentPage]);\r\n\r\n  const fetchPaymentHistory = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Get student payment history from income records\r\n      const response = await studentApi.getStudentPayments();\r\n      \r\n      // Handle different response structures\r\n      const paymentsData = Array.isArray(response) ? response : (response.data || []);\r\n      \r\n      setPayments(paymentsData);\r\n      setTotalPages(Math.ceil(paymentsData.length / 10)); // Assuming 10 per page\r\n    } catch (error) {\r\n      console.error('Error fetching payment history:', error);\r\n      setPayments([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getPaymentStatusClass = (status?: string) => {\r\n    switch (status) {\r\n      case 'paid':\r\n        return 'bg-green-100 text-green-800';\r\n      case 'partial':\r\n        return 'bg-amber-100 text-amber-800';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  const getPaymentStatusText = (status?: string) => {\r\n    switch (status) {\r\n      case 'paid':\r\n        return 'Paid';\r\n      case 'partial':\r\n        return 'Partial';\r\n      default:\r\n        return 'Completed';\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen\">\r\n        <div className=\"text-center py-20\">\r\n          <div className=\"relative\">\r\n            <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-blue-200 border-t-blue-600 mx-auto\"></div>\r\n          </div>\r\n          <p className=\"mt-6 text-gray-600 font-medium\">Loading payment history...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen\">\r\n      {/* Header */}\r\n      <div className=\"bg-white rounded-2xl p-8 mb-8 shadow-sm border border-gray-100\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Payment History</h1>\r\n            <p className=\"text-gray-600\">View all your payment records and transaction details</p>\r\n          </div>\r\n          <div className=\"bg-blue-50 px-4 py-2 rounded-lg\">\r\n            <span className=\"text-blue-700 font-medium\">Total Payments: {payments.length}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payment Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n        <div className=\"bg-white rounded-xl p-6 border border-gray-100 shadow-sm\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\r\n              <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-4\">\r\n              <p className=\"text-2xl font-bold text-gray-900\">\r\n                Rs. {formatCurrency(payments.reduce((sum, payment) => sum + Number(payment.amount), 0))}\r\n              </p>\r\n              <p className=\"text-sm text-gray-600\">Total Paid</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-xl p-6 border border-gray-100 shadow-sm\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n              <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-4\">\r\n              <p className=\"text-2xl font-bold text-gray-900\">{payments.length}</p>\r\n              <p className=\"text-sm text-gray-600\">Total Transactions</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-xl p-6 border border-gray-100 shadow-sm\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center\">\r\n              <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-4\">\r\n              <p className=\"text-2xl font-bold text-gray-900\">\r\n                {payments.length > 0 ? `Rs. ${formatCurrency(payments.reduce((sum, payment) => sum + Number(payment.amount), 0) / payments.length)}` : 'Rs. 0'}\r\n              </p>\r\n              <p className=\"text-sm text-gray-600\">Average Payment</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payment Records Table */}\r\n      <div className=\"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden\">\r\n        <div className=\"p-6 border-b border-gray-100\">\r\n          <h2 className=\"text-xl font-bold text-gray-900\">Payment Records</h2>\r\n        </div>\r\n        \r\n        {payments.length === 0 ? (\r\n          <div className=\"p-12 text-center\">\r\n            <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\" />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No Payment Records Found</h3>\r\n            <p className=\"text-gray-600\">You haven't made any payments yet.</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Date</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Amount</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Payment Method</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Payment For</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {payments.map((payment) => (\r\n                  <tr key={payment.id} className=\"hover:bg-gray-50 transition-colors\">\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900 font-medium\">\r\n                        {formatDate(payment.income_date)}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-bold text-green-600\">\r\n                        Rs. {formatCurrency(payment.amount)}\r\n                      </div>\r\n                      {payment.due_amount !== undefined && payment.due_amount > 0 && (\r\n                        <div className=\"text-xs text-red-500\">\r\n                          Due: Rs. {formatCurrency(payment.due_amount)}\r\n                        </div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {payment.paymentType?.name || payment.payment_type?.name || 'N/A'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {payment.incomeType?.title || payment.income_type?.title || 'N/A'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"text-sm text-gray-600 max-w-xs truncate\">\r\n                        {payment.description || payment.title || '-'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getPaymentStatusClass(payment.payment_status)}`}>\r\n                        {getPaymentStatusText(payment.payment_status)}\r\n                      </span>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Pagination */}\r\n      {totalPages > 1 && (\r\n        <div className=\"flex justify-center mt-8\">\r\n          <div className=\"flex space-x-2\">\r\n            <Button\r\n              onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\r\n              disabled={currentPage === 1}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Previous\r\n            </Button>\r\n            <span className=\"flex items-center px-4 py-2 text-sm text-gray-700\">\r\n              Page {currentPage} of {totalPages}\r\n            </span>\r\n            <Button\r\n              onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\r\n              disabled={currentPage === totalPages}\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n            >\r\n              Next\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\app\\student\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'UpdateProfileData' is defined but never used.","line":4,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChangePasswordData' is defined but never used.","line":4,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":87},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2285,2288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2285,2288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3536,3539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3536,3539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { profileApi, type UserProfile, type UpdateProfileData, type ChangePasswordData } from '@/lib/api';\r\nimport { Button, TableSkeleton } from '@/components/ui';\r\nimport { PasswordInput } from '@/components/ui/password-input';\r\nimport { User, AlertCircle } from 'lucide-react';\r\n\r\nexport default function StudentProfile() {\r\n  const [profile, setProfile] = useState<UserProfile | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Email update state\r\n  const [email, setEmail] = useState('');\r\n  const [isUpdatingEmail, setIsUpdatingEmail] = useState(false);\r\n  const [emailError, setEmailError] = useState<string | null>(null);\r\n  const [emailSuccess, setEmailSuccess] = useState(false);\r\n  \r\n  // Password change state\r\n  const [currentPassword, setCurrentPassword] = useState('');\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [isChangingPassword, setIsChangingPassword] = useState(false);\r\n  const [passwordError, setPasswordError] = useState<string | null>(null);\r\n  const [passwordSuccess, setPasswordSuccess] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchProfile();\r\n  }, []);\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const data = await profileApi.getProfile();\r\n      setProfile(data);\r\n      setEmail(data.email || '');\r\n    } catch (err) {\r\n      console.error('Error fetching profile:', err);\r\n      setError('Failed to load profile. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUpdateEmail = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setEmailError(null);\r\n    setEmailSuccess(false);\r\n\r\n    if (!email || !email.includes('@')) {\r\n      setEmailError('Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsUpdatingEmail(true);\r\n      const updatedProfile = await profileApi.updateProfile({ email });\r\n      setProfile(updatedProfile);\r\n      setEmailSuccess(true);\r\n      \r\n      setTimeout(() => {\r\n        setEmailSuccess(false);\r\n      }, 3000);\r\n    } catch (err: any) {\r\n      console.error('Error updating email:', err);\r\n      setEmailError(err.message || 'Failed to update email. Please try again.');\r\n    } finally {\r\n      setIsUpdatingEmail(false);\r\n    }\r\n  };\r\n\r\n  const handleChangePassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setPasswordError(null);\r\n    setPasswordSuccess(false);\r\n\r\n    if (!currentPassword || !newPassword || !confirmPassword) {\r\n      setPasswordError('All password fields are required');\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 8) {\r\n      setPasswordError('New password must be at least 8 characters long');\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      setPasswordError('New password and confirmation do not match');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsChangingPassword(true);\r\n      await profileApi.changePassword({\r\n        current_password: currentPassword,\r\n        new_password: newPassword,\r\n        new_password_confirmation: confirmPassword,\r\n      });\r\n      \r\n      setPasswordSuccess(true);\r\n      setCurrentPassword('');\r\n      setNewPassword('');\r\n      setConfirmPassword('');\r\n      \r\n      setTimeout(() => {\r\n        setPasswordSuccess(false);\r\n      }, 3000);\r\n    } catch (err: any) {\r\n      console.error('Error changing password:', err);\r\n      setPasswordError(err.message || 'Failed to change password. Please check your current password.');\r\n    } finally {\r\n      setIsChangingPassword(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-medium text-gray-900\">Profile Settings</h1>\r\n          <p className=\"text-sm text-gray-500 mt-1\">Loading profile information...</p>\r\n        </div>\r\n        <TableSkeleton />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !profile) {\r\n    return (\r\n      <div className=\"p-4 max-w-7xl mx-auto\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-400 mr-2\" />\r\n            <p className=\"text-red-800\">{error || 'Profile not found'}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-3 bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-7xl mx-auto\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-xl font-medium text-gray-900\">Profile Settings</h1>\r\n        <p className=\"text-sm text-gray-500 mt-1\">Manage your account settings and preferences</p>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Profile Information Card */}\r\n        <div className=\"lg:col-span-1\">\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                <User className=\"w-6 h-6 text-blue-600\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-lg font-medium text-gray-900\">Account Info</h2>\r\n                <p className=\"text-sm text-gray-500\">\r\n                  {profile.role === 'staff' && profile.staff_name ? profile.staff_name : \r\n                   profile.role === 'student' && profile.student_name ? profile.student_name :\r\n                   profile.role}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">User ID</label>\r\n                <p className=\"text-sm font-medium text-gray-900 mt-1\">{profile.user_id}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Email</label>\r\n                <p className=\"text-sm text-gray-900 mt-1\">{profile.email}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Role</label>\r\n                <p className=\"text-sm text-gray-900 mt-1 capitalize\">\r\n                  {profile.role === 'staff' ? 'Staff' : \r\n                   profile.role === 'student' ? 'Student' : \r\n                   profile.role}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs font-medium text-gray-500\">Member Since</label>\r\n                <p className=\"text-sm text-gray-900 mt-1\">\r\n                  {new Date(profile.created_at).toLocaleDateString('en-US', {\r\n                    year: 'numeric',\r\n                    month: 'long',\r\n                    day: 'numeric'\r\n                  })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Email Update and Password Change Forms */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          {/* Update Email Form */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n              </svg>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Update Email Address</h2>\r\n            </div>\r\n\r\n            {emailSuccess && (\r\n              <div className=\"mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-sm text-green-800\">Email updated successfully!</p>\r\n              </div>\r\n            )}\r\n\r\n            {emailError && (\r\n              <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-600\" />\r\n                <p className=\"text-sm text-red-800\">{emailError}</p>\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleUpdateEmail}>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Email Address\r\n                  </label>\r\n                  <input\r\n                    type=\"email\"\r\n                    id=\"email\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"Enter your email address\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={isUpdatingEmail || email === profile.email}\r\n                  className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n                >\r\n                  {isUpdatingEmail ? 'Updating...' : 'Update Email'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n\r\n          {/* Change Password Form */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n              <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n              </svg>\r\n              <h2 className=\"text-lg font-medium text-gray-900\">Change Password</h2>\r\n            </div>\r\n\r\n            {passwordSuccess && (\r\n              <div className=\"mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p className=\"text-sm text-green-800\">Password changed successfully!</p>\r\n              </div>\r\n            )}\r\n\r\n            {passwordError && (\r\n              <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-600\" />\r\n                <p className=\"text-sm text-red-800\">{passwordError}</p>\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleChangePassword}>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"current-password\"\r\n                    label=\"Current Password\"\r\n                    value={currentPassword}\r\n                    onChange={(e) => setCurrentPassword(e.target.value)}\r\n                    placeholder=\"Enter your current password\"\r\n                    required\r\n                    autoComplete=\"current-password\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"new-password\"\r\n                    label=\"New Password\"\r\n                    value={newPassword}\r\n                    onChange={(e) => setNewPassword(e.target.value)}\r\n                    placeholder=\"Enter new password (min 8 characters)\"\r\n                    required\r\n                    minLength={8}\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <PasswordInput\r\n                    id=\"confirm-password\"\r\n                    label=\"Confirm New Password\"\r\n                    value={confirmPassword}\r\n                    onChange={(e) => setConfirmPassword(e.target.value)}\r\n                    placeholder=\"Confirm new password\"\r\n                    required\r\n                    minLength={8}\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                </div>\r\n\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={isChangingPassword}\r\n                  className=\"bg-[#235999] hover:bg-[#1e4d87]\"\r\n                >\r\n                  {isChangingPassword ? 'Changing Password...' : 'Change Password'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\components\\StaffStructure.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleEmailCopy' is assigned a value but never used.","line":124,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { usePathname, useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/lib/auth';\r\n\r\nexport default function StaffStructure({ children }: { children: React.ReactNode }) {\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [userDropdownOpen, setUserDropdownOpen] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n  const [mounted, setMounted] = useState(false);\r\n  const [emailCopied, setEmailCopied] = useState(false);\r\n  const pathname = usePathname();\r\n  const router = useRouter();\r\n  const { logout, user, isLoading: authLoading } = useAuth();\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n    const timer = setInterval(() => {\r\n      setCurrentTime(new Date());\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  // Logout function\r\n  const handleLogout = async () => {\r\n    try {\r\n      await logout();\r\n    } catch (error) {\r\n      console.error('Logout failed:', error);\r\n    }\r\n  };\r\n\r\n  // Close dropdowns when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      const target = event.target as Element;\r\n      \r\n      // Close user dropdown if clicking outside of it\r\n      if (userDropdownOpen) {\r\n        const userDropdownElement = document.querySelector('[data-dropdown=\"user\"]');\r\n        const userButtonElement = document.querySelector('[data-button=\"user\"]');\r\n        \r\n        if (userDropdownElement && userButtonElement) {\r\n          if (!userDropdownElement.contains(target) && !userButtonElement.contains(target)) {\r\n            setUserDropdownOpen(false);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    if (userDropdownOpen) {\r\n      document.addEventListener('click', handleClickOutside);\r\n      return () => document.removeEventListener('click', handleClickOutside);\r\n    }\r\n  }, [userDropdownOpen]);\r\n\r\n  // Determine if back button should be shown (3+ segments deep)\r\n  const pathSegments = pathname.split('/').filter(Boolean);\r\n  const showBackButton = pathSegments.length >= 3;\r\n\r\n  const getPageName = (path: string) => {\r\n    const segments = path.split('/').filter(Boolean);\r\n    \r\n    // Define route mappings for staff pages\r\n    const routeMap: { [key: string]: string } = {\r\n      'staff': 'Dashboard',\r\n      'checkin-checkout': 'Check-In/Out',\r\n      'notice': 'Notices',\r\n      'salary': 'Salary',\r\n      'payment-history': 'Payment History',\r\n      'complain': 'Complains',\r\n      'inquiry': 'Inquiries',\r\n    };\r\n\r\n    if (segments.length === 1) {\r\n      return 'Staff Dashboard';\r\n    }\r\n\r\n    // Handle specific sub-routes\r\n    if (segments.length >= 2) {\r\n      const baseRoute = segments[1];\r\n      const subRoute = segments[2];\r\n      \r\n      if (subRoute === 'create') {\r\n        const baseName = routeMap[baseRoute];\r\n        return `Create ${baseName ? baseName.slice(0, -1) : 'Item'}`;\r\n      } else if (subRoute === 'edit' || (segments[3] === 'edit')) {\r\n        const baseName = routeMap[baseRoute];\r\n        return `Edit ${baseName ? baseName.slice(0, -1) : 'Item'}`;\r\n      } else if (!isNaN(Number(subRoute))) {\r\n        const baseName = routeMap[baseRoute];\r\n        return `View ${baseName ? baseName.slice(0, -1) : 'Item'}`;\r\n      }\r\n      \r\n      return routeMap[baseRoute] || 'Staff Panel';\r\n    }\r\n\r\n    return 'Staff Panel';\r\n  };\r\n\r\n  const currentPageName = getPageName(pathname);\r\n\r\n  // Handle back navigation\r\n  const handleBackClick = () => {\r\n    router.back();\r\n  };\r\n\r\n  const formatDateTime = (date: Date) => {\r\n    const options: Intl.DateTimeFormatOptions = {\r\n      weekday: 'short',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric',\r\n      hour: 'numeric',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    };\r\n    return date.toLocaleDateString('en-US', options);\r\n  };\r\n\r\n  const handleEmailCopy = () => {\r\n    navigator.clipboard.writeText(user?.email || '');\r\n    setEmailCopied(true);\r\n    setTimeout(() => setEmailCopied(false), 1500); // Reduced from 2000ms\r\n  };\r\n\r\n  // Sidebar items for staff\r\n  const sidebarItems = [\r\n    {\r\n      label: 'Dashboard',\r\n      href: '/staff',\r\n      icon: (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z\" />\r\n        </svg>\r\n      ),\r\n    },\r\n    {\r\n      label: 'Check-In/Out',\r\n      href: '/staff/checkin-checkout',\r\n      icon: (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ),\r\n    },\r\n    {\r\n      label: 'Inquiries',\r\n      href: '/staff/inquiry',\r\n      icon: (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z\" />\r\n          <path d=\"M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z\" />\r\n        </svg>\r\n      ),\r\n    },\r\n    {\r\n      label: 'Salary',\r\n      href: '/staff/salary',\r\n      icon: (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z\" />\r\n          <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ),\r\n    },\r\n    {\r\n      label: 'Complaints',\r\n      href: '/staff/complain',\r\n      icon: (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ),\r\n    },\r\n    {\r\n      label: 'Notices',\r\n      href: '/staff/notice',\r\n      icon: (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30\">\r\n      {/* Topbar */}\r\n      <header className=\"fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-xl border-b border-gray-200/50 h-16 shadow-lg\">\r\n        <div className=\"flex items-center h-full\">\r\n          {/* Left side - Title area */}\r\n          <div className=\"flex items-center w-64 px-6 border-r border-gray-200/50 h-full bg-gradient-to-r from-[#235999] to-[#1e4d87] relative overflow-hidden\">\r\n            {/* Background pattern */}\r\n            <div className=\"absolute inset-0 opacity-10\">\r\n              <div className=\"absolute top-0 left-0 w-32 h-32 bg-white rounded-full -translate-x-16 -translate-y-16\"></div>\r\n              <div className=\"absolute bottom-0 right-0 w-24 h-24 bg-white rounded-full translate-x-12 translate-y-12\"></div>\r\n            </div>\r\n            \r\n            {/* Mobile menu button */}\r\n            <button\r\n              onClick={() => setSidebarOpen(!sidebarOpen)}\r\n              className=\"lg:hidden w-9 h-9 flex items-center justify-center mr-4 rounded-xl hover:bg-white/20 transition-all duration-200 relative z-10\"\r\n            > \r\n              {sidebarOpen ? (\r\n                <svg className=\"h-5 w-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              ) : (\r\n                <svg className=\"h-5 w-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\r\n                </svg>\r\n              )}\r\n            </button>\r\n\r\n            {/* Logo and Title */}\r\n            <div className=\"flex items-center relative z-10\">\r\n              <div className=\"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center mr-3 backdrop-blur-sm\">\r\n                <svg className=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\r\n                </svg>\r\n              </div>\r\n              <span className=\"text-sm font-bold text-white tracking-tight\">Staff Portal</span>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Center - Navigation and info */}\r\n          <div className=\"flex items-center justify-between flex-1 px-6\">\r\n            <div className=\"flex items-center\">\r\n              {/* Back Button */}\r\n              {showBackButton && (\r\n                <button\r\n                  onClick={handleBackClick}\r\n                  className=\"w-9 h-9 flex items-center justify-center mr-4 bg-gradient-to-r from-gray-100 to-gray-50 rounded-xl hover:from-gray-200 hover:to-gray-100 transition-all duration-200 shadow-sm border border-gray-200/50\"\r\n                >\r\n                  <svg className=\"h-4 w-4 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n                  </svg>\r\n                </button>\r\n              )}\r\n              \r\n              {/* Page Title */}\r\n              <div className=\"flex items-center\">\r\n                <h1 className=\"text-xl font-bold text-gray-800 tracking-tight\">{currentPageName}</h1>\r\n                <div className=\"w-2 h-2 bg-[#235999] rounded-full ml-3 animate-pulse\"></div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Time display with enhanced design */}\r\n            <div className=\"hidden md:flex items-center space-x-3 text-sm text-gray-600 bg-gradient-to-r from-white to-gray-50 px-4 py-2.5 rounded-xl border border-gray-200/50 shadow-sm\">\r\n              <div className=\"w-8 h-8 bg-gradient-to-br from-[#235999] to-[#1e4d87] rounded-lg flex items-center justify-center\">\r\n                <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n              </div>\r\n              <div className=\"flex flex-col\">\r\n                <span className=\"text-xs text-gray-500 font-medium\">Current Time</span>\r\n                <span className=\"font-semibold text-gray-800\">{mounted ? formatDateTime(currentTime) : '--'}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right side - User menu */}\r\n          <div className=\"flex items-center px-6 space-x-3\">\r\n            {/* Notification bell */}\r\n            <button className=\"relative w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 transition-all duration-200 group\">\r\n              <svg className=\"w-5 h-5 text-gray-600 group-hover:text-[#235999] transition-colors duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 17h5l-3.5-5.5.5-3.5V7a6 6 0 00-12 0v1.5l.5 3.5L2 17h5m8 0v1a3 3 0 11-6 0v-1m6 0H9\" />\r\n              </svg>\r\n              <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center\">\r\n                <span className=\"text-xs font-bold text-white\">3</span>\r\n              </div>\r\n            </button>\r\n\r\n            {/* User dropdown */}\r\n            <div className=\"relative\">\r\n              <button\r\n                data-button=\"user\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  setUserDropdownOpen(!userDropdownOpen);\r\n                }}\r\n                className=\"flex items-center space-x-3 p-2 rounded-xl hover:bg-gray-100 transition-all duration-200 group\"\r\n              >\r\n                <div className=\"w-9 h-9 bg-gradient-to-br from-[#235999] to-[#1e4d87] rounded-xl flex items-center justify-center shadow-lg ring-2 ring-white\">\r\n                  <span className=\"text-white font-bold text-lg\">{user?.name?.charAt(0).toUpperCase() || 'S'}</span>\r\n                </div>\r\n                <div className=\"hidden lg:block text-left\">\r\n                  <div className=\"text-sm font-semibold text-gray-800\">{user?.name?.split(' ')[0] || 'Staff'}</div>\r\n                </div>\r\n                <svg className=\"hidden lg:block w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-colors duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                </svg>\r\n              </button>\r\n\r\n              {/* User dropdown menu */}\r\n              {userDropdownOpen && (\r\n                <div \r\n                  data-dropdown=\"user\"\r\n                  className=\"absolute right-0 mt-3 w-80 bg-white/95 backdrop-blur-xl border border-gray-200/50 shadow-2xl rounded-2xl py-3 z-50 animate-in slide-in-from-top-2 duration-200\"\r\n                  onClick={(e) => e.stopPropagation()}\r\n                >\r\n                  <div className=\"px-5 py-4 border-b border-gray-100/50\">\r\n                    <div className=\"flex items-start space-x-4\">\r\n                      <div className=\"w-9 h-9 bg-gradient-to-br from-[#235999] to-[#1e4d87] rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\">\r\n                        <span className=\"text-white font-bold text-lg\">{user?.name?.charAt(0).toUpperCase() || 'S'}</span>\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"text-base font-bold text-gray-800 mb-1\">{user?.name || 'Staff'}</div>\r\n                        <div \r\n                          className={`text-sm break-all cursor-pointer transition-all duration-200 hover:text-[#235999] ${\r\n                            emailCopied ? 'text-green-600' : 'text-gray-500'\r\n                          }`}\r\n                          title={emailCopied ? \"Email copied to clipboard!\" : \"Click to copy email\"}\r\n                          onClick={async (e) => {\r\n                            e.stopPropagation();\r\n                            try {\r\n                              await navigator.clipboard.writeText(user?.email || 'staff@hms.com');\r\n                              setEmailCopied(true);\r\n                              setTimeout(() => setEmailCopied(false), 1500);\r\n                            } catch (err) {\r\n                              console.error('Failed to copy email:', err);\r\n                            }\r\n                          }}\r\n                        >\r\n                          {emailCopied ? (\r\n                            <div className=\"flex items-center space-x-1\">\r\n                              <svg className=\"w-4 h-4 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                              </svg>\r\n                              <span>Email copied!</span>\r\n                            </div>\r\n                          ) : (\r\n                            <div className=\"flex items-center space-x-1 group\">\r\n                              <span>{user?.email || 'staff@hms.com'}</span>\r\n                              <svg className=\"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n                              </svg>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"py-2\">\r\n                    <Link\r\n                      href=\"/staff/profile\"\r\n                      className=\"flex items-center px-5 py-3.5 text-sm font-medium text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-[#235999] transition-all duration-200 group\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                      <div className=\"w-9 h-9 bg-gray-100 rounded-xl flex items-center justify-center mr-4 group-hover:bg-blue-100 transition-colors duration-200\">\r\n                        <svg className=\"h-4 w-4 text-gray-500 group-hover:text-[#235999]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"font-semibold text-sm\">Profile</div>\r\n                        <div className=\"text-xs text-gray-500\">Manage your account</div>\r\n                      </div>\r\n                    </Link>\r\n                    <Link\r\n                      href=\"/staff/settings\"\r\n                      className=\"flex items-center px-5 py-3.5 text-sm font-medium text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-[#235999] transition-all duration-200 group\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                      <div className=\"w-9 h-9 bg-gray-100 rounded-xl flex items-center justify-center mr-4 group-hover:bg-blue-100 transition-colors duration-200\">\r\n                        <svg className=\"h-4 w-4 text-gray-500 group-hover:text-[#235999]\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                          <path fillRule=\"evenodd\" d=\"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z\" clipRule=\"evenodd\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"font-semibold text-sm\">Settings</div>\r\n                        <div className=\"text-xs text-gray-500\">Preferences & configuration</div>\r\n                      </div>\r\n                    </Link>\r\n                  </div>\r\n                  <div className=\"border-t border-gray-200/50 my-2\"></div>\r\n                  <button \r\n                    className=\"flex items-center w-full px-5 py-3.5 text-sm font-medium text-red-600 hover:bg-red-50 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    onClick={handleLogout}\r\n                    disabled={authLoading}\r\n                  >\r\n                    <div className=\"w-9 h-9 bg-red-100 rounded-xl flex items-center justify-center mr-4 group-hover:bg-red-200 transition-colors duration-200\">\r\n                      {authLoading ? (\r\n                        <svg className=\"h-4 w-4 text-red-500 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                        </svg>\r\n                      ) : (\r\n                        <svg className=\"h-4 w-4 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                        </svg>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-left\">\r\n                      <div className=\"font-semibold text-sm\">\r\n                        {authLoading ? 'Signing out...' : 'Sign out'}\r\n                      </div>\r\n                      <div className=\"text-xs text-gray-500\">End current session</div>\r\n                    </div>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Sidebar */}\r\n      <aside\r\n        className={`fixed top-16 left-0 z-40 w-64 h-[calc(100vh-4rem)] bg-white/95 backdrop-blur-xl border-r border-gray-200/50 transition-transform duration-300 ease-out shadow-2xl ${\r\n          sidebarOpen ? \"translate-x-0\" : \"-translate-x-full\"\r\n        } lg:translate-x-0`}\r\n      >\r\n        {/* Sidebar content */}\r\n        <div className=\"h-full overflow-y-auto py-3 scrollbar-thin scrollbar-thumb-blue-200 scrollbar-track-transparent hover:scrollbar-thumb-blue-300\">\r\n          <nav className=\"px-2 space-y-0.5\">\r\n            {sidebarItems.map((item, index) => {\r\n              const isActive = pathname === item.href || (item.href !== \"/staff\" && pathname.startsWith(item.href) && !sidebarItems.some(otherItem => \r\n                otherItem.href !== item.href && \r\n                otherItem.href !== \"/staff\" && \r\n                pathname.startsWith(otherItem.href) && \r\n                otherItem.href.length > item.href.length\r\n              ));\r\n              \r\n              return (\r\n                <Link\r\n                  key={index}\r\n                  href={item.href}\r\n                  className={`group flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${\r\n                    isActive\r\n                      ? \"bg-gradient-to-r from-[#235999] to-[#1e4d87] text-white shadow-md shadow-blue-200/60\"\r\n                      : \"text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-[#235999]\"\r\n                  }`}\r\n                >\r\n                  <div className={`mr-3 flex-shrink-0 transition-transform duration-200 ${isActive ? 'scale-110' : 'group-hover:scale-105'}`}>\r\n                    {item.icon}\r\n                  </div>\r\n                  <span className=\"tracking-tight text-xs font-semibold\">{item.label}</span>\r\n                  {isActive && (\r\n                    <div className=\"ml-auto w-1.5 h-1.5 bg-white rounded-full opacity-90\"></div>\r\n                  )}\r\n                </Link>\r\n              );\r\n            })}\r\n          </nav>\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Mobile sidebar overlay */}\r\n      {sidebarOpen && (\r\n        <div \r\n          className=\"fixed inset-0 z-30 bg-black/40 backdrop-blur-sm lg:hidden transition-all duration-300\" \r\n          onClick={() => setSidebarOpen(false)} \r\n        />\r\n      )}\r\n\r\n      {/* Main content */}\r\n      <main className=\"pt-16 lg:pl-64 min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30\">\r\n        <div className=\"p-6\">\r\n          <div className=\"max-w-7xl mx-auto\">\r\n            {children}\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Lumica\\HMS_NEW\\frontend\\components\\Structure.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'user' is assigned a value but never used.","line":26,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'groupedItems' is assigned a value but never used.","line":353,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":353,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'categoryLabels' is assigned a value but never used.","line":361,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":361,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { usePathname, useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/lib/auth';\r\n\r\ntype SidebarItem = {\r\n  icon: () => JSX.Element;\r\n  label: string;\r\n  href: string;\r\n  category: string;\r\n  hasSubmenu?: boolean;\r\n  submenu?: { label: string; href: string }[];\r\n};\r\n\r\nexport default function Structure({ children }: { children: React.ReactNode }) {\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [userDropdownOpen, setUserDropdownOpen] = useState(false);\r\n  const [expenseMenuOpen, setExpenseMenuOpen] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n  const [mounted, setMounted] = useState(false);\r\n  const [emailCopied, setEmailCopied] = useState(false);\r\n  const pathname = usePathname();\r\n  const router = useRouter();\r\n  const { logout, user, isLoading: authLoading } = useAuth();\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n    const timer = setInterval(() => {\r\n      setCurrentTime(new Date());\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  // Logout function\r\n  const handleLogout = async () => {\r\n    try {\r\n      await logout();\r\n    } catch (error) {\r\n      console.error('Logout failed:', error);\r\n    }\r\n  };\r\n\r\n  // Close dropdowns when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      const target = event.target as Element;\r\n      \r\n      // Close user dropdown if clicking outside of it\r\n      if (userDropdownOpen) {\r\n        const userDropdownElement = document.querySelector('[data-dropdown=\"user\"]');\r\n        const userButtonElement = document.querySelector('[data-button=\"user\"]');\r\n        \r\n        if (userDropdownElement && userButtonElement) {\r\n          if (!userDropdownElement.contains(target) && !userButtonElement.contains(target)) {\r\n            setUserDropdownOpen(false);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    if (userDropdownOpen) {\r\n      document.addEventListener('click', handleClickOutside);\r\n      return () => document.removeEventListener('click', handleClickOutside);\r\n    }\r\n  }, [userDropdownOpen]);\r\n\r\n  // Determine if back button should be shown (3+ segments deep)\r\n  const pathSegments = pathname.split('/').filter(Boolean);\r\n  const showBackButton = pathSegments.length >= 3;\r\n\r\n  // Get current page name based on pathname\r\n  const getPageName = (pathname: string) => {\r\n    const segments = pathname.split('/').filter(Boolean);\r\n    \r\n    if (pathname === '/admin' || pathname === '/admin/') {\r\n      return 'Dashboard';\r\n    }\r\n    \r\n    // Map routes to page names\r\n    const routeMap: Record<string, string> = {\r\n      'student': 'Students',\r\n      'staff': 'Staff',\r\n      'block': 'Blocks',\r\n      'room': 'Rooms',\r\n      'student-checkin-checkout': 'Student Check-In/Out',\r\n      'staff-checkin-checkout': 'Staff Check-In/Out',\r\n      'income': 'Income',\r\n      'expense': 'Expenses',\r\n      'salary': 'Salary',\r\n      'supplier': 'Suppliers',\r\n      'complain': 'Complaints',\r\n      'notice': 'Notices',\r\n      'inquiry': 'Inquiries',\r\n      'report': 'Reports',\r\n      'settings': 'Settings',\r\n      'profile': 'Profile'\r\n    };\r\n\r\n    // Handle specific sub-routes\r\n    if (segments.length >= 2) {\r\n      const baseRoute = segments[1];\r\n      const subRoute = segments[2];\r\n      \r\n      if (subRoute === 'create') {\r\n        const baseName = routeMap[baseRoute];\r\n        return `Create ${baseName ? baseName.slice(0, -1) : 'Item'}`;\r\n      } else if (subRoute === 'edit' || (segments[3] === 'edit')) {\r\n        const baseName = routeMap[baseRoute];\r\n        return `Edit ${baseName ? baseName.slice(0, -1) : 'Item'}`;\r\n      } else if (subRoute && !['create', 'edit'].includes(subRoute)) {\r\n        const baseName = routeMap[baseRoute];\r\n        return `${baseName ? baseName.slice(0, -1) : 'Item'} Details`;\r\n      }\r\n      \r\n      return routeMap[baseRoute] || 'Dashboard';\r\n    }\r\n    \r\n    return 'Dashboard';\r\n  };\r\n\r\n  const currentPageName = getPageName(pathname);\r\n\r\n  // Auto-open expense menu if on expense or expense-category pages\r\n  useEffect(() => {\r\n    if (pathname.startsWith('/admin/expense')) {\r\n      setExpenseMenuOpen(true);\r\n    }\r\n  }, [pathname]);\r\n\r\n  const handleBackClick = () => {\r\n    router.back();\r\n  };\r\n\r\n  const formatDateTime = (date: Date) => {\r\n    const options: Intl.DateTimeFormatOptions = {\r\n      weekday: 'short',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric',\r\n      hour: 'numeric',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    };\r\n    return date.toLocaleDateString('en-US', options);\r\n  };\r\n\r\n  const sidebarItems: SidebarItem[] = [\r\n    // Core Management\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z\" />\r\n        </svg>\r\n      ), \r\n      label: \"Dashboard\", \r\n      href: \"/admin\",\r\n      category: \"core\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" />\r\n        </svg>\r\n      ), \r\n      label: \"Students\", \r\n      href: \"/admin/student\",\r\n      category: \"core\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z\" />\r\n        </svg>\r\n      ), \r\n      label: \"Staff\", \r\n      href: \"/admin/staff\",\r\n      category: \"core\"\r\n    },\r\n    \r\n    // Facility Management\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2v2h4V6H4zm6 0v2h6V6h-6zM4 10v2h4v-2H4zm6 0v2h6v-2h-6zM4 14v2h4v-2H4zm6 0v2h6v-2h-6z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Blocks\", \r\n      href: \"/admin/block\",\r\n      category: \"facility\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z\" />\r\n        </svg>\r\n      ), \r\n      label: \"Rooms\", \r\n      href: \"/admin/room\",\r\n      category: \"facility\"\r\n    },\r\n    \r\n    // Check-In/Out Operations\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Student Check-In/Out\", \r\n      href: \"/admin/student-checkin-checkout\",\r\n      category: \"operations\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Staff Check-In/Out\", \r\n      href: \"/admin/staff-checkin-checkout\",\r\n      category: \"operations\"\r\n    },\r\n    \r\n    // Financial Management\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Income\", \r\n      href: \"/admin/income\",\r\n      category: \"financial\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Expenses\", \r\n      href: \"/admin/expense\",\r\n      category: \"financial\",\r\n      hasSubmenu: true,\r\n      submenu: [\r\n        { label: \"All Expenses\", href: \"/admin/expense\" },\r\n        { label: \"Expense Categories\", href: \"/admin/expense-category\" }\r\n      ]\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z\" />\r\n          <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Salary\", \r\n      href: \"/admin/salary\",\r\n      category: \"financial\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm3 5a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm0 3a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Suppliers\", \r\n      href: \"/admin/supplier\",\r\n      category: \"financial\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z\" />\r\n          <path fillRule=\"evenodd\" d=\"M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Payment Methods\", \r\n      href: \"/admin/payment-type\",\r\n      category: \"financial\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\" />\r\n          <path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Income Type\", \r\n      href: \"/admin/income-type\",\r\n      category: \"financial\"\r\n    },\r\n    \r\n    // Communication & Support\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Complaints\", \r\n      href: \"/admin/complain\",\r\n      category: \"communication\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Notices\", \r\n      href: \"/admin/notice\",\r\n      category: \"communication\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Inquiries\", \r\n      href: \"/admin/inquiry\",\r\n      category: \"communication\"\r\n    },\r\n    \r\n    // Reports & Settings\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Reports\", \r\n      href: \"/admin/report\",\r\n      category: \"admin\"\r\n    },\r\n    { \r\n      icon: () => (\r\n        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path fillRule=\"evenodd\" d=\"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      ), \r\n      label: \"Settings\", \r\n      href: \"/admin/settings\",\r\n      category: \"admin\"\r\n    },\r\n  ];\r\n\r\n  // Group items by category\r\n  const groupedItems = sidebarItems.reduce((acc, item) => {\r\n    if (!acc[item.category]) {\r\n      acc[item.category] = [];\r\n    }\r\n    acc[item.category].push(item);\r\n    return acc;\r\n  }, {} as Record<string, typeof sidebarItems>);\r\n\r\n  const categoryLabels = {\r\n    core: \"Core\",\r\n    facility: \"Facility\",\r\n    operations: \"Operations\", \r\n    financial: \"Financial\",\r\n    communication: \"Communication\",\r\n    admin: \"Administration\"\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30\">\r\n      {/* Topbar */}\r\n      <header className=\"fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-xl border-b border-gray-200/50 h-16 shadow-lg\">\r\n        <div className=\"flex items-center h-full\">\r\n          {/* Left side - Title area */}\r\n          <div className=\"flex items-center w-64 px-6 border-r border-gray-200/50 h-full bg-gradient-to-r from-[#235999] to-[#1e4d87] relative overflow-hidden\">\r\n            {/* Background pattern */}\r\n            <div className=\"absolute inset-0 opacity-10\">\r\n              <div className=\"absolute top-0 left-0 w-32 h-32 bg-white rounded-full -translate-x-16 -translate-y-16\"></div>\r\n              <div className=\"absolute bottom-0 right-0 w-24 h-24 bg-white rounded-full translate-x-12 translate-y-12\"></div>\r\n            </div>\r\n            \r\n            {/* Mobile menu button */}\r\n            <button\r\n              onClick={() => setSidebarOpen(!sidebarOpen)}\r\n              className=\"lg:hidden w-9 h-9 flex items-center justify-center mr-4 rounded-xl hover:bg-white/20 transition-all duration-200 relative z-10\"\r\n            > \r\n              {sidebarOpen ? (\r\n                <svg className=\"h-5 w-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              ) : (\r\n                <svg className=\"h-5 w-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\r\n                </svg>\r\n              )}\r\n            </button>\r\n\r\n            {/* Logo and Title */}\r\n            <div className=\"flex items-center relative z-10\">\r\n              <div className=\"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center mr-3 backdrop-blur-sm\">\r\n                <svg className=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path d=\"M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z\" />\r\n                </svg>\r\n              </div>\r\n              <span className=\"text-sm font-bold text-white tracking-tight\">Hostel Management</span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Middle - Back button, title and time */}\r\n          <div className=\"flex items-center justify-between flex-1 px-6\">\r\n            <div className=\"flex items-center\">\r\n              {showBackButton && (\r\n                <button\r\n                  onClick={handleBackClick}\r\n                  className=\"w-9 h-9 flex items-center justify-center mr-4 bg-gradient-to-r from-gray-100 to-gray-50 rounded-xl hover:from-gray-200 hover:to-gray-100 transition-all duration-200 shadow-sm border border-gray-200/50\"\r\n                >\r\n                  <svg className=\"h-4 w-4 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n                  </svg>\r\n                </button>\r\n              )}\r\n              <div className=\"flex items-center\">\r\n                <h1 className=\"text-xl font-bold text-gray-800 tracking-tight\">{currentPageName}</h1>\r\n                <div className=\"w-2 h-2 bg-[#235999] rounded-full ml-3 animate-pulse\"></div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Time display with enhanced design */}\r\n            <div className=\"hidden md:flex items-center space-x-3 text-sm text-gray-600 bg-gradient-to-r from-white to-gray-50 px-4 py-2.5 rounded-xl border border-gray-200/50 shadow-sm\">\r\n              <div className=\"w-8 h-8 bg-gradient-to-br from-[#235999] to-[#1e4d87] rounded-lg flex items-center justify-center\">\r\n                <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n              </div>\r\n              <div className=\"flex flex-col\">\r\n                <span className=\"text-xs text-gray-500 font-medium\">Current Time</span>\r\n                <span className=\"font-semibold text-gray-800\">{mounted ? formatDateTime(currentTime) : '--'}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right side - Notifications and user */}\r\n          <div className=\"flex items-center px-6 space-x-3\">\r\n            {/* Notification bell */}\r\n            <button className=\"relative w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 transition-all duration-200 group\">\r\n              <svg className=\"w-5 h-5 text-gray-600 group-hover:text-[#235999] transition-colors duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 17h5l-3.5-5.5.5-3.5V7a6 6 0 00-12 0v1.5l.5 3.5L2 17h5m8 0v1a3 3 0 11-6 0v-1m6 0H9\" />\r\n              </svg>\r\n              <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center\">\r\n                <span className=\"text-xs font-bold text-white\">3</span>\r\n              </div>\r\n            </button>\r\n\r\n            {/* User dropdown */}\r\n            <div className=\"relative\">\r\n              <button\r\n                data-button=\"user\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  setUserDropdownOpen(!userDropdownOpen);\r\n                }}\r\n                className=\"flex items-center space-x-3 p-2 rounded-xl hover:bg-gray-100 transition-all duration-200 group\"\r\n              >\r\n                <div className=\"w-9 h-9 bg-gradient-to-br from-[#235999] to-[#1e4d87] rounded-xl flex items-center justify-center shadow-lg ring-2 ring-white\">\r\n                  <svg className=\"h-5 w-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"hidden lg:block text-left\">\r\n                  <div className=\"text-sm font-semibold text-gray-800\">Admin</div>\r\n                </div>\r\n                <svg className=\"hidden lg:block w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-colors duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                </svg>\r\n              </button>\r\n\r\n              {/* User dropdown menu */}\r\n              {userDropdownOpen && (\r\n                <div \r\n                  data-dropdown=\"user\"\r\n                  className=\"absolute right-0 mt-3 w-80 bg-white/95 backdrop-blur-xl border border-gray-200/50 shadow-2xl rounded-2xl py-3 z-50 animate-in slide-in-from-top-2 duration-200\"\r\n                  onClick={(e) => e.stopPropagation()}\r\n                >\r\n                  <div className=\"px-5 py-4 border-b border-gray-100/50\">\r\n                    <div className=\"flex items-start space-x-4\">\r\n                      <div className=\"w-9 h-9 bg-gradient-to-br from-[#235999] to-[#1e4d87] rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\">\r\n                        <svg className=\"h-4 w-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"text-base font-bold text-gray-800 mb-1\">Admin</div>\r\n                        <div \r\n                          className={`text-sm break-all cursor-pointer transition-all duration-200 hover:text-[#235999] ${\r\n                            emailCopied ? 'text-green-600' : 'text-gray-500'\r\n                          }`}\r\n                          title={emailCopied ? \"Email copied to clipboard!\" : \"Click to copy email\"}\r\n                          onClick={async (e) => {\r\n                            e.stopPropagation();\r\n                            try {\r\n                              await navigator.clipboard.writeText('admin@hms.com');\r\n                              setEmailCopied(true);\r\n                              setTimeout(() => setEmailCopied(false), 1500); // Reduced from 2000ms\r\n                            } catch (err) {\r\n                              console.error('Failed to copy email:', err);\r\n                            }\r\n                          }}\r\n                        >\r\n                          {emailCopied ? (\r\n                            <div className=\"flex items-center space-x-1\">\r\n                              <svg className=\"w-4 h-4 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                              </svg>\r\n                              <span>Email copied!</span>\r\n                            </div>\r\n                          ) : (\r\n                            <div className=\"flex items-center space-x-1 group\">\r\n                              <span>admin@hms.com</span>\r\n                              <svg className=\"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n                              </svg>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"py-2\">\r\n                    <Link\r\n                      href=\"/admin/profile\"\r\n                      className=\"flex items-center px-5 py-3.5 text-sm font-medium text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-[#235999] transition-all duration-200 group\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                      <div className=\"w-9 h-9 bg-gray-100 rounded-xl flex items-center justify-center mr-4 group-hover:bg-blue-100 transition-colors duration-200\">\r\n                        <svg className=\"h-4 w-4 text-gray-500 group-hover:text-[#235999]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"font-semibold text-sm\">Profile</div>\r\n                        <div className=\"text-xs text-gray-500\">Manage your account</div>\r\n                      </div>\r\n                    </Link>\r\n                    <Link\r\n                      href=\"/admin/settings\"\r\n                      className=\"flex items-center px-5 py-3.5 text-sm font-medium text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-[#235999] transition-all duration-200 group\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                      <div className=\"w-9 h-9 bg-gray-100 rounded-xl flex items-center justify-center mr-4 group-hover:bg-blue-100 transition-colors duration-200\">\r\n                        <svg className=\"h-4 w-4 text-gray-500 group-hover:text-[#235999]\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                          <path fillRule=\"evenodd\" d=\"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z\" clipRule=\"evenodd\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"font-semibold text-sm\">Settings</div>\r\n                        <div className=\"text-xs text-gray-500\">Preferences & configuration</div>\r\n                      </div>\r\n                    </Link>\r\n                  </div>\r\n                  <div className=\"border-t border-gray-200/50 my-2\"></div>\r\n                  <button \r\n                    className=\"flex items-center w-full px-5 py-3.5 text-sm font-medium text-red-600 hover:bg-red-50 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    onClick={handleLogout}\r\n                    disabled={authLoading}\r\n                  >\r\n                    <div className=\"w-9 h-9 bg-red-100 rounded-xl flex items-center justify-center mr-4 group-hover:bg-red-200 transition-colors duration-200\">\r\n                      {authLoading ? (\r\n                        <svg className=\"h-4 w-4 text-red-500 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                        </svg>\r\n                      ) : (\r\n                        <svg className=\"h-4 w-4 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                        </svg>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-left\">\r\n                      <div className=\"font-semibold text-sm\">\r\n                        {authLoading ? 'Signing out...' : 'Sign out'}\r\n                      </div>\r\n                      <div className=\"text-xs text-gray-500\">End current session</div>\r\n                    </div>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Sidebar */}\r\n      <aside\r\n        className={`fixed top-16 left-0 z-40 w-64 h-[calc(100vh-4rem)] bg-white/95 backdrop-blur-xl border-r border-gray-200/50 transition-transform duration-300 ease-out shadow-2xl ${\r\n          sidebarOpen ? \"translate-x-0\" : \"-translate-x-full\"\r\n        } lg:translate-x-0`}\r\n      >\r\n        {/* Sidebar content */}\r\n        <div className=\"h-full overflow-y-auto py-3 scrollbar-thin scrollbar-thumb-blue-200 scrollbar-track-transparent hover:scrollbar-thumb-blue-300\">\r\n          <nav className=\"px-2 space-y-0.5\">\r\n            {sidebarItems.map((item, index) => {\r\n              // For items with submenu, don't mark parent as active, only check submenu items\r\n              const isActive = !item.hasSubmenu && (\r\n                pathname === item.href || (item.href !== \"/admin\" && pathname.startsWith(item.href) && !sidebarItems.some(otherItem => \r\n                  otherItem.href !== item.href && \r\n                  otherItem.href !== \"/admin\" && \r\n                  pathname.startsWith(otherItem.href) && \r\n                  otherItem.href.length > item.href.length\r\n                ))\r\n              );\r\n              \r\n              // Check if any submenu item is active\r\n              const isSubmenuActive = item.submenu?.some(subItem => pathname === subItem.href || pathname.startsWith(subItem.href));\r\n              const shouldShowSubmenu = item.hasSubmenu && (expenseMenuOpen || isSubmenuActive);\r\n              \r\n              return (\r\n                <div key={index}>\r\n                  {item.hasSubmenu ? (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        setExpenseMenuOpen(!expenseMenuOpen);\r\n                      }}\r\n                      className={`group flex items-center w-full px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${\r\n                        isSubmenuActive\r\n                          ? \"bg-gradient-to-r from-[#235999] to-[#1e4d87] text-white shadow-md shadow-blue-200/60\"\r\n                          : \"text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-[#235999]\"\r\n                      }`}\r\n                    >\r\n                      <div className={`mr-3 flex-shrink-0 transition-transform duration-200 ${isSubmenuActive ? 'scale-110' : 'group-hover:scale-105'}`}>\r\n                        <item.icon />\r\n                      </div>\r\n                      <span className=\"tracking-tight text-xs font-semibold flex-1 text-left\">{item.label}</span>\r\n                      <svg \r\n                        className={`w-4 h-4 transition-transform duration-200 ${shouldShowSubmenu ? 'rotate-180' : ''}`}\r\n                        fill=\"none\" \r\n                        stroke=\"currentColor\" \r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                      </svg>\r\n                    </button>\r\n                  ) : (\r\n                    <Link\r\n                      href={item.href}\r\n                      className={`group flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${\r\n                        isActive\r\n                          ? \"bg-gradient-to-r from-[#235999] to-[#1e4d87] text-white shadow-md shadow-blue-200/60\"\r\n                          : \"text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-[#235999]\"\r\n                      }`}\r\n                    >\r\n                      <div className={`mr-3 flex-shrink-0 transition-transform duration-200 ${isActive ? 'scale-110' : 'group-hover:scale-105'}`}>\r\n                        <item.icon />\r\n                      </div>\r\n                      <span className=\"tracking-tight text-xs font-semibold\">{item.label}</span>\r\n                      {isActive && (\r\n                        <div className=\"ml-auto w-1.5 h-1.5 bg-white rounded-full opacity-90\"></div>\r\n                      )}\r\n                    </Link>\r\n                  )}\r\n                  \r\n                  {/* Submenu */}\r\n                  {item.hasSubmenu && shouldShowSubmenu && (\r\n                    <div className=\"mt-1 ml-7 space-y-0.5 animate-in slide-in-from-top-2 duration-200\">\r\n                      {item.submenu?.map((subItem, subIndex) => {\r\n                        const isSubItemActive = pathname === subItem.href || pathname.startsWith(subItem.href);\r\n                        return (\r\n                          <Link\r\n                            key={subIndex}\r\n                            href={subItem.href}\r\n                            className={`group flex items-center px-3 py-2 text-xs font-medium rounded-lg transition-all duration-200 ${\r\n                              isSubItemActive\r\n                                ? \"bg-blue-100 text-[#235999]\"\r\n                                : \"text-gray-600 hover:bg-blue-50 hover:text-[#235999]\"\r\n                            }`}\r\n                          >\r\n                            <div className=\"mr-2 w-1.5 h-1.5 rounded-full bg-current opacity-60\"></div>\r\n                            <span>{subItem.label}</span>\r\n                          </Link>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </nav>\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Mobile sidebar overlay */}\r\n      {sidebarOpen && (\r\n        <div \r\n          className=\"fixed inset-0 z-30 bg-black/40 backdrop-blur-sm lg:hidden transition-all duration-300\" \r\n          onClick={() => setSidebarOpen(false)} \r\n        />\r\n      )}\r\n\r\n      {/* Main content */}\r\n      <main className=\"pt-16 lg:pl-64 min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30\">\r\n        <div className=\"p-6\">\r\n          <div className=\"max-w-7xl mx-auto\">\r\n            {children}\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]}]